"object"==typeof globalThis&&(globalThis.jsExecStartTimeStamp=Date.now()),(self.webpackChunkuni=self.webpackChunkuni||[]).push([[8624],{76158:function(t,e){e.Z={"list-overlay":"tdocs-list-overlay",listOverlay:"tdocs-list-overlay","list-overlay-layer":"tdocs-list-overlay-layer",listOverlayLayer:"tdocs-list-overlay-layer","list-overlay-selected":"tdocs-list-overlay-selected",listOverlaySelected:"tdocs-list-overlay-selected","list-overlay-list-selected":"tdocs-list-overlay-list-selected",listOverlayListSelected:"tdocs-list-overlay-list-selected","list-marker-lite":"tdocs-list-marker-lite",listMarkerLite:"tdocs-list-marker-lite","list-marker-text":"tdocs-list-marker-text",listMarkerText:"tdocs-list-marker-text"}},13616:function(t,e,r){r.d(e,{AG:function(){return p},Rs:function(){return c},a1:function(){return n},c9:function(){return g},fC:function(){return l},lW:function(){return d},oc:function(){return h}});var n,i=r(85556),o=r(2613);!function(t){t.anchorId="tdaci",t.extraData="tded"}(n||(n={}));var a,s={addonId:"tdadi",displayText:"tddt",width:"tdw",height:"tdh",link:"tdl",originUrl:"tdo",embedUrl:"tdeu",iframeId:"tdid",lockAspectRatio:o.FieldCommonSwitchesName.lockAspectRatio},l=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),n),s);!function(t){t.ERROR="error",t.DELETED="deleted",t.AUTH="auth",t.LOADING="loading",t.ICON="icon"}(a||(a={}));var c=(0,i.__assign)((0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),n),s),{type:"tdty",padId:"tdpid",subId:"tdsid"}),p=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),n),{addonId:"tdadi",width:"tdw",height:"tdh",url:"tdo",store:"tds",lockAspectRatio:"tdlar"}),u={height:"tdh",width:"tdw",fitToParent:"tdfpw",placeholder:"tdpd"},g=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),n),u),h=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),n),{height:"tdh",width:"tdw"}),d=[s.width,s.height,u.fitToParent,u.placeholder,s.lockAspectRatio]},595:function(t,e,r){r.d(e,{R2:function(){return s},a:function(){return p},fy:function(){return n},h_:function(){return u},hq:function(){return g},m_:function(){return l}});var n,i=r(85556),o=r(2613);!function(t){t.extraData="extraData",t.fileName="fileName",t.displayText="displayText"}(n||(n={}));var a,s,l,c,p={internalJump:"l"},u=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),{fileId:"tdfid",fileExt:"tdfe",fileType:"tdft",fileUrl:"tdfu",fileName:"tdfn",docPolicy:"tddp",fileDesc:"tdds",fileFavicon:"tdfvi",openType:"tdop",docLinkFrom:"tdlf",fileCreatorNick:"tdcnk"}),p),g=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},o.FieldCommonSwitchesName),{fileId:"tdfid",fileDesc:"tdds",fileFavicon:"tdfvi",fileName:"tdfn",internalJump:"l"}),p);!function(t){t[t.WxworkDefaultBrowser=1]="WxworkDefaultBrowser"}(a||(a={})),function(t){t.FromDialog="FromDialog",t.FromInput="FromInput",t.FromPaste="FromPaste",t.FromUploadFile="FromUploadFile"}(s||(s={})),function(t){t.Link="Link",t.Doc="Doc",t.Wedoc="Wedoc",t.Wedrive="Wedrive",t.Loading="Loading",t.ProgressLoading="ProgressLoading",t.Placeholder="Placeholder"}(l||(l={})),function(t){t[t.PRIVATE=0]="PRIVATE",t[t.PARTIAL=1]="PARTIAL",t[t.ALL=2]="ALL"}(c||(c={}))},48717:function(t,e,r){r.d(e,{G:function(){return n}});var n={canJump:"h",relativePosition:"p"}},17657:function(t,e,r){r.d(e,{Au:function(){return o},Dm:function(){return l},Uc:function(){return c},e8:function(){return a},m7:function(){return i}});var n,i,o,a,s=r(2613),l="toolbar-field";!function(t){t.Default="normalLink",t.File="file",t.Audio="audio",t.Video="video",t.Location="location",t.Calendar="calendar",t.Database="database",t.AddonIframe="addonIframe",t.TDSheetIFrame="tdSheetIframe",t.Attachment="attachment",t.NormalLink="normalLink",t.DocLink="docLink",t.AddonLink="addonLink",t.AddonHina="addonHina"}(i||(i={})),function(t){t[t.COLLAB_SPACE=-2]="COLLAB_SPACE",t[t.FOLDER_SHARE=-1]="FOLDER_SHARE",t[t.WORD=0]="WORD",t[t.EXCEL=1]="EXCEL",t[t.FORM=2]="FORM",t[t.FOLDER=3]="FOLDER",t[t.SLIDE=4]="SLIDE",t[t.NOTE=5]="NOTE",t[t.PDF=6]="PDF",t[t.MINIPROGRAM=7]="MINIPROGRAM",t[t.SMARTSHEET=8]="SMARTSHEET",t[t.FORM_JOURNAL=9]="FORM_JOURNAL",t[t.MIND=90]="MIND",t[t.FLOWCHART=91]="FLOWCHART",t[t.UNKNOWN=10]="UNKNOWN",t[t.DRIVE=101]="DRIVE",t[t.SMARTCANVAS=8e3]="SMARTCANVAS",t[t.NORMAL_LINK=-10]="NORMAL_LINK",t[t.WEDRIVE_TXT=1e3]="WEDRIVE_TXT",t[t.WEDRIVE_HTML=1001]="WEDRIVE_HTML",t[t.WEDRIVE_IMAGE=1002]="WEDRIVE_IMAGE",t[t.WEDRIVE_AUDIO=1003]="WEDRIVE_AUDIO",t[t.WEDRIVE_VIDEO=1004]="WEDRIVE_VIDEO",t[t.WEDRIVE_ZIP=1005]="WEDRIVE_ZIP",t[t.WEDRIVE_FONT=1006]="WEDRIVE_FONT",t[t.WEDRIVE_MAIL=1007]="WEDRIVE_MAIL",t[t.WEDRIVE_XMIND=1008]="WEDRIVE_XMIND",t[t.WEDRIVE_EXE=1009]="WEDRIVE_EXE",t[t.WEDRIVE_EXCEL=1010]="WEDRIVE_EXCEL",t[t.WEDRIVE_PPT=1011]="WEDRIVE_PPT",t[t.WEDRIVE_WORD=1012]="WEDRIVE_WORD",t[t.WEDRIVE_NUMBERS=1013]="WEDRIVE_NUMBERS",t[t.WEDRIVE_KEYNOTE=1014]="WEDRIVE_KEYNOTE",t[t.WEDRIVE_PAGES=1015]="WEDRIVE_PAGES",t[t.WEDRIVE_CAD=1016]="WEDRIVE_CAD",t[t.WEDRIVE_CDR=1017]="WEDRIVE_CDR",t[t.WEDRIVE_SW=1018]="WEDRIVE_SW",t[t.WEDRIVE_PSD=1019]="WEDRIVE_PSD",t[t.WEDRIVE_AI=1020]="WEDRIVE_AI",t[t.WEDRIVE_PDF=1021]="WEDRIVE_PDF",t[t.WEDRIVE_SKETCH=1022]="WEDRIVE_SKETCH",t[t.WEDRIVE_ANDROID=1023]="WEDRIVE_ANDROID",t[t.WEDRIVE_MAC=1024]="WEDRIVE_MAC",t[t.WEDRIVE_SVG=1025]="WEDRIVE_SVG",t[t.WEDRIVE_FOLDER=1026]="WEDRIVE_FOLDER",t[t.WEDRIVE_OTHER=1027]="WEDRIVE_OTHER",t[t.APP_LINK=2e3]="APP_LINK"}(o||(o={})),function(t){t[t.WORD=0]="WORD",t[t.EXCEL=1]="EXCEL",t[t.FORM=2]="FORM",t[t.FOLDER=3]="FOLDER",t[t.SLIDE=4]="SLIDE",t[t.NOTE=5]="NOTE",t[t.PDF=6]="PDF",t[t.MINI_PROGRAM=7]="MINI_PROGRAM",t[t.SMARTCANVAS=8]="SMARTCANVAS",t[t.SMARTSHEET=9]="SMARTSHEET",t[t.UNKNOW=10]="UNKNOW",t[t.RESUME=11]="RESUME",t[t.DRAWING=89]="DRAWING",t[t.MIND=90]="MIND",t[t.FLOWCHART=91]="FLOWCHART",t[t.FILE=100]="FILE",t[t.DRIVE=101]="DRIVE",t[t.SOGOU_SPEECH=102]="SOGOU_SPEECH",t[t.ADDON=110]="ADDON"}(a||(a={}));var c=40;(n={})[s.FieldCommonSwitchesName.key]="",n[s.FieldCommonSwitchesName.isEscape]=!1,n[s.FieldCommonSwitchesName.width]=600,n[s.FieldCommonSwitchesName.height]=400},9234:function(t,e,r){r.d(e,{Ao:function(){return P},Ie:function(){return v},P5:function(){return S},Po:function(){return y},Vo:function(){return T},Xn:function(){return h},YQ:function(){return g},_r:function(){return u},dt:function(){return b},s0:function(){return m},wV:function(){return C}});var n=r(2613),i=r(52739),o=r(30479),a=r(13616),s=r(595),l=r(48717),c=r(14740),p=i.default;function u(t){return function(e,r){return t([e],r).component}}function g(t){return function(e){return t(null,e).overrideStyle}}function h(t,e){if(void 0===e&&(e=0),(0,n.isFieldContainerBox)(t)){var r=n.CssUtil.boxSize(t),i=r.width,a=r.height;return{width:i?parseFloat(i):void 0,height:a?parseFloat(a):void 0}}var s=t.property,l=document.getElementById("melo-container-placeholder-".concat(null==s?void 0:s.anchorId));if(!l){var c=(0,o.twipsToPx)(s.drawing.extent.cx),p=(0,o.twipsToPx)(s.drawing.extent.cy);return s.drawing.cNvGraphicFramePr.graphicFrameLocks.noChangeAspect||(p*=e/c),{width:c=e,height:p}}var u=l.style,g=u.width,h=u.height;return{width:g?parseFloat(g):void 0,height:h?parseFloat(h):void 0}}var d=new RegExp("\\\\".concat(n.FieldCommonSwitchesName.key," (\\w+)"),"g"),f=new RegExp("\\\\".concat(a.a1.anchorId," (\\w+)"),"g"),y={isHighlightOnBackspace:!0,isHighlightOnHover:function(t){return t.layoutType===n.FieldLayoutType.Text},onHighlight:function(t,e){t.fire(new n.FieldCodeNotification(n.FieldCodeNotificationType.Highlight,e))},onCancelHighlight:function(t,e){t.fire(new n.FieldCodeNotification(n.FieldCodeNotificationType.cancelHighlight,e))},onPasteDelta:{fieldCode:function(t,e){return"string"==typeof e.param.text&&(e.param.text=e.param.text.replace(d,"\\".concat(n.FieldCommonSwitchesName.key," ").concat(o.StringUtil.generateRandomId())).replace(f,"\\".concat(a.a1.anchorId," ").concat(o.StringUtil.generateRandomId()))),e}}},v=function(t,e,r){var i,o=null===(i=r.fieldCode.switches)||void 0===i?void 0:i[n.FieldCommonSwitchesName.key];if(o)return o;var a=t.getIndexFromRange(e.getRange()),s=a.first,l=a.last;return"".concat(s,"-").concat(l)};function m(t,e){for(var r=e,i=t.service.getDocument();r>0&&i.getTextFromGcpRange(new n.GCPRange(r-1,1))===n.PlaceholderChar.CommentReference;)r-=1;return r-=1}function S(t){var e,r=t.name,i=t.instructions;return r!==n.FieldName.HYPERLINK?null:null!==(e=null==i?void 0:i[0])&&void 0!==e?e:null}function b(t,e,r){var n=null!=r?r:S(t.fieldCode);if(n)try{e.clipboardManager.writeToClipboard(n),p.show({message:(0,c.$t)("复制链接成功"),type:"success",autoClose:!0})}catch(t){p.show({message:(0,c.$t)("复制链接失败: ".concat(t)),type:"error",autoClose:!0})}else o.Logger.error("[HYPERLINK] 无法获取准确链接，造成无法复制链接")}function C(t){var e;if(S(t))return null;var r=null===(e=t.switches)||void 0===e?void 0:e[s.a.internalJump];return null!=r?r:null}function P(t){var e,r,n=null===(e=t.switches)||void 0===e?void 0:e[l.G.canJump],i=null===(r=t.instructions)||void 0===r?void 0:r[0];return n&&i?i:null}function T(t,e){var r=t.getCurrentState(),i=r.contextState,o=r.docViewType,a=r.isFocusHeaderFooter,s=r.isInHeaderFooter;return n.CssUtil.computeContainerStyles(e,null==i?void 0:i.clipInfo,o,a,s)}},59692:function(t,e,r){r.d(e,{Ds:function(){return i},Ld:function(){return o},Lk:function(){return d},xo:function(){return n}});var n,i,o,a=r(85556),s=r(2613),l=r(30479),c=r(75929),p=r(14740),u=r(21856),g=r(17657),h=r(595);!function(t){t[t.Mobile=1123]="Mobile",t[t.Pc=1600]="Pc"}(n||(n={})),function(t){t.image="img",t.width="image-wrapper-width",t.height="image-wrapper-height",t.originWidth="image-width",t.originHeight="image-height",t.id="attachmentId",t.cropBottom="image-blipFill-srcRect-b",t.cropLeft="image-blipFill-srcRect-l",t.cropRight="image-blipFill-srcRect-r",t.cropTop="image-blipFill-srcRect-t",t.rotateDegree="image-rotateDegree",t.sourceType="image-sourceType"}(i||(i={})),function(t){t[t.Toolbar=1]="Toolbar",t[t.ContextMenu=2]="ContextMenu"}(o||(o={}));var d=function(){function t(){}return t.isImageThumb=function(t){return!(!this.isValidQqadaptDomain(t)&&!this.isValidDocImageDomain(t))&&(t.indexOf("1123")>0||t.indexOf("1600")>0)},t.getImageThumb=function(t,e){if(!this.isValidQqadaptDomain(t)&&!this.isValidDocImageDomain(t)&&!this.isValidWecomDocImgDomain(t))return t;if(t.indexOf("type=image/gif")>0){var r=t.indexOf("type=image/gif")-1;return t.substring(0,r)}var n=(0,a.__read)(t.split("?"),1)[0];return this.isValidQqadaptDomain(t)?"".concat(n.substring(0,n.length-1)).concat(e):"".concat(n.substring(0,n.length),"?imageMogr2/thumbnail/").concat(e,"x>/ignore-error/1")},t.isValidDocImageDomain=function(t){if(!t||t.length<1)return!1;var e=new RegExp(u.X.getInstance().getConfig("custom.domains.validDocImageDomain"));return t.search(e)>=0},t.isValidQqadaptDomain=function(t){if(!t||t.length<1)return!1;var e=u.X.getInstance().getConfig("custom.domains.validAdaptDomain");return t.indexOf(e)>0},t.isValidWecomDocImgDomain=function(t){if(!t||t.length<1)return!1;var e=u.X.getInstance().getConfig("custom.domains.validWedocImageDomain"),r=u.X.getInstance().getConfig("custom.domains.validWeworkImageDomain");return t.indexOf(e)>0||t.indexOf(r)>0},t.copyErrorTips=function(){return l.PlatformUtil.isMac()?(0,p.$t)("图片粘贴不成功。试试单独复制原图并用Cmd+V粘贴，或导入文档。"):(0,p.$t)("图片粘贴不成功。试试单独复制原图并用Ctrl+V粘贴，或导入文档。")},t.isPlaceHolder=function(t){return t&&t.indexOf("blob:https")>=0},t.getMaxWidthFromLayoutBox=function(t){var e=0;return(0,s.isContainerBoxLite)(t)?t.parentBox&&(e=(0,l.pxToTwips)(s.CssUtil.computeParagraphWidth(t.parentBox))):e=t.rect.width,e},t.getAttachmentId=function(){return Math.random().toString(16).substr(2,8)},t.getImgElementByContainerBox=function(e){var r;if(!e||!(0,s.isImageBox)(e)&&!(0,s.isImageBoxLite)(e))return null;var n=t.getUniqueAnchorId(e),i=document.getElementById(n);if(!i){var o=e.__node__;return o&&"IMG"===(null===(r=null==o?void 0:o.children[0])||void 0===r?void 0:r.nodeName)?null==o?void 0:o.children[0]:null}var a=$(i)[0];return a&&a instanceof HTMLImageElement?a:null},t.getRotateStyle=function(t,e){var r=e.marginLeft,n=e.marginTop,i=e.originWidth,o=e.originHeight,a=s.PropertyImageUtil.getTranslateFromRotate(t,i,o),l=a.x,c=a.y;return{width:i,height:o,transformOrigin:"left top",transform:"translate(".concat(l.toFixed(4),"px, ").concat(c.toFixed(4),"px) ")+"rotate(".concat(t/s.DefaultsUnit.rotate,"deg) translate(").concat(r,"px, ").concat(n,"px)")}},t.dataURLToBlob=function(t){for(var e=t.split(";base64,"),r=(0,a.__read)(e[0].split(":"),2)[1],n=window.atob(e[1]),i=n.length,o=new Uint8Array(i),s=0;s<i;++s)o[s]=n.charCodeAt(s);return new Blob([o],{type:r})},t.isOCRAvailable=function(){return!1},t.sortImageAttributes=function(t){var e,r,n=[],i=[],o=[],p=[],u=[],g=[];try{for(var h=(0,a.__values)(t),d=h.next();!d.done;d=h.next()){var f=d.value,y=f.drawingProp,v=s.PropertyImageUtil.getImageProperty(y),m=v.imgSrc;if(!(""===m||v.sourceType&&c.JY[v.sourceType])&&"string"==typeof m){var S=this.getAuthCdnUrl(m);if(!y)continue;var b=this.getImageNatureSize(y.anchorId),C=b.naturalWidth,P=void 0===C?(0,l.twipsToPx)(v.originHeight):C,T=b.naturalHeight,R=void 0===T?(0,l.twipsToPx)(v.originWidth):T,_=(0,l.twipsToPx)(v.originHeight)/(0,l.twipsToPx)(v.originWidth),I=R>P?R/_:P,w=R>P?R:P*_,x={cropLeft:v.cropLeft/s.DefaultsUnit.percentage,cropRight:v.cropRight/s.DefaultsUnit.percentage,cropBottom:v.cropBottom/s.DefaultsUnit.percentage,cropTop:v.cropTop/s.DefaultsUnit.percentage};n.push({imageWidth:I,imageHeight:w}),p.push(x),i.push(S),o.push(f.getAnchorId()),u.push(v.rotateDegree/s.DefaultsUnit.rotate%360),g.push(f.getRange())}}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}return{imageSizeList:n,imageList:i,imageIdList:o,cropValueList:p,rotateList:u,gcpList:g}},t.getEntSortImageAttributes=function(t,e,r){void 0===r&&(r=!1);var n=[],i=this.sortImageAttributes(t),o=i.imageSizeList,a=i.imageIdList,s=i.imageList,l=i.cropValueList,c=i.rotateList,p=i.gcpList,u=this.getWedriveImageAttributes(e,r),h=u.imageList,d=u.fieldIdList,f=u.gcpList,y=u.nameList,v=u.fileExtList;function m(){var t=a.shift();return{type:"image",url:s.shift(),size:o.shift(),imageId:t,cropValue:l.shift(),rotate:c.shift(),gcp:p.shift(),id:t}}function S(){var t=f.shift(),e=t.begin();return{type:v.shift()==="".concat(g.Au.WEDRIVE_VIDEO)?"wedrive_video":"wedrive_image",url:h.shift(),fieldId:d.shift(),gcp:t,name:y.shift(),id:"".concat(e,"gcp")}}for(;a.length>0&&d.length>0;)p[0].begin()<f[0].begin()?n.push(m()):n.push(S());for(;a.length>0;)n.push(m());for(;d.length>0;)n.push(S());return n},t.getFileExt=function(t){var e=/.*\.(.*)$/.exec(t);return(null==e?void 0:e[1])||""},t.getWedriveImageAttributes=function(t,e){var r=this;void 0===e&&(e=!1);var n=[],i=[],o=[],s=[],l=[],c=t.getFields();return(0,a.__spreadArray)([],(0,a.__read)(c),!1).forEach((function(t){var a=t.getFieldInfo().fieldCode,c=a.switches?a.switches[h.h_.fileExt]:"";if(a.switches&&["".concat(g.Au.WEDRIVE_IMAGE),"".concat(g.Au.WEDRIVE_VIDEO)].includes(c)&&a.instructions){var p=a.switches[h.h_.fileName];if(e&&"tiff"===r.getFileExt(p))return;n.push(a.instructions[0]),i.push(a.switches[h.h_.fileId]),o.push(t.getRange()),s.push(p),l.push(c)}})),{imageList:n,fieldIdList:i,gcpList:o,nameList:s,fileExtList:l}},t.getReportModuleNameFromWrapType=function(t){return new Map([[s.WrapType.Inline,"in_line_with_text"],[s.WrapType.Square,"square"],[s.WrapType.TopAndBottom,"top_and_bottom"],[s.WrapType.Front,"in_front_of_text"],[s.WrapType.Behind,"behind_text"]]).get(t)},t.fixImageUrl=function(t){try{return(t||"").replace(/^(http:)|(https:)/g,"")}catch(t){console.error(t)}return t},t.getAuthCdnUrl=function(t){return t=null==t?void 0:t.replace("http://","https://")},t.getImageNatureSize=function(t){var e=document.getElementById(t);return{naturalWidth:null==e?void 0:e.naturalWidth,naturalHeight:null==e?void 0:e.naturalHeight}},t.getUniqueAnchorId=function(t){var e;if(!(0,s.isImageBox)(t)&&!(0,s.isImageBoxLite)(t))return"";var r=t.property.anchorId;if((0,s.isImageBoxLite)(t))return r;var n=t.getAncestorOf(s.BoxKind.HeaderFooter);if(!n)return r;var i=n.getAncestorOf(s.BoxKind.Page);return"".concat(r,"-").concat(null!==(e=null==i?void 0:i.getPageIndex())&&void 0!==e?e:0)},t.imageSizeInit=function(e,r){var n=r.height,i=r.width,o=r.range,a=e.onDocument().getRange(o.begin(),o.end()).getInlineShapes().item(0);if(a){var c=a.getProperty(),p=new(s.PropertyFactory.getPropertyClass(s.PropertyType.DrawingProperty)),u=!1,g=c.isFloating?p.anchor:p.inlineKeyword;n>0&&i>0&&(g.extent.cx=(0,l.twipsToEmu)(i),g.extent.cy=(0,l.twipsToEmu)(n),g.graphic.graphicData.pic.spPr.xfrm.ext.cx=p.drawing.extent.cx,g.graphic.graphicData.pic.spPr.xfrm.ext.cy=p.drawing.extent.cy,g.graphic.graphicData.pic.isNotAutoFitLayout=!1,u=!0),a.getAnchorId()||(p.anchorId=t.getAttachmentId(),u=!0),u&&a.setImageProperties(p,e.isEditable())}},t}()},27440:function(t,e,r){r.d(e,{Z:function(){return a}});var n=r(85556),i=r(87363),o=r.n(i);function a(t,e){return o().forwardRef((function(r,i){var a=o().useRef(null);return o().useImperativeHandle(i,(function(){return a.current})),o().createElement(o().Suspense,{fallback:null!=e?e:null},o().createElement(t,(0,n.__assign)({},r,{ref:a})))}))}},42094:function(t,e,r){r.d(e,{G:function(){return a},Q:function(){return o}});var n=r(2613),i=r(17657),o=function(){function t(){this.fieldCodeMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.add=function(t,e){this.fieldCodeMap.set(t,e)},t.prototype.get=function(t){return this.fieldCodeMap.get(t)},t.prototype.remove=function(t){return this.fieldCodeMap.delete(t)},t}(),a=function(t){var e,r=t.fieldCode,a=r.name;r.name===n.FieldName.HYPERLINK&&t.layoutType===n.FieldLayoutType.Text?a=i.m7.NormalLink:n.FieldUtil.isComplexField(r.switches)&&(a=null!==(e=n.FieldUtil.getComplexFieldSubType(r.switches))&&void 0!==e?e:a);var s=o.getInstance().get(a);return s?s(t):{}}},32854:function(t,e,r){r.d(e,{x:function(){return S}});var n=r(85556),i=r(87363),o=r.n(i),a=r(2613),s=r(26061),l=r(88560),c=r(29492),p="tdocs-fieldcode-component",u="tdocs-fieldcode-dropdown",g="tdocs-fieldcode-dropdown-button",h="tdocs-fieldcode-mouse-link",d="tdocs-fieldcode-dropdown-backdrop",f="tdocs-toolbar-button-arrow",y=r(14740),v=r(3139),m=r(50982),S=function(t){function e(e){var r=t.call(this,e)||this;return r.onMouseEnter=function(){var t=r.props,e=t.layoutBox,n=t.fieldInfo,i=e.content;if(n&&i&&((0,a.isTextBox)(i)||(0,a.isTextBoxLite)(i))){var o=i.text,s=r.fieldService.convertToFieldCodeInfo(n),l=a.FieldUtil.getComplexFieldSubType(s.switches),c=a.FieldCodeManager.getInstance().getFieldProcessor(s.name,l);if(!c)return;var p=c.getDropdownItems(s,o);(!c.isAutoUpdate||p.length>0)&&c.isShowDropdowns&&r.setState({showButton:!0,dropdowns:p,isAutoUpdate:c.isAutoUpdate}),c.isShowHover&&r.setState({showBackground:!0})}},r.onMouseLeave=function(){r.setState({showBackground:!1,showButton:!1,showDropdown:!1})},r.handleDropdownClick=function(){r.setState({showDropdown:!0});var t=r.props.fieldInfo;if(t){var e=r.fieldService.convertToFieldCodeInfo(t),n=a.FieldUtil.getComplexFieldSubType(e.switches),i=a.FieldCodeManager.getInstance().getFieldProcessor(e.name,n);if(!i)return;i.afterShowDropdown()}},r.hideDropdown=function(){r.setState({showDropdown:!1,showBackground:!1,showButton:!1})},r.handleMenuClick=function(t){var e;if("update-field"!==t){var n=parseInt(t.replace("field-dropdown-",""),10),i=(null!==(e=r.props.fieldInfo)&&void 0!==e?e:{}).fieldRange;if(n>=0&&i){var o=r.state.dropdowns[n].onClick;o&&o(i)}r.hideDropdown()}else r.hideDropdown()},r.handleFieldClick=function(t){var e=r.props,n=e.layoutBox,i=e.fieldInfo;if(i){var o=r.fieldService.convertToFieldCodeInfo(i),s=a.FieldUtil.getComplexFieldSubType(o.switches),l=a.FieldCodeManager.getInstance().getFieldProcessor(o.name,s);if(!l)return;l.handleFieldClick(o,n,t)}},r.rootRef=o().createRef(),r.state={showBackground:!1,showButton:!1,showDropdown:!1,dropdowns:[],isAutoUpdate:!1},r}var r;return(0,n.__extends)(e,t),e.prototype.render=function(){var t=this.props,e=t.children,r=t.overrideStyle;return o().createElement("span",{style:(0,n.__assign)({background:this.state.showBackground?"#d1e6fc":void 0},a.CssUtil.cssPropsToStyle(r)),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:this.handleFieldClick,className:p,ref:this.rootRef},this.state.showButton&&o().createElement(l.default,{dropContent:o().createElement(c.default,{style:{width:110,transform:"translate(-50%, 0)",position:"relative",left:7},onClick:this.handleMenuClick},!this.state.isAutoUpdate&&o().createElement(c.default.Item,{id:"update-field"},(0,y.$t)("更新域")),!this.state.isAutoUpdate&&this.state.dropdowns.length>0&&o().createElement(s.default,null),this.state.dropdowns.map((function(t,e){return o().createElement(c.default.Item,{className:t.checked?"checked":"",key:"field-dropdown-".concat(e),id:"field-dropdown-".concat(e)},t.content)}))),visible:this.state.showDropdown,className:u},o().createElement("button",{className:"".concat(g," ").concat(f),onClick:this.handleDropdownClick})),this.state.showButton&&o().createElement("div",{className:h}),this.state.showDropdown&&o().createElement("div",{className:d,onClick:this.hideDropdown}),e)},(0,n.__decorate)([(0,v.tB)(),(0,n.__metadata)("design:type","function"==typeof(r=void 0!==m.D&&m.D)?r:Object)],e.prototype,"fieldService",void 0),e}(i.Component)},15510:function(t,e,r){r.d(e,{Cy:function(){return o},ZH:function(){return s},_b:function(){return a}});var n=r(2613),i=r(30479),o=function(){function t(){this.fieldCodeParserMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getRegisteredParser=function(t){return this.fieldCodeParserMap.get(t)},t.prototype.registerFieldCodeParser=function(t,e){this.fieldCodeParserMap.set(t,e)},t.prototype.removeFieldCodeParser=function(t){this.fieldCodeParserMap.delete(t)},t}(),a=function(t,e){var r=(0,n.makeEmptyCopyData)();if(!t.fieldProps)return r;var a=o.getInstance().getRegisteredParser(t.fieldProps.fieldCode.name);if(!a){var s=t.getResultNode({});if(s){var l="".concat((0,i.escapeHTML)(s.getTextContent()));return{html:l,plain:l,refText:l}}return r}return a(t,e)};function s(t,e){o.getInstance().registerFieldCodeParser(t,(function(t,r){var o=(0,n.makeEmptyCopyData)();if(!t.fieldProps)return o;var a=e(t.fieldProps);if(!a)return o;var s=(0,i.escapeHTML)(a);return{html:s,plain:s,refText:s}}))}},75929:function(t,e,r){r.d(e,{Ew:function(){return u},JY:function(){return p},X9:function(){return l},b3:function(){return s},lb:function(){return c}});var n,i,o=r(14740),a=r(2613),s=(r(30479),(n={})[a.STAddonSourceType.none]="image-needhover",n[a.STAddonSourceType.undefined]="image-needhover",n[a.STAddonSourceType.sign]="image-needhover",n[a.STAddonSourceType.latex]="",n[a.STAddonSourceType.signbar]="image-signbar",n),l=function(t){var e,r,n=t.isEditable,i=t.isOcr,o=((e={"":"move"})[a.STAddonSourceType.none]="zoom-in",e[a.STAddonSourceType.undefined]="zoom-in",e[a.STAddonSourceType.sign]="zoom-in",e[a.STAddonSourceType.latex]="default",e[a.STAddonSourceType.signbar]="pointer",e),s=((r={"":{move:n,default:i}})[a.STAddonSourceType.none]={move:n,default:i},r[a.STAddonSourceType.undefined]={move:n,default:i},r[a.STAddonSourceType.sign]={move:n,default:i},r[a.STAddonSourceType.latex]={move:n},r[a.STAddonSourceType.signbar]={default:i},r);return Object.keys(s).forEach((function(t){return Object.keys(s[t]).forEach((function(e){s[t][e]&&(o[t]=e)}))})),o},c=function(t){var e;return(e={})[a.STAddonSourceType.signbar]={originWidth:t,originHeight:96,marginTop:0,marginLeft:0},e},p=((i={})[a.STAddonSourceType.signbar]=!0,i[a.STAddonSourceType.latex]=!0,i),u=function(t,e){if(t!==a.STAddonSourceType.signbar)return{imageUrl:void 0,customActionButtonRect:void 0};var r=Math.max(window.devicePixelRatio||1,1),n=document.createElement("canvas");n.width=e*r,n.height=96*r;var i=n.getContext("2d"),s=(0,o.$t)("e-signature:click-to-sign"),l="#1e6fff";i.fillStyle=l;var c=a.CssUtil.parseFontFamily("");i.font="bold ".concat(17*r,'px "').concat(c,'"'),i.textBaseline="top";var p=i.measureText(s);i.fillText(s,(n.width-p.width)/2,26*r);var u=(0,o.$t)("e-signature:e-signature-message-full"),g="rgba(0, 0, 0, 0.24)";i.fillStyle=g,i.font="".concat(12*r,'px "').concat(c,'"');var h=i.measureText(u);i.translate((n.width-h.width)/2,0);var d=(0,o.$t)("e-signature:e-signature-message-left"),f=i.measureText(d);i.fillText(d,0,55*r);var y=(0,o.$t)("e-signature:e-signature-message-middle"),v=i.measureText(y);i.fillStyle=l,i.fillText(y,f.width,55*r);var m=(0,o.$t)("e-signature:e-signature-message-right");return i.fillStyle=g,i.fillText(m,f.width+v.width,55*r),{imageUrl:n.toDataURL(),customActionButtonRect:{left:((n.width-h.width)/2+f.width)/r,top:49,width:v.width/r,height:24}}}},75400:function(t,e,r){r.d(e,{U:function(){return i},s:function(){return o}});var n=r(2613);function i(t){return!(t.docEnv.layoutType!==n.LayoutType.Paged)}function o(t){return t.selection.subStoryInfo.storyProp.storyType===n.STStoryType.mainDocument&&t.docEnv.layoutType===n.LayoutType.Paged&&!t.onSelection().isInTable()}},25251:function(t,e,r){var n;r.d(e,{RY:function(){return g},SA:function(){return i},Vu:function(){return o},Y1:function(){return s},jY:function(){return a},o4:function(){return l},pR:function(){return c},qy:function(){return p}});var i,o,a="toolbar_mode_doc",s="immersive-toggle";!function(t){t.SINGLE="single",t.DOUBLE="double"}(i||(i={})),function(t){t.SINGLE="single-line-toolbar",t.DOUBLE="double-line-toolbar",t.IMMERSIVE="immersive-toolbar"}(o||(o={}));var l,c="toolbarLine",p="dynamicToolbarSchema",u=(null===(n=null===window||void 0===window?void 0:window.location)||void 0===n?void 0:n.hostname)?"//".concat(window.location.hostname,"/"):"//docs.qq.com/",g=("".concat(u,"v2/user/attribute/get"),"https:".concat(u,"v2/user/attribute/update"));!function(t){t.UNDO="undo",t.REDO="redo",t.FORMAT_PAINT="format-paint",t.CLEAR_FORMAT="clear-format",t.INSERT="toolbar-insert",t.HEADING="heading",t.FONT="font",t.FONT_SIZE="font-size",t.FONT_SIZE_INCREASE="font-size-increase",t.FONT_SIZE_DECREASE="font-size-decrease",t.BOLD="bold",t.ITALIC="italic",t.UNDERLINE="underline",t.STRIKE="strike-through",t.SUB="sub",t.SUP="sup",t.LETTER_SPACING="letter-spacing",t.FONT_BACKGROUND_COLOR="font-background-color",t.FONT_COLOR="font-color",t.BULLET_LIST="bullet-list",t.NUMBERED_LIST="numbered-list",t.TASK_LIST="task-list",t.DESC_INDENT="desc-indent",t.INC_INDENT="inc-indent",t.ALIGNMENT="alignment",t.ALIGNMENT_LEFT="align-left",t.ALIGNMENT_CENTER="align-center",t.ALIGNMENT_RIGHT="align-right",t.ALIGNMENT_JUSTIFY="align-justify",t.ALIGNMENT_DISTRIBUTE="align-distribute",t.LINE_HEIGHT="line-height",t.CELL_COLOR="cell-color",t.CELL_BORDER="cell-border",t.ALIGN_VERTICAL="align-vertical",t.CELL_MERGE="cell-merge",t.ROTATE_IMAGE="rotate-image",t.IMAGE_CROPPER="image-cropper",t.IMAGE_RESET="image-reset",t.IMAGE_INSERT="insert-image",t.PAGE_SETTINGS="page-settings",t.UNOFFICIAL_ADDONS="unofficial-addons",t.FIND_REPLACE="find-replace",t.TOGGLE="toolbar-toggle",t.AVATAR="avatar",t.TITLE_BAR_TOGGLE="tiltebar-toggle",t.FONT_SHELTER="font-shelter",t.PARAGRAPH_SHELTER="paragraph-shelter",t.IMAGE_SHELTER="image-shelter",t.TABLE_SHELTER="table-shelter",t.SINGLE_FONT_SHELTER="single-font-shelter",t.INSERT_MENTION_ENT="insert-mention-ent",t.MENU_QUOTE="menu-quote",t.PARAGRAPH_LIGHTBLOCK="paragraph-lightblock",t.BACKGROUND="background",t.SET_PERMISSION_RANGE="set-permission-range",t.DELETE_PERMISSION_RANGE="delete-permission-range",t.PDF_TRANSFORM="pdf-transform",t.GENERATE_IMAGE="generate-image",t.FORMAT_CONVERSION_SHELTER="format-conversion-shelter"}(l||(l={}))},18819:function(t,e,r){r.d(e,{k:function(){return n}});var n=function(){function t(){this.clients=new Map,this.stickyActions=new Map}return t.prototype.addClient=function(t,e){if(!this.clients.has(t)){this.clients.set(t,e);var r=this.stickyActions.get(t);r&&r.forEach((function(t){return e.onAction(t)}))}},t.prototype.get=function(t){var e=this.clients.get(t);return null==e?void 0:e.get()},t.prototype.sendAction=function(t,e,r,n){void 0===r&&(r=!0),void 0===n&&(n=!1);var i=this.clients.get(t);if(i)i.onAction(e);else if(r){var o=this.stickyActions.get(t);if(o){if(!n){var a=o.findIndex((function(t){return t.type===e.type}));a>=0&&o.splice(a,1)}}else o=[];o.push(e),this.stickyActions.set(t,o)}},t}()},99766:function(t,e,r){var n;r.d(e,{W0:function(){return a},kO:function(){return o},oS:function(){return i},zE:function(){return n}}),function(t){t[t.DatabaseProxy=0]="DatabaseProxy",t[t.List=1]="List",t[t.Splitline=2]="Splitline",t[t.Codeblock=3]="Codeblock",t[t.Location=4]="Location",t[t.Addon=5]="Addon",t[t.Hint=6]="Hint",t[t.AddonLink=7]="AddonLink",t[t.HyperLink=8]="HyperLink",t[t.Attachment=9]="Attachment",t[t.DocLink=10]="DocLink",t[t.ParagraphMenu=11]="ParagraphMenu",t[t.ParagraphMenuButton=12]="ParagraphMenuButton",t[t.NormalLink=13]="NormalLink",t[t.AttachmentPreview=14]="AttachmentPreview",t[t.LightBlock=15]="LightBlock",t[t.Shape=16]="Shape",t[t.DateReminder=17]="DateReminder",t[t.WxworkGroupChat=18]="WxworkGroupChat",t[t.WxworkGroupContactCard=19]="WxworkGroupContactCard",t[t.WxworkMemberContactCard=20]="WxworkMemberContactCard",t[t.WxworkCalender=21]="WxworkCalender",t[t.WxworkApp=22]="WxworkApp",t[t.WxworkMeeting=23]="WxworkMeeting",t[t.WxworkColdStartButton=24]="WxworkColdStartButton"}(n||(n={}));var i="add_bridge",o="add_deferred_bridge",a="add_field_code_bridge"},47818:function(t,e,r){r.d(e,{B:function(){return s}});var n=r(27623),i=r(2613),o=r(59692),a=(r(30479),function(){function t(){this.imagePlaceholderCache=new Map}return t.prototype.draw=function(t,e){var r=this.generateDrawingViewOptions(t,e),n=i.PoolNodeFactory.obtain(i.IDrawingView,r),o=this.getDrawingViewPriorityType(e);t.addView(n,o)},t.prototype.generateDrawingViewOptions=function(t,e){var r=i.PropertyImageUtil.getImageProperty(e.property),a=r.rotateDegree,s=r.effectExtent,l=r.imgSrc,c=r.cropTop,p=r.cropRight,u=r.cropBottom,g=r.cropLeft,h=r.width,d=r.height,f=r.containerWidth,y=r.containerHeight,v=(0,i.isFloatingBox)(e)?Number.POSITIVE_INFINITY:o.Lk.getMaxWidthFromLayoutBox(e);if(f>v){var m=v/f;h*=m,d*=m,f=v,y*=m}var S,b=t.getCurrentState(),C=b.docViewType,P=b.isFocusHeaderFooter,T=b.isInHeaderFooter,R=b.contextState,_=b.viewRegion,I=b.offset,w=i.CssUtil.computeHeaderFooterFocusStyles(C,P,T).opacity,x=void 0===w?1:w,E=o.Lk.isPlaceHolder(l);return E&&this.imagePlaceholderCache.set(e.key,l),S=0===d||0===h||E?void 0:o.Lk.getImageThumb(l,o.xo.Pc),{frame:{left:I.x+(f-h)/2,top:I.y+(y-d)/2-_.y,width:h,height:d,flipH:!1,flipV:!1,rotate:a/i.DefaultsUnit.rotate},path:{type:n.wf.RECT},effectExtent:s,fillStyle:{imageFill:{src:null!=S?S:l,alpha:x,rotateWithShape:!0,stretch:{srcRect:{b:u/i.DefaultsUnit.percentage,t:c/i.DefaultsUnit.percentage,l:g/i.DefaultsUnit.percentage,r:p/i.DefaultsUnit.percentage}}}},contextState:R,placeholderImageSrc:E?void 0:this.imagePlaceholderCache.get(e.key),containerWidth:f,containerHeight:y}},t.prototype.getDrawingViewPriorityType=function(t){var e;return(null===(e=t.property)||void 0===e?void 0:e.anchor.behindDoc)?i.RenderPriorityConfig.behindTextImage:i.RenderPriorityConfig.inFrontOfTextImage},t}());function s(){return new a}},91156:function(t,e,r){r.d(e,{t:function(){return l},A:function(){return c}});var n=r(87363),i=r.n(n),o=r(27440),a=i().lazy((function(){return Promise.all([r.e(1800),r.e(7200)]).then(r.bind(r,41234)).then((function(t){return{default:t.RenderImageWrapper}}))})),s=(0,o.Z)(a);function l(){return function(t,e,r){return i().createElement(s,{context:r,layoutBox:t,containerFocus:e})}}function c(){return function(t,e,r){return i().createElement(s,{context:r,layoutBox:t,containerFocus:e})}}},86461:function(t,e,r){r.d(e,{R:function(){return c}});var n=r(85556),i=r(87363),o=r.n(i),a=r(2613),s=r(30479),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,n.__extends)(e,t),Object.defineProperty(e.prototype,"listInfo",{get:function(){var t=this.props.layoutBox.lineBox;if(t){var e=t.parentBox;if(e)return e.property}},enumerable:!1,configurable:!0}),e.prototype.getRenderMetric=function(){var t=this.props.layoutBox.edge,e=(0,s.twipsToPx)(this.props.layoutBox.rect.width),r=(0,s.twipsToPx)(t.padding.right);return t.recycle(),{markWidth:e,width:e+r}},e}(r(62533).w);function c(t){return function(e,r){return e instanceof a.ListLineBox&&e.listMark?o().createElement(l,{key:r,layoutBox:e.listMark,bridge:t}):null}}},62533:function(t,e,r){r.d(e,{w:function(){return p}});var n=r(85556),i=r(87363),o=r.n(i),a=r(2613),s=r(76158),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ref=o().createRef(),e.onNativeTouchSelect=function(t){t.stopPropagation(),t.preventDefault(),e.props.onSelect(e)},e._onMouseSelect=function(t){t.stopPropagation(),t.preventDefault(),0===t.button&&e.props.onSelect(e)},e}return(0,n.__extends)(e,t),e.prototype.render=function(){return o().createElement("div",{ref:this.ref,className:s.Z["list-overlay"],style:(0,n.__assign)({width:this.props.width},this.props.textStyle),onMouseDown:this._onMouseSelect},this.props.text||"")},e.prototype.componentDidMount=function(){var t;null===(t=this.ref.current)||void 0===t||t.addEventListener("touchstart",this.onNativeTouchSelect)},e.prototype.componentWillUnmount=function(){var t;null===(t=this.ref.current)||void 0===t||t.removeEventListener("touchstart",this.onNativeTouchSelect)},e}(o().Component),c=function(t){function e(e){var r=t.call(this,e)||this;return r._onCancel=function(){r.props.bridge.instance.sendAction(r.props.bridge.key,{type:"select_cancel",data:null})},r.state={isListSelected:!1,isSelected:!1},r}return(0,n.__extends)(e,t),e.prototype.componentDidMount=function(){this.update(this.props.listId,this.props.listLevel,this.props.order)},e.prototype.shouldComponentUpdate=function(t,e){return this.update(t.listId,t.listLevel,t.order,this.props.listId,this.props.listLevel),this.state.isSelected!==e.isSelected||this.state.isListSelected!==e.isListSelected||this.props.markWidth!==t.markWidth},e.prototype.componentWillUnmount=function(){this.update("",-1,-1,this.props.listId,this.props.listLevel)},e.prototype.render=function(){var t=this.props.enableExtendOverlay?{}:{minWidth:this.props.width,width:"auto"},e=o().createElement("div",{className:this.state.isListSelected?s.Z["list-overlay-list-selected"]:s.Z["list-overlay-layer"],style:t},o().createElement("div",{ref:this.ref,className:this.state.isSelected?s.Z["list-overlay-selected"]:"".concat(s.Z["list-overlay-layer"]),style:(0,n.__assign)({width:this.props.markWidth},this.props.textStyle),onMouseDown:this._onMouseSelect},this.props.text||""));return this.props.enableExtendOverlay?o().createElement("div",{className:s.Z["list-overlay"],style:{width:2*this.props.width},onMouseDown:this._onCancel,onTouchStart:this._onCancel},e):e},e.prototype.update=function(t,e,r,n,i){void 0===n&&(n=""),void 0===i&&(i=-1),t===n&&e===i||this.props.bridge.instance.sendAction(this.props.bridge.key,{type:"dom_update",data:{prevListId:n,prevListLevel:i,listId:t,listLevel:e,listOrder:r,ref:this}},!0,!0)},e}(l),p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.renderTextInOverlay=!1,e.enableExtendOverlay=!0,e}return(0,n.__extends)(e,t),e.prototype.render=function(){var t=this,e=this.listInfo;if(e){var r=(0,n.__assign)({},a.CssUtil.cssPropsToStyle(a.CssUtil.computeStyles(e.listMarkerSpanProp).cssProperties));r.fontFamily&&e.listMarkerSpanProp&&!e.listMarkerSpanProp.fontFamily&&(r.fontFamily=void 0);var i=this.getRenderMetric(),p=i.width,u=i.markWidth,g=i.wrapperStyles,h=i.className,d=null;return this.props.bridge&&(d=e.isTask?o().createElement(l,{width:p,onSelect:function(){return t.onSelect(e)},text:this.renderTextInOverlay?e.actualText:void 0,textStyle:this.renderTextInOverlay?r:void 0}):o().createElement(c,{width:p,listId:e.listId,listLevel:e.listLevel,order:e.order,markWidth:u,bridge:this.props.bridge,enableExtendOverlay:this.enableExtendOverlay,onSelect:function(r){return t.onSelect(e,r)},text:this.renderTextInOverlay?e.actualText:void 0,textStyle:this.renderTextInOverlay?r:void 0})),o().createElement("span",{className:h,style:g},d,this.renderTextInOverlay?null:o().createElement("span",{className:s.Z["list-marker-text"],style:(0,n.__assign)({width:p},r)},e.actualText))}return null},e.prototype.onSelect=function(t,e){this.props.bridge&&this.props.bridge.instance.sendAction(this.props.bridge.key,{type:"select",data:{list:t,overlay:e}})},e}(o().Component)},27587:function(t,e,r){r.d(e,{$:function(){return i}});var n=r(2613),i=function(t){var e={};return t&&t.firstChild instanceof n.ListLineBox&&t.firstChild.listMark&&t.property.numPr.numId&&t.property.taskPr.taskState===n.STTaskState.done&&(e={opacity:.3,textDecoration:"line-through",textDecorationColor:"black"}),e}},98415:function(t,e,r){r.d(e,{A:function(){return i}});var n=r(87363),i=r.n(n)().createContext({})},11935:function(t,e,r){r.d(e,{W:function(){return u},c:function(){return g}});var n=r(87363),i=r.n(n),o=r(2613),a=r(30479),s=r(98415),l=r(15398),c=r(66280),p=function(){var t,e,r,p,u,g,h=(0,n.useContext)(s.A),d=function(){var t,e,r=h.paragraphBox,n=null==r?void 0:r.prevSibling,i=null==r?void 0:r.nextSibling,s=(0,o.isParagraphBox)(n)&&n.property.blockQuote,c=(0,o.isParagraphBox)(i)&&i.property.blockQuote;return function(t){var e=(0,l.J6)(h.paragraphBox),r=(0,l.x_)(null==e?void 0:e.nextSibling),n=(0,l.py)(null==e?void 0:e.prevSibling),i=n&&n.property.paraId===h.boxId,o=r&&r.property.paraId===h.boxId;return{top:i?0:t.top,bottom:o?0:t.bottom}}({top:s?(0,a.twipsToPx)(null!==(t=null==r?void 0:r.property.spacing.before)&&void 0!==t?t:0):0,bottom:c?(0,a.twipsToPx)(null!==(e=null==r?void 0:r.property.spacing.after)&&void 0!==e?e:0):0})};return i().createElement("div",{className:"paragraph-quote-container",style:{height:h.height,width:h.width,position:"absolute"}},i().createElement("div",{className:"paragraph-quote-line",style:(e=h.paragraphBox,r=d(),p=r.top,u=r.bottom,g=!!(null==e?void 0:e.getAncestorOf(o.BoxKind.HeaderFooter))==!!(null===(t=h.ctx)||void 0===t?void 0:t.getCurrentState().isFocusHeaderFooter)?1:.4,{position:"absolute",backgroundColor:c.Cm,width:"2px",height:"calc(100% + ".concat(p+u,"px)"),top:"".concat(-p,"px"),left:0,opacity:g})}))},u=function(){function t(t){this.editor=t}return t.prototype.draw=function(t,e){if(this.shouldRender(e)){var r=e.property;this.addComponent(t,r,e)}},t.prototype.addComponent=function(t,e,r){var n,l,c=null!==(l=null===(n=r.edge)||void 0===n?void 0:n.left)&&void 0!==l?l:0,u=(0,o.makeFrame)(-c,0,r.rect.width+c,r.rect.height),g={paragraphBox:r,boxId:e.paraId,editor:this.editor,height:(0,a.twipsToPx)(u.height),width:(0,a.twipsToPx)(u.width),ctx:t},h=o.PoolNodeFactory.obtain(o.IComponentView,"paragraph-quote-render-".concat(e.paraId,"-").concat(r.uuid),u,i().createElement(s.A.Provider,{value:g},i().createElement(p,null)));t.addView(h)},t.prototype.shouldRender=function(t){return!(!(0,o.isParagraphBox)(t)||t.hidden||(0,l.Vs)(t)||!t.property.blockQuote)},t}();function g(t){return new u(t)}},15398:function(t,e,r){r.d(e,{J6:function(){return y},Rp:function(){return d},Vs:function(){return p},ZK:function(){return f},dD:function(){return g},fz:function(){return c},g9:function(){return h},h0:function(){return l},hP:function(){return u},py:function(){return m},xN:function(){return S},x_:function(){return v}});var n=r(85556),i=r(30479),o=r(2613),a=r(86538),s=r(75400);function l(t){var e,r=(null===(e=t.getRoot())||void 0===e?void 0:e.getBoundingClientRect().x)||0,n=t.service.getDocument().getRange(0,0).getSectionFormat();return r+(0,i.twipsToPx)(n.getMarginLeft())/2-206>=0}var c=function(t){var e;return!!(0,a.tJ)(null===(e=t.parentBox)||void 0===e?void 0:e.parentBox)};function p(t){var e;return!!(0,a.tJ)(null===(e=t.firstChild)||void 0===e?void 0:e.firstChild)}function u(t,e){if(!(0,s.U)(t))return!1;var r=e.parentBox;if((null==r?void 0:r.lastChild)!==e)return!1;var n=e.getRange();return"\r"!==t.state.getTextStream().readText(n.end()-1,1)}function g(t,e){if(!(0,s.U)(t))return!1;var r=e.parentBox;if((null==r?void 0:r.firstChild)!==e)return!1;var n=e.getRange();return 0!==n.begin()&&"\r"!==t.state.getTextStream().readText(n.begin()-1,1)}function h(t){var e;return(0,a.$5)(null===(e=t.parentBox)||void 0===e?void 0:e.parentBox)}function d(t){return!!t.getAncestorOf(o.BoxKind.HeaderFooter)}function f(t,e){var r=e.getRange(),i=t.service.getDocument().getRange(r.begin(),r.begin()),o=(0,n.__read)(i.getFieldRanges(),1)[0];if(o&&(o.fieldRange.begin()<r.begin()||o.fieldRange.end()>r.end()))return!0;var a=t.service.getDocument().getRange(r.end()-1,r.end()-1),s=(0,n.__read)(a.getFieldRanges(),1)[0];return!(!s||!(s.fieldRange.begin()<r.begin()||s.fieldRange.end()>r.end()))}function y(t){return null==t?void 0:t.getAncestorOf(o.BoxKind.Page)}function v(t){return null==t?void 0:t.getFirstDescendantOf(o.BoxKind.Paragraph,(function(t){return t.firstVisibleChild}))}function m(t){return null==t?void 0:t.getLastDescendantOf(o.BoxKind.Paragraph,(function(t){return t.lastVisibleChild}))}function S(t){var e,r=null===(e=t.children[0])||void 0===e?void 0:e.children[0];return t.children.length<=1&&(0,a.tJ)(r)}},66280:function(t,e,r){r.d(e,{Cm:function(){return s},QG:function(){return c}});var n=r(85556),i=r(87363),o=r.n(i),a=r(2613),s="#1E6FFF",l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,n.__extends)(e,t),e.prototype.getQuoteLineStyle=function(){var t,e,r=a.CssUtil.computeParagraphStyles(this.props.layoutBox,this.props.layoutBox.property),n=r.paddingLeft,i=r.paddingTop,o=void 0===i?"0px":i,l=r.paddingBottom,c=void 0===l?"0px":l,p=null===(t=this.props.layoutBox.nextSibling)||void 0===t?void 0:t.property;p instanceof a.PropertyFactory.getPropertyClass(a.PropertyType.ParagraphProperty)&&p.blockQuote||(c="0px");var u=null===(e=this.props.layoutBox.prevSibling)||void 0===e?void 0:e.property;return u instanceof a.PropertyFactory.getPropertyClass(a.PropertyType.ParagraphProperty)&&u.blockQuote||(o="0px"),{height:"calc(100% + ".concat(o," + ").concat(c,")"),width:"calc(100% + ".concat(n,")"),top:"-".concat(o),left:"-".concat(n),borderLeft:"2px solid ".concat(s),backgroundColor:"rgba(255, 255, 255, 0.24)",position:"absolute",pointerEvents:"none"}},e.prototype.render=function(){return o().createElement("div",{style:this.getQuoteLineStyle()})},e}(o().Component);function c(t){var e;return(null===(e=null==t?void 0:t.property)||void 0===e?void 0:e.blockQuote)?(0,a.isTextFrameBoxLite)(t.firstChild)?null:o().createElement(l,{layoutBox:t}):null}},23777:function(t,e,r){r.d(e,{P:function(){return o}});var n=r(85556),i=r(9234),o=function(){function t(){var t=this;this.addUpsertConfigCallback=function(e,r,n){void 0===n&&(n=!0),t.upsertCallback.set(e,r),n&&t.fieldRenderConfig.forEach((function(t){return r(t)}))},this.deleteUpsertConfigCallback=function(e){t.upsertCallback.delete(e)},this.upsertFieldRenderConfig=function(e,r){var i=e.name,o=e.subtype,a=o?"".concat(i,"-").concat(o):i,s=t.fieldRenderConfig.get(a),l=e;!r&&s&&(l=(0,n.__assign)((0,n.__assign)((0,n.__assign)({},s),e),{render:t.mergeRenderConfig(s.render,e.render)})),t.fieldRenderConfig.set(a,l),t.upsertCallback.forEach((function(t){return t(l)}))},this.parseRenderConfig=function(t){var e,r=null!==(e=null==t?void 0:t.textRenderConfig)&&void 0!==e?e:t;return"children"in r?{containerRenderConfig:r}:{textRenderConfig:r,containerRenderConfig:"containerRenderConfig"in t?t.containerRenderConfig:void 0}},this.upsertFieldHookConfig=function(e,r){var o=e.name,a=e.subtype,s=a?"".concat(o,"-").concat(a):o,l=(0,n.__assign)((0,n.__assign)((0,n.__assign)({},i.Po),r?{}:t.fieldHookConfig.get(s)),e);t.fieldHookConfig.set(s,l)},this.getFieldRenderConfig=function(e){return t.fieldRenderConfig.get(e)},this.getFieldHookConfig=function(e,r){var o=r?"".concat(e,"-").concat(r):e,a=t.fieldHookConfig.get(o);return!a&&r&&(a=t.fieldHookConfig.get(e)),null!=a?a:(0,n.__assign)({name:e,subtype:r},i.Po)},this.fieldRenderConfig=new Map,this.fieldHookConfig=new Map,this.upsertCallback=new Map}return t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.destroy=function(){this.instance&&this.instance.upsertCallback.clear(),this.instance=null},t.prototype.mergeRenderConfig=function(t,e){if(!t||!e)return t||e;var r=this.parseRenderConfig(t),i=this.parseRenderConfig(e),o=(0,n.__assign)((0,n.__assign)({},r.textRenderConfig),i.textRenderConfig),a=(0,n.__assign)((0,n.__assign)({},r.containerRenderConfig),i.containerRenderConfig),s=!Object.keys(o).length,l=!Object.keys(a).length;return s?l?o:{textRenderConfig:o,containerRenderConfig:a}:l?void 0:a},t.prototype.getAllListByInteractiveConfigKey=function(t){var e=[];return this.fieldHookConfig.forEach((function(r){var n=r[t];n&&e.push(n)})),e},t}()},39011:function(t,e,r){r.d(e,{Z:function(){return f}});var n,i,o=r(85556),a=r(2613),s=r(30479),l=function(t,e){var r=parseFloat(t);return isNaN(r)?(s.Logger.error("[FIELD SERVICE] ".concat(e," 字符串转换为数字是解析错误为 NaN, value: ").concat(t)),0):r},c=((n={})[a.FieldCommonSwitchesName.displayLayoutType]=function(t){return t},n[a.FieldCommonSwitchesName.independentRender]=function(t){return t?a.FieldBoolean.True:a.FieldBoolean.False},n[a.FieldCommonSwitchesName.isEscape]=function(t){return t?a.FieldBoolean.True:a.FieldBoolean.False},n[a.FieldCommonSwitchesName.layoutType]=function(t){return t},n[a.FieldCommonSwitchesName.key]=function(t){return t},n[a.FieldCommonSwitchesName.width]=function(t){return t.toString()},n[a.FieldCommonSwitchesName.height]=function(t){return t.toString()},n[a.FieldCommonSwitchesName.lockAspectRatio]=function(t){return t.toString()},n[a.FieldCommonSwitchesName.padding]=function(t){var e=t.top,r=t.right,n=t.bottom,i=t.left;return'"'.concat(e," ").concat(r," ").concat(n," ").concat(i,'"')},n[a.FieldCommonSwitchesName.subtype]=function(t){return t},n[a.FieldCommonSwitchesName.extendedData]=function(t){return escape(JSON.stringify(t))},n),p=((i={})[a.FieldCommonSwitchesName.displayLayoutType]=function(t){return t},i[a.FieldCommonSwitchesName.independentRender]=function(t){return t===a.FieldBoolean.True},i[a.FieldCommonSwitchesName.isEscape]=function(t){return t===a.FieldBoolean.True},i[a.FieldCommonSwitchesName.layoutType]=function(t){return t},i[a.FieldCommonSwitchesName.key]=function(t){return t},i[a.FieldCommonSwitchesName.width]=function(t){return l(t,"width")},i[a.FieldCommonSwitchesName.height]=function(t){return l(t,"height")},i[a.FieldCommonSwitchesName.lockAspectRatio]=function(t){return l(t,"lockAspectRatio")},i[a.FieldCommonSwitchesName.padding]=function(t){var e,r,n,i,o=t.replace('"',"").split(" ").map((function(t){return l(t,"padding")}));return{top:null!==(e=o[0])&&void 0!==e?e:0,right:null!==(r=o[1])&&void 0!==r?r:0,bottom:null!==(n=o[2])&&void 0!==n?n:0,left:null!==(i=o[3])&&void 0!==i?i:0}},i[a.FieldCommonSwitchesName.subtype]=function(t){return t},i[a.FieldCommonSwitchesName.extendedData]=function(t){try{return JSON.parse(unescape(t))}catch(t){return{}}},i),u=r(23777),g=r(37769),h=function(){function t(){var t=this;this.keyProcessorMap=new Map,this.getFieldProcessor=function(e,r){var n=t.getKey(e,r),i=t.keyProcessorMap.get(n);return i||(r&&(i=t.keyProcessorMap.get(e))?i:null)},this.upsertFieldProcessor=function(e){var r=e.name,n=e.subtype,i=e.processor,s=t.getKey(r,n);if(i){if(i instanceof a.FieldCodeProcessor)return t.keyProcessorMap.delete(s),void t.keyProcessorMap.set(s,i);if(n)throw new Error("[FIELD PROCESSOR] subtype 为区分域最小力度，禁止对映 map 函数，只有 field name 才允许");Object.entries(i).map((function(e){var n=(0,o.__read)(e,2),i=n[0],a=n[1],s=t.getKey(r,i);t.keyProcessorMap.delete(s),t.keyProcessorMap.set(s,a)}))}else t.keyProcessorMap.delete(s)},a.FieldCodeManager.getInstance().setFieldProcessorCallback(this.getFieldProcessor),u.P.getInstance().addUpsertConfigCallback("fieldProcessorService",this.upsertFieldProcessor)}var e;return e=t,t.getInstance=function(){return this.instance||(this.instance=new e),this.instance},t.prototype.getKey=function(t,e){return"".concat(t).concat(e?"-".concat(e):"")},t=e=(0,o.__decorate)([(0,g.t)(),(0,o.__metadata)("design:paramtypes",[])],t)}(),d=function(){function t(){var t=this;this.processorService=h.getInstance(),this.encodeField=function(e){var r,n,i=e.fieldCode,s=i.name,l=i.switches,p=null==l?void 0:l[a.FieldCommonSwitchesName.subtype],u=p?"".concat(s,"-").concat(p):s,g=t.fieldConfigService.getFieldRenderConfig(u);if(!g)throw new Error("[FIELD SERVICE] 当前并没有注入 ".concat(u," 域（子）类型配置信息，无法插入数据"));var h=e,d=(0,o.__assign)((0,o.__assign)({},c),null===(r=g.fieldCodeConfig)||void 0===r?void 0:r.switchesValueConvertToString);if(l){var f=Object.entries(l).reduce((function(t,e){var r,n,i=(0,o.__read)(e,2),a=i[0],s=i[1];if(void 0===s)return t;var l=d[a];return(0,o.__assign)((0,o.__assign)({},t),((r={})[a]=null!==(n=null==l?void 0:l(s))&&void 0!==n?n:"".concat(s),r))}),{});h.fieldCode=(0,o.__assign)((0,o.__assign)({},e.fieldCode),{switches:f})}var y=(null!==(n=g.fieldCodeConfig)&&void 0!==n?n:{}).forbiddenEscapeSwitches,v=y?{forbiddenEscapeSwitches:y}:void 0;return a.FieldUtil.encodeField(h,v)}}return t.prototype.parseFieldCode=function(t){var e,r=t.name,n=t.instructions,i=void 0===n?[]:n,s=t.switches,l=void 0===s?{}:s,c=t.range,u=l[a.FieldCommonSwitchesName.subtype],g=u?"".concat(r,"-").concat(u):r,h=this.fieldConfigService.getFieldRenderConfig(g);if(!h&&u&&(h=this.fieldConfigService.getFieldRenderConfig(r)),!l||!h)return{name:r,instructions:i,switches:l,range:c};var d=(0,o.__assign)((0,o.__assign)({},p),null===(e=null==h?void 0:h.fieldCodeConfig)||void 0===e?void 0:e.switchesValueConvertToCustom),f=Object.entries(l).reduce((function(t,e){var r,n,i=(0,o.__read)(e,2),a=i[0],s=i[1],l=d[a];return(0,o.__assign)((0,o.__assign)({},t),((r={})[a]=null!==(n=null==l?void 0:l(s))&&void 0!==n?n:s,r))}),{});return{name:r,instructions:i,switches:f,range:c}},t.prototype.decodeFieldCode=function(t){var e=a.FieldUtil.decodeFieldCode(t);if(!e)return null;var r=this.parseFieldCode(e);if(!r.switches[a.FieldCommonSwitchesName.displayLayoutType]){var n=r.switches[a.FieldCommonSwitchesName.subtype],i=this.processorService.getFieldProcessor(e.name,n),o=null==i?void 0:i.getFieldLayoutType(e);o&&(r.switches[a.FieldCommonSwitchesName.displayLayoutType]=o)}return r},Object.defineProperty(t.prototype,"fieldConfigService",{get:function(){return u.P.getInstance()},enumerable:!1,configurable:!0}),t}(),f=d},2560:function(t,e,r){var n=r(85556),i=r(30479),o=r(2613),a=r(3139),s=r(22703),l=r(98158),c=r(77947),p=r(17657),u=r(25251),g=r(4082),h=function(){function t(){this.floatSchema=new Map,this.boxInfo=null,this.isChangeInfo=!1,this.stateManager.register(u.qy,{}),this.fieldSearchService=new g.Z}var e,r,h;return t.prototype.handFieldSchema=function(t,e){var r=t.floatToolbarSchema,i=t.name,o=t.subtype,a=o?"".concat(i,"-").concat(o):i,s=this.floatSchema.get(a),l=!!s;if(r){var c=!e&&l?(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(s),!1),(0,n.__read)(r),!1):r;this.floatSchema.set(a,c),this.updateFloatToolbarSchema(c,l)}else l&&e&&(this.floatSchema.delete(a),this.updateFloatToolbarSchema([[]],l))},t.prototype.updateFloatToolbarSchema=function(t,e){var r,i;void 0===e&&(e=!1);var o=this.toolbarService.getSchema(),a=(0,n.__assign)((0,n.__assign)({},o[p.Dm]),{data:e?this.getAllFloatToolbarSchema():(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(o[p.Dm].data),!1),(0,n.__read)(t),!1)}),s=this.stateManager.getValue(u.qy);this.stateManager.upsert(u.qy,(0,n.__assign)((0,n.__assign)({},s),((r={})[p.Dm]=a,r))),this.toolbarService.setSchema((0,n.__assign)((0,n.__assign)({},o),((i={})[p.Dm]=a,i)))},t.prototype.getAllFloatToolbarSchema=function(){return Array.from(this.floatSchema).reduce((function(t,e){var r=(0,n.__read)(e,2)[1];return r.length?t.concat(r):t}),[])},t.prototype.showFloatToolbar=function(t,e){var r=this,a=t.layoutBox,s=t.position,l=t.toolbarHeight,c=t.onMouseEnterToolbar,u=t.onMouseLeaveToolbar,g=this.fieldSearchService.getFieldByBox(a,e);if(g){this.floatToolbarShowFieldInfo=(0,n.__assign)((0,n.__assign)({},g),{layoutBox:a});var h=e.createRangeManager(!1),d="".concat(g.fieldRange.begin(),"-").concat(g.fieldRange.end());h.insertRange(d,g.fieldRange),this.boxInfo={layoutBox:a,editor:e,getRange:function(){return h.getRange(d)},unmount:function(){h.deleteRange(d),h.destroy()}};var f=null!=s?s:this.getSelectionToolbarPosition(e,a,l,g.layoutType===o.FieldLayoutType.Text?g.fieldRange:void 0);this.floatToolbarService.unmount("float-toolbar-selection"),this.floatToolbarService.show({name:p.Dm,dataType:p.Dm,placement:"top",position:f,onMouseEnter:c,onMouseLeave:u}),e.on(o.RenderNotificationTypes.SELECTION_END,(function(t){var n;!r.isChangeInfo||(null===(n=r.boxInfo)||void 0===n||n.editor.uuid,e.uuid)})),e.on(o.RenderNotificationTypes.TABLE_DID_SCROLL,(function(t){var n=t.gcp;if(r.floatToolbarShowFieldInfo&&!1!==r.floatToolbarShowFieldInfo.isInTable){var i=r.floatToolbarShowFieldInfo,o=i.fieldRange,a=i.isInTable;if(void 0===a){var s=e.service.getDocument().getTableFromGcp(n),l=null==s?void 0:s.getRange().contains(o.begin());if(r.floatToolbarShowFieldInfo.isInTable=a,!l)return}r.hideFloatToolbar(e)}}))}else i.Logger.error("[FIELD TOOLBAR] 当前无法对应区间展示域工具栏，请传入正确区间")},Object.defineProperty(t.prototype,"floatToolbarFieldInfo",{get:function(){var t;if(this.isChangeInfo&&this.boxInfo){var e=this.boxInfo,r=e.editor,i=e.layoutBox,o=(0,e.getRange)();if(!o)return;var a=this.fieldSearchService.getFieldByBox(i,r);this.floatToolbarShowFieldInfo=a?(0,n.__assign)((0,n.__assign)({},a),{fieldRange:o,layoutBox:i,isInTable:null===(t=this.floatToolbarShowFieldInfo)||void 0===t?void 0:t.isInTable}):void 0}return this.floatToolbarShowFieldInfo},enumerable:!1,configurable:!0}),t.prototype.hideFloatToolbar=function(t){var e;this.floatToolbarShowFieldInfo=void 0,null===(e=this.boxInfo)||void 0===e||e.unmount(),this.boxInfo=null,this.floatToolbarService.unmount(p.Dm),t.removeListener(o.RenderNotificationTypes.SELECTION_END,this),t.removeListener(o.RenderNotificationTypes.TABLE_DID_SCROLL,this)},t.prototype.getSelectionToolbarPosition=function(t,e,r,n){void 0===r&&(r=p.Uc);var a=e.getRange();if(e instanceof o.TextBox&&n){var s=n.begin(),l=n.end(),c=a.begin(),u=e.parentBox,g=null==u?void 0:u.getRangeBegin();s!==c&&void 0!==u&&g!==c&&u.children.some((function(t){var e=t.getRangeBegin();return e>c||e>l?(i.Logger.error("[FIELD TOOLBAR] 无法正确获取工具栏起点位置：".concat(e>c,",").concat(e>l)),!0):e>=s?(a=t.getRange(),!0):void 0}))}var h=t.service.getDocument().getRange(a.gcpBegin,a.gcpBegin+a.len),d=t.getViewRangeFromGcpRange(a);if(!d)return i.Logger.error("[FIELD TOOLBAR] 当前无法获取".concat(t.uuid,"编辑器的当前box起点位置")),{left:0,top:0};var f=d.start.getSurfaceOffset(t.zoom);if([o.STStoryType.headerContent,o.STStoryType.footerContent].includes(h.storyType())){var y=o.LayoutUtil.getOffsetPoint(e,o.BoxKind.Document);f.y=(0,i.twipsToPx)(y.y)}return{left:f.x,top:f.y-r}},t.prototype.shouldShowFieldFloatToolbarByRange=function(t,e){var r,n,i,a,s,l,c,p=null!==(i=null===(n=this.floatToolbarFieldInfo)||void 0===n?void 0:n.fieldRange)&&void 0!==i?i:{},u=p.gcpBegin,g=p.len,h=null===(s=null===(a=this.floatToolbarFieldInfo)||void 0===a?void 0:a.fieldCode.switches)||void 0===s?void 0:s[o.FieldCommonSwitchesName.displayLayoutType];if(!this.floatToolbarFieldInfo){var d=null===(l=e.getFieldStream())||void 0===l?void 0:l.getDecodedFieldInfo(t.begin());u=(r=null!==(c=null==d?void 0:d.fieldRange)&&void 0!==c?c:{}).gcpBegin,g=r.len,h=null==d?void 0:d.displayLayoutType}if(void 0===u||void 0===g)return!1;var f=u+g,y=t.gcpBegin,v=t.len,m=y+v;return!v&&y<=f&&y>=u||!(m<=u||y>=f)&&!!(y>u&&m<f&&h&&h!==o.FieldDisplayLayoutType.Text)},(0,n.__decorate)([(0,a.tB)(),(0,n.__metadata)("design:type","function"==typeof(e=void 0!==s.O&&s.O)?e:Object)],t.prototype,"toolbarService",void 0),(0,n.__decorate)([(0,a.tB)(),(0,n.__metadata)("design:type","function"==typeof(r=void 0!==l.m&&l.m)?r:Object)],t.prototype,"floatToolbarService",void 0),(0,n.__decorate)([(0,a.tB)(),(0,n.__metadata)("design:type","function"==typeof(h=void 0!==c.O&&c.O)?h:Object)],t.prototype,"stateManager",void 0),t}();e.Z=h},465:function(t,e,r){r.d(e,{o:function(){return L}});var n,i=r(85556),o=r(87363),a=r.n(o),s=r(2613),l=r(75611),c=r(37769),p=r(9234),u=r(17657),g=r(99766),h=r(18819),d=r(32854),f=function(){function t(){this.fieldCodeRenderMap=new Map,this.bridgeKeyMap=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.getField=function(t,e){if(t){var r=t.getFieldStream();if(r){var n=r.getFieldInfo(e.begin());if(n)return n}}return null},t.prototype.getRegisteredDecorator=function(t){return this.fieldCodeRenderMap.get(t)},t.prototype.getRegisteredBridgeKey=function(t){return this.bridgeKeyMap.get(t)},t.prototype.registerDecorator=function(t,e,r){this.fieldCodeRenderMap.set(t,e),r&&this.bridgeKeyMap.set(t,r)},t.prototype.removeDecorator=function(t){this.fieldCodeRenderMap.delete(t),this.bridgeKeyMap.delete(t)},t}(),y=r(42094),v=r(23777),m=r(4082),S=r(30479),b=r(2560),C=r(38429),P=function(){function t(t){var e=this;this.fieldConfigService=t,this.editorMouseEnterMap=new Map,this.initEventListener=function(t){t.on(s.HiddenEditorNotificationType.ON_INPUT,(function(r){return e.handleInput(t,r)}),e),t.on(s.MouseNotificationType.MOUSE_EVENT,(function(r){return e.handleMouseEvent(t,r)}),e),t.on(s.TouchNotificationType.TOUCH_EVENT,(function(r){return e.handleTouchEvent(t,r)}),e),t.on(s.StateNotification.DeleteFieldContainer,(function(r){return e.handleDeleteFieldContainer(t,r)}),e),t.on(s.RenderNotificationTypes.CONTEXT_MENU_EVENT,(function(){return e.fieldFloatToolbarService.hideFloatToolbar(t)}),e),t.on(s.ClipboardNotificationType.ON_PASTE,(function(r){return e.handlePaste(t,r)}),e),t.on(s.RenderNotificationTypes.PAGE_MOUSE_EVENT,(function(r){return e.handlePageMouseEvent(t,r)}),e)},this.removeEventListener=function(t){t.removeListener(s.HiddenEditorNotificationType.ON_INPUT,e),t.removeListener(s.MouseNotificationType.MOUSE_EVENT,e),t.removeListener(s.TouchNotificationType.TOUCH_EVENT,e),t.removeListener(s.StateNotification.DeleteFieldContainer,e),t.removeListener(s.RenderNotificationTypes.CONTEXT_MENU_EVENT,e),t.removeListener(s.ClipboardNotificationType.ON_PASTE,e),e.editorMouseEnterMap.delete(t.uuid)},this.handleInput=function(t,r){var n;(null===(n=r.data)||void 0===n?void 0:n.length)&&t&&!t.service.getSelection().isSelectionAtCodeblock()&&e.fieldConfigService.getAllListByInteractiveConfigKey("onInput").map((function(t){return t(r.data)}))},this.handleMouseEvent=function(t,r){var n;if(r.mouseAction===s.MouseAction.CLICK&&e.clickHitPoint){var i=null===(n=t.createRangeFinder())||void 0===n?void 0:n.findHitViewPoint(t.getDocumentBox(),{x:0,y:0},e.clickHitPoint,!1,!1,!0),o=null==i?void 0:i.leafBox;o&&e.handleClick(t,r.event,o),e.clickHitPoint=null}},this.getHookConfig=function(t){var r=t.fieldCode,n=r.name,i=r.switches,o=null==i?void 0:i[s.FieldCommonSwitchesName.subtype];return e.fieldConfigService.getFieldHookConfig(n,o)},this.handlePageMouseEvent=function(t,r){var n=r.hitPoint,i=r.event.type;n&&("mousemove"!==i?"mouseup"!==i||(e.clickHitPoint=n):e.handleThrottleMouseMove(t,n))},this.handleThrottleMouseMove=(0,S.throttle)((function(t,r){var n,i,o,a,c,p=null===(n=t.createRangeFinder())||void 0===n?void 0:n.findHitViewPoint(t.getDocumentBox(),{x:0,y:0},r,!1,!1,!0),u=null==p?void 0:p.gcp,g=null==p?void 0:p.leafBox,h=e.editorMouseEnterMap.get(t.uuid),d=void 0===u?void 0:new s.GCPRange(u,0),f=d&&e.fieldSearchService.getFieldByRange(t,d)[0],y=f&&e.isInFieldRange(t,f.fieldRange,r);if(h&&(!y||f&&y&&!h.fieldRange.contains(f.fieldRange))){var v=e.getHookConfig(h);(0,l.k)(null==v?void 0:v.isHighlightOnHover,!1,h)&&(null===(i=null==v?void 0:v.onCancelHighlight)||void 0===i||i.call(v,t,h)),null===(o=null==v?void 0:v.onMouseLeave)||void 0===o||o.call(v,t),e.editorMouseEnterMap.delete(t.uuid)}if(y&&f){var m=e.getHookConfig(f);(0,l.k)(m.isHighlightOnHover,!1,f)&&(null===(a=m.onHighlight)||void 0===a||a.call(m,t,f)),g&&(null===(c=m.onMouseEnter)||void 0===c||c.call(m,{editor:t,layoutBox:e.getLocationBox(g,f),fieldInfo:f})),e.editorMouseEnterMap.set(t.uuid,f)}}),100),this.handleTouchEvent=function(t,r){var n,i;if(r.touchAction===s.TouchAction.TOUCH){var o=null===(i=null!==(n=r.viewRange)&&void 0!==n?n:t.viewSelection.getViewRange())||void 0===i?void 0:i.start.leafBox;e.handleClick(t,r.event,o)}},this.handleClick=function(t,r,n){var i,o,a=e.fieldSearchService.getFieldByBox(n,t),l=[s.FieldDisplayLayoutType.Inline,s.FieldDisplayLayoutType.Text].includes(null!==(o=null===(i=null==a?void 0:a.fieldCode.switches)||void 0===i?void 0:i[s.FieldCommonSwitchesName.displayLayoutType])&&void 0!==o?o:"");if(a&&l){var c=a.fieldCode,p=c.name,u=c.switches,g=null==u?void 0:u[s.FieldCommonSwitchesName.subtype],h={editor:t,layoutBox:e.getLocationBox(n,a),name:p,subtype:g,fieldInfo:a};e.handleInteractive("onClick",h,r)}},this.handleDeleteFieldContainer=function(t,r){var n;r.fieldCodes.length>0&&(e.fieldFloatToolbarService.hideFloatToolbar(t),null===(n=t.surface)||void 0===n||n.requestFocus())},this.handlePaste=function(t,r){var n,i,o=r.type,a=r.pasteData,l=(null!=a?a:{}).pasteDelta;o!==s.ClipboardNotificationType.ON_PASTE||!l||(null===(i=null===(n=r.pasteData)||void 0===n?void 0:n.pasteDeltaExtraInfo)||void 0===i?void 0:i.isFromInternal)||C.cm||e.fieldConfigService.getAllListByInteractiveConfigKey("onPaste").map((function(t){return t(l)}))},this.handleInteractive=function(t,r,n){var o,a,s=r.name,l=r.subtype,c=(0,i.__assign)((0,i.__assign)({},r),{event:n});["onMouseLeave"].includes(t)&&(c=r.editor),null===(a=(o=e.fieldConfigService.getFieldHookConfig(s,l))[t])||void 0===a||a.call(o,c)},this.fieldSearchService=new m.Z,this.fieldFloatToolbarService=new b.Z}return t.prototype.isInFieldRange=function(t,e,r){var n,i=t.getViewRangeFromGcpRange(e);if(!i)return!1;var o=i.start.leafBox,a=i.end.leafBox,l=o.parentBox,c=a.parentBox;if(!l||!c)return!1;var p=s.LayoutUtil.getOffsetPoint(l,s.BoxKind.Document),u=p.x,g=p.y,h=s.LayoutUtil.getOffsetPoint(c,s.BoxKind.Document),d=h.y,f=h.x;if(r.y<g||r.y>d+c.totalHeight)return!1;var y=s.LayoutUtil.getOffsetPoint(o,s.BoxKind.Document).x,v=s.LayoutUtil.getOffsetPoint(a,s.BoxKind.Document).x;if(l===c)return r.x>=y&&r.x<=v+a.totalWidth;if(new S.MeloRect({x:y,y:g,width:u+l.totalWidth-y,height:l.totalHeight}).contains(r))return!0;if(new S.MeloRect({x:f,y:d,width:v-f,height:c.totalHeight}).contains(r))return!0;var m=g+l.totalHeight;return new S.MeloRect({x:u,y:m,width:(null===(n=l.parentBox)||void 0===n?void 0:n.totalWidth)||0,height:d-m}).contains(r)},t.prototype.getLocationBox=function(t,e){return e.fieldCode.switches[s.FieldCommonSwitchesName.displayLayoutType]===s.FieldDisplayLayoutType.Inline?this.getOuterFieldBox(t):t},t.prototype.getOuterFieldBox=function(t){for(var e=t;e&&!(0,s.isFieldBox)(e);)e=e.parentBox;return e||t},t}();!function(t){t.BACKSPACE="backspace"}(n||(n={}));var T=r(39011);function R(t){return function(e,r,n){var i=0,o=-1,a=[],l=[],c=void 0;return e.forEachOp((function(r,p,u){var g,h,d,f,y;if(0!==i&&o<=p&&s.OperationUtil.moveOffset(r,i),a.length>0)return l.push(p),r.param.text===s.PlaceholderChar.FieldBegin&&a.push(p),void(r.param.text===s.PlaceholderChar.FieldEnd&&(a.pop(),a.length||l.push(p+1,p+2)));var v=function(t,e){var r=t[e],n=e+2,i=t[n];return i instanceof s.InsertOperation&&i.param.text===s.PlaceholderChar.FieldSeparate&&r instanceof s.InsertOperation?n:null}(u,p);if(null!==v){var m=r.param.text,S=(new T.Z).decodeFieldCode(m);if(S){var b=S.name,C=S.switches,P=null==C?void 0:C[s.FieldCommonSwitchesName.subtype],R=null!==(h=null===(g=(c=t.getFieldHookConfig(b,P)).onPasteDeltaFilter)||void 0===g?void 0:g.call(c,S,n))&&void 0!==h?h:{},_=R.isFilter,I=R.toastContent;if(_){for(var w=p;w>-1&&(l.push(w),u[w].param.text!==s.PlaceholderChar.FieldBegin);)w-=1;return a.push(w),void((null==I?void 0:I.length)&&!(null===(d=n.toastContent)||void 0===d?void 0:d.includes(I))&&(n.toastContent=(null!==(f=n.toastContent)&&void 0!==f?f:[]).concat(I)))}var x=(null!==(y=c.onPasteDelta)&&void 0!==y?y:{}).fieldCode;if(x){var E=s.OperationUtil.getOffset(r);r=x(S,r,e);var D=s.OperationUtil.getOffset(r)-E;if(0!==D){o=v;for(var k=p+1;k<o;k++){var L=u[k];if(L.param.range){var A=L.param.range.clone();A.len+=D,A.gcpBegin+=i,L.param.range=A}}i+=D}}}}})),l.length&&e.opFilter((function(t,e){return!l.includes(e)})),e.correctCurrentRange(),{delta:e,extraInfo:n}}}function _(t,e){return function(r,n,i,o,a,l){return t.getAllListByInteractiveConfigKey("pasteNodeProcessor").reduce((function(t,r){return r.map((function(r){var n=r.priority,i=void 0===n?s.PasteNodeProcessorPriority.normal:n,o=r.processor;i===e&&t.push(o)})),t}),[]).some((function(t){return t(r,n,i,o,a,l)}))}}var I=r(15510);function w(t){return function(e,r){var n,i=(0,s.makeEmptyCopyData)();if(!e.fieldInfo)return i;var o=e.fieldInfo,a=o.fieldCode,l=o.fieldResult,c=o.fieldRange;if(!a)return i;var p=a.name,u=a.switches,g=null==u?void 0:u[s.FieldCommonSwitchesName.subtype],h=t.getFieldHookConfig(p,g).onCopyParser;if(!h){var d=I.Cy.getInstance().getRegisteredParser(p);if(d)return d(e,r);var f=null===(n=e.getResultNode)||void 0===n?void 0:n.call(e,{});if(f){var y="".concat((0,S.escapeHTML)(f.getTextContent()));return{html:y,plain:y,refText:y}}return i}return h({fieldCode:a,fieldResult:l,fieldRange:c,isBegin:!!e.isBegin,childNode:e.getBeginChild(),emptyResult:i},r)}}var x="field-container---JmR6",E=function(){function t(t,e,r,n){this.fieldRenderService=t,this.getFieldByBox=e,this.editor=r,this.bridge=n}return t.prototype.getOverlayStyle=function(t){var e,r=null===(e=t.parentBox)||void 0===e?void 0:e.parentBox;(0,s.isLineBox)(r)&&(r=r.parentBox);var n={};return r&&r.firstChild instanceof s.ListLineBox&&r.firstChild.listMark&&r.property.numPr.numId&&r.property.taskPr.taskState===s.STTaskState.done&&(n={opacity:.3,textDecoration:"line-through",textDecorationColor:"black"}),n},t.prototype.draw=function(t,e){var r,n,i;if((0,s.isFieldBox)(e)){var o=this.getOverlayStyle(e),a=s.FieldUtil.getComplexFieldSubType(null===(r=e.fieldInfo)||void 0===r?void 0:r.fieldCode.switches)||e.subType,l=this.getFieldByBox(e,this.editor);if(l){var c=null!==(i=null===(n=this.fieldRenderService.getDecoratorAndBridge(this.editor,a))||void 0===n?void 0:n.bridgeKey)&&void 0!==i?i:f.getInstance().getRegisteredBridgeKey(a),p=c&&this.bridge?{instance:this.bridge,bridgeKey:c}:void 0,u=this.fieldRenderService.getDrawCallback(a);null==u||u({editor:this.editor,ctx:t,box:e,cssStyle:o,fieldInfo:l,bridge:p})}}},t}();function D(t){var e=t.layoutBox,r=t.editor,n=t.name,i=t.subtype,s=t.fieldInfo,c=t.containerRender,u=t.handleInteractive,g=(0,o.useMemo)((function(){var e,r=(0,l.k)(c.className,[],t);return"".concat(x," ").concat(null!==(e=null==r?void 0:r.reduce((function(t,e){return"".concat(t," ").concat(e)}),""))&&void 0!==e?e:"")}),[c.className,t]),h={editor:r,layoutBox:e,name:n,subtype:i,fieldInfo:s},d=(0,o.createRef)();(0,o.useEffect)((function(){return d.current&&(e.__node__&&(e.__node__.__vm__=null),d.current.__vm__&&(d.current.__vm__.__node__=null),d.current.__vm__=e,d.current.__type__=e.constructor.name,e.__node__=d.current),function(){e.__node__=null}}));var f=(0,o.useMemo)((function(){var t=(0,p.Xn)(e),r=t.width,n=t.height;return{width:r?"".concat(r,"px"):"",height:n?"".concat(n,"px"):""}}),[e]),y="addonIframe"===i;return a().createElement("div",{ref:d,style:y?{}:f,className:y?"":g,onTouchStart:function(t){return u("onTouchStart",h,t)},onTouchMove:function(t){return u("onTouchMove",h,t)},onTouchEnd:function(t){return u("onTouchEnd",h,t)},onMouseEnter:function(t){return u("onMouseEnter",h,t)},onMouseLeave:function(t){return u("onMouseLeave",h,t)},onClick:function(t){return u("onClick",h,t)},onWheel:function(t){return u("onWheel",h,t)},onFocus:function(t){return u("onFocus",h,t)},onBlur:function(t){return u("onBlur",h,t)}},t.children)}var k=function(){function t(t,e,r){this.fieldRenderService=t,this.editor=e,this.handleInteractive=r}return t.prototype.draw=function(t,e){if((0,s.isFieldContainerBox)(e)){var r={layoutBox:e,editor:this.editor,context:this.editor,containerFocus:t.containerFocus},n=this.fieldRenderService.getFieldContainerInfo(r);if(n){var o=n.key,l=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},n),r),{handleInteractive:this.handleInteractive}),c=(0,s.makeFrame)(0,0,e.totalWidth,e.totalHeight),u=(0,p.Vo)(t,e),g=s.PoolNodeFactory.obtain(s.IComponentView,o,c,a().createElement(D,(0,i.__assign)({},l)),u);t.addView(g)}}},t}(),L=function(){function t(){var t=this;this.containerRenderMap=new Map,this.textRenderMap=new Map,this.editorBridgeMap=new Map,this.editorMap=new Map,this.upsertRenderConfig=function(e){var r=e.name,n=e.subtype,i=e.render,o=null!=n?n:r;return i?"containerRenderConfig"in i?(t.upsertTextRenderConfig(o,i.textRenderConfig),void t.upsertContainerRenderConfig(i.containerRenderConfig,r,n)):void("children"in i?t.upsertContainerRenderConfig(i,r,n):t.upsertTextRenderConfig(o,i)):(t.textRenderMap.delete(o),void t.containerRenderMap.delete(t.encodeKey(r,n)))},this.removeEditor=function(e){t.editorMap.delete(e.uuid)},this.fieldConfigService=v.P.getInstance(),this.fieldInteractiveService=new P(this.fieldConfigService),this.fieldConfigService.addUpsertConfigCallback("fieldRenderService",this.upsertRenderConfig),this.fieldSearchService=new m.Z}return t.prototype.upsertTextRenderConfig=function(t,e){this.textRenderMap.delete(t),this.textRenderMap.set(t,e)},t.prototype.encodeKey=function(t,e){return e?"".concat(t,"-").concat(e):t},t.prototype.upsertContainerRenderConfig=function(t,e,r){var n=this.encodeKey(e,r);this.containerRenderMap.delete(n),this.containerRenderMap.set(n,t)},t.prototype.initializeField=function(t,e){var r,i=this;void 0===e&&(e=!1);var o=t.uuid,a=(null!==(r=this.editorMap.get(o))&&void 0!==r?r:{}).callback;if(a)return a;var c=e?this.registerBridge(t):void 0,u=this.initializeFieldReact(t,c,!0),g=this.initializeFieldCanvas(t,c,!0),h=this.initializeFieldContainer(t,!0),d=function(t,e){var r;return(r={})[n.BACKSPACE]=function(r,n){var i=r.onSelection().range();if(!i.len){var o=(0,p.s0)(r,i.begin()),a=new s.GCPRange(o,0),c=t.getFieldByRange(r,a)[0];if((null==c?void 0:c.fieldRange.end())-1===o){var u=c.fieldCode,g=u.name,h=u.switches,d=null==h?void 0:h[s.FieldCommonSwitchesName.subtype],f=e.getFieldHookConfig(g,d);if((0,l.k)(null==f?void 0:f.isHighlightOnBackspace,!1,c))return void r.fire(new s.FieldCodeNotification(s.FieldCodeNotificationType.Delete,c,(function(){var t;return null===(t=f.onHighlight)||void 0===t?void 0:t.call(f,r,c)})))}}n()},r}(this.fieldSearchService,this.fieldConfigService);setTimeout((function(){t.registerPlugin(d),t.clipboardManager.addCopyModelParser(s.LayoutInputNodeType.FieldCode,w(i.fieldConfigService)),t.clipboardManager.addCopyModelParser(s.LayoutInputNodeType.FieldContainer,w(i.fieldConfigService)),t.clipboardManager.addPasteDeltaProcessor(R(i.fieldConfigService)),t.clipboardManager.addPasteNodeProcessor(_(i.fieldConfigService,s.PasteNodeProcessorPriority.normal)),t.clipboardManager.addPasteNodeProcessor(_(i.fieldConfigService,s.PasteNodeProcessorPriority.high),s.PasteNodeProcessorPriority.high)}),400),this.fieldInteractiveService.initEventListener(t);var f=function(){i.removeEditor.bind(t),u(),g(),h(),t.unRegisterPlugin(d),i.fieldInteractiveService.removeEventListener(t)};return this.editorMap.set(o,{editor:t,callback:f}),f},t.prototype.initializeFieldReact=function(t,e,r){var n,i=this;void 0===r&&(r=!1);var o=t.uuid,a=(null!==(n=this.editorMap.get(o))&&void 0!==n?n:{}).callback;if(!r&&a)return a;var l=this.getFieldDecorator(t,e);t.addDecorator(s.DecoratorTypes.LineFragment,l),t.addContentDecorator(s.BoxKind.FieldCodeLite,s.Region.Content,(0,p._r)(l)),t.addStyleDecorator(s.BoxKind.FieldCodeLite,(0,p.YQ)(l));var c=function(){return i.removeEditor.bind(t)};return this.editorMap.set(o,{editor:t,callback:c}),c},t.prototype.initializeFieldCanvas=function(t,e,r){var n,i=this;void 0===r&&(r=!1);var o=t.uuid,a=(null!==(n=this.editorMap.get(o))&&void 0!==n?n:{}).callback;if(!r&&a)return a;t.modelWrapperMgr.add(s.LayoutInputNodeType.FieldCode,(function(e){return i.getFieldModelWrapper(t,e)})),t.addExtendRenderer(s.ExtendRendererTypes.TextLineFragment,new E(this,this.fieldSearchService.getFieldByBox,t,e));var l=function(){i.removeEditor.bind(t),t.modelWrapperMgr.remove(s.LayoutInputNodeType.FieldCode)};return this.editorMap.set(o,{editor:t,callback:l}),l},t.prototype.initializeFieldContainer=function(t,e){var r,n,i=this;void 0===e&&(e=!1);var o=t.uuid,a=(null!==(r=this.editorMap.get(o))&&void 0!==r?r:{}).callback;if(!e&&a)return a;(null===(n=t.docEnv)||void 0===n?void 0:n.renderType)===s.RenderType.Canvas?t.addExtendRenderer(s.ExtendRendererTypes.LeafContainer,new k(this,t,this.fieldInteractiveService.handleInteractive)):null==t||t.addContainerRender(s.FieldType,(function(e,r,n){return i.getContainerRender(e,r,n,t)}));var l=function(){return i.removeEditor.bind(t)};return this.editorMap.set(o,{editor:t,callback:l}),l},t.prototype.getFieldContainerInfo=function(t){var e=t.layoutBox,r=t.containerFocus,n=t.editor,i=t.context,o=this.fieldSearchService.getFieldByBox(e,n);if(!o)return null;var a=o.fieldCode,l=a.name,c=a.switches,u=null==c?void 0:c[s.FieldCommonSwitchesName.subtype],g=this.encodeKey(l,u),h=this.containerRenderMap.get(g);if(!h)return null;var d=(0,p.Ie)(n,e,o),f=h.children({layoutBox:e,containerFocus:r,editor:n,context:i,fieldInfo:o,key:d});if(!f)return null;var y="element"in f?f.element:f,v="element"in f?f.elementKey:d;return{children:y,key:"".concat(g,"-").concat(v),fieldInfo:o,name:l,subtype:u,containerRender:h}},t.prototype.getContainerRender=function(t,e,r,n){var o={layoutBox:t,editor:n,context:r,containerFocus:e},s=this.getFieldContainerInfo(o);if(!s)return null;var l=s.key,c=(0,i.__assign)((0,i.__assign)((0,i.__assign)({},s),o),{handleInteractive:this.fieldInteractiveService.handleInteractive});return a().createElement(D,(0,i.__assign)({},c,{key:l}))},t.prototype.getDrawCallback=function(t){var e;return null===(e=this.textRenderMap.get(t))||void 0===e?void 0:e.draw},t.prototype.getFieldModelWrapper=function(t,e){var r,n,i,o,a=e.fieldCode,l=e.layoutType,c=a.name,p=a.switches,g=null!==(r=null==p?void 0:p[s.FieldCommonSwitchesName.subtype])&&void 0!==r?r:c,h=c===s.FieldName.HYPERLINK&&l===s.FieldLayoutType.Text?u.m7.NormalLink:g,d=null!==(o=null===(i=null===(n=this.textRenderMap.get(h))||void 0===n?void 0:n.modelWrapper)||void 0===i?void 0:i.call(n,t))&&void 0!==o?o:y.Q.getInstance().get(h);return d?d(e):{}},t.prototype.getFieldDecorator=function(t,e){var r=this;return function(n,i){var o,l=r.fieldSearchService.getFieldByBox(i,t);if(l){var c=l.fieldCode,p=c.name,u=c.switches,g=(null==u?void 0:u[s.FieldCommonSwitchesName.subtype])||p,h=f.getInstance(),y=null!==(o=r.getDecoratorAndBridge(t,g))&&void 0!==o?o:{decorator:h.getRegisteredDecorator(g),bridgeKey:h.getRegisteredBridgeKey(g)},v=y.decorator,m=y.bridgeKey;if(v)return v({children:n,box:i,fieldInfo:l,bridge:m&&e?{instance:e,bridgeKey:m}:void 0})}return{component:a().createElement(d.x,{editor:t,layoutBox:i,fieldInfo:l,key:"field-trigger-".concat(i.uuid)},n),overrideStyle:{}}}},t.prototype.registerBridge=function(t){var e,r=new h.k;return t.registerPlugin(((e={})[g.W0]=function(t,e,n,i){r.addClient(n,i)},e)),this.editorBridgeMap.set(t.uuid,r),r},t.prototype.getEditorBridge=function(t){return this.editorBridgeMap.get(t)},t.prototype.getDecoratorAndBridge=function(t,e){var r,n=null===(r=this.textRenderMap.get(e))||void 0===r?void 0:r.decorator;if(n)return{decorator:n.decoratorCallback(t),bridgeKey:n.bridgeKey}},t=(0,i.__decorate)([(0,c.t)(),(0,i.__metadata)("design:paramtypes",[])],t)}()},4082:function(t,e,r){var n=r(85556),i=r(2613),o=r(39011),a=function(){var t=this;this.getFieldByRange=function(e,r,i){void 0===i&&(i=1);var o=null!=r?r:e.service.getSelection().range(),a=o.begin(),s=o.len,l=e.service.getDocument().getRange(a,a+s);if(0===o.len){var c=t.getFieldByPoint(e,a,i);return c?[c]:[]}return l.getDecodedFieldInfos(i).map((function(e){return(0,n.__assign)((0,n.__assign)({},e),{fieldCode:(0,n.__assign)((0,n.__assign)({},t.fieldDataService.parseFieldCode(e.fieldCode)),{range:e.fieldCode.range})})}))},this.getFieldByPoint=function(e,r,i){var o,a=null===(o=e.getFieldStream())||void 0===o?void 0:o.getDecodedFieldInfo(r,i);return a?(0,n.__assign)((0,n.__assign)({},a),{fieldCode:(0,n.__assign)((0,n.__assign)({},t.fieldDataService.parseFieldCode(a.fieldCode)),{range:a.fieldCode.range})}):null},this.getFieldByBox=function(e,r){var i=e.fieldInfo;if(i)return(0,n.__assign)((0,n.__assign)({},i),{fieldCode:(0,n.__assign)((0,n.__assign)({},t.fieldDataService.parseFieldCode(i.fieldCode)),{range:i.fieldCode.range})});var o=e.getRange();return t.getFieldByPoint(r,o.begin())},this.getFieldByKey=function(e,r,n){void 0===n&&(n=1);var o=new i.GCPRange(0,r.state.getTextStream().getLength()),a=t.getFieldByRange(r,o,n),s=null;return a.some((function(t){var r=t.fieldCode.switches[i.FieldCommonSwitchesName.key];return e===r&&(s=t,!0)})),s},this.getFieldList=function(e,r,n,o){var a=new i.GCPRange(0,e.state.getTextStream().getLength()),s=t.getFieldByRange(e,a,o);if(void 0===o){var l=2,c=[];do{c=t.getFieldByRange(e,a,l),s=s.concat(c),l+=1}while(c.length)}return r||n?s.reduce((function(t,e){var o=e.fieldCode,a=o.name,s=o.switches[i.FieldCommonSwitchesName.subtype];return r&&n?a===r&&s===n?t.concat(e):t:r?a===r?t.concat(e):t:t.concat(e)}),[]):s},this.fieldDataService=new o.Z};e.Z=a},50982:function(t,e,r){r.d(e,{D:function(){return h}});var n=r(85556),i=r(2613),o=r(37769),a=r(27613),s=r(27954),l=r(2560),c=r(4082),p=r(39011),u=r(23777),g=r(30479),h=function(){function t(t){var e=this;this.contextService=t,this.getFieldByPoint=function(t,r,n){return e.fieldSearchService.getFieldByPoint(t,r,n)},this.fieldFloatToolbarService=new l.Z,this.fieldSearchService=new c.Z,this.fieldDataService=new p.Z,this.fieldConfigService=u.P.getInstance()}var e;return t.prototype.convertToFieldCodeInfo=function(t){return i.FieldUtil.getFieldCodeInfoByFieldInfo(t)},Object.defineProperty(t.prototype,"editor",{get:function(){return this.contextService.context.editor},enumerable:!1,configurable:!0}),t.prototype.getFieldHookConfig=function(t,e){return this.fieldConfigService.getFieldHookConfig(t,e)},t.prototype.addFieldRenderConfig=function(t,e){void 0===e&&(e=!1),this.fieldConfigService.upsertFieldRenderConfig(t,e)},t.prototype.addFieldInteractiveConfig=function(t,e){void 0===e&&(e=!1),this.fieldConfigService.upsertFieldHookConfig(t,e),this.fieldFloatToolbarService.handFieldSchema(t,e)},t.prototype.getRangeByGcpRange=function(t){var e=null!=t?t:this.editor.service.getSelection().range();return this.editor.service.getDocument().getRange(e.begin(),e.end())},t.prototype.insertField=function(t,e){void 0===e&&(e={});var r=this.fieldDataService.encodeField(t),i=r.fieldCode,o=r.fieldResult,a=r.key;return this.getRangeByGcpRange(t.fieldRange).insertField(i,o,(0,n.__assign)({},e)),a},t.prototype.insertFieldByStep=function(t,e){var r;return(0,n.__awaiter)(this,void 0,void 0,(function(){var i,o,a,s,l,c,p,u,g,h,d=this;return(0,n.__generator)(this,(function(n){switch(n.label){case 0:return i=this.editor.service,o=this.fieldDataService.encodeField(t),a=o.fieldCode,s=o.fieldResult,l=o.key,c=null!==(r=t.fieldRange)&&void 0!==r?r:i.getSelection().range(),p=this.editor.service.getDocument().getRange(c.begin(),c.end()),u=l,g=function(t){var e=d.fieldDataService.encodeField(t),r=e.fieldCode,n=e.fieldResult,o=e.key;p.insertFieldFinish(r,n,u),u=o;var a=i.getSelection().nextTextBreak(c.begin(),{skipField:!0});i.getSelection().setRange(a,a,{forceNotify:!0})},h=function(){p.insertFieldCancel(u)},p.insertFieldStart(a,s,u),[4,e(h,g)];case 1:return n.sent(),[2,u]}}))}))},t.prototype.insertFieldList=function(t,e){var r=this,n=[],i=t.map((function(t){var e=t.config,i=t.options,o=void 0===i?{}:i,a=r.fieldDataService.encodeField(e),s=a.fieldCode,l=a.fieldResult,c=a.key;return n.push(c),{fieldCode:s,fieldResult:l,options:o}}));return this.getRangeByGcpRange(e).insertFields(i),n},t.prototype.insertFieldStart=function(t){var e=this.fieldDataService.encodeField(t),r=e.fieldCode,n=e.fieldResult,i=e.key;return this.getRangeByGcpRange(t.fieldRange).insertFieldStart(r,n,i),i},t.prototype.insertFieldFinish=function(t,e){var r=this.fieldDataService.encodeField(e),n=r.fieldCode,i=r.fieldResult;this.getRangeByGcpRange(e.fieldRange).insertFieldFinish(n,i,t)},t.prototype.insertFieldCancel=function(t){this.getRangeByGcpRange().insertFieldCancel(t)},t.prototype.deleteField=function(t,e){var r,n,i,o=this;void 0===e&&(e=this.editor);var a=t.begin(),s=t.end(),l=null!==(r=this.fieldSearchService.getFieldByPoint(e,a))&&void 0!==r?r:{},c=l.fieldRange,p=l.nestingLevel,u=void 0===p?1:p,h=null!==(n=this.fieldSearchService.getFieldByPoint(e,s))&&void 0!==n?n:{},d=h.fieldRange,f=h.nestingLevel,y=void 0===f?1:f,v=Math.min(y,u);if(c&&d){if(c.contains(d.begin()))return e.onSelection().delete(c),!0;if(d.contains(c.begin()))return e.onSelection().delete(d),!0;for(var m=y>u?c.end()+1:d.begin()-1,S=y>u?d.begin():c.begin();1!==v;){var b=null!==(i=this.fieldSearchService.getFieldByPoint(e,m))&&void 0!==i?i:{},C=b.fieldRange,P=b.nestingLevel,T=void 0===P?1:P;if(!C||!T){g.Logger.info("[DELETE FIELD]: ".concat(a,"-").concat(s," error")),v=1;break}if(C.contains(S))return e.onSelection().delete(c),!0;v=Math.min(v,T),m=C.begin()-1}}else v=1;var R=this.fieldSearchService.getFieldByRange(this.editor,t,v).reverse();return R.map((function(t){var e=t.fieldRange;o.editor.onSelection().delete(e)})),R.length>0},t.prototype.updateField=function(t,e){var r=this.fieldDataService.encodeField(t),n=r.fieldCode,i=r.fieldResult;return this.getRangeByGcpRange(t.fieldRange).updateField(n,i,e),!0},t.prototype.getFieldByRange=function(t,e,r){return void 0===e&&(e=this.editor),void 0===r&&(r=1),this.fieldSearchService.getFieldByRange(e,t,r)},t.prototype.decodeField=function(t,e,r){return void 0===e&&(e=this.editor),void 0===r&&(r=1),this.getFieldByRange(t,e,r)[0]},t.prototype.encodeField=function(t){return this.fieldDataService.encodeField(t)},t.prototype.decodeFieldCode=function(t){return this.fieldDataService.decodeFieldCode(t)},t.prototype.getFieldByKey=function(t,e,r){return void 0===e&&(e=this.editor),void 0===r&&(r=1),this.fieldSearchService.getFieldByKey(t,e,r)},t.prototype.getFieldList=function(t,e,r,n){return void 0===r&&(r=this.editor),void 0===n&&(n=1),this.fieldSearchService.getFieldList(r,t,e,n)},t.prototype.getFieldByBox=function(t,e){return void 0===e&&(e=this.editor),this.fieldSearchService.getFieldByBox(t,e)},t.prototype.showFloatToolbar=function(t,e){void 0===e&&(e=this.editor),this.fieldFloatToolbarService.showFloatToolbar(t,e)},Object.defineProperty(t.prototype,"floatToolbarFieldInfo",{get:function(){return this.fieldFloatToolbarService.floatToolbarFieldInfo},enumerable:!1,configurable:!0}),t.prototype.hideFloatToolbar=function(t){void 0===t&&(t=this.editor),this.fieldFloatToolbarService.hideFloatToolbar(t)},t.prototype.shouldShowFieldFloatToolbarByRange=function(t,e){return void 0===e&&(e=this.editor),this.fieldFloatToolbarService.shouldShowFieldFloatToolbarByRange(t,e)},t=(0,n.__decorate)([(0,o.t)({overridable:!1,provide:s.Y}),(0,n.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==a.O&&a.O)?e:Object])],t)}()},27954:function(t,e,r){r.d(e,{Y:function(){return n}});var n=Symbol.for("service:field")},65161:function(t,e,r){r.d(e,{cr:function(){return $t},Xs:function(){return On},ZR:function(){return Bn},A8:function(){return ea},Mr:function(){return ei},en:function(){return ni},Wc:function(){return ve},bg:function(){return ze},PJ:function(){return Ke},bs:function(){return Kt},l_:function(){return nr},go:function(){return at},iQ:function(){return ar},Ah:function(){return N},X8:function(){return j},_J:function(){return E},Uy:function(){return vt},Hm:function(){return ye},Rh:function(){return H},Gb:function(){return ce},vQ:function(){return jt},d5:function(){return zt},e$:function(){return qt},x2:function(){return he},KU:function(){return K},r$:function(){return de},uY:function(){return ue},dh:function(){return Z},yH:function(){return Q},cL:function(){return St},pp:function(){return Ct},xR:function(){return Pt},Bf:function(){return z},g9:function(){return wt},k8:function(){return Tt},NH:function(){return Yt},Gv:function(){return Jt},NM:function(){return ge}});var n=r(66907),i=r(30479),o=r(85556),a=r(44892),s=r.n(a),l=r(43618),c=r(61251),p=r(46708),u=r(31518),g=r(82487),h=[g.IfD.StoryBreak,g.IfD.SubStoryBegin,g.IfD.SubStoryEnd,g.IfD.TableStart,g.IfD.TableEnd,g.IfD.TableRowBreak,g.IfD.TableCellBreak,g.IfD.PageBreak],d=new RegExp(h.join("|"),"g"),f=function(){function t(){}return t.getNodeType=function(t){if(t instanceof HTMLElement){if(this.isSingleTable(t))return n.PasteSrcType.Table;if(t.querySelector("table"))return n.PasteSrcType.Mix}return n.PasteSrcType.Text},t.isSingleTable=function(t){for(var e=t;e;){if(null!==e.nextSibling)return!1;if(e instanceof HTMLTableElement)return!0;e=e.childNodes[0]}return!1},t.pastePlainText=function(t,e,r,n){if(0!==r.length){var i=null!=n?n:e.delta();i.setCommandType(u.wI.DocPaste),e.deleteText(e.selection.validDeleteRange(),i);var o=r.replace(d,"");if(0!==o.length){for(var a=this.splitParaText(o),s=0;s<a.length-1;s++)u.Gh.insertText(i.currentRange().begin(),a[s],new(g.kkf.getPropertyClass(g.uSS.RunProperty)),i),u.Gh.insertParagraph(i.currentRange().begin(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),i);a[a.length-1]&&u.Gh.insertText(i.currentRange().begin(),a[a.length-1],new(g.kkf.getPropertyClass(g.uSS.RunProperty)),i),e.applyDelta(i)}}},t.getPasteTargetStyle=function(t,e){var r,n=null!=e?e:t.getSelection().range(),i=t.getSelection().getParaRange(n.gcpBegin);return r=i&&i.gcpBegin!==n.gcpBegin?new g.ICE(n.gcpBegin-1,0):new g.ICE(n.gcpBegin,0),{paraStyle:(0,o.__read)(t.getDocument().getParaStyleAtRange(r),1)[0],spanStyle:(0,o.__read)(t.getDocument().getTextStyleAtRange(r),1)[0]}},t.addExtraAttribute=function(t,e,r){var n=p.$w.getAttr(t,r);n&&e.set(r,n)},t.splitParaText=function(t){var e=new RegExp("".concat(g.IfD.ParagraphReturn,"|").concat(g.IfD.SectionBreak,"|").concat(g.IfD.ParagraphBreak),"g");return t.split(e).map((function(t){return(0,g.GDL)(t)}))},t}(),y=["font-size","mso-bidi-font-size","letter-spacing","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family","mso-font-width","font-family","color","bold","italic","underline","strikethrough","link","background","mso-highlight","background-color","font-style","font-weight","text-decoration","text-decoration-line"],v=["font-family","mso-fareast-font-family","mso-bidi-font-family","mso-hansi-font-family","mso-ascii-font-family"],m=function(t,e){return!(!t.has(e)||!t.get(e))},S=function(t,e){if(m(e,"font-size")){var r=e.get("font-size");/rem$/.test(r)?t.sz=g.keb.fontSize:t.sz=Math.round((0,i.ptToTwips)((0,i.fontSizeToPt)(r)))||20}m(e,"color")&&(t.color.val=e.get("color")),function(t,e){var r=e.get("data-font-family");r&&"default"!==r&&(t.fontFamily=e.get("data-font-family")),!r&&m(e,"font-family")&&(t.fontFamily=e.get("font-family"))}(t,e),t.i=m(e,"italic")&&"true"===e.get("italic"),t.u.val=m(e,"underline")&&"true"===e.get("underline")?g.qc8.single:g.qc8.none,t.strike=!1},b=function(t,e,r,n,o){if(!p.$w.isTextNode(t))return!1;if(!function(t,e){return!(t.parentNode&&"p"!==t.parentNode.nodeName.toLowerCase()&&"span"!==t.parentNode.nodeName.toLowerCase()&&e.isPasteFromMsoTable&&"  "===t.textContent||t.parentNode&&"body"===t.parentNode.nodeName.toLowerCase()&&i.PlatformUtil.isChrome()&&t instanceof Text&&t.previousElementSibling&&"MsoListParagraph"===p.$w.getProp(t.previousElementSibling,"className"))}(t,o))return!1;e=function(t,e){for(var r=0;r<e.length;r++)if(t.has(e[r])&&t.get(e[r])){var n=t.get(e[r]);t.set("font-family",n);break}return t}(e,v);var a=p.$w.getValue(t);if(a){var s=new(g.kkf.getPropertyClass(g.uSS.RunProperty));S(s,e),e.forEach((function(t,e){if(e&&t)switch(i.StringUtil.trim(e)){case"color":s.color.val=g.QBv.parseSTHexColor(t);break;case"letter-spacing":s.spacing=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t,0));break;case"mso-font-width":s.w=Number(t.replace("%",""));break;case"bold":s.b="true"===t;break;case"font-weight":s.b="bold"===t||"bolder"===t||parseInt(t)>=550;break;case"strikethrough":s.strike="true"===t;break;case"text-decoration":case"text-decoration-line":!function(t,e){t&&(-1!==t.indexOf("underline")&&(e.u.val=g.qc8.single),-1!==t.indexOf("line-through")&&(e.strike=!0))}(t,s);break;case"background":case"mso-highlight":case"background-color":s.shd.val=g.VHU.clear,s.shd.color=g.oPf.auto,s.shd.fill=g.QBv.parseSTHexColor(t);break;case"font-style":s.i=!0===s.i?s.i:"italic"===t;break;case"superscript":s.vertAlign="true"===t?g.TBk.superscript:g.TBk.baseline;break;case"subscript":s.vertAlign="true"===t?g.TBk.subscript:g.TBk.baseline;break;case"vertical-align":!function(t,e){e.vertAlign="sub"!==t?"super"!==t?g.TBk.baseline:g.TBk.superscript:g.TBk.subscript}(t,s)}})),o.isInTable&&(a=a.replace(new RegExp("".concat(g.IfD.PageBreak),"g"),""));for(var l=f.splitParaText(a),c=0;c<l.length-1;c++)u.Gh.insertText(r.currentRange().end(),l[c],s,r),u.Gh.insertParagraph(r.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),r);l[l.length-1]&&u.Gh.insertText(r.currentRange().end(),l[l.length-1],s,r)}return!0},C=function(){function t(){}return t.getRoot=function(t){for(var e=t;null==e?void 0:e.parentNode;)e=e.parentNode;return e},t.parseStyleContext=function(t){if(!this._styleContext){var e=this.getRoot(t);e&&e.head&&(this._styleContext=e.head.innerHTML)}return this._styleContext},t.parseInternalStyle=function(t,e){var r,n=new Map,i=this.parseStyleContext(t);try{var o,a=new RegExp(e.reg,"g");(o=a.exec(i))&&((null===(r=o[e.hasClassName?1:2])||void 0===r?void 0:r.split(/;\s*/))||[]).forEach((function(t){var e=t.split(":");e[0]&&e[1]&&n.set(e[0].trim(),e[1].trim())}))}catch(t){return n}return n},t.generateRegString=function(t,e){void 0===t&&(t=""),void 0===e&&(e="");var r=t.toLowerCase();return{reg:e?"".concat(r,"\\.").concat(e,"[^{]*{([^}]+)}"):"".concat(r,"(\\s*)(?!\\.){([^}]+)}"),hasClassName:Boolean(e)}},t.getInternalStyle=function(t,e,r){if(void 0===e&&(e=p.$w.getTagName(t).toLowerCase()),void 0===r&&(r=p.$w.getProp(t,"className")||""),this._cacheInternalStyle&&this._cacheInternalStyle.has("".concat(e).concat(r))&&this._cacheInternalStyle.get("".concat(e).concat(r)))return this._cacheInternalStyle.get("".concat(e).concat(r));var n=this.parseInternalStyle(t,this.generateRegString(e,r));return n?(this._cacheInternalStyle.set("".concat(e).concat(r),n),n):new Map},t.inlineStyleReset=function(){this._styleContext="",this._cacheInternalStyle=new Map},t._styleContext="",t._cacheInternalStyle=new Map,t}(),P=function(){function t(){}return t.generateInitStyle=function(e){var r=this;if(p.$w.isElementNode(e)){var n=window.getComputedStyle(e),i=new Map;return t.initStyle.forEach((function(t){var e=n[t];e&&i.set(r.toLine(t),e)})),i}return new Map},t.getSelfStyle=function(e){var r=t.splitCombineStyle(C.getInternalStyle(e)),n=t.splitCombineStyle(p.$w.getStyleMap(e));return new Map((0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(r),!1),(0,o.__read)(n),!1))},t.splitCombineStyle=function(e){var r=new Map(e);return this.combineStyle.forEach((function(n){if(e.has(n)&&e.get(n)){var i=e.get(n);r.delete(n);var o=t.splitCombineCssAttri(i);o&&"0px"!==i&&(r.set("".concat(n,"-top"),o.get("top")),r.set("".concat(n,"-right"),o.get("right")),r.set("".concat(n,"-bottom"),o.get("bottom")),r.set("".concat(n,"-left"),o.get("left")))}})),r},t.splitCombineCssAttri=function(t){var e,r,n;if(!t)return null;var i=t.split(" "),a=(0,o.__read)([0,0,0,0],4),s=a[0],l=a[1],c=a[2],p=a[3];switch(i.length){case 2:s=(e=(0,o.__read)([0,1,0,1],4))[0],l=e[1],c=e[2],p=e[3];break;case 3:s=(r=(0,o.__read)([0,1,2,1],4))[0],l=r[1],c=r[2],p=r[3];break;case 4:s=(n=(0,o.__read)([0,1,2,3],4))[0],l=n[1],c=n[2],p=n[3]}var u=new Map;return u.set("top",i[s]),u.set("right",i[l]),u.set("bottom",i[c]),u.set("left",i[p]),u},t.toLine=function(t){return t.replace(/([A-Z])/g,"-$1").toLowerCase()},t.combineStyle=["margin","padding","border"],t.initStyle=["lineHeight","color"],t.COVER=1,t.MERGE=2,t}(),T=["text-align","line-height","margin","margin-top","margin-bottom"];function R(t,e){!function(t,e){"exactly"===t.get("mso-line-height-rule")&&(e.spacing.lineRule=g.NRl.exact),e.spacing.lineRule||(e.spacing.lineRule=g.NRl.auto)}(t,e),function(t,e){var r=t.get("line-height"),n=Number(r);if(r){if(isNaN(n)||(e.spacing.line=n*g.jLu.autoLineRule),r.includes("%")&&(e.spacing.line=Number(r.replace("%",""))/100*g.jLu.autoLineRule),r.includes("pt")&&(e.spacing.line=(0,i.ptToTwips)(Number(r.replace("pt","")))),r.includes("px")){var o=g.keb.fontSizeStable,a=t.get("font-size");(null==a?void 0:a.includes("px"))?o=(0,i.pxToTwips)(Number(a.replace("px","")))||g.keb.fontSizeStable:(null==a?void 0:a.includes("pt"))&&(o=(0,i.ptToTwips)(Number(a.replace("pt","")))||g.keb.fontSizeStable),e.spacing.line=(0,i.pxToTwips)(Number(r.replace("px","")))/o*g.jLu.autoLineRule}e.spacing.line||(e.spacing.line=g.jLu.autoLineRule)}else e.spacing.line=g.jLu.autoLineRule}(t,e)}function _(t,e){if(t.has("layout-grid-mode")&&"char"===t.get("layout-grid-mode")?e.snapToGrid=!1:e.snapToGrid=!0,t.has("mso-para-margin-left")&&t.get("mso-para-margin-left")&&t.get("mso-para-margin-left").indexOf("gd")>0){var r=Number(t.get("mso-para-margin-left").replace("gd",""));e.ind.leftChars=r*g.jLu.indentChars}if(t.has("mso-para-margin-right")&&t.get("mso-para-margin-right")&&t.get("mso-para-margin-right").indexOf("gd")>0){var n=Number(t.get("mso-para-margin-right").replace("gd",""));e.ind.rightChars=n*g.jLu.indentChars}if(t.has("margin-left")&&t.get("margin-left")){var o=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t.get("margin-left"),0));e.ind.left=o}if(t.has("margin-right")&&t.get("margin-right")){var a=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t.get("margin-right"),0));e.ind.right=a}!function(t,e){if(t.has("mso-char-indent-count")&&t.get("mso-char-indent-count")){var r=Number(t.get("mso-char-indent-count"));r>0?e.ind.firstLineChars=r*g.jLu.indentChars:e.ind.hangingChars=r*g.jLu.indentChars}if(t.has("text-indent")&&t.get("text-indent")){var n=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t.get("text-indent"),0));n>0?e.ind.firstLine=Math.abs(n):e.ind.hanging=Math.abs(n)}}(t,e)}function I(t,e){var r=new Map([["solid",g.EJ9.thick],["dotted",g.EJ9.dotted],["dash-small-gap",g.EJ9.dashSmallGap],["dashed",g.EJ9.dashed],["dot-dash",g.EJ9.dotDash],["double",g.EJ9.double],["triple",g.EJ9.triple],["thin-thick-small-gap",g.EJ9.thinThickSmallGap],["thick-thin-small-gap",g.EJ9.thickThinSmallGap],["thin-thick-thin-small-gap",g.EJ9.thinThickThinSmallGap],["thin-thick-medium-gap",g.EJ9.thinThickMediumGap],["thick-thin-medium-gap",g.EJ9.thickThinMediumGap],["thin-thick-thin-medium-gap",g.EJ9.thinThickThinMediumGap],["thin-thick-large-gap",g.EJ9.thinThickLargeGap],["thick-thin-large-gap",g.EJ9.thickThinLargeGap],["thin-thick-thin-large-gap",g.EJ9.thinThickThinLargeGap],["wave",g.EJ9.wave],["double-wave",g.EJ9.doubleWave],["dash-dot-stroked",g.EJ9.dashDotStroked],["three-d-emboss",g.EJ9.threeDEmboss],["three-d-engrave",g.EJ9.threeDEngrave],["outset",g.EJ9.outset],["inset",g.EJ9.inset],["dot-dot-dash",g.EJ9.dotDotDash]]),n=new Map([["solid",1],["dotted",1],["dash-small-gap",1],["dashed",1],["dot-dash",1],["double",3],["triple",5],["thin-thick-small-gap",1.5],["thick-thin-small-gap",1.5],["thin-thick-thin-small-gap",2],["thin-thick-medium-gap",2],["thick-thin-medium-gap",2],["thin-thick-thin-medium-gap",3],["thin-thick-large-gap",1.75],["thick-thin-large-gap",1.75],["thin-thick-thin-large-gap",3],["wave",4],["double-wave",6.7],["dash-dot-stroked",1],["three-d-emboss",2],["three-d-engrave",2],["outset",1],["inset",1],["dot-dot-dash",2]]);[{key:"bottom",value:["border-bottom","mso-border-bottom-alt"]}].forEach((function(a){a.value.forEach((function(s){if(t.has(s)){var l=t.get(s);if(l&&"none"!==l){var c=l.split(" "),p=(0,o.__read)(function(t,e){var r=[],n=t.find((function(t){return!!e.has(t)}));r.push(n);var i=t.find((function(t){return g.QBv.parseSTHexColor(t)!==g.oPf.auto}));r.push(i?g.QBv.parseHexColor(i):void 0);var o=t.find((function(t){return!(!/pt$/.test(t)&&!/px$/.test(t))}));return r.push(o),r}(c,r),3),u=p[0],h=p[1],d=p[2];u&&r.get(u)?e.pBdr[a.key].val=r.get(u):e.pBdr[a.key].val=g.EJ9.thick,h&&"windowtext"!==h&&(e.pBdr[a.key].color=h),d&&(e.pBdr[a.key].sz=8*function(t){var e;return t/(null!==(e=n.get(null!=u?u:"solid"))&&void 0!==e?e:1)}((f=(0,i.dimensionSizeToPt)(d,1),Math.round(8*f)/8)))}}var f}))}))}var w={middot:g.SW1.middleDot,dashed:g.SW1.hyphen,dotted:g.SW1.dot,lined:g.SW1.underscore},x={left:g.lp4.left,right:g.lp4.right,center:g.lp4.center,decimal:g.lp4.decimal,bar:g.lp4.bar};function E(t,e,r){var n=P.splitCombineStyle(t),a=null!=r?r:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));return I(t,a),function(t,e){if(t.has("text-align")&&t.get("text-align")){var r=t.get("text-align");-1!==(null==r?void 0:r.indexOf("left"))?e.jc=g.aLG.left:-1!==(null==r?void 0:r.indexOf("center"))?e.jc=g.aLG.center:-1!==(null==r?void 0:r.indexOf("right"))?e.jc=g.aLG.right:-1!==(null==r?void 0:r.indexOf("justify"))&&(t.has("text-justify")&&"distribute-all-lines"===t.get("text-justify")?e.jc=g.aLG.distribute:e.jc=g.aLG.both)}}(n,a),R(n,a),_(n,a),function(t,e){t.has("mso-para-margin-top")&&t.get("mso-para-margin-top")&&t.get("mso-para-margin-top").indexOf("gd")>0&&(e.spacing.before=(0,i.ptToTwips)((0,i.linesToPoints)(Number(t.get("mso-para-margin-top").replace("gd",""))))),t.has("mso-para-margin-bottom")&&t.get("mso-para-margin-bottom")&&t.get("mso-para-margin-bottom").indexOf("gd")>0&&(e.spacing.after=(0,i.ptToTwips)((0,i.linesToPoints)(Number(t.get("mso-para-margin-bottom").replace("gd",""))))),t.has("margin-top")&&t.get("margin-top")&&(e.spacing.before=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t.get("margin-top"),0))),t.has("margin-bottom")&&t.get("margin-bottom")&&(e.spacing.after=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(t.get("margin-bottom"),0)))}(n,a),function(t,e){var r,n,a=t.get("tab-stops");if(a){var s=a.split(" "),l=[],c=new(g.kkf.getPropertyClass(g.uSS.CTTabStop));try{for(var p=(0,o.__values)(s),u=p.next();!u.done;u=p.next()){var h=u.value,d=x[h];if(d)c.val=d;else{var f=w[h];if(f)c.leader=f;else{var y=(0,i.ptToTwips)((0,i.dimensionSizeToPt)(h,0));y&&(c.val===g.lp4.undefined&&(c.val=g.lp4.left),c.pos=y,l.push(c),c=new(g.kkf.getPropertyClass(g.uSS.CTTabStop)))}}}}catch(t){r={error:t}}finally{try{u&&!u.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}l.length>0&&e.tabs.tab.setProperties(l)}}(n,a),a}var D,k=function(t,e,r,n,i,o){var a=p.$w.getTagName(t).toLowerCase();if(!["p","div","h1","h2"].includes(a))return!1;var s=!0;(null==t?void 0:t.lastElementChild)&&(s=function(t){return!["p","div","ol","ul","table","br"].includes(t)}(p.$w.getTagName(t.lastElementChild).toLowerCase()));var l=p.$w.getProp(t,"className");if(("h1"===a||"h2"===a)&&!(l=p.$w.getTdocTitle(l)))return!1;var c=function(t,e,r){return r.forEach((function(r){var n=t.get(r),i=e.get(r);!n&&i&&t.set(r,i)})),t}(P.getSelfStyle(t),e,i.validParaAttris),h=E(c),d=function(t,e){if(!t)return null;var r=null;if(/MsoNormal/.exec(t)&&e&&e.has("mso-outline-level")){var n=e.get("mso-outline-level");r="heading ".concat(n)}else/MsoTitle/.exec(t)?r=g.HiI.Title:/MsoSubtitle/.exec(t)?r=g.HiI.Subtitle:/MsoHeading7/.exec(t)?r=g.HiI.Heading7:/MsoHeading8/.exec(t)?r=g.HiI.Heading8:/MsoHeading9/.exec(t)?r=g.HiI.Heading9:/tco-title-title/.exec(t)?r=g.HiI.Title:/tco-title-subtitle/.exec(t)&&(r=g.HiI.Subtitle);return r}(l,c);if(d){var f=n.getDocument().generateStyleProperty(r,String(d));if(!f)throw Error("can not find ".concat(d,"!"));h.pStyle=f.styleId}if(o(t,e,r,n,i),"melo-hidden-editor"!==p.$w.getProp(t,"id")&&"inline-block"!==c.get("display")&&"inline"!==c.get("display")&&s){var y=p.$w.getNodeTextContent(t);(function(t,e){return!!e&&(e instanceof window[t]||!!e.ownerDocument&&!!e.ownerDocument.defaultView&&e instanceof e.ownerDocument.defaultView.window[t])})("HTMLElement",t)&&(null==y?void 0:y.replace("".concat(g.IfD.ParagraphReturn),""))&&u.Gh.insertParagraph(r.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),h,r)}return!0},L=function(t,e,r,n,i,o){if("br"!==p.$w.getTagName(t).toLowerCase())return!1;o(t,e,r,n,i);var a=E(e);return u.Gh.insertParagraph(r.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),a,r),!0},A=function(t,e,r,n,i,a){if("span"!==p.$w.getTagName(t).toLowerCase())return!1;if(i.isInTable&&function(t){var e,r,n,i=(null===(e=t.parentElement)||void 0===e?void 0:e.firstChild)===t,o=(null===(r=t.parentElement)||void 0===r?void 0:r.lastChild)===t;return!(!i||!o)&&""===(null===(n=null==t?void 0:t.textContent)||void 0===n?void 0:n.trim())}(t))return!1;var s=P.getSelfStyle(t);return function(t,e){var r=(0,o.__read)((t.get("mso-tab-count")||"").split(" "),1)[0],n=parseInt(r||"",10);if(n&&n>0){for(var i=0;i<n;i++)u.Gh.insertText(e.currentRange().end(),g.IfD.Tab,new(g.kkf.getPropertyClass(g.uSS.RunProperty)),e);return!0}return!1}(s,r)||function(t,e,r){var n=t.get("mso-element"),i=g.P1W.undefined,o=r.fieldNestingLevel||0;switch(n){case"field-begin":o+=1,i=g.P1W.begin;break;case"field-separator":i=g.P1W.separate;break;case"field-end":i=g.P1W.end;break;default:return!1}var a=new(g.kkf.getPropertyClass(g.uSS.RunProperty)),s=new(g.kkf.getPropertyClass(g.uSS.FieldCharProperty));return s.nestingLevel=o,s.fldCharType=i,i===g.P1W.end&&(o-=1),r.fieldNestingLevel=o,u.Gh.insertFieldChar(e.currentRange().end(),a,s,e),!0}(s,r,i)||function(t,e,r,n,i,a,s){var l=a.get("mso-field-code");if(!l)return!1;var c=l.match(/"([^"]*)/);if(!c)return!1;var p=(i.fieldNestingLevel||0)+1;return u.Gh.insertFieldByRange(c[1],new(g.kkf.getPropertyClass(g.uSS.RunProperty)),r,(function(r){s(t,e,r,n,(0,o.__assign)((0,o.__assign)({},i),{fieldNestingLevel:p}))}),p),!0}(t,e,r,n,i,s,a)||(f.addExtraAttribute(t,e,"data-font-family"),a(t,e,r,n,i)),!0},F=function(t,e,r,n,i,o){var a=p.$w.getTagName(t).toLowerCase();if(!a||"#comment"!==a)return!1;var s=t.textContent;if(!s)return!1;var l=s.match(/^\[if\s+([^\]]*)\s*\]>([\s\S]*)<!\[endif\]$/);if(!l)return!1;var c=l[1],u=l[2];return!("supportFields"!==c||!u||(o((new DOMParser).parseFromString(u,"text/html").body,e,r,n,i),0))},M=r(46016),O=function(){function t(t,e,r){this.pasteNodeProcessors=[],this.context=t,this.state=e,this.service=r,this.initBasicPasteNodeProcessor()}return t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=n.PasteNodeProcessorPriority.normal);for(var r=!1,i={processor:t,priority:e},o=0;o<this.pasteNodeProcessors.length;++o)if(this.pasteNodeProcessors[o].priority<e){this.pasteNodeProcessors.splice(o,0,i),r=!0;break}r||this.pasteNodeProcessors.push(i)},t.prototype.initBasicPasteNodeProcessor=function(){this.addPasteNodeProcessor(b),this.addPasteNodeProcessor(A),this.addPasteNodeProcessor(k),this.addPasteNodeProcessor(L),this.addPasteNodeProcessor(F)},t.prototype.doPaste=function(t,e,r,o){void 0===r&&(r=!1);var a=f.getNodeType(t),s={dstType:n.ClipboardUtils.getPasteDstType(this.service.getSelection(),e),srcType:a,validTextAttris:y,validParaAttris:T,pasteScene:o,fieldNestingLevel:0},l=u.C1.createLocalDeltaOption(e).buildDelta();l.setCommandType(u.wI.DocPaste);var c=P.generateInitStyle(t);if(r){var p=this.state.followSpanProp(l.currentRange().begin());if(p){var h=M.vW8.cssPropsToStyle(M.vW8.computeTextSpanFullStyles(p).cssProperties);h&&Object.keys(h).forEach((function(t){M.vW8.isDefaultCss(t,h[t])||c.set(i.StringUtil.camelToChain(t),h[t])}))}}if(this.processPasteNode(t,c,l,this.service,s),s.fieldNestingLevel){i.Logger.error("[FIELD PASTE ERROR] 缺少域结束符");var d=new(g.kkf.getPropertyClass(g.uSS.FieldCharProperty));d.fldCharType=g.P1W.end;for(var v=s.fieldNestingLevel;v>0;v--)u.Gh.insertFieldChar(l.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),d,l)}return C.inlineStyleReset(),l},t.prototype.processPasteNode=function(t,e,r,n,i){if(t){P.getSelfStyle(t).forEach((function(t,r){e.set(r,t)}));for(var o=!1,a=0;a<this.pasteNodeProcessors.length&&!(o=this.pasteNodeProcessors[a].processor(t,e,r,n,i,this.processPasteChildNode.bind(this)));a++);o||function(t,e,r,n,i,o){var a=p.$w.getTagName(t).toLowerCase();!a||"style"===a||"img"===a||"table"===a||"meta"===a||"title"===a||o(t,e,r,n,i)}(t,e,r,n,i,this.processPasteChildNode.bind(this))}},t.prototype.processPasteChildNode=function(t,e,r,n,i){for(var o=0;o<p.$w.getChildNodeNum(t);o++){var a=p.$w.getChildNode(t,o);if(a){if(p.$w.isTextNode(a)){var s=a.nodeValue||"",l=t.parentElement&&p.$w.getStyleMap(t.parentElement)||new Map;""===s.replace("&nbsp;"," ").trim()&&"Ignore"===l.get("mso-list")&&(a.nodeValue=""),a.nodeValue=this.handleLineBreak(s,e)}if("O:P"===a.nodeName)continue;this.processPasteNode(a,new Map(e),r,n,i)}}return!0},t.prototype.handleLineBreak=function(t,e){var r=e.get("white-space")||"";return["pre","pre-wrap","pre-line","break-spaces"].includes(r)?t:/^(\r?\n)+$/.test(t)?t.replace(/\r?\n/g,""):t.replace(/\r?\n/g," ")},t}(),B=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.transformInternalDataToPasteData=function(t,e){if(!t)return{success:!1,delta:null,isFromOtherPad:!1};var r=JSON.parse(t);if(!r)return{success:!1,delta:null,isFromOtherPad:!1};var n=u.C1.createLocalDeltaOption(e).buildDelta();n.setCommandType(u.wI.DocPaste);var o=r.subStory,a=r.mainStory;this.state.context.run("tranOperationDataToDelta",n,this.state.getStoryStream(),this.context,a,o,e);var s=!1,l=this.context.docEnv.uniqueId,c=r.srcGlobalPadId;return l&&(s=c!==l),0===n.operations.length?{success:!1,delta:null,isFromOtherPad:s,srcPadId:c}:(i.Logger.info(u.wI.DocPaste,"paste range [".concat(e.begin(),", ").concat(n.currentRange().end(),"]!")),{success:!0,delta:n,isFromOtherPad:s,srcPadId:c})},t}();function N(t,e){return e.some((function(e){return e.contains(t)}))}function H(t){var e,r,n=[],i=1;return t.forEachOp((function(t){if(u.NC.isTableStartCharOp(t)&&(1===i&&((e=new g.ICE).gcpBegin=t.param.range.gcpBegin),i+=1),u.NC.isTableEndCharOp(t)){if(1!=(i-=1)||!e)return;e.len=t.param.range.end()-(null==e?void 0:e.gcpBegin)+1,e&&n.push(e.clone()),e=void 0}var o=u.NC.isCodeBlock(t)||u.NC.isLightBlock(t)||u.NC.isTextFrame(t);o&&u.NC.isSubStoryBeginOp(t)&&((r=new g.ICE).gcpBegin=t.param.range.gcpBegin),o&&u.NC.isSubStoryEndOp(t)&&(r.len=t.param.range.end()-r.gcpBegin,r&&n.push(r),r=void 0)})),n}!function(t){t[t.headingWithListInfo=0]="headingWithListInfo",t[t.headingWithoutListInfo=1]="headingWithoutListInfo",t[t.mainWithListInfo=2]="mainWithListInfo",t[t.mainWithoutListInfo=3]="mainWithoutListInfo"}(D||(D={}));var W=[[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!1,!1],[!1,!1,!0,!1]],G=function(t){return t instanceof u.IZ};function V(t,e){var r=function(t,e){var r=t.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(e);return!r.isEmpty(r.tKeys.outlineLvl)&&r.outlineLvl!==g.ilm.LevelNone}(e,t),n=function(t){return!(t.isEmpty(t.tKeys.numPr)||t.numPr.isEmpty(t.numPr.tKeys.numId)||t.numPr.isEmpty(t.numPr.tKeys.ilvl))}(t);return r?n?D.headingWithListInfo:D.headingWithoutListInfo:n?D.mainWithListInfo:D.mainWithoutListInfo}var U,K=function(t,e,r){var n,i,a=e.getContentRange().gcpBegin,s=t.getTextStream().readText(a,r-a),l=0;try{for(var c=(0,o.__values)(s),p=c.next();!p.done;p=c.next())p.value===g.IfD.Tab&&(l+=1)}catch(t){n={error:t}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return l},z=function(t,e){var r=t.getTextStream().createParagraphIterator();r.seek(e);var n=r.getContentRange().gcpBegin,i=K(t,r,e);return!!i&&i===e-n};function j(t){t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.left),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.leftChars),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.right),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.rightChars),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.hangingChars),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.hanging),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.firstLine),t.ind.setDefault(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.firstLineChars)}var q=((U={})[g.RHh.Bullet]=function(t,e,r){var n=r.numPr,i=n.numId,o=n.ilvl,a=t.param.property;a.numPr.numId=i,a.numPr.ilvl=o},U[g.RHh.Task]=function(t,e,r){var n=r.numPr,i=n.numId,o=n.ilvl,a=t.param.property;a.numPr.numId=i,a.numPr.ilvl=o,a.taskPr.taskState=r.taskPr.taskState},U[g.RHh.Numbered]=function(t,e,r){var n=r.numPr,i=n.numId,o=n.ilvl,a=t.param.property;a.numPr.numId=i,a.numPr.ilvl=o},U);function X(t){if(!(t instanceof u.Ks))return!1;var e=t.param.property;return!(e.isEmpty(e.tKeys.numPr)||e.numPr.isEmpty(e.numPr.tKeys.numId)||e.numPr.isEmpty(e.numPr.tKeys.ilvl))}function Q(t){return t.some(X)}function Y(t,e,r,n,i,o){var a=V(o,r),s=H(t);t.forEachOp((function(t){if(t instanceof u.Ks){var l=t.param,c=l.property,p=l.range,g=V(c,r);if(N(p,s))return;W[g][a]&&!i&&n&&(j(c),q[n.listType](t,e,n)),function(t,e){!e.isEmpty(e.tKeys.blockQuote)&&e.blockQuote&&(t.blockQuote=e.blockQuote)}(c,o)}}))}function J(t,e,r,n){var i,o,a=t.operations.findIndex((function(t){return function(t){return G(t)&&t.param.text===g.IfD.ParagraphReturn}(t)})),s=-1!==t.operations.findIndex((function(t){return function(t){var e=[g.IfD.TableStart,g.IfD.FieldBegin];return G(t)&&-1!==e.indexOf(t.param.text)}(t)})),l=n.targetRange?r.isRangeBeginAtParaStart(n.targetRange):e.getSelection().isSelectionCollapseAtParaStart(),c=null!==(o=null===(i=null==n?void 0:n.targetRange)||void 0===i?void 0:i.gcpBegin)&&void 0!==o?o:e.getSelection().range().gcpBegin;return!(-1===a&&!s||l||z(r,c))}function Z(t,e,r,n){var i=f.getPasteTargetStyle(e,n.targetRange).paraStyle,a=r.dataEngine.getDataManager().getNumberingManager();if(i){var s=Q(t.operations);!function(t,e,r,n,i,a,s){var l,c,p=function(t,e){return t.isListParagraph(e)||e.blockQuote}(a,i);if(J(t,e,r,s)&&(p||n)){e.getSelection().insertParagraphBefore(s.targetRange);try{for(var h=(0,o.__values)(t.operations),d=h.next();!d.done;d=h.next()){var f=d.value;u.Yy.moveOffset(f,1)}}catch(t){l={error:t}}finally{try{d&&!d.done&&(c=h.return)&&c.call(h)}finally{if(l)throw l.error}}var y=s.targetRange;y&&(s.targetRange=new g.ICE(y.gcpBegin+1,y.len))}}(t,e,r,s,i,a,n);var l=e.getSelection().range(),c=e.getSelection().getParaRange(l.gcpBegin);Y(t,e,r,a.getListInfoFromGcpRange(c),s,i)}}var $,tt=function(t,e,r,n){var i=e.getSelection().validDeleteRange();if(u.Yy.isStartTable(t.operations)){at.isParaBeforeTable=!0;var o=f.getPasteTargetStyle(e,n.targetRange).paraStyle,a=u.Gh.getInsertParagraphOp(i.end(),null!=o?o:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)));a&&t.insertOperations(a,0)}return Z(t,e,r,n),t},et=r(52739),rt=et.Snackbar,nt=function(){function t(t,e,r){this.dstProcessors=new Map,this.deltaProcessors=[],this.context=t,this.state=e,this.service=r,this.initBasicProcessor()}return t.prototype.initBasicProcessor=function(){this.addPasteDstProcessor(n.PasteDstType.Doc,tt)},t.prototype.addPasteDstProcessor=function(t,e){this.dstProcessors.set(t,e)},t.prototype.addPasteDeltaProcessor=function(t,e){void 0===e&&(e=n.PasteDeltaProcessorPriority.Normal);for(var r=!1,i={processor:t,priority:e},o=0;o<this.deltaProcessors.length;++o)if(this.deltaProcessors[o].priority<e){this.deltaProcessors.splice(o,0,i),r=!0;break}r||this.deltaProcessors.push(i)},t.prototype.doProcessPaste=function(t,e){var r=this.doProcessDst(t,e);if(r){if(r=this.doDeleteSelectionOp(r,e.targetRange),r=this.doProcessDelta(r,e))return r.setCommandType(u.wI.DocPaste),this.state.applyDelta(r),r;i.Logger.info("doProcessPaste delta is null")}else i.Logger.info("doProcessPaste delta is null")},t.prototype.doDeleteSelectionOp=function(t,e){var r=null!=e?e:this.service.getSelection().validDeleteRange();if(r.isEmpty())return t;var n={range:r},i=u.Bz.createLocalOperation(n,u.C8.DeleteText);return i&&t.insertOperation(i,0),t},t.prototype.doProcessDst=function(t,e){var r=n.ClipboardUtils.getPasteDstType(this.service.getSelection(),e.targetRange),i=this.dstProcessors.get(r);return i?i(t,this.service,this.state,e):null},t.prototype.doProcessDelta=function(t,e){for(var r,n=t,i=e,o=0;o<this.deltaProcessors.length;o++){var a=this.deltaProcessors[o].processor(n,this.service,i);if(!a)return null;n="delta"in a?a.delta:a,i="delta"in a?a.extraInfo:i}if(null===(r=i.toastContent)||void 0===r?void 0:r.length){var s=i.toastContent.join(""),l=window.$t("paste:paste-toast-prefix");rt.show({message:"".concat(l).concat(s),duration:2e3,autoClose:!0})}return n},t}(),it=new RegExp(" || |᠎|\ufeff|[ - ]| |​|\u2028|\u2029| | |　","g"),ot=new RegExp("<iframe.*?>.*?<\\/iframe.*?>","gi");!function(t){t.paste="Paste",t.pastePlainText="pastePlainText"}($||($={}));var at=function(){function t(t,e,r,i){this.checkIfNeedInnerData=function(t){return!(0,n.isLocalEdit)()||t===n.InnerDataType.LocalData},this.context=t,this.state=e,this.service=r,this.customClipboard=i,this.pasteProcessorManager=new O(t,e,r),this.internalDataTransformer=new B(t,e),this.pasteDataProcessor=new nt(t,e,r)}var e,r,a,g;return t.prototype.doPastePlainText=function(t){return this.doPaste("",t,"",!1,void 0,$.pastePlainText)},t.prototype.doPaste=function(t,e,r,o,a,s){var l;void 0===o&&(o=!1),void 0===s&&(s=$.paste);var c=function(t){var e=t.replace(it," ");return e.replace(ot,"")}(t),g=Date.now();if(this.checkPermissionRange()){var h=!(c||!e),d=this.service.getSelection();a&&d.setRange(a.gcpBegin,a.end());var y,v,m,S=n.ClipboardUtils.getPasteDstType(d,a),b=f.getPasteTargetStyle(this.service,a);c&&(T=this.getPasteInnerData(c,e))&&(r=T),(y=e.length)>15e3?p.kQ.zzsStatus({attributeId:p.GI.PASTE_LENGTH_OVER_15000,status:p.eG.SUCCESS}):y>1e4?p.kQ.zzsStatus({attributeId:p.GI.PASTE_LENGTH_OVER_10000,status:p.eG.SUCCESS}):y>5e3?p.kQ.zzsStatus({attributeId:p.GI.PASTE_LENGTH_OVER_5000,status:p.eG.SUCCESS}):y>2500?p.kQ.zzsStatus({attributeId:p.GI.PASTE_LENGTH_OVER_2500,status:p.eG.SUCCESS}):p.kQ.zzsStatus({attributeId:p.GI.PASTE_LENGTH_LESS_2500,status:p.eG.SUCCESS});var C=0,P=null!=a?a:this.state.selection.validDeleteRange();if(r.length>0){var T;(T=this.internalDataTransformer.transformInternalDataToPasteData(r,P)).success&&T.delta&&(m=(l=this.handleInnerPasteData(T,S,s,P)).pasteDeltaExtraInfo,C=l.srcContentType,v=l.pasteDelta)}else{S===n.PasteDstType.Codeblock&&(h=!0);var R=null;try{var _=void 0;if(h)(_=document.createElement("span")).innerText=e;else{var I=(new DOMParser).parseFromString(c,"text/html");_=I.body,R=this.transformHtml2Document(_,I.head)}var w=this.pasteProcessorManager.doPaste(_,P,h,s);m={isFromInternal:!1,clipboardType:n.ClipboardType.Paste,pasteScene:s,targetRange:P},C=u.Yy.getContentType(w),v=this.pasteDataProcessor.doProcessPaste(w,m)}catch(t){i.Logger.error("Html parse error: ".concat(t)),p.kQ.captureException(p.GI.HTML_PARSE_ERROR,{extra:{error:t}},t)}finally{R&&R.remove()}}p.kQ.zzsValue(p.GI.PASTE_DATA_USE_TIME,(Date.now()-g)/1e3);var x={plain:e,html:c,isPlainText:h,pasteDelta:v,pasteDeltaExtraInfo:m,pasteDstType:o?void 0:S,pasteTargetStyle:b,srcContentType:C};this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE,x),!1),this.customClipboard.setPasteType(n.ClipboardType.Copy)}},t.prototype.pasteInnerData=function(t){var e=this.state.selection.validDeleteRange(),r=this.internalDataTransformer.transformInternalDataToPasteData(t,e);r.success&&r.delta&&this.pasteDataProcessor.doProcessPaste(r.delta,{isFromOtherPad:r.isFromOtherPad,isFromInternal:!0,clipboardType:n.ClipboardType.Cut})},t.prototype.pasteCustomInnerData=function(t){var e=t.data,r=t.targetRange,n=t.pasteScene;if(this.context.isEditable()){var i=null!=e?e:this.customClipboard.getSelectionInnerData();if(i){var o=i.html,a=i.plain,s=i.innerData;s instanceof Object?this.doPaste(o,a,JSON.stringify(s),!0,r,n):this.doPaste(o,a,s,!0,r,n)}}},t.prototype.getPasteInnerData=function(t,e){var r=null,o=null,a=(new DOMParser).parseFromString(t,"text/html").querySelector("[tdoc-data-src]");if(a&&(r=p.$w.getAttr(a,"tdoc-data-src"),o=p.$w.getAttr(a,n.INNER_DATA_TYPE)),!r||!this.checkIfNeedInnerData(o))return"";if(a&&r&&r.length>0){var l=p.$w.getAttr(a,"data-version"),c=p.$w.getAttr(a,"data-hash"),g=(e||"").replace(u.Xr,""),h=c===s().hash(g);if(l===n.DATA_VERSION&&h)return i.Logger.info("getPasteInnerData, innerData: ".concat(r)),r}return""},t.prototype.transformHtml2Document=function(t,e){var r=document.createElement("iframe");return r.name="pasteTemplate",r.style.position="absolute",r.style.top="99999px",r.style.left="99999px",document.body.appendChild(r),window.frames.pasteTemplate.document.body=t,(null==e?void 0:e.childNodes)&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((function(t){window.frames.pasteTemplate.document.head.appendChild(t)})),r},t.prototype.handleInnerPasteData=function(t,e,r,i){var o,a={isFromOtherPad:t.isFromOtherPad,isFromInternal:!0,srcPadId:t.srcPadId,targetRange:i,clipboardType:t.isFromOtherPad?n.ClipboardType.Copy:this.customClipboard.getPasteType(),pasteScene:r},s=0;if(t.delta)if(s=u.Yy.getContentType(t.delta),e===n.PasteDstType.HeaderFooter){var l=u.Yy.filterPlugins(t.delta);o=this.pasteDataProcessor.doProcessPaste(l,a)}else o=this.pasteDataProcessor.doProcessPaste(t.delta,a);return{pasteDeltaExtraInfo:a,srcContentType:s,pasteDelta:o}},t.prototype.addPasteNodeProcessor=function(t,e){void 0===e&&(e=n.PasteNodeProcessorPriority.normal),this.pasteProcessorManager.addPasteNodeProcessor(t,e)},t.prototype.addPasteDstProcessor=function(t,e){this.pasteDataProcessor.addPasteDstProcessor(t,e)},t.prototype.addPasteDeltaProcessor=function(t,e){void 0===e&&(e=n.PasteDeltaProcessorPriority.Normal),this.pasteDataProcessor.addPasteDeltaProcessor(t,e)},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.pasteSelectionInnerData=function(t){if(this.context.isEditable()){var e=null!=t?t:this.customClipboard.getSelectionInnerData();if(e){var r=e.html,n=e.plain,i=e.innerData;i instanceof Object?this.doPaste(r,n,JSON.stringify(i),!0):this.doPaste(r,n,i,!0)}}},t.prototype.checkPermissionRange=function(){return this.context.service.getPermissionRange().checkPermissionRange()?(this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),!0):(this.context.fire(new n.BeforeClipboardActionNotification(!1),!1),!1)},t.isParaBeforeTable=!1,t=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qw&&c.Qw)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(a=void 0!==c.vH&&c.vH)?a:Object,"function"==typeof(g=void 0!==n.CustomClipboard&&n.CustomClipboard)?g:Object])],t)}(),st=r(35831),lt=r.n(st),ct=(function(t){function e(e,r,a,s){var l=t.call(this,e,r,a,s)||this;return l.attached=!1,l.pasteData=function(){return(0,o.__awaiter)(l,void 0,void 0,(function(){var t,e,r;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,lt().invoke("readSystemClipboard",{})];case 1:return 0===(t=o.sent()).length?(i.Logger.info("readMiNiSystemClipboard success with plain, plain.length = 0"),[2]):((e=this.customClipboard.isCopyByInternal(t))?(r=this.customClipboard.getData().innerData,this.doPaste(e,t,r)):this.doPaste("",t,""),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE)),[3,3]);case 2:return o.sent(),[3,3];case 3:return[2]}}))}))},l}var r,a,s,p;(0,o.__extends)(e,t),e.prototype.attach=function(){this.attached||(this.attached=!0)},e.prototype.detach=function(){this.attached=!1},e.prototype.paste=function(){return this.pasteData()},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at),function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}var r,i,a,s;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t=this.customClipboard.getData(),e=t.html,r=t.plain,n=t.innerData;this.doPaste(e,r,n)},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(i=void 0!==l.ZM&&l.ZM)?i:Object,"function"==typeof(a=void 0!==c.vH&&c.vH)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(at),function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.attached=!1,o.onPasteByEvent=function(t){var e;o.paste(),null===(e=null==t?void 0:t.preventDefault)||void 0===e||e.call(t)},o}var r,a,s,p;(0,o.__extends)(e,t),e.prototype.attach=function(){if(this.attached)i.Logger.warn("paste has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("paste",this.onPasteByEvent),this.attached=!0):i.Logger.error("PasteByMqq attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("paste",this.onPasteByEvent):i.Logger.error("PasteByMqq detach surfaceDom is null"),this.attached=!1},e.prototype.paste=function(){var t=this,e=window.top.mqq;if(e&&"0"!==e.clientVersion)e.invoke("docx","readSystemClipboard",{},(function(e,r){if(r){var n=r.plain,i=void 0===n?"":n,o=r.html,a=void 0===o?"":o,s=t.customClipboard.isCopyByInternal(i,a);if(s){var l=t.customClipboard.getData().innerData;t.doPaste(s,i,l)}else t.doPaste(a,i,"")}else{var c=t.customClipboard.getData();a=c.html,i=c.plain,l=c.innerData,t.doPaste(a,i,l)}}));else{var r=this.customClipboard.getData(),n=r.html,i=r.plain,o=r.innerData;this.doPaste(n,i,o)}},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at),function(t){function e(e,r,a,s){var l=t.call(this,e,r,a,s)||this;return l.attached=!1,l.isEditFeatureLoaded=!1,l.onPasteByEvent=function(t){return(0,o.__awaiter)(l,void 0,void 0,(function(){var e,r,a,s,l,c;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(!this.context.isEditable())return[2];if(!(null===(l=this.context.surface)||void 0===l?void 0:l.isFocusing()))return[2];if(e="",r="",t){s=this.getPasteData(t),e=s.html,r=s.plain,i.Logger.info("onPasteByEvent: html.length:".concat(e.length,", plain.length: ").concat(r.length,", plain: ").concat(r));try{if(this.context.run("paste_plugin",e,r,t))return[2]}catch(t){i.Logger.error(t)}if((a=this.getBlob(t))&&(""===e||n.ClipboardUtils.isOutImageHtml(e)||n.ClipboardUtils.isPasteNativeImageToWeb(e)))return n.ClipboardUtils.insertImageByPaste(a,this.context),[2]}return null===(c=null==t?void 0:t.preventDefault)||void 0===c||c.call(t),[4,this.waitFeatureEditLoaded()];case 1:return o.sent(),this.doPaste(e,r,""),[2]}}))}))},u.kn.once(u.wq.FEATURE_LOADED,(function(){l.isEditFeatureLoaded=!0})),l}var r,a,s,p;return(0,o.__extends)(e,t),e.prototype.attach=function(){if(this.attached)i.Logger.warn("paste has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("paste",this.onPasteByEvent),this.attached=!0):i.Logger.error("PasteByWeb attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("paste",this.onPasteByEvent):i.Logger.error("PasteByWeb detach surfaceDom is null"),this.attached=!1},e.prototype.paste=function(){if(this.context.isEditable()){var t=this.customClipboard.getData(),e=t.html,r=t.plain,n=t.innerData;this.doPaste(e,r,n)}},e.prototype.isBugSafariForErrorCode=function(){return!(!i.PlatformUtil.isSafari()||!i.PlatformUtil.isMac())&&navigator.userAgent.toLocaleLowerCase().indexOf("version/13.1")>-1},e.prototype.getPasteData=function(t){var e,r="",n="";if(i.PlatformUtil.isIE()?e=window.clipboardData:t&&(e=t.clipboardData),!e)return{html:r,plain:n};if(i.PlatformUtil.isIE())n=e.getData("Text"),(o=this.customClipboard.isCopyByInternal(n))&&(r=o);else if(this.isBugSafariForErrorCode()){var o;n=e.getData("Text"),r=(o=this.customClipboard.isCopyByInternal(n))||e.getData("text/html")}else i.PlatformUtil.isTencentDocsPC()?(r=external.getClipboardData("text/html"),n=e.getData("text/plain")):(r=e.getData("text/html"),n=e.getData("text/plain"));return{html:r,plain:n}},e.prototype.clipboardMayHasImage=function(t){if(!(null==t?void 0:t.clipboardData))return!1;for(var e=t.clipboardData.items||t.clipboardData.files||[],r=0;r<e.length;r++)if(e[r].type.startsWith("image/"))return!0;return!1},e.prototype.getBlob=function(t){var e,r,n,i;if(this.clipboardMayHasImage(t)){for(var o=t.clipboardData.items||t.clipboardData.files||[],a=[],s=0;s<o.length;s++)if(o[s].type.startsWith("image/")&&!o[s].type.startsWith("image/svg+xml")){var l=(null===(r=(e=o[s]).getAsFile)||void 0===r?void 0:r.call(e))||(null===(i=(n=o[s]).slice)||void 0===i?void 0:i.call(n));l&&a.push(l)}return a.length>0?a:void 0}t.clipboardData&&this.context.run("paste_files",t.clipboardData.items)},e.prototype.waitFeatureEditLoaded=function(){return this.isEditFeatureLoaded?Promise.resolve():new Promise((function(t){u.kn.once(u.wq.FEATURE_LOADED,t)}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at)),pt=(function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}var a,s,p,u;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t;return(0,o.__awaiter)(this,void 0,void 0,(function(){var e,a=this;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.resolve().then(r.t.bind(r,90698,23))];case 1:return e=o.sent(),null===(t=null==e?void 0:e.default)||void 0===t||t.callNative("DocsWebViewPlugin","GetClipboard",void 0,(function(t){if(t.code&&1===t.code){i.Logger.info("PasteByWemeet|paste resp succ");var e=t.data,r=a.customClipboard.isCopyByInternal(e);if(r){var o=a.customClipboard.getData().innerData;a.doPaste(r,e,o)}else a.doPaste("",e,"");a.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))}else{i.Logger.info("PasteByWemeet|paste resp fail");var s=a.customClipboard.getData(),l=s.html;e=s.plain,o=s.innerData,a.doPaste(l,e,o)}})),[2]}}))}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(a=void 0!==c.Qw&&c.Qw)?a:Object,"function"==typeof(s=void 0!==l.ZM&&l.ZM)?s:Object,"function"==typeof(p=void 0!==c.vH&&c.vH)?p:Object,"function"==typeof(u=void 0!==n.CustomClipboard&&n.CustomClipboard)?u:Object])],e)}(at),function(t){function e(e,r,i,o){var a=t.call(this,e,r,i,o)||this;return a.weworkReadApi=function(){return n.tdocsCopyPaste.isSupportRead?n.tdocsCopyPaste.read():(0,n.readWeworkClipboard)()},a}var r,a,s,p;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.paste=function(){var t=this;return this.weworkReadApi().then((function(e){i.Logger.info("paste by wework, get paste Data: ".concat(e));var r=e.plain,o=e.html||t.customClipboard.isCopyByInternal(r);if(o){var a=t.customClipboard.getData().innerData;t.doPaste(o,r,a)}else t.doPaste("",r,"");t.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))})).catch((function(){var e=t.customClipboard.getData(),r=e.html,n=e.plain,i=e.innerData;t.doPaste(r,n,i)}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at),function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}var r,i,a,s;return(0,o.__extends)(e,t),e.prototype.paste=function(){var t=this;return(0,n.readWXRTFClipboard)().then((function(e){var r=e.html,i=e.plain;if(t.customClipboard.isCopyByInternal(i)){var o=t.customClipboard.getData().innerData;t.doPaste(r,i,o)}else t.doPaste(r,i,"");p.kQ.tdwReport({opername:"doc_word_editor",module:"copy_paste",action:"wx_read_rich_text"}),t.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))})).catch((function(){p.kQ.idkeyReport(p.bP.WECHAT_COPYPASTE_FAILED)}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(i=void 0!==l.ZM&&l.ZM)?i:Object,"function"==typeof(a=void 0!==c.vH&&c.vH)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(at)),ut=(function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}var r,a,s,p;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.read=function(){var t=this;try{i.Logger.info("window.browser.file",window.browser.file),window.browser.file.getClipboardData((function(e){i.Logger.info("paste getClipboardData",e);var r=e.plain,n=e.html;t.doPaste(n,r,"")}),(function(){i.Logger.info("getClipboardData fail")}),{})}catch(t){i.Logger.info("paste getClipboardData failed",t)}},e.prototype.paste=function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t;return(0,o.__generator)(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,(0,n.loadQQBrowserJSSDK)()];case 1:return e.sent(),[3,3];case 2:return t=e.sent(),i.Logger.error("loadQQBrowserJSSDK failed",t),[3,3];case 3:return[2,this.read()]}}))}))},e.prototype.b64ToUTF8=function(t){return decodeURIComponent(escape(window.atob(t)))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at),function(t){function e(e,r,n,i){return t.call(this,e,r,n,i)||this}var r,a,s,p;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.read=function(){var t,e=this;try{null===(t=window.fb)||void 0===t||t.getClipboardData().then((function(t){i.Logger.info("paste getClipboardData",t);var r=t;i.Logger.info("getClipboardData from fb",r),e.pasteData(r)})).catch((function(){return""}))}catch(t){i.Logger.info("paste getClipboardData failed",t)}},e.prototype.pasteData=function(t){var e=this.customClipboard.isCopyByInternal(t);if(e){var r=this.customClipboard.getData().innerData;i.Logger.info("paste with internal data",e),this.doPaste(e,t,r)}else this.doPaste("",t,"")},e.prototype.paste=function(){return this.read()},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at),function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o.attached=!1,o.onVisibilityChange=function(){var t=document.visibilityState;"hidden"===o.visibilityState&&"visible"===t&&(window.setTimeout((function(){o.getCopyDataFromServer()}),1500),window.setTimeout((function(){o.getCopyDataFromServer()}),3500)),o.visibilityState=t},o.getCopyDataFromServer(),o.visibilityState=document.visibilityState||"visible",o}var r,a,s,p;return(0,o.__extends)(e,t),e.prototype.attach=function(){this.attached||(document.addEventListener("visibilitychange",this.onVisibilityChange),this.attached=!0)},e.prototype.detach=function(){document.removeEventListener("visibilitychange",this.onVisibilityChange),this.attached=!1},e.prototype.paste=function(){var t=this.customClipboard.getData(),e=t.plain,r=t.html,i=t.innerData;this.doPaste(r,e,i),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_PASTE))},e.prototype.getCopyDataFromServer=function(){var t=this;(0,n.readWeDriveMiniClipboard)().then((function(e){var r=e.plain;t.customClipboard.setData("",r)})).catch((function(t){console.error("paste error: ",t),i.Logger.error("paste in wedrive mini failed: ".concat(JSON.stringify(t)))}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.vH),(0,o.__param)(3,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==c.vH&&c.vH)?s:Object,"function"==typeof(p=void 0!==n.CustomClipboard&&n.CustomClipboard)?p:Object])],e)}(at)),gt=function(t){var e,r=t.factory;(0,n.isSupportWeDriveMini)()?e=ut:(0,n.isSupportWXRTF)()?e=pt:(navigator.userAgent.indexOf("FBMP"),e=ct),i.Logger.info("paste injector use class: ".concat(e.name));var o=r.inject(n.PasteInterface,(0,p.vM)(e));o&&o.attach(),o instanceof at&&r.inject(n.IPasteProcessorManager,o)},ht=r(82274);function dt(t,e){var r=t.getDocument().getParaStyleAtRange(e,!0),n=(0,o.__read)(r,1)[0];return n?n.outlineLvl:g.ilm.LevelNone}function ft(t,e){var r=t.dataEngine.getDataManager().getStyleSheetManager(),n=t.dataEngine.getDataStream().getTextStream().createParagraphIterator();n.seek(e.gcpBegin);var i=n.getProperty();return null===i?null:r.mergeStyleParagraphProperty(i).ind}function yt(t,e){var r=(0,o.__spreadArray)([],(0,o.__read)(new Set(e.map((function(e){var r=e.range,n=e.outlineLevel;return null!=n?n:dt(t,r)})))),!1);r.sort();for(var n=new Map,i=0;i<r.length;i++){var a=r[i];a>=g.ilm.LevelNone||n.set(a,Math.min(i,g.keb.listLevelLimit))}return n}function vt(t,e,r){var n=e.dataEngine.getDataStream().getTextStream().createParagraphIterator(),i=t.map((function(t){var e=t.position,r=t.outlineLevel,i=t.skipCompareLevel;return n.seek(e),{range:n.getRange(),outlineLevel:r,skipCompareLevel:i}})),o=yt(r,i),a=[];return i.forEach((function(t){var e,n=t.range,i=t.outlineLevel,s=t.skipCompareLevel,l=null!=i?i:dt(r,n),c=null===(e=r.getSelection().getFirstListInfoInSelection(n))||void 0===e?void 0:e.listLevel,p=o.get(l);"number"!=typeof p||!s&&c===p||a.push({range:n,level:p})})),{diffListParas:a,outlineLevelMap:o}}function mt(t){var e,r,n,i,a=t.headingNumberingGroup,s=t.state,l=t.editor,c=(0,o.__spreadArray)([],(0,o.__read)(new Set(a.map((function(t){return t.findResult.listId})))),!1);if(1!==c.length)return a;var p=c[0];if(null===p){var u=yt(l.service,a.map((function(t){return{range:t.range}})));try{for(var g=(0,o.__values)(a),h=g.next();!h.done;h=g.next()){var d=h.value,f=dt(l.service,d.range);d.findResult.level=u.get(f)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(r=g.return)&&r.call(g)}finally{if(e)throw e.error}}return a}var y=s.dataEngine.getDataManager().getNumberingManager().getWholeListByListId(p),v=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(a.map((function(t){return{position:t.range.end()-1,skipCompareLevel:!0}}))),!1),(0,o.__read)(y.filter((function(t){return!t.isVirtual})).map((function(t){return{position:t.gcp-1}}))),!1),m=vt(v,l.state,l.service),S=m.diffListParas,b=m.outlineLevelMap;try{for(var C=(0,o.__values)(a),P=C.next();!P.done;P=C.next())d=P.value,f=dt(l.service,d.range),d.findResult.level=b.get(f)}catch(t){n={error:t}}finally{try{P&&!P.done&&(i=C.return)&&i.call(C)}finally{if(n)throw n.error}}return S.length?S.map((function(t){var e=t.level,r=t.range;return{range:r,findResult:{level:e,listId:p,paragraphIndent:ft(s,r),text:s.getDataStream().getTextStream().readText(r.begin(),r.length())}}})):a}function St(t,e){return dt(t,e)<g.ilm.LevelNone}function bt(t,e){var r=t.mergeStyleParagraphProperty(e,null);return!r.isEmpty(e.tKeys.outlineLvl)&&r.outlineLvl!==g.ilm.LevelNone}function Ct(t,e){var r=(0,o.__read)(t.getDocument().getParaStyleAtRange(e,!1),1)[0];return!r.isEmpty(r.tKeys.numPr)&&!r.numPr.isEmpty(r.numPr.tKeys.numId)&&!r.numPr.isEmpty(r.numPr.tKeys.ilvl)}function Pt(t){return!(!t||t.isEmpty(t.tKeys.numPr)||t.numPr.isEmpty(t.numPr.tKeys.numId)||t.numPr.isEmpty(t.numPr.tKeys.ilvl))}function Tt(t,e){var r,n,i;if(!Pt(t)||!e)return!1;var o=g.g85.getAbstractNumType(e,t.numPr.numId);return(null===(i=null===(n=null===(r=null==o?void 0:o.lvl)||void 0===r?void 0:r.getProperty("0"))||void 0===n?void 0:n.numFmt)||void 0===i?void 0:i.val)===g.OBG.task}function Rt(t,e,r,n){var i=t.service.getDocument(),a=e.getDataStream(),s=i.getParaStyleAtRange(r,!0),l=(0,o.__read)(s,1)[0],c=l instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&l.isPlaceholder,p=a.getTextStream().createParagraphIterator(r).getRange();if(c){var u=e.dataEngine.getDataStream().getTextStream().charCodeAt(p.end()-1);return n?n.includes(u):(0,g.dAl)(u)}return!1}function _t(t,e,r){var n=t.service.getDocument(),i=e.getDataStream().getTextStream(),a=e.getDataStream().getStoryStream(),s=e.getDataStream().getTableStream(),l=a.getSubStoryInfoFromGcp(r.gcpBegin);if(!l)return!1;var c=i.createParagraphIterator(l.contentRange);c.seek(r.gcpBegin);do{var p=c.getRange(),u=(0,o.__read)(n.getParaStyleAtRange(p,!0),1)[0],h=u instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&u.isPlaceholder,d=i.createParagraphIterator(p).getRange();if(h&&e.dataEngine.getDataStream().getTextStream().charCodeAt(d.end()-1)===g.ghV.TableStart){var f=s.getTableInfo(d.gcpBegin).range;return r.end()<=f.end()}}while(c.prev());return!1}function It(t,e){var r=t.getDataStream().getTableStream().createTableIterator();do{if(r.getRange().equal(e))return!0}while(r.next());return!1}function wt(t,e,r){var n=t.service.getDocument(),i=e.getDataStream().getTextStream().createParagraphIterator(r).getRange(),o=n.getRange(i.begin(),i.end()).getParagraphFormat().getQuote();return o&&o!==c.Jj.Undefined}function xt(t,e){if(!e)return!0;var r=Math.min(t.length,e.length),n=e.slice(0,r).map((function(t){return[t.listFormat,t.listText]})),i=t.slice(0,r).map((function(t){return[t.listFormat,t.listText]}));return(0,ht.Z)(n,i)}function Et(t,e,r,n){if(t.blockQuote!==e.blockQuote)return!1;if(!r||!n)return!1;var i=Math.min(r.length,n.length),o=n.slice(0,i).map((function(t){return{format:t.numFmt.val,text:t.lvlText.val}})),a=r.slice(0,i).map((function(t){return{format:t.numFmt.val,text:t.lvlText.val}}));return(0,ht.Z)(o,a)}function Dt(t,e){var r=[g.IfD.Space,g.IfD.Tab];return e.readText(t.gcpBegin,t.len).split("").every((function(t){return r.includes(t)}))}var kt,Lt=function(){function t(t,e){this.editor=t,this.state=e}return Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editorDocument",{get:function(){return this.editor.service.getDocument()},enumerable:!1,configurable:!0}),t.prototype.splitRangeWhen2Heading=function(t){var e=this.state,r=this.editor,n=new Set,i=[];return It(e,t)||_t(r,e,t)?this.splitRangeWhen2HeadingInTable(t,n,i):this.splitRangeWhen2HeadingInNormal(t,n,i),{rangesNeedToFindResult:i,listIdsNeedAutoAdjust:n}},t.prototype.splitRangeWhen2Normal=function(t){var e=this.state,r=this.editor,n=new Set,i=[];return It(e,t)||_t(r,e,t)?this.splitRangeWhen2NormalInTable(t,n,i):this.splitRangeWhen2NormalInNormal(t,n,i),{rangesNeedToFindResult:i,listIdsNeedAutoAdjust:n}},t.prototype.splitRangeWhen2HeadingInTable=function(t,e,r){var n=this,i=this.editor,o=this.state;u.Yy.splitCellRange(this.tableStream,t,(function(t){var a=n.textStream.createParagraphIterator(t),s=[];do{var l=a.getRange();if(!Rt(i,o,l,[g.ghV.TableCellBreak])){var c=St(i.service,l),p=n.editorDocument.getListInfoFromGcpRange(l);p&&(c?e.add(p.listId):s.push(l))}}while(a.next());return s.length&&r.push(s),!0}))},t.prototype.splitRangeWhen2HeadingInNormal=function(t,e,r){var n=this.editor,i=this.state,o=this.textStream.createParagraphIterator(t),a=[];do{var s=o.getRange();if(Rt(n,i,s,[g.ghV.TableStart])){var l=this.tableStream.getTableInfo(s.gcpBegin).range;this.splitRangeWhen2HeadingInTable(l,e,r),o.seek(l.end()-1)}else{var c=St(n.service,s),p=this.editorDocument.getListInfoFromGcpRange(s);p&&(c?e.add(p.listId):a.push(s))}}while(o.next());a.length&&r.push(a)},t.prototype.splitRangeWhen2NormalInTable=function(t,e,r){var n=this,i=this.editor,o=this.state;u.Yy.splitCellRange(this.tableStream,t,(function(t){var a=n.textStream.createParagraphIterator(t),s=[],l=[],c=!1;do{var p=a.getRange();if(!Rt(i,o,p,[g.ghV.TableCellBreak])){var u=wt(i,o,p);u&&!c&&(c=!0,l=[]),!u&&c&&(c=!1,l.length&&(r.push(l),l=[]));var h=St(i.service,p),d=n.editorDocument.getListInfoFromGcpRange(p);d&&h&&(e.add(d.listId),u?l.push(p):s.push(p))}}while(a.next());return s.length&&r.push(s),c&&l.length&&r.push(l),!0}))},t.prototype.splitRangeWhen2NormalInNormal=function(t,e,r){var n=this.editor,i=this.state,o=this.textStream.createParagraphIterator(t),a=[],s=[],l=!1;do{var c=o.getRange();if(Rt(n,i,c,[g.ghV.TableStart])){var p=this.tableStream.getTableInfo(c.gcpBegin).range;this.splitRangeWhen2NormalInTable(p,e,r),o.seek(p.end()-1)}else{var u=wt(n,i,c);u&&!l&&(l=!0,s=[]),!u&&l&&(l=!1,s.length&&(r.push(s),s=[]));var h=St(n.service,c),d=this.editorDocument.getListInfoFromGcpRange(c);d&&h&&(e.add(d.listId),(u?s:a).push(c))}}while(o.next());a.length&&r.push(a),l&&s.length&&r.push(s)},t}(),At=r(607);!function(t){t.NORMAL="NORMAL",t.NORMAL_QUOTE_PART="NORMAL_QUOTE_PART",t.NORMAL_QUOTE_ALL="NORMAL_QUOTE_ALL",t.TABLE_NORMAL="TABLE_NORMAL",t.TABLE_QUOTE_PART="TABLE_QUOTE_PART",t.TABLE_QUOTE_ALL="TABLE_QUOTE_ALL"}(kt||(kt={}));var Ft="NOT_IN_A_CELL",Mt=function(){function t(t,e){this.editor=t,this.state=e,this.buffNormalRanges=[],this.buffQuoteRanges=[],this.currCellId=Ft,this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.shouldFilterTable=function(t){return t===kt.NORMAL},this.filterTable=function(t){return t!==kt.TABLE_NORMAL&&t!==kt.TABLE_QUOTE_ALL&&t!==kt.TABLE_QUOTE_PART}}return Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),t.prototype.splitRange=function(t){var e=this.editor,r=this.state;return this.resetInitial(),It(r,t)||_t(e,r,t)?this.handleSplitRangeInTable(t):this.handleSplitRange(t),this.buff2Result(),this.result},t.prototype.handleSplitRange=function(t){var e=this.editor,r=this.state,n=this.textStream.createParagraphIterator(t);do{var i=n.getRange();if(Rt(e,r,i,[g.ghV.TableStart])){this.currQuote2Buff(this.currCellId);var o=this.tableStream.getTableInfo(i.gcpBegin).range;this.handleSplitRangeInTable(o),n.seek(o.end()-1),this.resetState2Normal()}else this.handleQuote(i,!1)||this.currBuffNormalRange.ranges.push(i)}while(n.next());this.currQuote2Buff(this.currCellId),this.currNormal2Buff()},t.prototype.handleSplitRangeInTable=function(t){var e=this,r=this.editor,n=this.state;u.Yy.splitCellRange(this.tableStream,t,(function(t){e.resetState2Cell();var i=e.textStream.createParagraphIterator(t);do{var o=i.getRange();Rt(r,n,o,[g.ghV.TableCellBreak])||e.handleQuote(o,!0)||e.currBuffCellNormalRange.ranges.push(o)}while(i.next());return e.currQuote2Buff(e.currCellId),e.currCellNormal2Buff(e.currCellId),!0})),this.currQuote2Buff(this.currCellId),this.currCellNormal2Buff(this.currCellId)},t.prototype.handleQuote=function(t,e){var r=this.editor,n=this.state;return!!wt(r,n,t)&&(this.currBuffQuoteRange.rangeType=e?kt.TABLE_QUOTE_PART:kt.NORMAL_QUOTE_PART,function(t,e,r){var n=t.service.getDocument(),i=e.getDataStream().getTextStream(),o=e.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.gcpBegin);if(!o)return!1;var a=i.createParagraphIterator(o.contentRange);if(a.seek(r.gcpBegin),!wt(t,e,r))return!1;if(!a.hasPrev())return!0;a.prev();var s=a.getRange();if(Rt(t,e,s))return!0;var l=n.getRange(s.begin(),s.end()).getParagraphFormat().getQuote();return!(l&&l!==c.Jj.Undefined)}(r,n,t)&&(!this.isQuoteStartFind&&this.isQuoteEndFind&&(this.currQuote2Buff(this.currCellId),this.isQuoteStartFind=!1,this.isQuoteEndFind=!1),this.isQuoteStartFind=!0),function(t,e,r){var n=t.service.getDocument(),i=e.getDataStream().getTextStream(),o=e.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.gcpBegin);if(!o)return!1;var a=i.createParagraphIterator(o.contentRange);if(a.seek(r.gcpBegin),!wt(t,e,r))return!1;if(!a.hasNext())return!0;a.next();var s=a.getRange();if(Rt(t,e,s))return!0;var l=n.getRange(s.begin(),s.end()).getParagraphFormat().getQuote();return!(l&&l!==c.Jj.Undefined)}(r,n,t)&&(this.isQuoteEndFind=!0),this.currBuffQuoteRange.ranges.push(t),this.isQuoteStartFind&&this.isQuoteEndFind&&(this.currBuffQuoteRange.rangeType=e?kt.TABLE_QUOTE_ALL:kt.NORMAL_QUOTE_ALL,this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currQuote2Buff(this.currCellId)),!0)},t.prototype.resetInitial=function(){this.result={normal:[],heading:[]},this.buffNormalRanges=[],this.buffQuoteRanges=[],this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=Ft,this.resetCurrBuffNormalRange(),this.resetCurrBuffQuoteRange(Ft),this.resetCurrBuffCellNormalRange(Ft)},t.prototype.resetState2Normal=function(){this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=Ft,this.resetCurrBuffQuoteRange(Ft)},t.prototype.resetState2Cell=function(){this.isQuoteStartFind=!1,this.isQuoteEndFind=!1,this.currCellId=(0,At.Z)(),this.resetCurrBuffQuoteRange(this.currCellId),this.resetCurrBuffCellNormalRange(this.currCellId)},t.prototype.resetCurrBuffNormalRange=function(){this.currBuffNormalRange={ranges:[],rangeType:kt.NORMAL,cellId:Ft}},t.prototype.resetCurrBuffQuoteRange=function(t){this.currBuffQuoteRange={ranges:[],rangeType:t===Ft?kt.NORMAL_QUOTE_PART:kt.TABLE_QUOTE_PART,cellId:t}},t.prototype.resetCurrBuffCellNormalRange=function(t){this.currBuffCellNormalRange={ranges:[],rangeType:kt.TABLE_NORMAL,cellId:t}},t.prototype.buff2Result=function(){var t,e,r,n,i,a,s=this;try{for(var l=(0,o.__values)(this.buffNormalRanges),c=l.next();!c.done;c=l.next()){var p=c.value,u=[],g=[];try{for(var h=(r=void 0,(0,o.__values)(p.ranges)),d=h.next();!d.done;d=h.next()){var f=d.value;St(this.editor.service,f)?(this.pushRanges2Result(u,p,!1),g.push(f),u=[]):u.push(f)}}catch(t){r={error:t}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}this.pushRanges2Result(u,p,!1),this.pushRanges2Result(g,p,!0)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}var y=function(t){var e,r,n=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(v.result.normal),!1),(0,o.__read)(v.result.heading),!1);if(t.rangeType===kt.NORMAL_QUOTE_ALL&&n.some((function(t){return t.rangeType===kt.NORMAL})))return"continue";if(t.rangeType===kt.TABLE_QUOTE_ALL){var i=n.some((function(e){var r=e.rangeType,n=e.cellId;return r===kt.TABLE_NORMAL&&t.cellId===n}));if(i)return"continue"}var a=[],s=[];try{for(var l=(e=void 0,(0,o.__values)(t.ranges)),c=l.next();!c.done;c=l.next()){var p=c.value;St(v.editor.service,p)?(v.pushRanges2Result(a,t,!1),s.push(p),a=[]):a.push(p)}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}v.pushRanges2Result(a,t,!1),v.pushRanges2Result(s,t,!0)},v=this;try{for(var m=(0,o.__values)(this.buffQuoteRanges),S=m.next();!S.done;S=m.next())y(p=S.value)}catch(t){i={error:t}}finally{try{S&&!S.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(this.result.normal),!1),(0,o.__read)(this.result.heading),!1).some((function(t){var e=t.rangeType;return s.shouldFilterTable(e)}))&&(this.result={normal:this.result.normal.filter((function(t){var e=t.rangeType;return s.filterTable(e)})),heading:this.result.heading.filter((function(t){var e=t.rangeType;return s.filterTable(e)}))})},t.prototype.pushRanges2Result=function(t,e,r){t.length&&(r?this.result.heading:this.result.normal).push({ranges:t,rangeType:e.rangeType,cellId:e.cellId})},t.prototype.currNormal2Buff=function(){this.currBuffNormalRange.ranges.length?(this.buffNormalRanges.push(this.currBuffNormalRange),this.resetCurrBuffNormalRange()):this.resetCurrBuffNormalRange()},t.prototype.currQuote2Buff=function(t){this.currBuffQuoteRange.ranges.length?(this.buffQuoteRanges.push(this.currBuffQuoteRange),this.resetCurrBuffQuoteRange(t)):this.resetCurrBuffQuoteRange(t)},t.prototype.currCellNormal2Buff=function(t){this.currBuffCellNormalRange.ranges.length?(this.buffNormalRanges.push(this.currBuffCellNormalRange),this.resetCurrBuffCellNormalRange(t)):this.resetCurrBuffCellNormalRange(t)},t}();function Ot(t,e){if(t.matchInfo.isMultiLevelRecognize)return!1;var r=t.matchInfo.listMatchInfos.some((function(t){var r=t.order,n=t.possibleLevels.includes(0);return e?0===r&&n:0!==r&&n}));return r}function Bt(t){return t.order+t.start-1}function Nt(t){var e=t.listInfo,r=t.editor,n=t.state,i=t.textStream,a=function(t,e,r){var n,i;try{for(var a=(0,o.__values)(e.service.getDocument().getParagraphs()),s=a.next();!s.done;s=a.next()){var l=s.value;if(t.paraId===l.getParaId()){var c=l.getRange();return{range:c,paragraphIndent:ft(r,c)}}}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return null}(e,r,n),s=a?a.range:null;return{level:e.listLevel,listId:e.listId,paragraphIndent:a?a.paragraphIndent:null,text:s?i.readText(s.gcpBegin,s.len):""}}function Ht(t){var e=t.recognizeRange,r=t.recognizeLevel,n=t.findListInfo,i=t.editor,o=t.isHeading,a=t.isMultiMaxLevelMatch,s=n.listLevel,l=n.outlineLvl;return(!o||o&&!a||dt(i.service,e)===l)&&r===s}function Wt(t){var e=t.findListInfo,r=t.isHeading,n=t.listMatchInfo,i=t.recognizeRange,o=t.editor,a=e.listLevel,s=e.outlineLvl,l=e.isVirtual,c=n.possibleLevels;if(!r)return c.includes(a);var p=dt(o.service,i);return c.includes(a)&&(!!l||p===s)}function Gt(t,e,r,n){return void 0===n&&(n=!1),n?t===e:r?t-1===e:t+1===e}var Vt,Ut,Kt=function(){function t(){}return t.hasSetIndent=function(t){return!t.isEmpty(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.left)&&t.left>0||!t.isEmpty(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.leftChars)&&t.leftChars>0||!t.isEmpty(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.firstLine)&&t.firstLine>0||!t.isEmpty(g.kkf.getPropertyClass(g.uSS.CTInd).tKeys.firstLineChars)&&t.firstLineChars>0},t.getParaStartTabCount=function(t,e){var r,n,i=e.readText(t.gcpBegin,t.len),a=0;try{for(var s=(0,o.__values)(i),l=s.next();!l.done&&l.value===g.IfD.Tab;l=s.next())a+=1}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a},t.getFinalNumericalLeftIndent=function(t,e,r,n,i,o){var a,s=null!==(a=n.getListInfoFromGcpRange(e))&&void 0!==a?a:t,l=this.getParaStartTabCount(e,r)*g.keb.tabCharsCount*g.keb.fontSize;if(s.isEmpty(s.tKeys.ind))return l;var c=s.ind;l+=c.leftChars?c.leftChars*g.keb.fontSize/g.jLu.indentChars:c.left-c.hanging;var p=c.firstLineChars?this.convertSpecialIndentFromCharToNum(c.firstLineChars,s,e,r,i):c.firstLine,u=c.hangingChars?this.convertSpecialIndentFromCharToNum(c.hangingChars,s,e,r,i):c.hanging,h=o.ignoreFirstLine,d=o.ignoreHanging;return p&&!h&&(l+=p),u&&!d&&(l+=u),l},t.convertRelativeIndentToListLevel=function(t,e){var r=t/g.keb.fontSize;if(r<this.minRelativeCharsIndent)return e;var n=Math.floor(r/this.maxRelativeCharsIndent);return e+n+(r-n*this.maxRelativeCharsIndent<this.minRelativeCharsIndent?0:1)},t.getListLevelFromIndent=function(t,e,r,n,i){var o=r.createParagraphIterator();o.seek(e.gcpBegin);var a=0,s=o.getProperty();if(!s)return a;if(!(s=n.mergeStyleParaPropWithGcp(s,e.gcpBegin)))return a;var l=this.getFinalNumericalLeftIndent(s,e,r,i,n,{ignoreHanging:!0,ignoreFirstLine:!1}),c=this.lastParaLevelInfoMap.get(t);if(c){var p=c.indent,u=c.level;(a=this.convertRelativeIndentToListLevel(l-p,u))===u&&this.lastParaLevelInfoMap.set(t,{indent:l,level:u})}else this.lastParaLevelInfoMap.set(t,{indent:l,level:a});return a},t.getNewLeftIndentAfterModify=function(e,r,n,i,o,a,s){var l=!s;return t.getFinalNumericalLeftIndent(e,r,n,i,o,{ignoreHanging:l,ignoreFirstLine:!0})+(a?1:-1)*g.keb.tabCharsCount*g.keb.fontSize},t.initializeIndentInfo=function(t,e){var r=e.getLevelType(t,0);if(r){var n=r.pPr.ind,i=n.left,o=n.hanging;this.lastParaLevelInfoMap.set(t,{indent:i-o,level:0})}},t.clearLevelCache=function(){this.lastParaLevelInfoMap.clear()},t.convertSpecialIndentFromCharToNum=function(t,e,r,n,i){var o,a=n.createRunIterator(r);a.seek(r.gcpBegin);var s=null!==(o=a.getProperty())&&void 0!==o?o:new(g.kkf.getPropertyClass(g.uSS.RunProperty));return i.mergeStyleRunPropWithGcp(s,e,r.gcpBegin).sz*t/g.jLu.indentChars},t.lastParaLevelInfoMap=new Map,t.minRelativeCharsIndent=1,t.maxRelativeCharsIndent=2,t}(),zt=function(t){var e=[];return t.lvl.forEach((function(t){e.push(t.clone())})),e.length>0&&g.g85.isTaskFormat(e[0].numFmt.val)?[e[0]]:e.sort((function(t,e){return t.ilvl-e.ilvl}))},jt=function(t,e){var r=e.getAbstractNumType(t);return r?zt(r):null},qt=function(t,e,r){var n=g.keb.tabCharsCount;e||(n*=-1);var i=t.every((function(t){var e=t.pPr.ind,i=e.left,o=e.leftChars,a=e.hanging,s=0;return s=o>0?(o+n*g.jLu.indentChars)/g.jLu.indentChars*g.keb.fontSize:n*g.keb.fontSize+i-a,r(s)===s}));return i?t.map((function(t){var e=t,r=e.pPr.ind,i=r.left,o=r.leftChars;return o>0?e.pPr.ind.leftChars=o+n:e.pPr.ind.left=n*g.keb.fontSize+i,e})):null},Xt=function(t,e,r,n,i){var a=[],s=(0,o.__read)(e,1)[0];if(!s)return a;var l=s.listFormat,c=g.g85.isTaskFormat(l)||g.g85.isBulletFormat(l),p=function(t,e,r,n,i,o){var a,s=n.createParagraphIterator(t);s.seek(t.gcpBegin);var l=new(g.kkf.getPropertyClass(g.uSS.CTLvlWml)),c=s.getProperty();if(!c)return l;if(!(c=i.mergeStyleParaPropWithGcp(c,t.gcpBegin)))return l;var p=Kt.getFinalNumericalLeftIndent(c,t,n,o,i,{ignoreHanging:!0,ignoreFirstLine:!1});return l.ilvl=0,l.pPr.ind.hanging=null!==(a=e.listHangingIndent)&&void 0!==a?a:g.keb.listDefaultHanging,l.pPr.ind.left=p+l.pPr.ind.hanging,l.start=1,l.lvlJc=g.aLG.left,l.numFmt.val=e.listFormat,l.lvlText.val=e.listText,r&&g.g85.setSpanFont(l.rPr,"wingdings"),l}(t,s,c,r,n,i);return g.g85.isTaskFormat(l)?a.push(p):e.slice(1).forEach((function(t,e){var r=function(t,e,r,n,i){var o,a;void 0===i&&(i=!1);var s=new(g.kkf.getPropertyClass(g.uSS.CTLvlWml));s.ilvl=n,s.start=1,s.lvlJc=g.aLG.left,s.numFmt.val=t.listFormat,s.lvlText.val=t.listText;var l=null!==(o=t.listHangingIndent)&&void 0!==o?o:g.keb.listDefaultHanging;return s.pPr.ind.hanging=l,t.listLeftIndent&&(s.pPr.ind.left=r.pPr.ind.left-r.pPr.ind.hanging+t.listLeftIndent-(null!==(a=e.listLeftIndent)&&void 0!==a?a:0)+l),i&&g.g85.setSpanFont(s.rPr,"wingdings"),s}(t,s,p,e+1,c);a.push(r)})),g.g85.completeListTemplateParagraphs(p,a,g.keb.listLevelLimit),a},Qt=function(t,e){var r,n,i=t.clone(),o=i.pPr.ind.left-i.pPr.ind.hanging;return i.numFmt.val=e.listFormat,i.lvlText.val=e.listText,i.pPr.ind.hanging=null!==(r=e.listHangingIndent)&&void 0!==r?r:g.keb.listDefaultHanging,i.pPr.ind.left=(null!==(n=e.listLeftIndent)&&void 0!==n?n:o)+i.pPr.ind.hanging,["","wingdings"].includes(i.rPr.rFonts.eastAsia)&&(g.g85.isBulletFormat(i.numFmt.val)?g.g85.setSpanFont(i.rPr,"wingdings"):g.g85.setSpanFont(i.rPr,"")),i},Yt=function(t,e){var r=g.g85.getPeriodListStyleset(e);return 1===e.length&&e[0].listFormat===g.OBG.task?[Qt(t[0],e[0])]:t.reduce((function(t,e){var n=r[e.ilvl%r.length],i=Qt(e,n);return t.push(i),t}),[])},Jt=function(t,e){var r=[];return t.forEach((function(t){var n=t.listLevel,i=t.start,o=e.findIndex((function(t){return t.ilvl===n})),a=e[o];if(a&&a.start!==i){var s=function(t,e){var r=t.clone();return r.start=e,r}(a,i);r.push(s),e.splice(o,1)}})),r.push.apply(r,(0,o.__spreadArray)([],(0,o.__read)(e),!1)),r.sort((function(t,e){return t.ilvl-e.ilvl})),r},Zt=function(t,e){return new RegExp("^\t*(".concat(t,")([").concat(e,"])( )*"))},$t={BulletCircle:[{listFormat:g.OBG.bullet,listText:g.ly6.Circle},{listFormat:g.OBG.bullet,listText:g.ly6.HollowCircle},{listFormat:g.OBG.bullet,listText:g.ly6.Square}],BulletArrow:[{listFormat:g.OBG.bullet,listText:g.ly6.Arrow},{listFormat:g.OBG.bullet,listText:g.ly6.HollowCircle},{listFormat:g.OBG.bullet,listText:g.ly6.Square}],BulletHook:[{listFormat:g.OBG.bullet,listText:g.ly6.Hook},{listFormat:g.OBG.bullet,listText:g.ly6.Circle},{listFormat:g.OBG.bullet,listText:g.ly6.Diamond}],BulletHollowCircle:[{listFormat:g.OBG.bullet,listText:g.ly6.HollowCircle},{listFormat:g.OBG.bullet,listText:g.ly6.Square},{listFormat:g.OBG.bullet,listText:g.ly6.Diamond}],BulletStar:[{listFormat:g.OBG.bullet,listText:g.ly6.Star},{listFormat:g.OBG.bullet,listText:g.ly6.Arrow},{listFormat:g.OBG.bullet,listText:g.ly6.Square}],NumberDecimal:[{listFormat:g.OBG.decimal,listText:"%1."},{listFormat:g.OBG.lowerLetter,listText:"%2."},{listFormat:g.OBG.lowerRoman,listText:"%3."},{listFormat:g.OBG.decimal,listText:"%4."},{listFormat:g.OBG.lowerLetter,listText:"%5."},{listFormat:g.OBG.lowerRoman,listText:"%6."},{listFormat:g.OBG.decimal,listText:"%7."},{listFormat:g.OBG.lowerLetter,listText:"%8."},{listFormat:g.OBG.lowerRoman,listText:"%9."}],NumberLevelDecimal:[{listFormat:g.OBG.decimal,listText:"%1.",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.decimal,listText:"%1.%2.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+.8*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+1.6*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+2.4*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.%5.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+3.2*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.%5.%6.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+4*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+4.8*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.%8.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+5.6*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%1.%2.%3.%4.%5.%6.%7.%8.%9.",listHangingIndent:Math.floor(g.keb.listDefaultHanging+6.4*g.keb.fontSizeStable)}],NumberIdeographicComma:[{listFormat:g.OBG.decimal,listText:"%1、"},{listFormat:g.OBG.lowerLetter,listText:"%2)"},{listFormat:g.OBG.lowerRoman,listText:"%3)"},{listFormat:g.OBG.decimal,listText:"%4、"},{listFormat:g.OBG.lowerLetter,listText:"%5)"},{listFormat:g.OBG.lowerRoman,listText:"%6)"},{listFormat:g.OBG.decimal,listText:"%7、"},{listFormat:g.OBG.lowerLetter,listText:"%8)"},{listFormat:g.OBG.lowerRoman,listText:"%9)"}],NumberSingleParentheses:[{listFormat:g.OBG.decimal,listText:"%1)"},{listFormat:g.OBG.lowerLetter,listText:"%2)"},{listFormat:g.OBG.lowerRoman,listText:"%3)"},{listFormat:g.OBG.decimal,listText:"%4)"},{listFormat:g.OBG.lowerLetter,listText:"%5)"},{listFormat:g.OBG.lowerRoman,listText:"%6)"},{listFormat:g.OBG.decimal,listText:"%7)"},{listFormat:g.OBG.lowerLetter,listText:"%8)"},{listFormat:g.OBG.lowerRoman,listText:"%9)"}],NumberParentheses:[{listFormat:g.OBG.decimal,listText:"(%1)"},{listFormat:g.OBG.lowerLetter,listText:"%2."},{listFormat:g.OBG.lowerRoman,listText:"%3."},{listFormat:g.OBG.decimal,listText:"(%4)"},{listFormat:g.OBG.lowerLetter,listText:"%5."},{listFormat:g.OBG.lowerRoman,listText:"%6."},{listFormat:g.OBG.decimal,listText:"(%7)"},{listFormat:g.OBG.lowerLetter,listText:"%8."},{listFormat:g.OBG.lowerRoman,listText:"%9."}],NumberChinese:[{listFormat:g.OBG.chineseCountingThousand,listText:"%1、",listHangingIndent:Math.floor(g.keb.mediumListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%2、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%3)",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.chineseCountingThousand,listText:"%4、",listHangingIndent:Math.floor(g.keb.mediumListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%5、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%6)",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.chineseCountingThousand,listText:"%7、",listHangingIndent:Math.floor(g.keb.mediumListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%8、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%9)",listHangingIndent:g.keb.listDefaultHanging}],NumberChineseParentheses:[{listFormat:g.OBG.chineseCountingThousand,listText:"（%1）",listHangingIndent:Math.floor(g.keb.bigListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%2、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%3)",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.chineseCountingThousand,listText:"（%4）",listHangingIndent:Math.floor(g.keb.bigListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%5、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%6)",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.chineseCountingThousand,listText:"（%7）",listHangingIndent:Math.floor(g.keb.bigListFontNum*g.keb.fontSizeStable)},{listFormat:g.OBG.decimal,listText:"%8、",listHangingIndent:g.keb.listDefaultHanging},{listFormat:g.OBG.lowerLetter,listText:"%9)",listHangingIndent:g.keb.listDefaultHanging}],NumberUpperLetter:[{listFormat:g.OBG.upperLetter,listText:"%1."},{listFormat:g.OBG.lowerLetter,listText:"%2."},{listFormat:g.OBG.lowerRoman,listText:"%3."},{listFormat:g.OBG.upperLetter,listText:"%4."},{listFormat:g.OBG.lowerLetter,listText:"%5."},{listFormat:g.OBG.lowerRoman,listText:"%6."},{listFormat:g.OBG.upperLetter,listText:"%7."},{listFormat:g.OBG.lowerLetter,listText:"%8."},{listFormat:g.OBG.lowerRoman,listText:"%9."}],TaskList:[{listFormat:g.OBG.task,listText:g.G2o.Todo}]},te=[$t.NumberDecimal,$t.NumberLevelDecimal,$t.NumberIdeographicComma,$t.NumberSingleParentheses,$t.NumberParentheses,$t.NumberChinese,$t.NumberChineseParentheses,$t.NumberUpperLetter],ee=[{prefix:"",suffix:".",indentFactor:.5},{prefix:"",suffix:"、",indentFactor:1},{prefix:"",suffix:")",indentFactor:.5},{prefix:"(",suffix:")",indentFactor:.5},{prefix:"（",suffix:"）",indentFactor:1}],re={"一":1,"二":2,"三":3,"四":4,"五":5,"六":6,"七":7,"八":8,"九":9,"零":0},ne=ee.map((function(t){return t.suffix})).join(""),ie=((Vt={})[g.OBG.decimal]=[/^([1-9]\d{0,3})(\.)(\u0020*)(?!\d)/,Zt("[1-9]\\d{0,3}",ne.replace(".",""))],Vt[g.OBG.lowerLetter]=[Zt("[a-z]+",ne)],Vt[g.OBG.upperLetter]=[Zt("[A-Z]+",ne)],Vt[g.OBG.lowerRoman]=[Zt("i[xv]|v?i{0,3}",ne)],Vt[g.OBG.upperRoman]=[Zt("I[XV]|V?I{0,3}",ne)],Vt[g.OBG.chineseCountingThousand]=[Zt("([一二三四五六七八九]?十)?[一二三四五六七八九]?",ne)],Vt),oe=/^\t*(([1-9]\d{0,3}\.){2,})(\u0020)*(?!\d)/,ae=((Ut={})[g.OBG.decimal]="1",Ut[g.OBG.lowerLetter]="a",Ut[g.OBG.lowerRoman]="i",Ut[g.OBG.chineseCountingThousand]="一",Ut[g.OBG.upperLetter]="A",Ut[g.OBG.upperRoman]="I",Ut),se=[g.g85.getDefaultBulletListText(1),g.g85.getDefaultBulletListText(2)],le=[g.g85.getDefaultNumberListStyle(1),g.g85.getDefaultNumberListStyle(2)];function ce(t){if(t.length>0){var e=(0,o.__read)(t,1)[0];if(g.g85.isTaskFormat(e.listFormat))return"task";var r=[];if(g.g85.isBulletFormat(e.listFormat))for(var n=0;n<3;++n)r.push(t[n]?t[n].listText:se[n-1]);else{var i=t.length>=3?t:(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(t),!1),(0,o.__read)(le),!1),a=i.map((function(t){return ae[t.listFormat]||"1"})),s=function(t){i[t]&&i[t].listText&&r.push(i[t].listText.replace(/%([1-9])/g,(function(){return a[t]||""})))};for(n=0;n<3;++n)s(n)}return r.join(" ")}return""}new Map(Object.values($t).map((function(t){return[ce(t),t]}))),$t.BulletCircle,$t.NumberDecimal,$t.TaskList;var pe=function(){function t(){}return t.getImageInfo=function(t){var e,r,n,i,o;return null===(o=null===(i=null===(n=null===(r=null===(e=t.drawing.graphic)||void 0===e?void 0:e.graphicData)||void 0===r?void 0:r.pic)||void 0===n?void 0:n.blipFill)||void 0===i?void 0:i.blip)||void 0===o?void 0:o.embed},t.createClearRunProperty=function(){var t=new(g.kkf.getPropertyClass(g.uSS.RunProperty));return t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.b),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.sz),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.u),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.strike),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.i),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.spacing),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.vertAlign),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.rFonts),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.color),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.shd),t.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.w),t},t.createStoryPropertyFromType=function(t){var e=null;switch(t){case g.AHI.headerContent:e=new(g.kkf.getPropertyClass(g.uSS.HeaderStoryProperty));break;case g.AHI.footerContent:e=new(g.kkf.getPropertyClass(g.uSS.FooterStoryProperty));break;case g.AHI.footnoteContent:e=new(g.kkf.getPropertyClass(g.uSS.FootnoteStoryProperty));break;case g.AHI.endnoteContent:e=new(g.kkf.getPropertyClass(g.uSS.EndnoteStoryProperty));break;case g.AHI.commentContent:e=new(g.kkf.getPropertyClass(g.uSS.CommentStoryProperty));break;case g.AHI.textboxContent:e=new(g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty));break;default:i.Logger.warn("story类型错误！")}return e},t.isTextFrame=function(t,e){var r=e.drawing.graphic.graphicData.wsp,n=t.getStoryStream().getSubStoryInfoFromId(r.txbx.contentId,g.AHI.textboxContent);return(null==n?void 0:n.subStoryProp)instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)},t.isStoryOperation=function(t){return t instanceof u.di||(t instanceof u.jb?t.param.property.isPlaceholder:t instanceof u.IZ&&[g.IfD.SubStoryBegin,g.IfD.SubStoryEnd].includes(t.param.text))},t.isStoryEndBreak=function(t){return t instanceof u.IZ&&t.param.text===g.IfD.SubStoryEnd},t.isStoryStartBreak=function(t){return t instanceof u.IZ&&t.param.text===g.IfD.SubStoryBegin},t.isTableSeperate=function(t){return[g.IfD.TableCellBreak,g.IfD.TableRowBreak,g.IfD.TableStart,g.IfD.TableEnd].includes(t)},t.generateStyleProperty=function(t,e,r){var n=e.getStylePropertyFromName(r);if(!n){var i=e.packBuiltinStyleProperty(r);i&&(n=i.styleProp,u.Gh.setSettingProperty(i.stylesProp,g.LK6.styles,t))}return n},t.adjustColor=function(t){if(!/(^[0-9A-F]{6}$)|(^[0-9a-f]{6}$)/i.test(t))return t;var e=t.slice(0,2),r=t.slice(2,4),n=t.slice(4,6),i=(0,o.__read)([e,r,n].map((function(t){return function(t){return 255===t?t-Math.round(5*Math.random()):0===t?t+Math.round(5*Math.random()):t}(function(t){return Math.max(Math.min(t,255),0)}((e=t,parseInt(e,16)+Math.round(10*Math.random()-5)))).toString(16).padStart(2,"0");var e})),3),a=i[0],s=i[1],l=i[2];return"".concat(a).concat(s).concat(l)},t.isTableEnd=function(t,e){var r=e.getTableStream().getTableInfo(t);return!!r&&r.range.end()-1===t},t.shouldInsertParaBeforeTable=function(e,r){var n=new rn(r);return!r.isRangeBeginAtParaStart(new g.ICE(e,0))||e===n.storyRange().begin()||t.isTableEnd(e-1,r)},t.defaultCp=-1,t.blod=!0,t}(),ue=function(t,e){var r=e.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(!r)throw Error("invalid gcp range for list operation");return t.end()>r.range.end()?r.range.intersectRange(t):t},ge=function(t,e){var r=[];return u.Yy.splitCellRange(e.getTableStream(),t,(function(t){var n=e.getTextStream().createParagraphIterator(t),i=e.getTextStream().createRunIterator();do{var o=n.getRange();i.seek(o.end()-1);var a=e.getTextStream().readText(o.begin(),1);a&&!pe.isTableSeperate(a)&&r.push(o)}while(n.next());return!0})),r},he=function(t){return t.reduce((function(t,e){return[Math.min(t[0],e.listLevel),Math.max(t[1],e.listLevel)]}),[Number.POSITIVE_INFINITY,-1])},de=function(t,e){return Math.max(0,Math.min(t,e-1))},fe=function(t,e,r){if(r===g.RHh.Task)return 1;var n=jt(t,e);return n&&n.length?n[n.length-1].ilvl+1:g.keb.listLevelLimit},ye=function(t,e){return t===g.RHh.Numbered?e?$t.NumberLevelDecimal:$t.NumberDecimal:t===g.RHh.Bullet?$t.BulletCircle:$t.TaskList},ve=function(){function t(){}return t.init=function(){this.initListOrderParserMap(),this.initListMarkStyleSetMap(te),this.initAvailableListCharacterConfig(),this.initListDelimiterMap()},t.getListMatchInfo=function(t){if(!(t.length<2))return this.checkIsMultiLevel(t)?this.getMultiLevelListMatchInfo(t):this.getSingleLevelListMatchInfo(t)},t.getListOrderForSingleLevelFromMatchInfo=function(t){if(!t.isMultiLevelRecognize){var e=t.listMatchInfos.map((function(t){return t.order}));return(0,o.__spreadArray)([],(0,o.__read)(new Set(e)),!1)}},t.getListStylesFromMatchInfo=function(t,e){var r;if(!t.isMultiLevelRecognize)return e&&t.listMatchInfos.some((function(t){return t.listStyles===$t.NumberLevelDecimal}))?$t.NumberLevelDecimal:null===(r=t.listMatchInfos.find((function(t){return t.possibleLevels.includes(0)})))||void 0===r?void 0:r.listStyles},t.initListOrderParserMap=function(){this.listOrderParserMap.set(g.OBG.decimal,this.parseDecimalOrder),this.listOrderParserMap.set(g.OBG.lowerLetter,this.parseLowerLetterOrder),this.listOrderParserMap.set(g.OBG.upperLetter,this.parseUpperLetterOrder),this.listOrderParserMap.set(g.OBG.lowerRoman,this.parseLowerRomanOrder),this.listOrderParserMap.set(g.OBG.upperRoman,this.parseUpperRomanOrder),this.listOrderParserMap.set(g.OBG.chineseCountingThousand,this.parseChineseOrder)},t.initListMarkStyleSetMap=function(t){var e=this;t.forEach((function(t){t.forEach((function(r){var n=r.listFormat,i=r.listText,o=e.getListMarkInfoFromListText(i);if(o){var a=o.prefix,s=o.suffix,l="".concat(n,"_").concat(a,"_").concat(s);e.listMarkStyleSetMap.has(l)?e.listMarkStyleSetMap.get(l).add(t):e.listMarkStyleSetMap.set(l,new Set([t]))}}))}))},t.initAvailableListCharacterConfig=function(){this.initCharacterConfig("0123456789",g.OBG.decimal),this.initCharacterConfig("abcdefghijklmnopqrstuvwxyz",g.OBG.lowerLetter),this.initCharacterConfig("ABCDEFGHIJKLMNOPQRSTUVWXYZ",g.OBG.upperLetter),this.initCharacterConfig("ivx",g.OBG.lowerRoman),this.initCharacterConfig("IVX",g.OBG.upperRoman),this.initCharacterConfig("一二三四五六七八九十",g.OBG.chineseCountingThousand)},t.initListDelimiterMap=function(){var t=this;ee.forEach((function(e){var r=e.prefix,n=e.suffix;t.listDelimiterMap.has(r)?t.listDelimiterMap.get(r).push(n):t.listDelimiterMap.set(r,[n])}))},t.getSingleLevelListMatchInfo=function(t){var e=this,r=[],n="",i=t.trimStart(),a="",s=(0,o.__read)(i,2),l=s[0],c=s[1],p=this.listCharacterConfigMap.get(l);if(p||(n=l,i=i.slice(1),p=this.listCharacterConfigMap.get(c)),p)return p.forEach((function(t){var s,l,c,p,u=t.format,g=t.matchRegExpList;try{for(var h=(0,o.__values)(g),d=h.next();!d.done;d=h.next()){var f=d.value,y=i.match(f);if(y){var v=(0,o.__read)(y,2),m=v[0],S=v[1],b=y[y.length-2];a="".concat(n).concat(m);var C="".concat(u,"_").concat(n,"_").concat(b),P=e.listMarkStyleSetMap.get(C),T=e.getListOrder(u,S);if(P&&"number"==typeof T)try{for(var R=(c=void 0,(0,o.__values)(P.values())),_=R.next();!_.done;_=R.next()){var I=_.value,w=e.getPossibleLevels(u,n,b,I);r.push({listStyles:I,possibleLevels:w,order:T})}}catch(t){c={error:t}}finally{try{_&&!_.done&&(p=R.return)&&p.call(R)}finally{if(c)throw c.error}}}}}catch(t){s={error:t}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(s)throw s.error}}})),{isMultiLevelRecognize:!1,fullText:a,listMatchInfos:r}},t.getMultiLevelListMatchInfo=function(t){var e=this,r=t.match(oe),n=(0,o.__read)(r,2),i=n[0],a=n[1],s=[];return a.slice(0,-1).split(".").forEach((function(t,r){var n=e.getListOrder(g.OBG.decimal,t);"number"==typeof n&&s.push({order:n,level:r})})),{listStyles:$t.NumberLevelDecimal,fullText:i,isMultiLevelRecognize:!0,orderAndLevel:s}},t.getPossibleLevels=function(t,e,r,n){var i=this,o=[];return n.forEach((function(n,a){var s=n.listFormat,l=n.listText,c=i.getListMarkInfoFromListText(l);if(c){var p=c.prefix,u=c.suffix;e===p&&r===u&&t===s&&o.push(a)}})),o},t.initCharacterConfig=function(t,e){var r=this,n={format:e,matchRegExpList:ie[e]};t.split("").forEach((function(t){r.listCharacterConfigMap.has(t)?r.listCharacterConfigMap.get(t).push(n):r.listCharacterConfigMap.set(t,[n])}))},t.checkIsMultiLevel=function(t){return oe.test(t)},t.getListOrder=function(t,e){var r=this.listOrderParserMap.get(t);return null==r?void 0:r(e)},t.getListMarkInfoFromListText=function(t){if(!/(%\d\.){2,}/.test(t)){var e="",r=(0,o.__read)(t,1)[0];return"%"!==r&&(e=r),{prefix:e,suffix:t[t.length-1]}}},t.parseDecimalOrder=function(t){return parseInt(t,10)-1},t.parseLowerLetterOrder=function(e){var r,n,i=e.split("").map(t.convertSingleLetterToDigit),a=0;try{for(var s=(0,o.__values)(i),l=s.next();!l.done;l=s.next()){var c=l.value;a*=26,a+=c}}catch(t){r={error:t}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return a-1},t.parseUpperLetterOrder=function(e){return t.parseLowerLetterOrder(e.toLowerCase())},t.parseLowerRomanOrder=function(e){for(var r=t.convertSingleRomanToDigit(e[0]),n=r,i=1;i<e.length;++i){var o=t.convertSingleRomanToDigit(e[i]);o<=n?r+=o:r=r-2*n+o,n=o}return r-1},t.parseUpperRomanOrder=function(e){return t.parseLowerRomanOrder(e.toLowerCase())},t.parseChineseOrder=function(t){return 1===t.length?re[t]-1:2===t.length?t.startsWith("十")?10+re[t[1]]-1:t.endsWith("十")?10*re[t[0]]-1:Number.NaN:10*re[t[0]]+re[t[2]]-1},t.convertSingleLetterToDigit=function(t){return t.charCodeAt(0)-96},t.convertSingleRomanToDigit=function(t){switch(t){case"x":return 10;case"v":return 5;default:return 1}},t.listDelimiterMap=new Map,t.listOrderParserMap=new Map,t.listCharacterConfigMap=new Map,t.listMarkStyleSetMap=new Map,t}();function me(t){var e=t.listId,r=t.listDeltaHandler,n=t.contextRanges,i=t.listIdsNeedAutoAdjust,a=t.delta,s=t.extraAdjustRangeMap;i.add(e);var l=s.get(e)||[];l.push.apply(l,(0,o.__spreadArray)([],(0,o.__read)(n),!1)),s.set(e,l),r.setListPropsInRanges(e,n.map((function(t){return{range:t,level:0}})),a)}function Se(t){var e,r,n=t.listDeltaHandler,i=t.contextRanges,a=t.listIdsNeedAutoAdjust,s=t.delta,l=t.extraAdjustRangeMap,c=null!==(r=null===(e=t.editorDocument.getListInfoFromGcpRange(i[0]))||void 0===e?void 0:e.listType)&&void 0!==r?r:g.RHh.Numbered,p=n.setListWithCreateInfo(i[0],{listType:c,listId:null,level:0},!0,s).listId;i.slice(1).forEach((function(t){return n.setListWithCreateInfo(t,{listType:c,listId:p,level:0},!0,s)})),a.add(p),l.set(p,(0,o.__spreadArray)([],(0,o.__read)(i),!1))}function be(t,e,r,n){var i,a,s=t.context,l=s.service,c=l.getDocument(),p=e.pPr.outlineLvl,u=new Lt(s,t),g=new ze(t,l),h=new Ke(s,t),d=new Map,f=u.splitRangeWhen2Heading(n),y=f.rangesNeedToFindResult,v=f.listIdsNeedAutoAdjust;v.forEach((function(t){return d.set(t,[])}));try{for(var m=(0,o.__values)(y),S=m.next();!S.done;S=m.next()){var b=S.value;if(b.length){var C=h.findWhenSetHeading(b).listId,P={listDeltaHandler:g,listIdsNeedAutoAdjust:v,extraAdjustRangeMap:d,delta:r,contextRanges:b,editorDocument:c};C?me((0,o.__assign)({listId:C},P)):Se(P)}}}catch(t){i={error:t}}finally{try{S&&!S.done&&(a=m.return)&&a.call(m)}finally{if(i)throw i.error}}!function(t){var e,r,n=t.state,i=t.listDeltaHandler,a=t.listIdsNeedAutoAdjust,s=t.extraAdjustRangeMap,l=t.newOutlineLvl,c=t.range,p=t.delta,u=n.context.service,g=n.dataEngine.getDataManager().getNumberingManager(),h=n.dataEngine.getDataStream().getTextStream().createParagraphIterator();try{for(var d=(0,o.__values)(a),f=d.next();!f.done;f=d.next()){var y=f.value,v=g.getWholeListByListId(y).filter((function(t){return!t.isVirtual})),m=s.get(y)||[],S=v.map((function(t){var e=t.gcp;h.seek(e-1);var r=h.getRange();return{position:e-1,outlineLevel:r.intersect(c)?l:dt(u,r)}})),b=m.map((function(t){return{position:t.begin(),outlineLevel:l}})),C=vt((0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(S),!1),(0,o.__read)(b),!1),n,u).diffListParas;i.setListPropsInRanges(y,C,p)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}}({state:t,listIdsNeedAutoAdjust:v,extraAdjustRangeMap:d,newOutlineLvl:p,listDeltaHandler:g,range:n,delta:r})}function Ce(t){var e=t.editorDocument,r=t.listId,n=t.listDeltaHandler,i=t.contextRanges,o=t.delta,a=t.extraAdjustRangeMap;i.forEach((function(t){var r,n=null===(r=e.getListInfoFromGcpRange(t))||void 0===r?void 0:r.listId;if(n){var i=a.get(n)||[];i.push(t),a.set(n,i)}})),n.setListPropsInRanges(r,i.map((function(t){return{range:t,level:0}})),o)}function Pe(t){var e,r,n=t.editorDocument,i=t.listDeltaHandler,a=t.contextRanges,s=t.delta,l=t.extraAdjustRangeMap,c=null!==(r=null===(e=n.getListInfoFromGcpRange(a[0]))||void 0===e?void 0:e.listType)&&void 0!==r?r:g.RHh.Numbered,p=i.setListWithCreateInfo(a[0],{listType:c,listId:null,level:0},!1,s).listId;a.slice(1).forEach((function(t){return i.setListWithCreateInfo(t,{listType:c,listId:p,level:0},!1,s)})),l.forEach((function(t){return t.push.apply(t,(0,o.__spreadArray)([],(0,o.__read)(a),!1))}))}function Te(t,e,r){var n,i,a=t.context,s=a.service,l=s.getDocument(),c=new Lt(a,t),p=new ze(t,s),u=new Ke(a,t),g=new Map,h=c.splitRangeWhen2Normal(r),d=h.rangesNeedToFindResult,f=h.listIdsNeedAutoAdjust;f.forEach((function(t){return g.set(t,[])}));try{for(var y=(0,o.__values)(d),v=y.next();!v.done;v=y.next()){var m=v.value;if(m.length){var S=u.findWhenSetNormal(m).listId,b={listDeltaHandler:p,listIdsNeedAutoAdjust:f,extraAdjustRangeMap:g,delta:e,contextRanges:m,editorDocument:l};S?Ce((0,o.__assign)((0,o.__assign)({},b),{listId:S})):Pe(b)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}!function(t){var e,r,n,i,a=t.state,s=t.listDeltaHandler,l=t.listIdsNeedAutoAdjust,c=t.extraAdjustRangeMap,p=t.delta,u=a.context,g=a.dataEngine.getDataStream().getTextStream().createParagraphIterator(),h=a.dataEngine.getDataManager().getNumberingManager();try{for(var d=(0,o.__values)(l),f=d.next();!f.done;f=d.next()){var y=f.value,v=h.getWholeListByListId(y).filter((function(t){return!t.isVirtual})).map((function(t){return g.seek(t.gcp-1),g.getRange()})),m=c.get(y),S=[],b=function(t){m.some((function(e){return e.intersect(t)}))||S.push(t)};try{for(var C=(n=void 0,(0,o.__values)(v)),P=C.next();!P.done;P=C.next())b(P.value)}catch(t){n={error:t}}finally{try{P&&!P.done&&(i=C.return)&&i.call(C)}finally{if(n)throw n.error}}var T=vt(S.map((function(t){return{position:t.gcpBegin,skipCompareLevel:!0}})),a,u.service).diffListParas;s.setListPropsInRanges(y,T,p)}}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}}({state:t,listIdsNeedAutoAdjust:f,extraAdjustRangeMap:g,listDeltaHandler:p,delta:e})}function Re(t,e,r,n){if(e.pPr.outlineLvl<g.ilm.LevelNone)return be(t,e,r,n);Te(t,r,n)}function _e(t,e,r,n){if(n)return n.forEach((function(n){return Re(t,e,r,n)}));var i=r.globalOpts.originRange;Re(t,e,r,i)}var Ie=function(t,e,r){var n,i,a,s;if(t.isValid()){var l=e.context.service,c=e.dataEngine.getDataStream().getTextStream().createParagraphIterator(),p=new ze(e,l),u=e.dataEngine.getDataManager().getNumberingManager(),h=u.getListInfoArrayFromGcpRange(t);h=h.filter((function(e){var r=e.gcp;return c.seek(r-1),t.contains(c.getRange())}));var d=h.filter((function(t){var e=t.outlineLvl;return!t.isVirtual&&e<g.ilm.LevelNone})),f=new Map;d.forEach((function(t){var e=t.listId,r=t.gcp;c.seek(r-1);var n=c.getRange(),i=f.get(e)||[];i.push(n),f.set(e,i)}));try{for(var y=(0,o.__values)(f),v=y.next();!v.done;v=y.next()){var m=(0,o.__read)(v.value,2),S=m[0],b=m[1],C=u.getWholeListByListId(S).filter((function(t){return!t.isVirtual})).map((function(t){return c.seek(t.gcp-1),c.getRange()})),P=[],T=function(t){b.some((function(e){return e.intersect(t)}))||P.push(t)};try{for(var R=(a=void 0,(0,o.__values)(C)),_=R.next();!_.done;_=R.next())T(_.value)}catch(t){a={error:t}}finally{try{_&&!_.done&&(s=R.return)&&s.call(R)}finally{if(a)throw a.error}}var I=vt(P.map((function(t){return{position:t.gcpBegin}})),e,l).diffListParas;p.setListPropsInRanges(S,I,r)}}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}}};function we(t,e,r){var n,i,a,s,l=e.context.service,c=e.dataEngine.getDataManager().getNumberingManager(),p=new ze(e,l),u=new Map,g=e.dataEngine.getDataStream().getTextStream().createParagraphIterator();g.setLimitRange(t);do{var h=g.getRange(),d=St(l,h),f=c.getListInfoFromGcpRange(h);d&&f&&((C=u.get(f.listId)||[]).push(h),u.set(f.listId,C))}while(g.next());var y=e.dataEngine.getDataStream().getTextStream().createParagraphIterator();try{for(var v=(0,o.__values)(u),m=v.next();!m.done;m=v.next()){var S=(0,o.__read)(m.value,2),b=S[0],C=S[1],P=c.getWholeListByListId(b).filter((function(t){return!t.isVirtual})).map((function(t){return y.seek(t.gcp-1),y.getRange()})),T=[],R=function(t){C.some((function(e){return e.intersect(t)}))||T.push(t)};try{for(var _=(a=void 0,(0,o.__values)(P)),I=_.next();!I.done;I=_.next())R(I.value)}catch(t){a={error:t}}finally{try{I&&!I.done&&(s=_.return)&&s.call(_)}finally{if(a)throw a.error}}var w=vt(T.map((function(t){return{position:t.gcpBegin,skipCompareLevel:!0}})),e,l).diffListParas;p.setListPropsInRanges(b,w,r)}}catch(t){n={error:t}}finally{try{m&&!m.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}function xe(t,e,r,n,i){i?we(t,e,r):(we(t,e,r),function(t,e,r,n){var i=r.context.service,o=r.dataEngine.getDataManager().getNumberingManager();if(o.isListParagraph(t)){var a=r.dataEngine.getDataManager().getStyleSheetManager();r.dataEngine.getDataStream().getTextStream().createParagraphIterator().setLimitRange(e);var s=t.numPr.numId,l=o.getListTypeByListId(s),c=t.numPr.ilvl,p=i.getNumbering().getListStyleset(s),u=new ze(r,i),g=bt(a,t),h=ge(e,r.dataEngine.getDataStream()),d=u.setListWithCreateInfo(h[0],{listType:l,listId:null,level:c,listStyles:p},g,n);h.slice(1).forEach((function(t){return u.setListWithCreateInfo(t,{listType:l,listId:d.listId,level:c,listStyles:p},g,n)}))}}(n,t,e,r))}var Ee=r(32922),De=function(){function t(t,e){this.editor=t,this.state=e}return Object.defineProperty(t.prototype,"numbering",{get:function(){return this.editor.service.getNumbering()},enumerable:!1,configurable:!0}),t.prototype.findRecognizeFlow=function(t,e){var r=function(t,e){return{level:0,listId:null,paragraphIndent:ft(e,t),text:e.getDataStream().getTextStream().readText(t.begin(),t.length())}}(t.range,this.state);if(Ot(t,!0)){var n=e.findRecognizeNext(t);return{isNumbering:!0,findResult:e.isFoundResultValid(n)?n:r}}var i=e.findRecognizePrev(t);if(e.isFoundResultValid(i))return{isNumbering:!0,findResult:i};var o=e.findRecognizeNext(t);return e.isFoundResultValid(o)?{isNumbering:!0,findResult:o}:Ot(t,!1)?{isNumbering:!0,findResult:r}:{isNumbering:!1,findResult:r}},t}(),ke=function(){function t(t,e){var r=this;this.firstLevelChecker=function(t,e){var r=e.listType,n=e.outlineLvl,i=t,o=i.listType,a=i.listLevel,s=i.outlineLvl;return o===r&&0===a&&(void 0===n||n>=s)},this.otherLevelChecker=function(t,e){var n=e.listType,i=e.listStyles,o=t,a=o.listType,s=o.listId;return a===n&&xt(r.numbering.getListStyleset(s),i)},this.editor=t,this.state=e}return t.prototype.isFoundResultValid=function(t){var e=t.listId;return null!==e&&""!==e},t.prototype.createNotFoundResult=function(){return{level:0,listId:null,paragraphIndent:null,text:""}},Object.defineProperty(t.prototype,"numbering",{get:function(){return this.editor.service.getNumbering()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textStream",{get:function(){return this.state.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storyStream",{get:function(){return this.state.getDataStream().getStoryStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawingStream",{get:function(){return this.state.getDataStream().getDrawingStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"editorDocument",{get:function(){return this.editor.service.getDocument()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"styleSheetManager",{get:function(){return this.state.dataEngine.getDataManager().getStyleSheetManager()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numberingManager",{get:function(){return this.state.dataEngine.getDataManager().getNumberingManager()},enumerable:!1,configurable:!0}),t.prototype.getParagraphIndent=function(t){return null===t?null:this.styleSheetManager.mergeStyleParagraphProperty(t).ind},t.prototype.checkEdge=function(t,e){return e?t.hasPrev():t.hasNext()},t.prototype.stepIter=function(t,e){return!!this.checkEdge(t,e)&&(e?t.prev():t.next())},t.prototype.shouldJumpTable=function(t,e,r){if(Rt(this.editor,this.state,e,[r?g.ghV.TableEnd:g.ghV.TableStart])){var n=this.tableStream.getTableInfo(e.gcpBegin),i=n.range.gcpBegin;return t.seek(r?i:n.range.end()-1),!0}return!1},t.prototype.shouldBreakTable=function(t,e){return Rt(this.editor,this.state,t,[g.ghV.TableCellBreak,g.ghV.TableRowBreak,e?g.ghV.TableStart:g.ghV.TableEnd])},t.prototype.decideRecognize=function(t){var e=t.findRecognizeParams;return e.matchInfo.isMultiLevelRecognize?this.decideRecognizeForMulti((0,o.__assign)((0,o.__assign)({},t),{findRecognizeParams:e})):this.decideRecognizeForSingle((0,o.__assign)((0,o.__assign)({},t),{findRecognizeParams:e}))},t.prototype.decideRecognizeForMulti=function(t){var e=t.findRecognizeParams,r=t.findListInfo,n=t.isPrev,i=t.isHeading,o=e.matchInfo,a=o.orderAndLevel,s=o.listStyles,l=r.listId;if(!xt(s,this.numbering.getListStyleset(l)))return this.createNotFoundResult();a.sort((function(t,e){return e.level-t.level}));for(var c=r,p=0;p<a.length;p++){var u=a[p],g=u.order,h=u.level;if(!c)return this.createNotFoundResult();var d=Gt(g,Bt(c),n,0!==p);if(!Ht({recognizeRange:e.range,recognizeLevel:h,findListInfo:c,editor:this.editor,isHeading:i,isMultiMaxLevelMatch:0===p})||!d)return this.createNotFoundResult();c=c.parent}return this.getRecognizeMatchResult(r)},t.prototype.decideRecognizeForSingle=function(t){var e,r,n=t.findRecognizeParams,i=t.findListInfo,a=t.isPrev,s=t.isHeading,l=n.matchInfo.listMatchInfos,c=this.numbering.getListStyleset(i.listId),p=l.filter((function(t){return xt(t.listStyles,c)}));if(!p.length)return this.createNotFoundResult();try{for(var u=(0,o.__values)(p),g=u.next();!g.done;g=u.next()){var h=g.value,d=p[0].order,f={findListInfo:i,recognizeRange:n.range,listMatchInfo:h,isHeading:s,isPrev:a},y=0===d?this.decideRecognizeForSingleWhenStartOrder(f):this.decideRecognizeForSingleWhenNotStartOrder(f);if(this.isFoundResultValid(y))return y}}catch(t){e={error:t}}finally{try{g&&!g.done&&(r=u.return)&&r.call(u)}finally{if(e)throw e.error}}return this.createNotFoundResult()},t.prototype.decideRecognizeForSingleWhenStartOrder=function(t){return function(t){var e=t.findListInfo,r=t.isPrev,n=Bt(e);return!r&&1===n&&Wt(t)}((0,o.__assign)((0,o.__assign)({},t),{editor:this.editor}))?this.getRecognizeMatchResult(t.findListInfo):this.createNotFoundResult()},t.prototype.decideRecognizeForSingleWhenNotStartOrder=function(t){var e=t.findListInfo,r=t.listMatchInfo,n=t.isPrev,i=Bt(e);return Gt(r.order,i,n)&&Wt((0,o.__assign)((0,o.__assign)({},t),{editor:this.editor}))?this.getRecognizeMatchResult(e):this.createNotFoundResult()},t.prototype.decideRecognizeInParentChain=function(t){for(var e=t.findListInfo,r=t.isPrev,n=this.getNextInParentChain(e,r);n;){var i=this.decideRecognize((0,o.__assign)((0,o.__assign)({},t),{findListInfo:n}));if(this.isFoundResultValid(i))return i;n=this.getNextInParentChain(n,r)}return this.createNotFoundResult()},t.prototype.getNextInParentChain=function(t,e){var r=this.state.dataEngine.getDataManager().getNumberingManager();return e?t.parent:function(t,e){var r=t.listId,n=t.listLevel,i=t.order,o=e.getWholeListByListId(r);if(0===n)return null;var a=o.filter((function(t){return t.listLevel===n-1&&t.order===i+1}));return a.length?a[0]:null}(t,r)},t.prototype.getRecognizeMatchResult=function(t){var e=this,r=e.state;return Nt({listInfo:t,textStream:e.textStream,editor:e.editor,state:r})},t}(),Le=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findForceWithFirstLevel=function(t){return this.findFlow(t,this.firstLevelChecker)},e.prototype.findForceWithOtherLevel=function(t){return this.findFlow(t,this.otherLevelChecker)},e.prototype.findFlow=function(t,e){var r=t.range,n=t.listType,i=t.listStyles,o=t.listLevel,a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return this.createNotFoundResult();var s=this.textStream.createParagraphIterator(a.contentRange);s.seek(r.gcpBegin);var l=dt(this.editor.service,s.getRange());if(!s.hasPrev())return this.createNotFoundResult();for(;s.prev();){var c=s.getRange();if(c.gcpBegin<a.contentRange.gcpBegin||!c.isValid())return this.createNotFoundResult();if(this.shouldBreakTable(c,!0))return this.createNotFoundResult();if(!this.shouldJumpTable(s,c,!0)&&St(this.editor.service,c)){var p=this.editorDocument.getListInfoFromGcpRange(c);if(p&&e(p,{listType:n,listStyles:i,outlineLvl:l}))return{level:o,listId:p.listId,paragraphIndent:this.getParagraphIndent(s.getProperty()),text:this.textStream.readText(c.begin(),c.length())}}}return this.createNotFoundResult()},e}(ke),Ae=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findAutoPrev=function(t){return this.findFlow(t,!0)},e.prototype.findAutoNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.listStyles,n=t.listType,i=t.selectionRange,o=t.range,a=this.editor,s=this.createNotFoundResult(),l=this.storyStream.getSubStoryInfoFromGcp(o.gcpBegin);if(!l)return s;var c=this.textStream.createParagraphIterator(l.contentRange);if(c.seek(o.gcpBegin),!this.checkEdge(c,e))return s;this.stepIter(c,e);do{var p=c.getRange();if(!p.isValid())return this.createNotFoundResult();if(this.shouldBreakTable(p,e))return this.createNotFoundResult();if(!this.shouldJumpTable(c,p,e)&&St(a.service,p)){var u=this.editorDocument.getListInfoFromGcpRange(p);if(u&&!i.contains(p))return this.otherLevelChecker(u,{listType:n,listStyles:r})?{level:0,listId:u.listId,paragraphIndent:this.getParagraphIndent(c.getProperty()),text:this.textStream.readText(p.begin(),p.length())}:s}}while(this.stepIter(c,e));return s},e}(ke),Fe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findRecognizePrev=function(t){return this.findFlow(t,!0)},e.prototype.findRecognizeNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.range,n=this.createNotFoundResult(),i=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!i)return n;var o=this.textStream.createParagraphIterator(i.contentRange);if(o.seek(r.gcpBegin),!this.checkEdge(o,e))return n;this.stepIter(o,e);do{var a=o.getRange();if(!a.isValid())return n;if(this.shouldBreakTable(a,!1))return n;if(!this.shouldJumpTable(o,a,!1)&&St(this.editor.service,a)){var s=this.editorDocument.getListInfoFromGcpRange(a);if(s){var l={findListInfo:s,findRecognizeParams:t,isPrev:e,isHeading:!0},c=this.decideRecognize(l);return this.isFoundResultValid(c)||0===s.listLevel?c:this.decideRecognizeInParentChain(l)}}}while(this.stepIter(o,e));return n},e}(ke),Me=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findSetStylePrev=function(t){return this.findFlow(t,!0)},e.prototype.findSetStyleNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=this.createNotFoundResult(),n=this.storyStream.getSubStoryInfoFromGcp(t.gcpBegin);if(!n)return r;var i=this.textStream.createParagraphIterator(n.contentRange);if(i.seek(t.gcpBegin),!this.checkEdge(i,e))return r;for(var o=this.editorDocument.getListInfoFromGcpRange(t);this.stepIter(i,e);){var a=i.getRange();if(a.gcpBegin<n.contentRange.gcpBegin||!a.isValid())return r;if(this.shouldBreakTable(a,e))return r;if(!this.shouldJumpTable(i,a,e)&&St(this.editor.service,a)){var s=this.editorDocument.getListInfoFromGcpRange(a);if(s)return(null==o?void 0:o.listType)!==s.listType?r:{listId:s.listId,paragraphIndent:this.getParagraphIndent(i.getProperty()),text:this.textStream.readText(a.begin(),a.length())}}}return r},e}(ke),Oe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findPastePrev=function(t){var e=this.findPastePrevInPasteData(t);return this.isFoundResultValid(e)||e.skipFindPrev?e:this.findPastePrevInDoc(t)},e.prototype.findPasteNext=function(t){var e=t.paraIter,r=t.outlineLevel,n=t.pastePosition,i=t.listTemplate,a=t.paraProp;e.seek(n);for(var s=this.createNotFoundResult();e.hasNext();){e.next();var l=e.getRange(),c=e.getProperty();if(!l.isValid()||!c)return s;if(bt(this.styleSheetManager,c)&&Pt(c)){var p=jt(c.numPr.numId,this.numberingManager),u=this.editor.service.getSelection().getFirstListInfoInSelection(l);return p&&u&&r===u.outlineLvl&&Et(c,a,p,i)?(0,o.__assign)((0,o.__assign)({},s),{listId:u.listId,level:u.listLevel}):s}}return s},e.prototype.findPastePrevInPasteData=function(t){for(var e=t.listTemplate,r=t.paraProp,n=t.outlineLevel,i=t.cachePasteData,a=this.createNotFoundResult(),s=i.length-1;s>=0;s--){var l=i[s],c=l.pasteParaInfo,p=c.outlineLevel,u=c.paraProp,h=l.pasteListInfo;if(p!==g.ilm.LevelNone&&h){var d=h.listId,f=h.level;return Et(u,r,h.listTemplate,e)?n===p?{listId:d,level:f,paragraphIndent:this.getParagraphIndent(u),text:""}:n>p?{listId:d,level:f+1,paragraphIndent:this.getParagraphIndent(u),text:""}:(0,o.__assign)((0,o.__assign)({},a),{skipFindPrev:!0}):(0,o.__assign)((0,o.__assign)({},a),{skipFindPrev:!0})}}return a},e.prototype.findPastePrevInDoc=function(t){var e=t.paraIter,r=t.pastePosition,n=t.listTemplate,i=t.paraProp,a=t.outlineLevel;e.seek(r);var s=this.createNotFoundResult();do{var l=e.getRange(),c=e.getProperty();if(!l.isValid()||!c)return s;if(Rt(this.editor,this.state,l))return s;if(bt(this.styleSheetManager,c)&&Pt(c)){var p=jt(c.numPr.numId,this.numberingManager),u=this.editor.service.getSelection().getFirstListInfoInSelection(l);if(p&&u){var g=u;if(!Et(c,i,p,n))return s;for(;g;){var h=g.outlineLvl;if(h===a)return(0,o.__assign)((0,o.__assign)({},s),{listId:g.listId,level:g.listLevel,paragraphIndent:this.getParagraphIndent(i)});if(h<a)return(0,o.__assign)((0,o.__assign)({},s),{listId:g.listId,level:g.listLevel+1,paragraphIndent:this.getParagraphIndent(i)});g=g.parent}}}}while(e.prev());return s},e}(ke),Be=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.headingForceHandler=new Le(e,r),n.headingAutoHandler=new Ae(e,r),n.headingRecognizeHandler=new Fe(e,r),n.headingSetStyleHandler=new Me(e,r),n.headingPasteHandler=new Oe(e,r),n}return(0,o.__extends)(e,t),e.prototype.findAuto=function(t){var e=t.groupRanges,r=t.listStyles,n=t.listType,i=t.selectionRange,o=this.headingAutoHandler.findAutoPrev({selectionRange:i,listStyles:r,listType:n,range:e[0]}),a=function(t){return e.map((function(e){return{range:e,findResult:(0,Ee.Z)(t)}}))};return this.headingAutoHandler.isFoundResultValid(o)?{headingNumberingGroup:a(o)}:{headingNumberingGroup:a(this.headingAutoHandler.findAutoNext({selectionRange:i,listStyles:r,listType:n,range:e[e.length-1]}))}},e.prototype.findForce=function(t){return 0===t.listLevel?this.headingForceHandler.findForceWithFirstLevel(t):this.headingForceHandler.findForceWithOtherLevel(t)},e.prototype.findRecognize=function(t){return this.findRecognizeFlow(t,this.headingRecognizeHandler)},e.prototype.findSetHeading=function(t){var e=this.headingSetStyleHandler.findSetStylePrev(t[0]);return this.headingSetStyleHandler.isFoundResultValid(e)?e:this.headingSetStyleHandler.findSetStyleNext(t[t.length-1])},e.prototype.findPaste=function(t){var e=this.headingPasteHandler.findPastePrev(t);return this.headingPasteHandler.isFoundResultValid(e)?e:this.headingPasteHandler.findPasteNext(t)},e}(De),Ne=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findForceWithFirstLevel=function(t){return this.findFlow(t,this.firstLevelChecker)},e.prototype.findForceWithOtherLevel=function(t){return this.findFlow(t,this.otherLevelChecker)},e.prototype.findFlow=function(t,e){var r=t.range,n=t.listType,i=t.listStyles,o=t.listLevel,a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return this.createNotFoundResult();var s={findRange:a.contentRange,iterStart:r.gcpBegin,listType:n,listStyles:i,listLevel:o,listInfoChecker:e};return this.doFindInStory(s)},e.prototype.doFindInStory=function(t){var e=t.findRange,r=t.iterStart,n=t.listType,i=t.listStyles,o=t.listLevel,a=t.listInfoChecker,s=this.textStream.createParagraphIterator(e);if(s.seek(r),!s.hasPrev())return this.createNotFoundResult();s.prev();do{var l=s.getRange();if(l.gcpBegin<e.gcpBegin||!l.isValid())return this.createNotFoundResult();if(!St(this.editor.service,l)){var c=this.editorDocument.getListInfoFromGcpRange(l);if(c&&a(c,{listType:n,listStyles:i}))return{level:o,listId:c.listId,paragraphIndent:this.getParagraphIndent(s.getProperty()),text:this.textStream.readText(l.begin(),l.length())}}}while(s.prev());return this.createNotFoundResult()},e}(ke),He=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findAutoPrev=function(t){return this.findFlow(t,!0)},e.prototype.findAutoNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.listStyles,n=t.listType,i=t.range,o=t.selectionRange,a=this.editor,s=this.state,l=this.createNotFoundResult(),c=this.storyStream.getSubStoryInfoFromGcp(i.gcpBegin);if(!c)return l;var p=this.textStream.createParagraphIterator(c.contentRange);if(p.seek(i.gcpBegin),!this.checkEdge(p,e))return l;var u=wt(a,s,i);this.stepIter(p,e);do{var g=p.getRange();if(!g.isValid())return l;if(St(a.service,g)||Rt(a,s,g))return l;if(u!==wt(a,s,g))return l;var h=this.editorDocument.getListInfoFromGcpRange(g),d=this.editorDocument.isParaEmpty(g.gcpBegin);if(!h){if(d)continue;return l}return!this.otherLevelChecker(h,{listType:n,listStyles:r})||o.contains(g)?l:{listId:h.listId,paragraphIndent:this.getParagraphIndent(p.getProperty()),text:this.textStream.readText(g.begin(),g.length())}}while(this.stepIter(p,e));return l},e}(ke),We=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findRecognizePrev=function(t){return this.findFlow(t,!0)},e.prototype.findRecognizeNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=t.range,n=this.editor,i=this.state,o=this.createNotFoundResult(),a=this.storyStream.getSubStoryInfoFromGcp(r.gcpBegin);if(!a)return o;var s=this.textStream.createParagraphIterator(a.contentRange);if(s.seek(r.gcpBegin),!this.checkEdge(s,e))return o;var l=wt(n,i,r);this.stepIter(s,e);do{var c=s.getRange();if(!c.isValid())return o;if(St(n.service,c))return o;if(this.shouldBreakTable(c,!1))return o;if(!this.shouldJumpTable(s,c,!1)){var p=wt(n,i,c);if(l&&!p)return o;if(l||!p){var u=this.editorDocument.getListInfoFromGcpRange(c);if(u){var g={findListInfo:u,findRecognizeParams:t,isPrev:e,isHeading:!1},h=this.decideRecognize(g);return this.isFoundResultValid(h)||0===u.listLevel?h:this.decideRecognizeInParentChain(g)}}}}while(this.stepIter(s,e));return o},e}(ke),Ge=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.findSetStylePrev=function(t){return this.findFlow(t,!0)},e.prototype.findSetStyleNext=function(t){return this.findFlow(t,!1)},e.prototype.findFlow=function(t,e){var r=this.editor,n=this.state,i=this.createNotFoundResult(),o=this.storyStream.getSubStoryInfoFromGcp(t.gcpBegin);if(!o)return i;var a=this.textStream.createParagraphIterator(o.contentRange);if(a.seek(t.gcpBegin),!this.checkEdge(a,e))return i;var s=wt(r,n,t);this.stepIter(a,e);var l=this.editorDocument.getListInfoFromGcpRange(t);do{var c=a.getRange();if(!c.isValid()||St(r.service,c)||Rt(r,n,c))return i;if(s!==wt(r,n,c))return i;var p=this.editorDocument.getListInfoFromGcpRange(c),u=this.editorDocument.isParaEmpty(c.gcpBegin);if(!p){if(u)continue;return i}return(null==l?void 0:l.listType)!==p.listType?i:{listId:p.listId,paragraphIndent:this.getParagraphIndent(a.getProperty()),text:this.textStream.readText(c.begin(),c.length())}}while(this.stepIter(a,e));return i},e}(ke),Ve=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.isFoundResultValid=function(t){var e=t.listId,r=t.level;return null!==e&&""!==e||!!r},e.prototype.findPastePrev=function(t){var e=this.findPastePrevInPasteData(t);return this.isFoundResultValid(e)||e.skipFindPrev?e:this.findPastePrevInDoc(t)},e.prototype.findPasteNext=function(t){var e=t.paraIter,r=t.pastePosition,n=t.paraProp,i=t.listTemplate,a=this.createNotFoundResult();for(e.seek(r);e.hasNext();){e.next();var s=e.getRange(),l=e.getProperty();if(!s.isValid()||!l)return a;if(!Pt(l)){if(Dt(e.getContentRange(),this.textStream))continue;return a}if(bt(this.styleSheetManager,l))return a;var c=jt(l.numPr.numId,this.numberingManager),p=this.editor.service.getSelection().getFirstListInfoInSelection(s);return Et(l,n,c,i)&&p?(0,o.__assign)((0,o.__assign)({},a),{listId:p.listId}):a}return a},e.prototype.findPastePrevInPasteData=function(t){for(var e=t.paraProp,r=t.listTemplate,n=t.cachePasteData,i=this.createNotFoundResult(),a=n.length-1;a>=0;a--){var s=n[a],l=s.pasteParaInfo,c=l.isEmptyPara,p=l.outlineLevel,u=l.paraProp,h=s.pasteListInfo;if(!h){if(c)continue;return(0,o.__assign)((0,o.__assign)({},i),{skipFindPrev:!0})}if(p!==g.ilm.LevelNone)return(0,o.__assign)((0,o.__assign)({},i),{skipFindPrev:!0});var d=h.listId,f=h.topLevel;return Et(u,e,h.listTemplate,r)?(0,o.__assign)((0,o.__assign)({},i),{listId:d,level:f}):(0,o.__assign)((0,o.__assign)({},i),{skipFindPrev:!0})}return i},e.prototype.findPastePrevInDoc=function(t){var e=this.createNotFoundResult(),r=t.paraIter,n=t.pastePosition,i=t.paraProp,o=t.listTemplate;r.seek(n);var a=Pt(r.getProperty());do{var s=r.getRange(),l=r.getProperty(),c=Dt(r.getContentRange(),this.textStream);if(!s.isValid()||!l||Rt(this.editor,this.state,s))return e;if(!Pt(l)){if(c)continue;return e}var p=this.editor.service.getSelection().getFirstListInfoInSelection(s);if(!p||bt(this.styleSheetManager,l))return e;var u=Et(l,i,jt(l.numPr.numId,this.numberingManager),o);return a&&(u?(e.level=p.listLevel,e.listId=p.listId,Kt.hasSetIndent(p.listParaInd)&&(e.paragraphIndent=p.listParaInd)):e.level=de(p.listLevel,o.length)),u&&(e.listId=p.listId),e}while(r.prev());return e},e}(ke),Ue=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.normalForceHandler=new Ne(e,r),n.normalAutoHandler=new He(e,r),n.normalRecognizeHandler=new We(e,r),n.normalSetStyleHandler=new Ge(e,r),n.normalPasteHandler=new Ve(e,r),n}return(0,o.__extends)(e,t),e.prototype.findAuto=function(t){var e=t.groupRanges,r=t.listStyles,n=t.listType,i=t.selectionRange,o=e[0],a=e[e.length-1],s=this.normalAutoHandler.findAutoPrev({selectionRange:i,range:o,listStyles:r,listType:n});return this.normalAutoHandler.isFoundResultValid(s)?{ranges:e,findResult:s}:{ranges:e,findResult:this.normalAutoHandler.findAutoNext({selectionRange:i,range:a,listStyles:r,listType:n})}},e.prototype.findForce=function(t){return 0===t.listLevel?this.normalForceHandler.findForceWithFirstLevel(t):this.normalForceHandler.findForceWithOtherLevel(t)},e.prototype.findRecognize=function(t){return this.findRecognizeFlow(t,this.normalRecognizeHandler)},e.prototype.findSetHeading=function(t){var e=this.normalSetStyleHandler.findSetStylePrev(t[0]);return this.normalSetStyleHandler.isFoundResultValid(e)?e:this.normalSetStyleHandler.findSetStyleNext(t[t.length-1])},e.prototype.findPaste=function(t){var e=this.normalPasteHandler.findPastePrev(t);return this.normalPasteHandler.isFoundResultValid(e)?e:this.normalPasteHandler.findPasteNext(t)},e}(De),Ke=function(){function t(t,e){this.editor=t,this.state=e,this.headingListFinder=new Be(t,e),this.normalListFinder=new Ue(t,e),this.listRangeSpliter=new Mt(t,e)}return t.prototype.findAuto=function(t){var e,r,n,i,a=t.range,s=t.listStyles,l=t.listType,c={normal:[],heading:[]},p=this.listRangeSpliter.splitRange(a),u=p.normal,g=p.heading;try{for(var h=(0,o.__values)(u),d=h.next();!d.done;d=h.next())if((m=d.value.ranges).length){var f=this.normalListFinder.findAuto({selectionRange:a,groupRanges:m,listType:l,listStyles:s});c.normal.push(f)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(e)throw e.error}}try{for(var y=(0,o.__values)(g),v=y.next();!v.done;v=y.next()){var m;if((m=v.value.ranges).length){var S=mt({headingNumberingGroup:this.headingListFinder.findAuto({selectionRange:a,groupRanges:m,listType:l,listStyles:s}).headingNumberingGroup,editor:this.editor,state:this.state});c.heading.push(S)}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}return c},t.prototype.findForce=function(t){var e=t.range;return St(this.editor.service,e)?this.headingListFinder.findForce(t):this.normalListFinder.findForce(t)},t.prototype.findRecognize=function(t){var e=t.range;return St(this.editor.service,e)?this.headingListFinder.findRecognize(t):this.normalListFinder.findRecognize(t)},t.prototype.findPaste=function(t){return t.outlineLevel!==g.ilm.LevelNone?this.headingListFinder.findPaste(t):this.normalListFinder.findPaste(t)},t.prototype.findWhenSetHeading=function(t){return this.headingListFinder.findSetHeading(t)},t.prototype.findWhenSetNormal=function(t){return this.normalListFinder.findSetHeading(t)},t}(),ze=function(){function t(t,e){this.state=t,this.service=e}return Object.defineProperty(t.prototype,"dataStream",{get:function(){return this.state.getDataStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selection",{get:function(){return this.service.getSelection()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"numberingManager",{get:function(){return this.state.dataEngine.getDataManager().getNumberingManager()},enumerable:!1,configurable:!0}),t.prototype.setListInNewGroup=function(t,e,r,n,i){this.insertListTemplates(e,r,n),this.modifyOldListToNewList(t,e,0,n,i,r.length)},t.prototype.modifyListTemplateSpanChange=function(t){},t.prototype.modifyListTemplate=function(t,e,r){this.removeTemplatesById(t,r),this.insertListTemplates(t,e,r)},t.prototype.modifyParagraphsIndent=function(t,e,r){t.forEach((function(t,n){var i=e[n],o=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));o.ind.left=i,o.ind.setNull(o.ind.tKeys.leftChars);var a={range:new g.ICE(t.end()-1,1),property:o,mode:g.XS7.Merge};u.Gh.setParagraphProperty(a,r)}))},t.prototype.modifyListToNewListStyleSet=function(t,e,r){var n=jt(t,this.numberingManager);if(n){var i=Yt(n,e);this.removeTemplatesById(t,r),this.insertListTemplates(t,i,r)}},t.prototype.modifyTaskState=function(t,e){},t.prototype.cancelListInRange=function(t,e,r,n,i){var o=ue(t,this.dataStream),a=this.dataStream.getTextStream().createParagraphIterator(o);a.seek(o.gcpBegin);var s=0,l=this.numberingManager.getWholeListByListId(e),c=[],p=!l.some((function(t){return!t.isVirtual&&(t.outlineLvl===g.ilm.LevelNone||t.isTask)}));do{var u=a.getProperty(),h=a.getRange();Ct(this.service,h)&&(this.cancelListPropsInParaRange(h,i,r,n),c.push(u.paraId),s+=1)}while(a.next());if(p){var d=vt((l=l.filter((function(t){return!c.includes(t.paraId)&&!t.isVirtual}))).map((function(t){return{position:t.gcp-1}})),this.state,this.service).diffListParas;this.setListPropsInRanges(e,d,i)}this.numberingManager.getWholeListByListId(e).filter((function(t){return!t.isVirtual})).length===s&&this.removeTemplatesById(e,i)},t.prototype.cancelListByListId=function(t,e,r,n){var i=this,o=this.numberingManager.getWholeListByListId(t);if(o.length){var a=this.dataStream.getTextStream().createParagraphIterator();o.forEach((function(t){a.seek(t.gcp-1);var o=a.getRange();i.cancelListPropsInParaRange(o,n,e,r)})),this.removeTemplatesById(t,n)}},t.prototype.setListInAutoFindResult=function(t,e,r,n,i){var a=this,s=t.normal,l=t.heading,c=[];s.forEach((function(t){var s=t.ranges,l=t.findResult,p=(0,o.__read)(s,1)[0],u=l.listId;u||(u=a.createNewListTemplate(p,e,!1,r,n)),Kt.initializeIndentInfo(u,a.numberingManager);var g=fe(u,a.numberingManager,e);s.forEach((function(t){a.setListPropsInParaRange(t,g,{listId:u,taskStatus:i},r),c.push(t)}))})),l.forEach((function(t){var s=(0,o.__read)(t,1)[0],l=s.range,p=s.findResult.listId,u=p;u||(u=a.createNewListTemplate(l,e,!0,r,n));var g=fe(p,a.numberingManager,e);t.forEach((function(t){var e=t.range,n=t.findResult.level;a.setListPropsInParaRange(e,g,{listId:u,listLevel:n,taskStatus:i},r),c.push(e)}))})),this.clearListCache(),this.deleteParaStartTab(c,r)},t.prototype.setListWithCreateInfo=function(t,e,r,n,i){var o=e.listId,a=e.level,s=e.listType,l=e.listStyles,c=e.order,p=o;return p?!this.numberingManager.getWholeListByListId(p).some((function(e){return e.listLevel===a&&(e.gcp<=t.gcpBegin||1===e.start)}))&&this.modifyTemplateStartInRecognizeFind(p,{listLevel:null!=a?a:0,start:(null!=c?c:0)+1},n):p=this.createNewListTemplate(t,s,r,n,l,{listLevel:null!=a?a:0,start:(null!=c?c:0)+1}),this.setListPropsInRanges(p,[{range:t,level:a}],n,i),{listId:p,level:a}},t.prototype.modifyTemplateStartInRecognizeFind=function(t,e,r){var n=jt(t,this.numberingManager);if(n){var i=Jt([e],n);this.removeTemplatesById(t,r),this.insertListTemplates(t,i,r)}},t.prototype.deleteParaStartTab=function(t,e){t.sort((function(t,e){return t.gcpBegin-e.gcpBegin}));var r=this.dataStream.getTextStream(),n=0;t.forEach((function(t){var i=Kt.getParaStartTabCount(t,r),o=new g.ICE(t.begin()-n,i);n+=i,u.Gh.deleteText(o,e)}))},t.prototype.createNewListTemplate=function(t,e,r,n,i,o){var a=Xt(t,null!=i?i:ye(e,r),this.dataStream.getTextStream(),this.state.dataEngine.getDataManager().getStyleSheetManager(),this.numberingManager);if(o&&1!==o.start){var s=o.listLevel,l=o.start;a=Jt([{listLevel:s,start:l}],a)}var c=g.g85.createId();return this.insertListTemplates(c,a,n),c},t.prototype.insertListTemplates=function(t,e,r){if(e.length){var n=g.g85.insertLevelsType(new(g.kkf.getPropertyClass(g.uSS.NumberingProperty)),t,e);u.Gh.setSettingProperty(n,g.LK6.numbering,r,!1)}},t.prototype.modifyOldListToNewList=function(t,e,r,n,i,o){var a=this,s=this.numberingManager.getWholeListByListId(t);s.sort((function(t,e){return t.gcp-e.gcp}));var l=!0;if(s.length){var c=null!=o?o:fe(e,this.numberingManager);s.forEach((function(t){if(!t.isVirtual)if(i&&i(t))l=!1;else{var o=new g.ICE(t.gcp-1,1),s=t.listLevel+r;a.setListPropsInParaRange(o,c,{listId:e,listLevel:s},n)}}))}l&&this.removeTemplatesById(t,n)},t.prototype.setListPropsInParaRange=function(t,e,r,n){var i=r.listId,o=r.listLevel,a=r.taskStatus,s=this.state.dataEngine.getDataManager().getStyleSheetManager(),l=de(null!=o?o:Kt.getListLevelFromIndent(i,t,this.dataStream.getTextStream(),s,this.numberingManager),e),c=this.createListParaProperty(i,l,a);c.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.ind);var p={range:new g.ICE(t.end()-1,0),property:c,mode:g.XS7.Merge};u.Gh.setParagraphProperty(p,n)},t.prototype.cancelListPropsInParaRange=function(t,e,r,n){var i=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));i.setNull(i.tKeys.numPr),i.setNull(i.tKeys.taskPr),this.convertListIndentToParaIndent(t,i,r,n);var o={range:new g.ICE(t.end()-1,1),property:i,mode:g.XS7.Merge};u.Gh.setParagraphProperty(o,e)},t.prototype.convertListIndentToParaIndent=function(t,e,r,n){var i=this.numberingManager.getListInfoFromGcpRange(t);if(i){var o=Kt.getFinalNumericalLeftIndent(i,t,this.dataStream.getTextStream(),this.numberingManager,this.state.dataEngine.getDataManager().getStyleSheetManager(),{ignoreHanging:r,ignoreFirstLine:n});e.ind.left=o,e.ind.setNull(e.ind.tKeys.leftChars),e.ind.setNull(e.ind.tKeys.hanging),e.ind.setNull(e.ind.tKeys.hangingChars)}},t.prototype.setListPropsInRanges=function(t,e,r,n){var i=this,o=fe(t,this.numberingManager);e.forEach((function(e){var a=e.range,s=e.level;i.setListPropsInParaRange(a,o,{listId:t,listLevel:s,taskStatus:n},r)}))},t.prototype.createListParaProperty=function(t,e,r){var n=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));return n.numPr.numId=t,n.numPr.ilvl=e,r&&(n.taskPr.taskState=r),n},t.prototype.removeTemplatesById=function(t,e){var r=g.g85.removeAbstractNumType(t,this.numberingManager.getNumberingProperty(!0));r&&u.Gh.setSettingProperty(r,g.LK6.numbering,e,!1)},t.prototype.clearListCache=function(){Kt.clearLevelCache()},t.prototype.createNewDeltaOption=function(t,e){return void 0===e&&(e=!1),u.C1.createLocalDeltaOption(t||this.selection.range(),e)},t}(),je=r(44667);function qe(t,e,r){var n=null;switch(r){case g.kbS.Span:n=t.getSpanProp();var i=t.getParaProp();i&&n&&n instanceof g.kkf.getPropertyClass(g.uSS.RunProperty)&&(n=e.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunProperty(n,i),e.dataEngine.getDataManager().getThemeManager().mergeThemeForRun(n,g.Op5.EastAsian));break;case g.kbS.Paragraph:(n=t.getParaProp())&&n instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&(n=e.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParagraphProperty(n));break;case g.kbS.Section:n=t.getSectProp()}return n}function Xe(t){var e=t.iterType,r=t.callback,n=t.state,i=t.deltaOpt;if(function(t,e){return e===g.kbS.Span&&t.updateSelection&&0===t.originRange.length()}(i,e)){var o=i.originRange.begin(),a=n.currentParaProp(o),s=function(t,e){return t.isRangeBeginAtParaStart(e.originRange)&&t.listMarkerSpanProp}(n,i)?n.listMarkerSpanProp:n.followSpanProp(o);return a&&s&&(s=n.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunProperty(s,a),n.dataEngine.getDataManager().getThemeManager().mergeThemeForRun(s,g.Op5.EastAsian)),r(s)}var l=c.Jj.Undefined,p=function(t){var e=new Map([[g.kbS.Span,g.uSS.RunProperty],[g.kbS.Paragraph,g.uSS.ParagraphProperty],[g.kbS.Section,g.uSS.SectionProperty]]);return g.kkf.getPropertyClass(e.get(t)||g.uSS.RunProperty)}(e),h=n.dataEngine.getDataStream(),d=h.getTableStream(),f=i.originRange,y=n.selection,v=y.gcpRanges,m=y.gcpRange,S=function(t){var i=h.createDataIterator(t),o=qe(i,n,e);for(o&&o instanceof p&&(l=r(o));i.next(e);){if((o=qe(i,n,e))instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&o.isPlaceholder){var a=i.getRange().end(),s=h.getTextStream().charCodeAt(a-1);if((0,g.dAl)(s))return!0}if(!(o&&o instanceof p&&l===r(o)))return l=c.Jj.Undefined,!1}return!0};return i.originRange.equal(m)?v.forEach(S):u.Yy.splitCellRangeWithIntersect(d,f,S),l}var Qe=function(){function t(t,e){var r=this;this.iterAttributeResultValue=c.Jj.Undefined,this.iterForSection=function(t,e){var n=r._state.dataEngine.getDataStream().getSectionStream().createSectionIterator(e),i=g.kkf.getPropertyClass(g.uSS.SectionProperty),o=n.getCloneProperty();for(o&&o instanceof i&&(r.iterAttributeResultValue=t(o));n.next();)if(!((o=n.getCloneProperty())&&o instanceof i&&r.iterAttributeResultValue===t(o)))return r.iterAttributeResultValue=c.Jj.Undefined,!1;return!0},this.iterForParagraph=function(t,e){var n,i=g.kkf.getPropertyClass(g.uSS.ParagraphProperty),o=r._state.dataEngine.getDataStream().getTextStream(),a=o.createParagraphIterator(e),s=r.getPropAndPropClassTypeForParagraph(a,t);for((null==s?void 0:s.propClassType)===i&&(r.iterAttributeResultValue=s.prop);a.next();){if((null==(s=r.getPropAndPropClassTypeForParagraph(a,t))?void 0:s.propClassType)===i&&(null===(n=null==s?void 0:s.extraParaUsedProp)||void 0===n?void 0:n.isPlaceholder)){var l=a.getRange(),p=o.charCodeAt(l.end()-1);if((0,g.dAl)(p))return!0}if(!s||s.propClassType!==i||r.iterAttributeResultValue!==s.prop)return r.iterAttributeResultValue=c.Jj.Undefined,!1}return!0},this.iterForSpan=function(t,e){var n=g.kkf.getPropertyClass(g.uSS.RunProperty),i=r._state.dataEngine.getDataStream().getTextStream(),o=i.createRunIterator(e),a=i.createParagraphIterator(e),s=r.getPropAndPropClassTypeForSpan(o,a,t);for((null==s?void 0:s.propClassType)===n&&(r.iterAttributeResultValue=s.prop);o.next();)if(!(s=r.getPropAndPropClassTypeForSpan(o,a,t))||s.propClassType!==n||r.iterAttributeResultValue!==s.prop)return r.iterAttributeResultValue=c.Jj.Undefined,!1;return!0},this._state=t,this._deltaOpt=e}return t.prototype.getRange=function(){return this._deltaOpt?this._deltaOpt.originRange.clone():new g.ICE},t.prototype.applyBlockMultiAttribute=function(t,e,r,n,i){var o=this;if(void 0===i&&(i=g.XS7.Merge),this._state&&this._deltaOpt){var a=null!=n?n:this._deltaOpt.buildDelta();r.forEach((function(r){var n=o._state.getDataStream().getStoryStream().getSubStoryInfoFromGcp(r.begin()),s=n&&n.subStoryProp;if(!(n&&n.storyProp.storyType===g.AHI.textboxContent&&s instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)&&s.isCodeBlock))switch(a.moveTo(r),e){case g.kbS.Span:a.setCommandType(u.wI.DocModifyText),a.splitValidRange(o._state.getTableStream(),(function(e){u.Gh.setRunProperty(e,t,a,i)}));break;case g.kbS.Paragraph:a.setCommandType(u.wI.DocModifyParagraph),a.splitValidRange(o._state.getTableStream(),(function(e){var r={range:e,property:t,mode:i};u.Gh.setParagraphProperty(r,a)}));break;case g.kbS.Section:a.setCommandType(u.wI.DocModifySection),u.Gh.setSectionProperty(a.currentRange(),t,a,i)}})),n||this._state.applyDelta(a)}},t.prototype._applyAttribute=function(t,e,r,n,i){if(void 0===r&&(r=g.XS7.Merge),this._state&&this._deltaOpt){var o=n||this._deltaOpt.buildDelta(),a=null!=i?i:o.globalOpts.originRange,s=this._state.getDataStream().getStoryStream().getSubStoryInfoFromGcp(a.begin());if(s&&s.storyProp.storyType===g.AHI.textboxContent&&s.subStoryProp instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)&&s.subStoryProp.textBoxType===g.Xbc.CodeBlock)return;if(e===g.kbS.Span&&t instanceof g.kkf.getPropertyClass(g.uSS.RunProperty)&&o.globalOpts.updateSelection&&0===o.globalOpts.originRange.length()){if(this._state.isRangeBeginAtParaStart(o.globalOpts.originRange)&&this._state.listMarkerSpanProp)this._state.listMarkerSpanProp.merge(t),this._state.context.fire(new u.Fx(this._state.listMarkerSpanProp),!1);else if(!n){var l=this._state.getTextStream().createParagraphIterator(o.globalOpts.originRange),c=l.getRange(),p=l.getProperty();if(o.globalOpts.originRange.begin()===c.end()-1&&p&&p.numPr.isEmpty()){c.gcpBegin=c.end()-1,c.len=1;var h=this._deltaOpt.buildDelta();h.setCommandType(u.wI.DocModifyText),h.globalOpts.originRange=c.clone(),h.moveTo(c),this._applyAttribute(t,g.kbS.Span,g.XS7.Merge,h),c.len=0,h.moveTo(c),this._state.applyDelta(h)}this._state.cusorSpanProp=t}}else{switch(e){case g.kbS.Span:o.setCommandType(u.wI.DocModifyText),o.splitValidRange(this._state.getTableStream(),(function(e){u.Gh.setRunProperty(e,t,o,r)}));break;case g.kbS.Paragraph:o.setCommandType(u.wI.DocModifyParagraph),o.splitValidRange(this._state.getTableStream(),(function(e){var n={range:e,property:t,mode:r};u.Gh.setParagraphProperty(n,o)}),i);break;case g.kbS.Section:o.setCommandType(u.wI.DocModifySection),u.Gh.setSectionProperty(o.currentRange(),t,o,r)}n||this._state.applyDelta(o)}}},t.prototype.iterAttributeByMerge=function(t,e){return this._state&&this._deltaOpt?Xe({iterType:e,callback:t,state:this._state,deltaOpt:this._deltaOpt}):c.Jj.Undefined},t.prototype.iterAttributeForSection=function(t){if(this.iterAttributeResultValue=c.Jj.Undefined,!this._state||!this._deltaOpt)return this.iterAttributeResultValue;var e=this.iterForSection.bind(this,t);return this.iterLoopInRanges(e),this.iterAttributeResultValue},t.prototype.iterAttributeForParagraph=function(t){if(this.iterAttributeResultValue=c.Jj.Undefined,!this._state||!this._deltaOpt||!t.filter((function(t){return!!t})).length)return this.iterAttributeResultValue;var e=this.iterForParagraph.bind(this,t);return this.iterLoopInRanges(e),(0,g.EbI)(this.iterAttributeResultValue)},t.prototype.iterAttributeForSpan=function(t){if(this.iterAttributeResultValue=c.Jj.Undefined,!this._state||!this._deltaOpt||!t.filter((function(t){return!!t})).length)return this.iterAttributeResultValue;if(this._deltaOpt.updateSelection&&0===this._deltaOpt.originRange.length())return this.iterAttributeForSpanSpecial(t);var e=this.iterForSpan.bind(this,t);return this.iterLoopInRanges(e),(0,g.EbI)(this.iterAttributeResultValue)},t.prototype.iterAttributeForSpanSpecial=function(t){var e=this._deltaOpt.originRange.begin();if(this._state.isRangeBeginAtParaStart(this._deltaOpt.originRange)&&this._state.listMarkerSpanProp){var r=this._state.currentParaProp(e),n=this._state.listMarkerSpanProp;return r&&n&&(n=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(n,r,e)),(0,je.Z)(n,t)}var i=this._state.currentParaProp(e),o=this._state.followSpanProp(e);return i&&o&&(o=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(o,i,e)),(0,je.Z)(o,t)},t.prototype.iterLoopInRanges=function(t){this._deltaOpt.originRange.equal(this._state.selection.gcpRange)?this._state.selection.gcpRanges.forEach(t):u.Yy.splitCellRangeWithIntersect(this._state.dataEngine.getDataStream().getTableStream(),this._deltaOpt.originRange,t)},t.prototype.getPropAndPropClassTypeForParagraph=function(t,e){var r=this;if(!this._state)return null;var n=t.getProperty(),i={isPlaceholder:null==n?void 0:n.isPlaceholder},o=g.kkf.getPropertyClass(g.uSS.ParagraphProperty),a=this.getPropValueFromAttrList(n,e);if(n&&n instanceof o&&(this._state.dataEngine.getDataManager().getStyleSheetManager().traceToParagraphBaseStyle(n,(function(t){var n=r.getPropValueFromAttrList(t,e);return null!==n&&null===a&&(a=n,!0)}),!0),null===a)){var s=this._state.dataEngine.getDataManager().getStyleSheetManager().getDocDefaultsStyle(!0).pPrDefault.pPr;a=(0,je.Z)(s,e)}return null===a?null:{prop:a,propClassType:o,extraParaUsedProp:i}},t.prototype.getPropAndPropClassTypeForSpan=function(t,e,r){var n=this;if(!this._state)return null;var i=t.getProperty();e.seek(t.getOperationRange().begin());var o=e.getProperty(),a=g.kkf.getPropertyClass(g.uSS.ParagraphProperty),s=g.kkf.getPropertyClass(g.uSS.RunProperty),l=this.getPropValueFromAttrList(i,r);if(o&&o instanceof a&&i&&i instanceof s&&(this._state.dataEngine.getDataManager().getStyleSheetManager().traceToRunBaseStyle(i,o,(function(t){var e=n.getPropValueFromAttrList(t,r);return null!==e&&null===l&&(l=e,!0)}),!0),null===l)){var c=this._state.dataEngine.getDataManager().getStyleSheetManager().getDocDefaultsStyle(!0).rPrDefault.rPr;l=(0,je.Z)(c,r)}return null===l?null:{prop:l,propClassType:s}},t.prototype.getPropValueFromAttrList=function(t,e){var r,n;if(!t)return null;var i=t;try{for(var a=(0,o.__values)(e),s=a.next();!s.done;s=a.next()){var l=s.value;if(!i.has(i.tKeys[l]))return null;i=i[l]}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return i},t}(),Ye=function(){function t(){}return t.getRunIterator=function(t,e){return t.dataEngine.getDataStream().getTextStream().createRunIterator(e)},t.getParagraphIterator=function(t,e){return t.dataEngine.getDataStream().getTextStream().createParagraphIterator(e)},t.getSectionIterator=function(t,e){return t.dataEngine.getDataStream().getSectionStream().createSectionIterator(e)},t.clearIteratorCache=function(){this.sectionIterators.clear(),this.runIterators.clear(),this.paraIterators.clear()},t.runIterators=new Map,t.paraIterators=new Map,t.sectionIterators=new Map,t}(),Je=g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys,Ze=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateFont=function(t,r){return new e(t,r)},e.createEmptyFont=function(){return new e},e.prototype.isValidTextSpan=function(t){if(!this._state)return!1;var e=this._state.getTextStream().readText(t.begin(),t.len);return![g.IfD.TableCellBreak,g.IfD.TableRowBreak,g.IfD.TableStart,g.IfD.TableEnd].includes(e)},e.prototype.getAttributes=function(t){if(void 0===t&&(t=!0),this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;for(var e=Ye.getRunIterator(this._state,this._deltaOpt.originRange),r=e.getCloneProperty();t&&r&&!this.isValidTextSpan(e.getRange(!0));)e.hasNext()?(e.next(),r=e.getCloneProperty()):r=null;this._lastRange=this._deltaOpt.originRange,this._attribute=r||new(g.kkf.getPropertyClass(g.uSS.RunProperty))}return this._attribute||(this._attribute=new(g.kkf.getPropertyClass(g.uSS.RunProperty))),this._attribute},e.prototype.setFont=function(t){this._state?this._applyAttribute(t.getAttributes(),g.kbS.Span,g.XS7.Merge,void 0):this.getAttributes().merge(t.getAttributes())},e.prototype.setBold=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));t===c.Jj.Toggle?r.b=!0!==this.isBold():r.b=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().b=!0===t},e.prototype.isBold=function(){return this._state?this.iterAttributeForSpan([Je.b]):this.getAttributes().b},e.prototype.setItalic=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));t===c.Jj.Toggle?r.i=!0!==this.isItalic():r.i=!!t,Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().i=!!t},e.prototype.isItalic=function(){return this._state?this.iterAttributeForSpan([Je.i]):!!this.getAttributes().i},e.prototype.setUnderline=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));t===c.Jj.Toggle?r.u.val=!0!==this.isUnderline()?g.qc8.single:g.qc8.none:r.u.val=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().u.val=!0!==this.isUnderline()?g.qc8.single:g.qc8.none},e.prototype.getUnderline=function(){return this._state?this.iterAttributeForSpan([Je.u,g.kkf.getPropertyClass(g.uSS.CTUnderline).tKeys.val]):this.getAttributes().u.val},e.prototype.isUnderline=function(){var t=this.getUnderline();return t===c.Jj.Undefined?c.Jj.Undefined:t!==g.qc8.none&&t!==g.qc8.undefined},e.prototype.setStrike=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));t===c.Jj.Toggle?r.strike=!0!==this.isStrike():r.strike=!!t,Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().strike=!!t},e.prototype.isStrike=function(){return this._state?this.iterAttributeForSpan([Je.strike]):!!this.getAttributes().strike},e.prototype.setFontSize=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));r.sz=t,Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span)}else this.getAttributes().sz=t},e.prototype.getFontSize=function(){return this._state?this.iterAttributeForSpan([Je.sz]):this.getAttributes().sz},e.prototype.setFontFamily=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.RunProperty));e.fontFamily=t,this._applyAttribute(e,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().fontFamily=t},e.prototype.getFontFamily=function(){return this._state?this.iterAttributeByMerge((function(t){return t.fontFamily}),g.kbS.Span):this.getAttributes().fontFamily},e.prototype.setTextColor=function(t,e){var r=function(t,e){var r=g.kkf.getPropertyClass(g.uSS.CTColorWml);t.color.val=e,t.color.setNull(r.tKeys.themeColor),t.color.setNull(r.tKeys.themeShade),t.color.setNull(r.tKeys.themeTint)};if(this._state){var n=new(g.kkf.getPropertyClass(g.uSS.RunProperty));r(n,t),Array.isArray(e)?this.applyBlockMultiAttribute(n,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(n,g.kbS.Span,g.XS7.Merge,void 0)}else r(this.getAttributes(),t)},e.prototype.getTextColor=function(){return this._state?this.iterAttributeByMerge((function(t){return t.color.val}),g.kbS.Span):this.getAttributes().color.val},e.prototype.setTextHighlight=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));r.highlight=t,e?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span)}else this.getAttributes().highlight=t},e.prototype.getTextHighlight=function(){return this._state?this.iterAttributeForSpan([Je.highlight]):this.getAttributes().highlight},e.prototype.setTextFillColor=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty));r.shd.val=g.VHU.clear,r.shd.color=g.oPf.auto,r.shd.fill=t,r.setNull(r.tKeys.highlight),Array.isArray(e)?this.applyBlockMultiAttribute(r,g.kbS.Span,e,void 0,g.XS7.Merge):this._applyAttribute(r,g.kbS.Span,g.XS7.Merge,void 0)}else this.getAttributes().shd.val=g.VHU.clear,this.getAttributes().shd.color=g.oPf.auto,this.getAttributes().shd.fill=t,this.getAttributes().setNull(this.getAttributes().tKeys.highlight)},e.prototype.getTextFillColor=function(){return this._state?this.iterAttributeForSpan([Je.shd,g.kkf.getPropertyClass(g.uSS.CTShd).tKeys.fill]):g.QBv.getHexColorFromShd(this.getAttributes().shd)},e.prototype.setLetterSpacing=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.RunProperty));e.spacing=t,this._applyAttribute(e,g.kbS.Span)}else this.getAttributes().spacing=t},e.prototype.getLetterSpacing=function(){return this._state?this.iterAttributeForSpan([Je.spacing]):this.getAttributes().spacing},e.prototype.setFontScaling=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.RunProperty));e.w=t,this._applyAttribute(e,g.kbS.Span)}else this.getAttributes().w=t},e.prototype.getFontScaling=function(){return this._state?this.iterAttributeForSpan([Je.w]):this.getAttributes().w},e.prototype.setVerticalAlignRun=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.RunProperty));e.vertAlign=t,this._applyAttribute(e,g.kbS.Span)}else this.getAttributes().vertAlign=t},e.prototype.getVerticalAlignRun=function(){return this._state?this.iterAttributeForSpan([Je.vertAlign]):this.getAttributes().vertAlign},e.prototype.getStyleProp=function(){if(this._state){var t=this.iterAttributeForSpan([Je.rStyle])||c.Jj.Undefined;if(t!==c.Jj.Undefined){var e=this._state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t);if(e&&e.type===g.TAq.character)return e}}return c.Jj.Undefined},e.prototype.getStyleName=function(){var t=this.getStyleProp();return t&&t!==c.Jj.Undefined?t.name:c.Jj.Undefined},e.prototype.getStyleShowName=function(){var t=this.getStyleProp();return t?t===c.Jj.Undefined?c.Jj.Undefined:g.LCw.getStyleShowName(t):c.Jj.Undefined},e.prototype.setStyle=function(t,e,r){if(t.type===g.TAq.character)if(this._state){var n=new(g.kkf.getPropertyClass(g.uSS.RunProperty));n.rStyle=t.styleId,Array.isArray(r)?this.applyBlockMultiAttribute(n,g.kbS.Span,r,void 0,g.XS7.Merge):this._applyAttribute(n,g.kbS.Span,g.XS7.Merge,e)}else this.getAttributes().rStyle=t.styleId},e}(Qe),$e=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n._items=[],n._iterIndex=0,n._initCount=0,n._totalCount=-1,n._iterator=n.createIterator(),n}return(0,o.__extends)(e,t),e.prototype.createIterator=function(){return(0,o.__generator)(this,(function(t){throw new Error("BaseCollection.createIterator must be overrided.")}))},e.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return this._totalCount=this._totalCount<0?0:this._totalCount,this._totalCount+=(0,o.__spreadArray)([],(0,o.__read)(e),!1).length,(t=this._items).push.apply(t,(0,o.__spreadArray)([],(0,o.__read)(e),!1))},e.prototype.count=function(){if(this._totalCount>=0)return this._totalCount;for(;!this.goNext(););return this._totalCount},e.prototype.item=function(t){if(!(t<0)){if(this._totalCount>=0)return t<this._items.length?this._items[t]:void 0;do{if(t<this._initCount)break}while(!this.goNext());return this._items[t]}},e.prototype.goNext=function(){var t=this._iterator.next();return t.done?this._totalCount=this._initCount:(this._items[this._initCount]=t.value,this._initCount+=1),t.done},e.prototype.next=function(){var t=this.item(this._iterIndex);return t?(this._iterIndex+=1,{done:!1,value:t}):{done:!0,value:void 0}},e.prototype[Symbol.iterator]=function(){return this._iterIndex=0,this},e}(Qe),tr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateSpan=function(t,r){return new e(t,r)},e.prototype.getFont=function(){return this._state&&this._deltaOpt?Ze.createStateFont(this._state,this._deltaOpt):Ze.createEmptyFont()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getRunIterator(this._state);if(r.seek(t.begin()),r.next()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getRunIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSpan(this._state,n)}}},e}(Ze),er=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateSpans=function(t,r){return new e(t,r)},e.prototype.createIterator=function(t){var e,r,n;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];e=this._deltaOpt.originRange,r=Ye.getRunIterator(this._state,e),t&&r.seek(t),i.label=1;case 1:return n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),[4,tr.createStateSpan(this._state,n)];case 2:i.sent(),i.label=3;case 3:if(r.next())return[3,1];i.label=4;case 4:return[2]}}))},e}($e),rr=g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys,nr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateParagraphFormat=function(t,r){return new e(t,r)},e.createEmptyParagraphFormat=function(){return new e},e.prototype.isValidParaProperty=function(t){if(!this._state)return!1;var e=this._state.getTextStream().readText(t.begin(),t.len);return![g.IfD.TableCellBreak,g.IfD.TableRowBreak,g.IfD.TableStart,g.IfD.TableEnd].includes(e)},e.prototype.getAttributes=function(t){if(void 0===t&&(t=!0),this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;for(var e=Ye.getParagraphIterator(this._state,this._deltaOpt.originRange),r=e.getCloneProperty();t&&r&&!this.isValidParaProperty(e.getRange(!0));)e.hasNext()?(e.next(),r=e.getCloneProperty()):r=null;this._attribute=r||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))}return this._attribute||(this._attribute=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))),this._attribute},e.prototype.setFormat=function(t,e){this._state?this._applyAttribute(t.getAttributes(),g.kbS.Paragraph,g.XS7.Merge,void 0,e):this.getAttributes().merge(t.getAttributes())},e.prototype.setHeadingWithMultiRanges=function(t,e,r){var n=this;this._deltaOpt&&this._state&&t&&e.forEach((function(e){r.moveTo(e),r.splitValidRange(n._state.getTableStream(),(function(t){u.Gh.setRunProperty(t,pe.createClearRunProperty(),r,g.XS7.Merge)}));var i=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));i.pStyle=t.styleId,n._applyAttribute(i,g.kbS.Paragraph,g.XS7.Merge,r)}))},e.prototype.getListInfoArray=function(t){var e;if(!this._state)return[];var r=this._state.getTextStream().createParagraphIterator(t),n=[],i=!0;do{var o=r.getRange(),a=null===(e=this._state.dataEngine.getDataManager().getNumberingManager())||void 0===e?void 0:e.getListInfoFromGcpRange(o);if(!a){i=!1;break}n.push(a)}while(r.next()&&i);return i?n:[]},e.prototype.getListInfoCommonHangingIndent=function(t){var e,r,n,i=this.getListInfoArray(t);if(0===i.length)return 0;var a=(null===(n=i[0].listInd)||void 0===n?void 0:n.hanging)||0,s=!0;try{for(var l=(0,o.__values)(i),c=l.next();!c.done;c=l.next())if(a!==c.value.listInd.hanging){s=!1;break}}catch(t){e={error:t}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}return s?a:0},e.prototype.getParaId=function(){if(this._state){var t=this.iterAttributeForParagraph([rr.paraId]);return t===c.Jj.Undefined?"":t}return this.getAttributes().paraId},e.prototype.setParagraphAlignment=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.jc=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().jc=t},e.prototype.getParagraphAlignment=function(){return this._state?this.iterAttributeForParagraph([rr.jc]):this.getAttributes().jc},e.prototype.setOutlineLevel=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.outlineLvl=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().outlineLvl=t},e.prototype.getOutlineLevel=function(){return this._state?this.iterAttributeForParagraph([rr.outlineLvl]):this.getAttributes().outlineLvl},e.prototype.setLineSpacing=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.line=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.line=t},e.prototype.setLineSpacingRule=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.lineRule=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.lineRule=t;var r="spacing_auto";switch(t){case g.NRl.auto:r="spacing_auto";break;case g.NRl.exact:r="spacing_exact";break;case g.NRl.atLeast:r="spacing_atLeast"}p.kQ.tdwReport({opername:"doc_word_editor",module:"paragraph",action:r})},e.prototype.getLineSpacing=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.line]):this.getAttributes().spacing.line},e.prototype.getLineSpacingRule=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.lineRule]):this.getAttributes().spacing.lineRule},e.prototype.setSpaceBefore=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.before=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.before=t},e.prototype.setLineUnitBefore=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.beforeLines=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.beforeLines=t},e.prototype.setSpaceBeforeAuto=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.beforeAutospacing=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.beforeAutospacing=t},e.prototype.getSpaceBefore=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.before]):this.getAttributes().spacing.before},e.prototype.getLineUnitBefore=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.beforeLines]):this.getAttributes().spacing.beforeLines},e.prototype.getSpaceBeforeAuto=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.beforeAutospacing]):this.getAttributes().spacing.beforeAutospacing},e.prototype.setSpaceAfter=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.after=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.after=t},e.prototype.setLineUnitAfter=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.afterLines=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.afterLines=t},e.prototype.setSpaceAfterAuto=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.spacing.afterAutospacing=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().spacing.afterAutospacing=t},e.prototype.getSpaceAfter=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.after]):this.getAttributes().spacing.after},e.prototype.getLineUnitAfter=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.afterLines]):this.getAttributes().spacing.afterLines},e.prototype.getSpaceAfterAuto=function(){return this._state?this.iterAttributeForParagraph([rr.spacing,g.kkf.getPropertyClass(g.uSS.CTSpacing).tKeys.afterAutospacing]):this.getAttributes().spacing.afterAutospacing},e.prototype.setSnapToGrid=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.snapToGrid=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().snapToGrid=t},e.prototype.isSnapToGrid=function(){return this._state?this.iterAttributeForParagraph([rr.snapToGrid]):this.getAttributes().snapToGrid},e.prototype.setAutoSpaceDE=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.autoSpaceDE=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().autoSpaceDE=t},e.prototype.getAutoSpaceDE=function(){return this._state?this.iterAttributeForParagraph([rr.autoSpaceDE]):this.getAttributes().autoSpaceDE},e.prototype.setAutoSpaceDN=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.autoSpaceDN=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().autoSpaceDN=t},e.prototype.getAutoSpaceDN=function(){return this._state?this.iterAttributeForParagraph([rr.autoSpaceDN]):this.getAttributes().autoSpaceDN},e.prototype.setLeftIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.left=t,this._applyAttribute(e,g.kbS.Paragraph,g.XS7.Merge)}else this.getAttributes().ind.left=t},e.prototype.setLeftCharsIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.leftChars=t,this._applyAttribute(e,g.kbS.Paragraph,g.XS7.Merge)}else this.getAttributes().ind.leftChars=t},e.prototype.getLeftIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.left}),g.kbS.Paragraph):this.getAttributes().ind.left},e.prototype.getLeftCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.leftChars}),g.kbS.Paragraph):this.getAttributes().ind.leftChars},e.prototype.setRightIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.right=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.right=t},e.prototype.setRightCharsIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.rightChars=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.rightChars=t},e.prototype.getRightIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.right}),g.kbS.Paragraph):this.getAttributes().ind.right},e.prototype.getRightCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.rightChars}),g.kbS.Paragraph):this.getAttributes().ind.rightChars},e.prototype.setFirstLineIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.firstLine=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.firstLine=t},e.prototype.setHangingIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.hanging=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.hanging=t},e.prototype.setFirstLineCharsIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.firstLineChars=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.firstLineChars=t},e.prototype.setHangingCharsIndent=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.ind.hangingChars=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().ind.hangingChars=t},e.prototype.getFirstLineIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.firstLine}),g.kbS.Paragraph):this.getAttributes().ind.firstLine},e.prototype.getHangingIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.hanging}),g.kbS.Paragraph):this.getAttributes().ind.hanging},e.prototype.getFirstLineCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.firstLineChars}),g.kbS.Paragraph):this.getAttributes().ind.firstLineChars},e.prototype.getHangingCharsIndent=function(){return this._state?this.iterAttributeByMerge((function(t){return t.ind.hangingChars}),g.kbS.Paragraph):this.getAttributes().ind.hangingChars},e.prototype.getStyleProp=function(){if(this._state){var t=this.iterAttributeForParagraph([rr.pStyle])||c.Jj.Undefined;if(t!==c.Jj.Undefined){var e=this._state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t);if(e&&e.type===g.TAq.paragraph)return e}}return c.Jj.Undefined},e.prototype.getStyleName=function(){var t=this.getStyleProp();return t&&t!==c.Jj.Undefined?t.name:c.Jj.Undefined},e.prototype.getStyleShowName=function(){var t=this.getStyleProp();return t?t===c.Jj.Undefined?c.Jj.Undefined:g.LCw.getStyleShowName(t):c.Jj.Undefined},e.prototype.setStyle=function(t,e,r){if(t.type===g.TAq.paragraph)if(this._state&&this._deltaOpt){var n=e||this._deltaOpt.buildDelta(),i=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));i.pStyle=t.styleId,Array.isArray(r)&&r.length>0?(this.beforeSetStyle(this._state,n,r),this.applyBlockMultiAttribute(i,g.kbS.Paragraph,r,n,g.XS7.Merge)):(this.beforeSetStyle(this._state,n),this._applyAttribute(i,g.kbS.Paragraph,g.XS7.Merge,n)),n.setCommandType(u.wI.DocModifyParagraphStyle),e||this._state.applyDelta(n)}else this.getAttributes().pStyle=t.styleId},e.prototype.beforeSetStyle=function(t,e,r){var n=this;e.splitValidRange(t.getTableStream(),(function(t){var r={range:t,property:g.vCY.createClearParagraphProperty(!1),mode:g.XS7.Merge};u.Gh.setParagraphProperty(r,e)})),(Array.isArray(r)?r:[this.getRange()]).forEach((function(r){var i=n.getParaRange(t,r.begin()).begin(),o=n.getParaRange(t,r.end()-1).end(),a=new g.ICE(i,o-i);e.moveTo(a),e.splitValidRange(t.getTableStream(),(function(t){u.Gh.setRunProperty(t,pe.createClearRunProperty(),e,g.XS7.Merge)})),e.moveTo(r)}))},e.prototype.getParaRange=function(t,e){return t.getTextStream().createParagraphIterator(new g.ICE(e,0)).getRange()},e.prototype.getListId=function(){return this._state?this.iterAttributeForParagraph([rr.numPr,g.kkf.getPropertyClass(g.uSS.CTNumPr).tKeys.numId]):this.getAttributes().numPr.numId},e.prototype.getListLevel=function(){return this._state?this.iterAttributeForParagraph([rr.numPr,g.kkf.getPropertyClass(g.uSS.CTNumPr).tKeys.ilvl]):this.getAttributes().numPr.ilvl},e.prototype.getTaskState=function(){return this._state?this.iterAttributeForParagraph([rr.taskPr,g.kkf.getPropertyClass(g.uSS.CTTaskPr).tKeys.taskState]):this.getAttributes().taskPr.taskState},e.prototype.setTaskState=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.taskPr.taskState=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().taskPr.taskState=t},e.prototype.getBorder=function(){return this._state?this.iterAttributeByMerge((function(t){return t.pBdr}),g.kbS.Paragraph):this.getAttributes().pBdr},e.prototype.setBorder=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.pBdr=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().pBdr=t},e.prototype.getHintType=function(){return this._state?this.iterAttributeForParagraph([rr.hintType]):this.getAttributes().hintType},e.prototype.setHintType=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.hintType=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().hintType=t},e.prototype.setQuote=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));e.blockQuote=t,this._applyAttribute(e,g.kbS.Paragraph)}else this.getAttributes().blockQuote=t},e.prototype.getQuote=function(){return this._state?this.iterAttributeForParagraph([rr.blockQuote]):this.getAttributes().blockQuote},e}(Qe),ir=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateParagraph=function(t,r){return new e(t,r)},e.prototype.getFormat=function(){return this._state&&this._deltaOpt?nr.createStateParagraphFormat(this._state,this._deltaOpt):nr.createEmptyParagraphFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getParagraphIterator(this._state);if(r.seek(t.begin()),r.next()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getParagraphIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateParagraph(this._state,n)}}},e}(nr),or=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateParagraphs=function(t,r){return new e(t,r)},e.prototype.createIterator=function(){var t,e,r;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=Ye.getParagraphIterator(this._state,t),n.label=1;case 1:return r=u.C1.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,ir.createStateParagraph(this._state,r)];case 2:n.sent(),n.label=3;case 3:if(e.next())return[3,1];n.label=4;case 4:return[2]}}))},e}($e),ar=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateSectionFormat=function(t,r){return new e(t,r)},e.createEmptySectionFormat=function(){return new e},e.prototype.getAttributes=function(){if(this._state&&this._deltaOpt){if(this._lastRange&&this._attribute&&this._lastRange.equal(this._deltaOpt.originRange))return this._attribute;var t=Ye.getSectionIterator(this._state,this._deltaOpt.originRange).getCloneProperty();this._attribute=t||new(g.kkf.getPropertyClass(g.uSS.SectionProperty))}return this._attribute||(this._attribute=new(g.kkf.getPropertyClass(g.uSS.SectionProperty))),this._attribute},e.prototype.setSectionFormat=function(t){if(this._state){var e=t.getAttributes();this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().merge(t.getAttributes())},e.prototype.insertHeaderOrFooter=function(t,e,r,n){if(!this._state)return"";var o=e?g.AHI.headerContent:g.AHI.footerContent,a=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(a!==c.Jj.Undefined&&this._state.getStoryStream().getSubStoryInfoFromId(a,o))return a;var s=i.StringUtil.generateRandomId(),l=n||u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();l.setCommandType(e?u.wI.DocInsertHeader:u.wI.DocInsertFooter);var p=e?new(g.kkf.getPropertyClass(g.uSS.HeaderStoryProperty)):new(g.kkf.getPropertyClass(g.uSS.FooterStoryProperty));p.id=s;var h=e?"header":"footer",d=pe.generateStyleProperty(l,this._state.dataEngine.getDataManager().getStyleSheetManager(),h),f=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));(null==d?void 0:d.type)===g.TAq.paragraph&&(f.pStyle=null==d?void 0:d.styleId);var y=this._state.getStoryStream().getStoryLastPos(o);u.Gh.insertSubStory(y,p,g.IfD.SubStoryBegin,l,g.XS7.Insert),u.Gh.insertParagraph(l.currentRange().end(),new(g.kkf.getPropertyClass(g.uSS.RunProperty)),f,l),u.Gh.insertSubStory(l.currentRange().end(),p.clone(),g.IfD.SubStoryEnd,l,g.XS7.Insert);var v=new(g.kkf.getPropertyClass(g.uSS.SectionProperty)),m=new(g.kkf.getPropertyClass(g.uSS.CTHdrFtrRef));return m.type=t,m.id=s,(e?v.headerReference:v.footerReference).appendProperty(m,"type"),l.moveTo(r),this._applyAttribute(v,g.kbS.Section,g.XS7.Merge,l),n||this._state.applyDelta(l),s},e.prototype.cleanHeaderOrFooter=function(t,e,r,n){if(this._state){var i=r||(e?this.getHeaderStoryId(t):this.getFooterStoryId(t));if(i&&i!==c.Jj.Undefined){var o=this._state.getStoryStream().getSubStoryInfoFromId(i,e?g.AHI.headerContent:g.AHI.footerContent);if(o){var a=n||u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();a.setCommandType(e?u.wI.DocDeleteHeader:u.wI.DocDeleteFooter),u.Gh.deleteText(g.ICE.insetBoth(o.contentRange,0,1),a),n||this._state.applyDelta(a)}}}},e.prototype.removeHeaderOrFooter=function(t,e,r,n){if(this._state){var i=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(i&&i!==c.Jj.Undefined){var o=this._state.getStoryStream().getSubStoryInfoFromId(i,e?g.AHI.headerContent:g.AHI.footerContent);o&&this.doRemoveHeaderOrFooter(t,e,null==o?void 0:o.range,r,n)}}},e.prototype.removeEmptyHeaderFooter=function(){if(this._state&&this._deltaOpt){var t=this._deltaOpt.buildDelta(),e=t.currentRange();this.removeEmptyHeaderOrFooter(e,!1,t),this.removeEmptyHeaderOrFooter(e,!0,t),this._state.applyDelta(t)}},e.prototype.getEmptyHeaderOrFooterRange=function(t,e,r){var n=e?this.getHeaderStoryId(t):this.getFooterStoryId(t);if(!n||n===c.Jj.Undefined)return null;var i=r.getStoryStream().getSubStoryInfoFromId(n,e?g.AHI.headerContent:g.AHI.footerContent);return i&&i.contentRange.length()<=1&&this.isDefaultParagraph(i.contentRange)?i.range:null},e.prototype.isDefaultParagraph=function(t){if(!this._state)return!1;var e=this._state.getTextStream().createParagraphIterator(t).getCloneProperty();return!e||(e.setDefault(e.tKeys.paraId),e.setDefault(e.tKeys.pStyle),!!e.isEmpty())},e.prototype.removeEmptyHeaderOrFooter=function(t,e,r){var n=this;if(this._state&&this._deltaOpt){var i=r||this._deltaOpt.buildDelta(),o=this.getEmptyHeaderOrFooterRange(g.SoA.default,e,this._state),a=this.getEmptyHeaderOrFooterRange(g.SoA.first,e,this._state),s=this.getEmptyHeaderOrFooterRange(g.SoA.even,e,this._state),l=[{range:o,type:g.SoA.default},{range:a,type:g.SoA.first},{range:s,type:g.SoA.even}];(l=l.filter((function(t){return null!==t.range}))).sort((function(t,e){return t.range&&e.range?e.range.begin()-t.range.begin():0})),l.forEach((function(r){n.doRemoveHeaderOrFooter(r.type,e,r.range,t,i)})),r||this._state.applyDelta(i)}},e.prototype.doRemoveHeaderOrFooter=function(t,e,r,n,i){if(this._state){var o=i||u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();o.setCommandType(e?u.wI.DocDeleteHeader:u.wI.DocDeleteFooter);var a=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e?a.headerReference.removeProperty(t,!1):a.footerReference.removeProperty(t,!1),o.moveTo(n),this._applyAttribute(a,g.kbS.Section,g.XS7.Merge,o),u.Gh.deleteText(r,o),i||this._state.applyDelta(o)}},e.prototype.getHeaderOrFooterStoryId=function(t,e){return t?this.getHeaderStoryId(e):this.getFooterStoryId(e)},e.prototype.getHeaderStoryId=function(t){return this._state?this.iterAttributeForSection((function(e){var r;return(null===(r=e.headerReference.getProperty(t))||void 0===r?void 0:r.id)||""})):c.Jj.Undefined},e.prototype.getFooterStoryId=function(t){return this._state?this.iterAttributeForSection((function(e){var r;return(null===(r=e.footerReference.getProperty(t))||void 0===r?void 0:r.id)||""})):c.Jj.Undefined},e.prototype.setPageWidth=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgSz.w=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgSz.w=t},e.prototype.getPageWidth=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgSz.w})):this.getAttributes().pgSz.w},e.prototype.setPageHeight=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgSz.h=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgSz.h=t},e.prototype.getPageHeight=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgSz.h})):this.getAttributes().pgSz.h},e.prototype.setMarginTop=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgMar.top=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgMar.top=t},e.prototype.getMarginTop=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.top})):this.getAttributes().pgMar.top},e.prototype.setMarginRight=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgMar.right=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgMar.right=t},e.prototype.getMarginRight=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.right})):this.getAttributes().pgMar.right},e.prototype.setMarginBottom=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgMar.bottom=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgMar.bottom=t},e.prototype.getMarginBottom=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.bottom})):this.getAttributes().pgMar.bottom},e.prototype.setMarginLeft=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgMar.left=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgMar.left=t},e.prototype.getMarginLeft=function(){return this._state?this.iterAttributeForSection((function(t){return t.pgMar.left})):this.getAttributes().pgMar.left},e.prototype.getContentWidth=function(){var t=this.getPageWidth(),e=this.getMarginLeft(),r=this.getMarginRight();return t===c.Jj.Undefined||e===c.Jj.Undefined||r===c.Jj.Undefined?c.Jj.Undefined:t-e-r},e.prototype.setPageStartAt=function(t){if(this._state&&this._deltaOpt){var e=this._deltaOpt.buildDelta();e.setCommandType(u.wI.DocModifySection),e.globalOpts.updateSelection=!1;var r=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));r.pgNumType.start=t,u.Gh.setSectionProperty(e.currentRange(),r,e,g.XS7.Merge),this._state.applyDelta(e)}},e.prototype.getPageStartAt=function(){if(this._state&&this._deltaOpt){var t=this._state.getDataStream().getSectionStream().createSectionIterator(this._deltaOpt.originRange).getCloneProperty();return(null==t?void 0:t.has(t.tKeys.pgNumType))&&(null==t?void 0:t.pgNumType.has(g.kkf.getPropertyClass(g.uSS.CTPageNumber).tKeys.start))?t.pgNumType.start:g.keb.section.pageStartAt}return g.keb.section.pageStartAt},e.prototype.getColumnNum=function(){return this._state?this.iterAttributeForSection((function(t){return t.cols.num})):this.getAttributes().cols.num},e.prototype.setColumnNum=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.cols.num=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().cols.num=t},e.prototype.getTitlePg=function(){return this._state?this.iterAttributeForSection((function(t){return t.titlePg})):this.getAttributes().titlePg},e.prototype.setTitlePg=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.titlePg=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().titlePg=t},e.prototype.setPageNum=function(t){if(this._state){var e=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));e.pgNumType=t,this._applyAttribute(e,g.kbS.Section)}else this.getAttributes().pgNumType=t},e.prototype.setSectType=function(t,e){if(this._state){var r=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));r.type=t,this._applyAttribute(r,g.kbS.Section,void 0,e)}else this.getAttributes().type=t},e.prototype.getSectType=function(){return this._state?this.iterAttributeForSection((function(t){return t.type})):this.getAttributes().type},e}(Qe),sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateSection=function(t,r){return new e(t,r)},e.prototype.getSectionFormat=function(){return this._state&&this._deltaOpt?ar.createStateSectionFormat(this._state,this._deltaOpt):ar.createEmptySectionFormat()},e.prototype.getNext=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getSectionIterator(this._state);if(r.seek(t.begin()),r.next()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,n)}}},e.prototype.getPrev=function(){if(this._state&&this._deltaOpt){var t=this.getRange(),r=Ye.getSectionIterator(this._state);if(r.seek(t.begin()),r.prev()){var n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection);return e.createStateSection(this._state,n)}}},e}(ar),lr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.createStateSections=function(t,r){return new e(t,r)},e.prototype.getSectionFormat=function(){return ar.createStateSectionFormat(this._state,this._deltaOpt)},e.prototype.createIterator=function(){var t,e,r;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._deltaOpt.originRange,e=Ye.getSectionIterator(this._state,t),n.label=1;case 1:return r=u.C1.createLocalDeltaOption(e.getRange(),this._deltaOpt.updateSelection),[4,sr.createStateSection(this._state,r)];case 2:n.sent(),n.label=3;case 3:if(e.next())return[3,1];n.label=4;case 4:return[2]}}))},e}($e),cr=r(47176),pr=function(t){function e(e,r,n,i){void 0===i&&(i=null);var o=t.call(this,e,r)||this;return o.drawingProp=n,o.drawingStream=o._state.dataEngine.getDataStream().getDrawingStream(),o.parent=i,o.selector=o.editor.createSelector(),o}return(0,o.__extends)(e,t),e.create=function(t,r,n,i){return void 0===i&&(i=null),new e(t,r,n,i)},Object.defineProperty(e.prototype,"editor",{get:function(){return this._state.context},enumerable:!1,configurable:!0}),e.prototype.getAnchorId=function(){return this.drawingProp.anchorId},e.prototype.getProperty=function(){return this.drawingProp.clone()},e.prototype.getBox=function(){var t,e=null===(t=this._state.context.getViewRangeFromGcpRange(this.getRange()))||void 0===t?void 0:t.start,r=null==e?void 0:e.leafBox;return(0,c.qM)(r)||(0,c.tJ)(r)?r:null},e.prototype.getAnchorParagraph=function(){var t=this.getBox();if(!t)return null;var e=t.getAncestorOf(c.uO.Paragraph);return(0,c.wS)(e)?e:null},e.prototype.getViewParagraph=function(){var t=g.yRb.createBuilder(this.getProperty()).getPosition();return t?this.selector.findHitParagraphBox({x:t.offsetH,y:t.offsetV}):null},e.prototype.getChangedOffsetV=function(t,e){var r=this.getAnchorParagraph(),n=cr.MM.getOffsetPoint(r,c.uO.Page).y,o=e+(t?(0,i.twipsToEmu)(n):(0,i.twipsToEmu)(-n)),a=this.getViewParagraph(),s=this.getRange().begin(),l=this.getRange().begin(),p=!1;if(a&&r!==a&&!t){l=a.getRangeBegin();var u=cr.MM.getOffsetPoint(r,c.uO.Page).y-cr.MM.getOffsetPoint(a,c.uO.Page).y;u>0&&(o+=(0,i.twipsToEmu)(u),p=!0)}return{offsetV:o,sourceGcp:s,destGcp:l,needChange:p}},e.prototype.getDeltaOpt=function(t){var e,r=t.updateSelection,n=void 0===r||r,i=t.needCollab,o=void 0===i||i,a=null===(e=this._deltaOpt)||void 0===e?void 0:e.copy();return a?(a.updateSelection=n,a.needCollab=o,a):null},e}(Qe),ur=function(t){function e(e,r,n,i){void 0===i&&(i=null);var o=t.call(this,e,r,n,i)||this;return o.parent=i,o._deltaOpt.commandType=u.wI.DocModifyImage,o}return(0,o.__extends)(e,t),e.create=function(t,r,n,i){return void 0===i&&(i=null),new e(t,r,n,i)},Object.defineProperty(e.prototype,"graphicObject",{get:function(){return this.parent,this.drawingProp.drawing.graphic.graphicData.pic},enumerable:!1,configurable:!0}),e.prototype.getProperty=function(){return this.drawingProp.clone()},e.prototype.getWidth=function(){return(0,i.emuToTwips)(this.drawingProp.drawing.extent.cx)},e.prototype.getHeight=function(){return(0,i.emuToTwips)(this.drawingProp.drawing.extent.cy)},e.prototype.setHeight=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));e.drawing.extent.cy=(0,i.twipsToEmu)(t),e.drawing.graphic.graphicData.pic.spPr.xfrm.ext.cy=(0,i.twipsToEmu)(t),this._applyAttribute(e,g.kbS.Span)},e.prototype.setWidth=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));e.drawing.extent.cx=(0,i.twipsToEmu)(t),e.drawing.graphic.graphicData.pic.spPr.xfrm.ext.cx=(0,i.twipsToEmu)(t),this._applyAttribute(e,g.kbS.Span)},e.prototype.getAnchorId=function(){return this.drawingProp.anchorId},e.prototype.getImageSrc=function(){if(this.drawingProp instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty))return pe.getImageInfo(this.drawingProp)},e.prototype.setImageProperties=function(t,e){void 0===e&&(e=!0);var r=this._deltaOpt.buildDelta();r.setCommandType(u.wI.DocModifyImage),u.Gh.setDrawingProperty(r.currentRange(),t,r,g.XS7.Merge),r.setUpdateSelection(!1),r.setNeedCollab(e),this._state.applyDelta(r)},e}(pr),gr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.state=e,n.drawingStream=n.state.dataEngine.getDataStream().getDrawingStream(),n.storyStream=n.state.dataEngine.getDataStream().getStoryStream(),n.textStream=n.state.dataEngine.getDataStream().getTextStream(),n}return(0,o.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.createIterator=function(){var t,e,r,n,i;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(this._deltaOpt||(this._deltaOpt=u.C1.createLocalDeltaOption(new g.ICE(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),o.label=1;case 1:return r.hasNext()?(n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),i=r.getCloneProperty(),r.next(),i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)?[4,pr.create(this._state,n,i)]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e.prototype.getTopRelativeHeight=function(){for(var t=this.drawingStream.createDrawingIterator(),e=0;t.hasNext();){var r=t.getProperty();(null==r?void 0:r.isFloating)&&(e=Math.max(e,r.anchor.relativeHeight)),t.next()}return p.nU.getRelativeHeight(p.nU.getZIndex(e)+1)},e}($e),hr=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,o.__extends)(e,t),e.createStateInlineShapes=function(t,r){return new e(t,r)},e.prototype.addImage=function(t,e,r,n){if(!(n.length<=0)){var o=this._coreRange(),a=o.fixToValidReplaceRange(o.gcpRange),s=this._state.followSpanProp(a.begin()),l=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));l.inlineKeyword.extent.cx=(0,i.twipsToEmu)(e),l.inlineKeyword.extent.cy=(0,i.twipsToEmu)(r),l.anchorId=t,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=l.drawing.extent.cx,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=l.drawing.extent.cy,l.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=n;var c=this._deltaOpt.buildDelta();c.setCommandType(u.wI.DocInsertImage),u.Gh.deleteText(a,c),u.Gh.insertImage(c.currentRange().end(),l,c,s),this._state.applyDelta(c)}},e.prototype.insertImageStart=function(t,e,r,n){this._state.insertResourceStart(t,this._deltaOpt,(function(o,a,s){i.Logger.info("insertImageStart callback, insertGcp: ".concat(a));var l=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));l.inlineKeyword.extent.cx=Math.round((0,i.twipsToEmu)(e)),l.inlineKeyword.extent.cy=Math.round((0,i.twipsToEmu)(r)),l.anchorId=t,l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=Math.round((0,i.twipsToEmu)(e)),l.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=Math.round((0,i.twipsToEmu)(r)),l.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=n,o.setCommandType(u.wI.DocInsertImage),u.Gh.insertImage(a,l,o,s)}))},e.prototype.insertImageProgress=function(t){this._state.insertResourceProgress(t,this._deltaOpt,(function(t,e,r){if(i.Logger.info("insertImageProgress callback, insertGcp: ".concat(e)),r instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&r.drawingType===g.HgR.Picture){var n=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));r.merge(n),t.setDrawingProperty(new g.ICE(e,1),r,g.XS7.Merge)}}))},e.prototype.insertImageFinish=function(t,e){var r,n=this;this._state.insertResourceFinish(t,this._deltaOpt,(function(t){var e,i=null===(e=n._state)||void 0===e?void 0:e.getDrawingStream().createDrawingIterator(t),o=null==i?void 0:i.getCloneProperty();return!!o&&(r=o,!0)}),(function(n,o,a){i.Logger.info("insertImageFinish callback, insertGcp: ".concat(o)),n.setCommandType(u.wI.DocInsertImage);var s=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));s.inlineKeyword.graphic.graphicData.pic.blipFill.blip.embed=e,s.inlineKeyword.extent.cx=r.drawing.extent.cx,s.inlineKeyword.extent.cy=r.drawing.extent.cy,s.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cx=s.inlineKeyword.extent.cx,s.inlineKeyword.graphic.graphicData.pic.spPr.xfrm.ext.cy=s.inlineKeyword.extent.cy,s.anchorId=t,u.Gh.insertImage(o,s,n,a)}))},e.prototype.insertCopyImageFinish=function(t,e,r,n){var i=this;setTimeout((function(){i._state.insertCopyImageFinish(t,e,r,n)}),200)},e.prototype.replaceImage=function(t,e,r){var n;if(t!==e&&t!==e-1){var i=this._state.getTextStream().createRunIterator();i.seek(t);var o=i.getCloneProperty();if(null==o?void 0:o.isPlaceholder){var a=r||g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),t);if(a instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)){var s=this.readSingleComment(t+1),l=this._deltaOpt.buildDelta();l.setCommandType(u.wI.DocMoveContent),s&&l.deleteCommentRange(s.commentReferenceProperty.id,new g.ICE(t,1)),u.Gh.insertImage(e,a,l,o),s&&u.Gh.insertCommentReference(e+1,new g.ICE(e,1),s.commentReferenceProperty,l);var c=s?2:1,p=t<e?t:t+c;u.Gh.deleteText(new g.ICE(p,c),l),this._state.applyDelta(l),null===(n=this._state)||void 0===n||n.context.setRangeTo(new g.ICE(e+(e>t?0:c),0))}}}},e.prototype.readSingleComment=function(t){var e,r=this._state.dataEngine.getDataStream(),n=r.createDataIterator(new g.ICE(t)).getRange(g.kbS.Span,!0),i=g.vCY.findPlaceholderCharProperty(r,n.begin());if(i instanceof g.kkf.getPropertyClass(g.uSS.CommentReferenceProperty)){var o=this._state.dataEngine.getDataStream().getAnnotationStream().getCommentRangeInfoFromId(i.id);if(1===(null===(e=null==o?void 0:o.commentRange)||void 0===e?void 0:e.len))return{commentReferenceProperty:i,commentRefInfo:o}}return null},e.prototype.imagesCount=function(){if(!this._state)return 0;var t=this._state.dataEngine.getDataStream().getDrawingStream().createDrawingIterator(),e=0;do{var r=t.getCloneProperty();r&&!r.drawing.graphic.graphicData.pic.isEmpty()&&(e+=1)}while(t.next());return e},e.prototype._coreRange=function(t){return new l.wA(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.isPicture=function(t){return!t.drawing.graphic.graphicData.isEmpty(g.kkf.getPropertyClass(g.uSS.CTGraphicalObjectData).tKeys.pic)},e.prototype.createIterator=function(){var t,e,r,n,i;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),o.label=1;case 1:return r.hasNext()?(n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),i=r.getCloneProperty(),r.next(),i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&this.isPicture(i)?[4,ur.create(this._state,n,i)]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(gr),dr=function(){function t(t){this.stylesCache=new Map,this.state=t}return t.create=function(e){return this.instance?this.instance:new t(e)},t.prototype.setStyleProperty=function(t,e,r){var n,i=this.state.dataEngine.getDataManager().getStyleSheetManager(),o=this.stylesCache.get(r);if(o)n=o;else{if(!(n=pe.generateStyleProperty(t,i,r)))return void this.checkIfClearRunPropRStyle(e);this.stylesCache.set(r,n)}if(n.type===g.TAq.character&&e instanceof g.kkf.getPropertyClass(g.uSS.RunProperty)){var a=new(g.kkf.getPropertyClass(g.uSS.RunProperty));a.rStyle=n.styleId,e.merge(a)}else if(n.type===g.TAq.paragraph&&e instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)){var s=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));s.pStyle=n.styleId,e.merge(s)}},t.prototype.clear=function(){this.stylesCache.clear()},t.prototype.checkIfClearRunPropRStyle=function(t){t instanceof g.kkf.getPropertyClass(g.uSS.RunProperty)&&(t.rStyle="")},t}(),fr=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n)||this;return o.storyStream=o._state.dataEngine.getDataStream().getStoryStream(),o.parent=i,o._deltaOpt.commandType=u.wI.DocModifyCodeBlock,o.styleManager=dr.create(e),o}return(0,o.__extends)(e,t),e.create=function(t,r,n,i){return void 0===i&&(i=null),new e(t,r,n,i)},Object.defineProperty(e.prototype,"graphicObject",{get:function(){return this.parent,this.drawingProp.drawing.graphic.graphicData.wsp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"contentId",{get:function(){return this.graphicObject.txbx.contentId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textboxStoryProperty",{get:function(){var t,e=null===(t=this.storyStream.getSubStoryInfoFromId(this.contentId,g.AHI.textboxContent))||void 0===t?void 0:t.subStoryProp;return e&&e instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)?e:null},enumerable:!1,configurable:!0}),e.prototype.setDrawingProperty=function(t,e){if(void 0===e&&(e=g.XS7.Merge),this._deltaOpt&&this._state){var r=this._deltaOpt.buildDelta();this.setProperty(r,t,e)}},e.prototype.setTextFrameParaStyle=function(t,e){var r;void 0===e&&(e=!1);var n=this.storyStream.getSubStoryInfoFromId(this.contentId,g.AHI.textboxContent);if(n){var i=null===(r=this.getDeltaOpt({updateSelection:!1,needCollab:!1}))||void 0===r?void 0:r.buildDelta();if(!i)return;i.setCommandType(u.wI.DocModifyParagraph);var o=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));this.styleManager.setStyleProperty(i,o,t);var a={range:n.contentRange,property:o,mode:g.XS7.Merge};if(u.Gh.setParagraphProperty(a,i),e){var s=new(g.kkf.getPropertyClass(g.uSS.RunProperty));s.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.rStyle),u.Gh.setRunProperty(n.contentRange,s,i,g.XS7.Merge)}this._state.applyDelta(i)}},e.prototype.getTextFrameType=function(){var t=this.storyStream.getSubStoryInfoFromId(this.contentId,g.AHI.textboxContent);return t&&t.subStoryProp instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)?t.subStoryProp.textBoxType:g.Xbc.TextFrame},e.prototype.getSubStoryInfo=function(){return this.storyStream.getSubStoryInfoFromId(this.contentId)},e.prototype.setProperty=function(t,e,r){this._state&&(t.splitValidRange(this._state.getTableStream(),(function(n){u.Gh.setDrawingProperty(n,e,t,r)})),this._state.applyDelta(t))},e}(pr),yr=r(2613),vr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.state=e,n.drawingStream=n.state.dataEngine.getDataStream().getDrawingStream(),n.storyStream=n.state.dataEngine.getDataStream().getStoryStream(),n.textStream=n.state.dataEngine.getDataStream().getTextStream(),n.styleManager=dr.create(n.state),n}return(0,o.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.gcpRange=function(){return this.state.selection.gcpRange},e.prototype.deltaOption=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!0),u.C1.createLocalDeltaOption(this.gcpRange(),t,e)},e.prototype.getTextFrame=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t,!0);return this.getTextFrameByDrawingInfo(e)},e.prototype.getTextFrameByAnchorId=function(t){var e=this.drawingStream.getDrawingInfo(t);return this.getTextFrameByDrawingInfo(e)},e.prototype.getTextFrameByDrawingInfo=function(t){var e,r;if(t){var n=t.property,i=t.range,o=u.C1.createLocalDeltaOption(i,null===(e=this._deltaOpt)||void 0===e?void 0:e.updateSelection,null===(r=this._deltaOpt)||void 0===r?void 0:r.needCollab);return fr.create(this.state,o,n)}},e.prototype.getStoryId=function(t){var e=this.state.dataEngine.getDataStream().getDrawingStream().getDrawingInfo(t);return null==e?void 0:e.property.drawing.graphic.graphicData.wsp.txbx.contentId},e.prototype.getAnchorId=function(t){var e=this.state.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromContentId(t);return null==e?void 0:e.property.anchorId},e.prototype.setStyleProperty=function(t,e,r){this.styleManager.setStyleProperty(t,e,r)},e.addTextFrameStory=function(t,e,r,n,i,o){var a,s,l=t.currentRange(),c=new(g.kkf.getPropertyClass(g.uSS.RunProperty)),p=null!==(a=r.paraProp)&&void 0!==a?a:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));n&&(null==o||o.setStyleProperty(t,c,n)),i&&(null==o||o.setStyleProperty(t,p,i));var h=g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun();t.moveTo(new g.ICE(e,0));var d=r.content&&r.content.length>0?r.content:g.IfD.ParagraphReturn,f=r.textboxStoryProperty;u.Gh.insertSubStory(t.currentRange().end(),f,g.IfD.SubStoryBegin,t,g.XS7.Insert),null===(s=r.withContent)||void 0===s||s.call(r,t);for(var y=new RegExp("".concat(g.IfD.ParagraphReturn,"|").concat(g.IfD.ParagraphBreak),"g"),v=d[d.length-1].match(y),m=d.split(y),S=v?m.length-1:m.length,b=0;b<S;b++){var C=m[b%S];C&&u.Gh.insertText(t.currentRange().end(),C,c,t),u.Gh.insertParagraph(t.currentRange().end(),h,p,t)}u.Gh.insertSubStory(t.currentRange().end(),f,g.IfD.SubStoryEnd,t,g.XS7.Insert),t.moveTo(l)},e.inputTextframe=function(t,r,n){var o,a,s=n.range(),l=null===(o=n.getShapes().item(0))||void 0===o?void 0:o.getProperty(),c=t.getStoryStream().getSubStoryInfoFromId(null!==(a=null==l?void 0:l.contentId)&&void 0!==a?a:"");if(c)n.setRange(c.contentRange.end(),c.contentRange.end()),n.setText(r);else{var p=u.C1.createLocalDeltaOption(s,!0).buildDelta(),h=i.StringUtil.generateRandomId(),d={content:r,storyType:g.AHI.textboxContent,textboxStoryProperty:(0,g.y5v)(h)},f=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty));(null==l?void 0:l.isFloating)?f.anchor.graphic.graphicData.wsp.txbx.contentId=h:f.inlineKeyword.graphic.graphicData.wsp.txbx.contentId=h,u.Gh.setDrawingProperty(s,f,p,g.XS7.Merge);var y=t.getStoryStream().getStoryLastPos(g.AHI.textboxContent);e.addTextFrameStory(p,y,d),p.moveTo(new g.ICE(y+1+r.length,0)),t.applyDelta(p)}},e.prototype.addTextFrame=function(t,r){var n,i=r.selection,o=r.textFrameProp,a=r.spanStyle,s=r.paraStyle,l=r.range,c=null===(n=r.updateSelection)||void 0===n||n,p=this.deltaOption(c).buildDelta();p.setCommandType(u.wI.DocInsertCodeBlock);var h=t.storyType,d=l||this.gcpRange();if(e.addTextFrameStory(p,this.storyStream.getStoryLastPos(h),t,a,s,this.styleManager),this.truncateWithRange(p,d,i),this.handleInsertDrawingProperty(o),u.Gh.insertDrawing(p.currentRange().end(),o,p),this.shouldInsertAfterTextFrame(i)&&u.Gh.insertParagraph(p.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),p),this.shouldInsertAfterTextFrameAgain(i)&&u.Gh.insertParagraph(p.currentRange().end(),g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),p),this.state.applyDelta(p),this.styleManager.clear(),c){var f=t.textboxStoryProperty,y=this.storyStream.getSubStoryInfoFromId(f.id,h);if(y){var v=new g.ICE(y.contentRange.begin(),0);this.state.setRangeTo(v,{forceFocus:!0,scrollToView:yr.ScrollViewType.None})}}},e.prototype.handleInsertDrawingProperty=function(t){t.drawing.graphic.graphicData.wsp.cNvSpPr.txBox=!0,t.isFloating&&!t.anchor.relativeHeight&&this.state.context.constraintSpace&&(t.anchor.relativeHeight=this.getTopRelativeHeight())},e.prototype.truncateWithRange=function(t,e,r){var n=this.state.getTextStream().createParagraphIterator(e).getCloneProperty();n||(n=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)));var i=this.state.getTextStream().createRunIterator(e).getCloneProperty();t.moveTo(e),u.Gh.deleteText(e,t),this.shouldInsertBeforeTextFrame(r)&&u.Gh.insertParagraph(t.currentRange().end(),i||new(g.kkf.getPropertyClass(g.uSS.RunProperty)),n,t)},e.prototype.addPasteTextFrameStory=function(t,r,n,i){var o=this,a=t.currentRange().end(),s=this.storyStream.getStoryLastPos(g.AHI.textboxContent),l=this.getOffsetWhenAddPasteTextFrameStory(t);r.forEach((function(r){var a=u.C1.createLocalDeltaOption(g.ICE.emptyRange()).buildDelta();e.addTextFrameStory(a,s,r,n,i,o.styleManager),a.operations.length>0&&a.operations.forEach((function(e,r){t.insertOperation(e.clone(),l+r,!1)}))})),t.moveTo(new g.ICE(a,0))},e.prototype.getOffsetWhenAddPasteTextFrameStory=function(t){var e=0;return t.someOp((function(t,r,n){if(!pe.isStoryOperation(t)){if(0===r)return!0;var i=n[r-3];if(pe.isStoryEndBreak(i))return e=r,!0}return!1})),e},e.prototype.updateTextFrameDrawingProperty=function(t,e,r){var n;void 0===r&&(r=!0);var i=null===(n=this.drawingStream.getDrawingInfo(t))||void 0===n?void 0:n.range;if(i){var o=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();o.setCommandType(u.wI.DocModifyShape),u.Gh.setDrawingProperty(i,e,o,g.XS7.Merge),o.setNeedCollab(r),this.state.applyDelta(o)}},e.prototype.updateTextFrameSubStoryProperty=function(t,e){var r=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();r.setCommandType(u.wI.DocModifyCodeBlock);var n=this.drawingStream.createDrawingIterator();if(n.seek(t.begin()),n.getRange().contains(t)){var i=n.getCloneProperty(),o=null==i?void 0:i.drawing.graphic.graphicData.wsp.txbx.contentId;if(o){var a=this.storyStream.getSubStoryInfoFromId(o,g.AHI.textboxContent);if(a){var s={range:new g.ICE(a.range.end()-1,1),property:e,mode:g.XS7.Merge};u.Gh.setSubStoryProperty(s,r),this.state.applyDelta(r)}}}},e.prototype.removeTextFrame=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t);if(e){var r=this.storyStream.getSubStoryInfoFromId(t,g.AHI.textboxContent);if(r){var n=this.deltaOption().buildDelta();n.setCommandType(u.wI.DocDeleteCodeBlock),this.state.deleteText(r.range,n),this.state.deleteText(e.range,n),this.state.applyDelta(n)}}},e.prototype.getTextFrameSubStoryRange=function(t){if(this.drawingStream.getDrawingInfoFromContentId(t)){var e=this.storyStream.getSubStoryInfoFromId(t,g.AHI.textboxContent);if(e)return e.range}},e.prototype.getTextFrameDrawingRange=function(t){var e=this.drawingStream.getDrawingInfoFromContentId(t);if(e)return e.range},e.prototype.getTextframeFromContentGCP=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(e){var r=e.subStoryProp.id;return this.getTextFrame(r)}},e.prototype.findPrevTextFrame=function(t){if(t.isEmpty()){var e=this.storyStream.createStoryIterator(t).getProperty();return e&&e.storyType===g.AHI.mainDocument?this.findPrevCharacter(t.begin(),!0):null}return null},e.prototype.findPrevCharacter=function(t,e){void 0===e&&(e=!1);var r=new g.ICE(t,0),n=l._l.previousTextBreak(this.state.getTextStream(),r.begin()),i=this.state.getTextStream().createRunIterator(new g.ICE(n,0)),o=i.getCloneProperty(),a=i.getRange();if(o){if(o.isPlaceholder){var s=g.vCY.findPlaceholderCharProperty(this.state.getDataStream(),a.begin());if(s instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)){var c=s.drawing.graphic.graphicData.wsp.txbx.contentId,p=this.storyStream.getSubStoryInfoFromId(c,g.AHI.textboxContent);if((null==p?void 0:p.subStoryProp)instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty))return s}}if(e&&o.isPlaceholder)return this.findPrevCharacter(n)}return null},e.prototype.replaceTextframe=function(t,e,r){if(t!==e&&t!==e-1&&this._state&&this._deltaOpt){var n=this._state.getTextStream().createRunIterator();n.seek(t);var i=n.getCloneProperty();if(null==i?void 0:i.isPlaceholder){var o=null!=r?r:g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),t);if(o instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)){var a=this._deltaOpt.buildDelta();a.globalOpts.updateSelection=!0,a.setCommandType(u.wI.DocMoveContent),u.Gh.deleteText(new g.ICE(t,1),a),u.Gh.insertDrawing(t<e?e-1:e,o,a),a.moveTo(g.ICE.insetBoth(a.currentRange(),-1,0)),this._state.applyDelta(a)}}}},e.prototype.isTextframe=function(t){return t.drawingType===g.HgR.WordprocessingShape},e.prototype.shouldInsertBeforeTextFrame=function(t){return!1},e.prototype.shouldInsertAfterTextFrame=function(t){return!1},e.prototype.shouldInsertAfterTextFrameAgain=function(t){return!1},e.prototype.createIterator=function(){var t,e,r,n,i;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(this._deltaOpt||(this._deltaOpt=u.C1.createLocalDeltaOption(new g.ICE(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),o.label=1;case 1:return r.hasNext()?(n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),i=r.getCloneProperty(),r.next(),i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&this.isTextframe(i)?[4,fr.create(this._state,n,i)]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(gr),mr=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n,i)||this;return o._deltaOpt.commandType=u.wI.DocModifyCodeBlock,o}return(0,o.__extends)(e,t),e.create=function(t,r,n,i){return void 0===i&&(i=null),new e(t,r,n,i)},e.prototype.highlightCodeblockRunStyle=function(t,e,r){var n,i=this,o=this.storyStream.getSubStoryInfoFromId(t,g.AHI.textboxContent);if(o){var a=null===(n=this.getDeltaOpt({updateSelection:!1,needCollab:!1}))||void 0===n?void 0:n.buildDelta();if(!a)return;a.setCommandType(u.wI.DocModifyText),e.forEach((function(t){var e=t.length,n=o.contentRange.begin()+r+t.start,s=new g.ICE(n,e),l=new(g.kkf.getPropertyClass(g.uSS.RunProperty));l.setNull(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.rFonts),i.styleManager.setStyleProperty(a,l,t.styleName),u.Gh.setRunProperty(s,l,a,g.XS7.Merge)})),this._state.applyDelta(a)}},e}(fr),Sr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.create=function(t,r){return new e(t,r)},e.prototype.getCodeblock=function(t){var e,r;if(!this.isCodeblock(t))return null;var n=this.drawingStream.getDrawingInfoFromContentId(t,!0);if(!n)return null;var i=n.property,o=n.range,a=u.C1.createLocalDeltaOption(o,null===(e=this._deltaOpt)||void 0===e?void 0:e.updateSelection,null===(r=this._deltaOpt)||void 0===r?void 0:r.needCollab);return mr.create(this.state,a,i)},e.prototype.isCodeblock=function(t){var e,r=null===(e=this.storyStream.getSubStoryInfoFromId(t,g.AHI.textboxContent))||void 0===e?void 0:e.subStoryProp;return!!(r&&r instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty))&&r.isCodeBlock},e.prototype.createDefaultCodeblockProperty=function(t,e){var r=e.getRange(0,0).getSectionFormat().getContentWidth();return(0,g.DbJ)(t,r)},e.prototype.highlightCodeblockRunStyle=function(t,e,r){var n=this.getCodeblock(t);null==n||n.highlightCodeblockRunStyle(t,e,r)},e.prototype.shouldInsertBeforeTextFrame=function(t){var e=t.getParaRangeFromSelection(!0),r=t.relationToSelectAndPara(!0,!0,!0),n=0===this.gcpRange().len&&"``` "===this.state.getTextStream().readText(e.begin(),this.gcpRange().begin()-e.begin()),i=r||n,o=t.storyRange().begin(),a=t.isSelectionBeginAtStoryBegin(),s=n&&o===e.begin();return!i||i&&(a||s)},e.prototype.shouldInsertAfterTextFrame=function(t){var e=t.relationToSelectAndPara(!1,!1,!1,!1),r=!e,n=e&&t.isSelectionEndAtStoryEnd(!1);return r||n},e.prototype.shouldInsertAfterTextFrameAgain=function(t){return t.isSelectionEndAtStoryEnd(!0)},e.prototype.createIterator=function(){var t,e,r,n,i,a;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(this._deltaOpt||(this._deltaOpt=u.C1.createLocalDeltaOption(new g.ICE(0,this.textStream.getLength()),!1)),!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getDrawingStream(),e=this._deltaOpt.originRange,r=t.createDrawingIterator(e),o.label=1;case 1:return r.hasNext()?(n=u.C1.createLocalDeltaOption(r.getRange(),this._deltaOpt.updateSelection),i=r.getCloneProperty(),r.next(),i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&(a=this.getStoryId(i.anchorId))&&this.isCodeblock(a)?[4,mr.create(this._state,n,i)]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return[3,1];case 4:return[2]}}))},e}(vr),br=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.pluginProp=n,i}return(0,o.__extends)(e,t),e.prototype.getAttributes=function(){return this.pluginProp},e.createStateInlinePlugin=function(t,r,n){return new e(t,r,n)},e}(Qe),Cr=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,o.__extends)(e,t),e.createStateInlinePlugins=function(t,r){return new e(t,r)},e.prototype._coreRange=function(t){return new l.wA(this._state.dataEngine,t||this._deltaOpt.originRange)},e.prototype.createIterator=function(){var t,e,r,n,i,a,s,l,c,p,h,d;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];t=this._state.dataEngine.getDataStream().getFieldStream(),e=this._deltaOpt.originRange,r=t.createFieldIterator({limitRange:e}),o.label=1;case 1:return(n=r.getRange()).isValid()?(i=t.getDecodedFieldInfo(n.begin()))?(a=u.C1.createLocalDeltaOption(i.fieldRange,this._deltaOpt.updateSelection),s=r.getProperty(),l=i.fieldCode,c=l.name,p=l.instructions,h=l.switches,d=g.BqD.encodeFieldCode(c,p,h),s&&g.YU5.getInstance().isContainerField(d)?[4,br.createStateInlinePlugin(this._state,a,s)]:[3,3]):[3,3]:[3,4];case 2:o.sent(),o.label=3;case 3:if(r.hasNext()&&r.next())return[3,1];o.label=4;case 4:return[2]}}))},e.prototype.insertPlugin=function(t,e){e.insertField(t.fieldCode,t.fieldResult,{})},e.prototype._insertPluginWithProperty=function(t){var e=this._coreRange().fixToValidReplaceRange(this._coreRange().gcpRange),r=new(g.kkf.getPropertyClass(g.uSS.DrawingProperty))(this._state.followSpanProp(e.begin()));t.merge(r);var n=this._deltaOpt.buildDelta();n.setCommandType(u.wI.DocInsertPlugin),u.Gh.deleteText(e,n),u.Gh.insertDrawing(n.currentRange().end(),t,n),this._state.applyDelta(n)},e.prototype.insertPluginFromGCP=function(t){var e=this._coreRange().fixToValidReplaceRange(this._coreRange().gcpRange),r=this._state.followSpanProp(e.end()),n=this._deltaOpt.buildDelta();u.Gh.insertField(t.fieldCode,t.fieldResult,r,n),this._state.applyDelta(n)},e.prototype.insertPluginStart=function(t,e,r,n,i){},e.prototype.insertPluginFinish=function(t,e,r){},e.prototype.insertPluginCancel=function(t){this._state.insertResourceCancel(t)},e.prototype._setPluginInfo=function(t,e,r,n,i){},e.prototype.movePlugin=function(t,e){var r,n,i,o=t,a=e,s=null===(r=this._state)||void 0===r?void 0:r.getFieldStream().getDecodedFieldInfo(o),l=null==s?void 0:s.fieldRange,c=null===(n=null==s?void 0:s.fieldResult)||void 0===n?void 0:n.range;if(o!==a&&l&&c&&s&&!s.hasNestField){var p=this._deltaOpt.buildDelta();p.setCommandType(u.wI.DocMoveContent);var h=null===(i=this._state)||void 0===i?void 0:i.getTextStream().readText(c.gcpBegin,c.len);u.Gh.deleteText(l,p),o<a?p.moveTo(new g.ICE(a-l.len,0)):p.moveTo(new g.ICE(a,0));var d=s.fieldCode,f=d.name,y=d.instructions,v=d.switches,m=g.BqD.encodeFieldCode(f,y,v);u.Gh.insertField(m,h,new(g.kkf.getPropertyClass(g.uSS.RunProperty)),p),this._state.applyDelta(p)}},e}($e),Pr=function(){function t(t,e,r){this.nestingLevel=e,this.range=r,this.dataEngine=t}return Object.defineProperty(t.prototype,"dataStream",{get:function(){return this.dataEngine.getDataStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.dataStream.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRaw",{get:function(){return!this.range.isValid()},enumerable:!1,configurable:!0}),t.prototype.getRange=function(){return this.range},t.prototype.beforeCreateOperation=function(t){this.beforeHooks||(this.beforeHooks=[]),this.beforeHooks.push(t)},t.prototype.afterCreateOperation=function(t){this.afterHooks||(this.afterHooks=[]),this.afterHooks.push(t)},t.prototype.invokeAfterCreateHook=function(t,e){var r,n;if(this.afterHooks)try{for(var i=(0,o.__values)(this.afterHooks),a=i.next();!a.done;a=i.next())(0,a.value)(t,e)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.invokeBeforeCreateHook=function(t,e){var r,n;if(this.beforeHooks)try{for(var i=(0,o.__values)(this.beforeHooks),a=i.next();!a.done;a=i.next())(0,a.value)(t,e)}catch(t){r={error:t}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t}();function Tr(t,e){for(var r=t.length-1;r>=0;r--)e(t[r],r)}function Rr(t){t.setNull(t.tKeys.numPr),t.setNull(t.tKeys.taskPr)}var _r=function(t){function e(e){var r=t.call(this,e.dataEngine,e.nestingLevel,e.range)||this;return r.gridSpan=0,r.gridIndex=0,r.isLackParagraph=!0,r.dirtyProperties={},r.cellProperty=e.cellProperty,r.parent=e.row,r.paraProperty=e.paraProperty,r.interval=e.interval,r.contentRange=e.contentRange||g.ICE.emptyRange(),r.runProperty=e.runProperty,r}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"actionManager",{get:function(){return this.parent.parent.getTableActionManager()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return g.Rh7.getWidth(this.cellProperty.tcW)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this.getCurrentIndex()},enumerable:!1,configurable:!0}),e.createTableCell=function(t){return new e((0,o.__assign)({range:g.ICE.invalidRange()},t))},e.prototype.getContentRange=function(){return this.contentRange},e.prototype.nextCell=function(){var t=this.parent.cells.indexOf(this);return t+1>=0?this.parent.cells[t+1]:null},e.prototype.prevCell=function(){var t=this.parent.cells.indexOf(this);return t-1>=0?this.parent.cells[t-1]:null},e.prototype.getCaretStart=function(){return new g.ICE(this.range.begin(),1)},e.prototype.getCaretEnd=function(){return new g.ICE(this.range.end()-1,1)},e.prototype.deletePlaceholder=function(){this.deleteRange(new g.ICE(this.range.end()-1,1))},e.prototype.deleteContent=function(){this.isRaw||this.deleteRange(g.ICE.insetBoth(this.contentRange,0,1))},e.prototype.deleteCell=function(){this.deleteRange(this.range),this.parent.cells.splice(this.getCurrentIndex(),1)},e.prototype.deleteRange=function(t){this.actionManager.createDeleteAction(this,t)},e.prototype.insertLeft=function(t){var e=this.getCurrentIndex();this.parent.cells.splice(e,0,t),t.parent=this.parent,this.isRaw||t.insertTo(this.range.begin())},e.prototype.insertRight=function(t){var e=this.getCurrentIndex();this.parent.cells.splice(e+1,0,t),t.parent=this.parent,this.isRaw||t.insertTo(this.range.end())},e.prototype.getVMergeCells=function(){var t,e,r=[this];if(this.getProperty().vMerge!==g.m7Q.restart)return r;for(var n=this.parent,i=n.parent.rows,a=i.indexOf(n)+1;a<i.length;a++){var s=!1;try{for(var l=(t=void 0,(0,o.__values)(i[a].cells)),c=l.next();!c.done;c=l.next()){var p=c.value;if(p.interval.isEqual(this.interval)&&p.getProperty().vMerge===g.m7Q.continue){s=!0,r.push(p);break}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}if(!s)break}return r},e.prototype.setProperty=function(t){this.isRaw?this.cellProperty.assign(t):(this.dirtyProperties.cell?this.dirtyProperties.cell.property.assign(t):(this.dirtyProperties.cell={property:t,mode:g.XS7.Merge},this.cellProperty=this.cellProperty.clone()),this.cellProperty.assign(t),this.actionManager.createModifyAction(this))},e.prototype.isEmpty=function(){return 2===this.range.len},e.prototype.splitCell=function(t,r){for(var n=t-1,i=[this],o=this.cellProperty.clone(),a=this.collectParagraph(),s=Math.floor(a.length/t),l=a.length%t,c=0,p=n;p>0;p--){var u=e.createTableCell({dataEngine:this.dataEngine,cellProperty:new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))(o),paraProperty:(null==r?void 0:r.paragraph)||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(this.paraProperty),row:this.parent,runProperty:(null==r?void 0:r.run)||new(g.kkf.getPropertyClass(g.uSS.RunProperty))(this.runProperty),nestingLevel:this.nestingLevel}),h=s*p+Math.min(l,p)-1;s>0||p<l?(u.disableAppendDefaultPara(),this.parent.cells.splice(this.index,0,u),u.insertTo(a[h].end()),i.splice(c,0,u),c+=1):(this.insertRight(u),i.splice(c+1,0,u))}return this.averageWidth(i,this.width),i},e.prototype.averageWidth=function(t,e){for(var r=Math.floor(e/t.length),n=e-r*(t.length-1),i=0;i<t.length-1;i++)t[i].setWidth(r);t[t.length-1].setWidth(n)},e.prototype.splitToGridUnit=function(t){this.gridSpan||this.parent.updateCellSpan();var r=Math.max(null!=t?t:this.gridIndex,this.gridIndex+1);if(!(r<this.gridIndex||r>=this.gridIndex+this.gridSpan)&&1!==this.gridSpan){var n=this.parent.parent.grid,i=r-this.gridIndex;this.setWidth(n.getWidth(this.gridIndex,i));for(var o=this.gridSpan-i-1;o>=0;o--){var a=e.createTableCell({dataEngine:this.dataEngine,cellProperty:new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))(this.cellProperty),paraProperty:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(this.paraProperty),row:this.parent,nestingLevel:this.nestingLevel});a.setWidth(n.getWidth(r+o,1)),this.insertRight(a)}}},e.prototype.setWidth=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));e.tcW.w=t,e.tcW.type=g.i7d.dxa,this.setProperty(e)},e.prototype.setGrid=function(t,e){this.gridIndex=t,this.gridSpan=e},e.prototype.getGridSpan=function(){return 0===this.gridSpan&&this.parent.updateCellSpan(),this.gridSpan},e.prototype.getProperty=function(){return this.cellProperty},e.prototype.getParagraphProperty=function(){return this.paraProperty},e.prototype.isMainVMergeCell=function(){return this.cellProperty.vMerge===g.m7Q.restart},e.prototype.isLastVMergeCell=function(){var t,e;if(!this.isVMergedCell())return!1;var r=this.parent,n=r.parent.rows,i=n.indexOf(r);if(i===n.length-1)return!0;try{for(var a=(0,o.__values)(n[i+1].cells),s=a.next();!s.done;s=a.next()){var l=s.value;if(l.interval.isEqual(this.interval)&&l.isVMergedCell())return!1}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return!0},e.prototype.isVMergedCell=function(){return this.cellProperty.vMerge===g.m7Q.continue},e.prototype.clone=function(){return this.cloneBase()},e.prototype.cloneDeep=function(){var t=this.cloneBase();if(this.isRaw)return t;var e=u.Me.collectDataToOps(this.dataEngine,this.contentRange);return t.afterCreateOperation((function(t,r){var n,i,a=u.Yy.moveOps(e,t);try{for(var s=(0,o.__values)(a),l=s.next();!l.done;l=s.next()){var c=l.value;r.addOperation(c)}}catch(t){n={error:t}}finally{try{l&&!l.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}})),t.disableAppendDefaultPara(),t},e.prototype.insertTo=function(t){this.isRaw&&this.actionManager.createInsertAction(this,t)},e.prototype.clearVMerge=function(){var t=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));t.setNull(g.kkf.getPropertyClass(g.uSS.TableCellProperty).tKeys.vMerge),this.setProperty(t)},e.prototype.setToMerged=function(){var t=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));t.vMerge=g.m7Q.continue,this.setProperty(t)},e.prototype.unVMerge=function(){this.isMainVMergeCell()&&Tr(this.getVMergeCells(),(function(t){t.clearVMerge()}))},e.prototype.prevCellOfMergedGroup=function(){var t;if(!this.isVMergedCell())return null;var e=null===(t=this.parent.prevRow())||void 0===t?void 0:t.getIntervalEqualCell(this.interval);return e&&(e.isMainVMergeCell()||e.isVMergedCell())?e:null},e.prototype.nextCellOfMergedGroup=function(){var t;if(!this.isVMergedCell()&&!this.isMainVMergeCell())return null;var e=null===(t=this.parent.nextRow())||void 0===t?void 0:t.getIntervalEqualCell(this.interval);return(null==e?void 0:e.isVMergedCell())?e:null},e.prototype.coverProperty=function(t){this.cellProperty=t,this.isRaw||(this.dirtyProperties.cell={property:t,mode:g.XS7.Cover}),this.actionManager.createModifyAction(this)},e.prototype.disableAppendDefaultPara=function(){this.isLackParagraph=!1},e.prototype.getMainCell=function(){var t;if(!this.isVMergedCell())return null;var e=this.parent.parent,r=e.mergedMapping.getMainCell(this.parent.index,this.interval.begin);return r&&(null===(t=e.rows[r.rowIndex])||void 0===t?void 0:t.findCellFromCol(r.colBegin))||null},e.prototype.coverParagraph=function(t){this.paraProperty=t.paragraph,this.runProperty=t.run,this.isRaw||(this.dirtyProperties.paragraph={mode:g.XS7.Cover,property:t.paragraph},t.run&&(this.dirtyProperties.run={mode:g.XS7.Cover,property:t.run}))},e.prototype.applyInsert=function(t,e){if(u.Gh.insertTableCell(t,this.cellProperty,e),this.isLackParagraph){var r=this.paraProperty.isPlaceholder?new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)):this.paraProperty;Rr(r),u.Gh.insertParagraph(t,this.runProperty||new(g.kkf.getPropertyClass(g.uSS.RunProperty)),r,e)}},e.prototype.applyModify=function(t){this.dirtyProperties.paragraph&&u.Gh.setParagraphProperty((0,o.__assign)((0,o.__assign)({},this.dirtyProperties.paragraph),{range:this.contentRange}),t),this.dirtyProperties.run&&u.Gh.setRunProperty(this.contentRange,this.dirtyProperties.run.property,t,this.dirtyProperties.run.mode),this.dirtyProperties.cell&&(this.dirtyProperties.cell.property.nestingLevel=this.nestingLevel,u.Gh.setTableCellProperty((0,o.__assign)((0,o.__assign)({},this.dirtyProperties.cell),{range:this.range}),t))},e.prototype.getGridIndex=function(){return this.gridIndex},e.prototype.getFollowParaStyle=function(){var t=this.dataStream.getTextStream().createParagraphIterator();t.seek(this.range.begin());var e=this.dataStream.getTextStream().createRunIterator();return e.seek(this.range.begin()),{paragraph:t.getCloneProperty()||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),run:e.getCloneProperty()||new(g.kkf.getPropertyClass(g.uSS.RunProperty))}},e.prototype.collectParagraph=function(){if(this.isRaw||this.hasNestingTable())return[];for(var t=this.dataStream.getTextStream().createParagraphIterator(this.contentRange),e=[];t.hasNext();)e.push(t.getRange(!0)),t.next();return e},e.prototype.hasNestingTable=function(){return this.tableStream.createTableIterator({limitRange:this.contentRange,nestingLevel:this.nestingLevel+1}).hasNext()},e.prototype.getCurrentIndex=function(){return this.parent.cells.indexOf(this)},e.prototype.cloneBase=function(){var t=e.createTableCell({dataEngine:this.dataEngine,cellProperty:new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))(this.cellProperty),paraProperty:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(this.paraProperty),runProperty:new(g.kkf.getPropertyClass(g.uSS.RunProperty))(this.getRunProperty()),row:this.parent,nestingLevel:this.nestingLevel});return t.parent=this.parent,t},e.prototype.getRunProperty=function(){if(this.isRaw||this.runProperty)return this.runProperty;var t=this.dataStream.getTextStream().createRunIterator();t.seek(this.contentRange.end()-1);var e=t.getProperty();return e&&(this.runProperty=e),this.runProperty},e}(Pr),Ir=function(t){function e(e,r){var n=t.call(this,e,r.property.nestingLevel,r.range)||this;return n.cacheCells=[],n.hasInit=!1,n.stageProperty=null,n.beforeSpan=0,n.property=r.property,n}return(0,o.__extends)(e,t),e.createTableRow=function(t,r){return new e(t,(0,o.__assign)({range:g.ICE.invalidRange(),contentRange:g.ICE.invalidRange()},r))},Object.defineProperty(e.prototype,"index",{get:function(){return this.parent.rows.indexOf(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.property.trHeight.val},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cells",{get:function(){return this.hasInit||this.initCells(),this.cacheCells},set:function(t){this.hasInit=!0,this.cacheCells=t},enumerable:!1,configurable:!0}),e.prototype.prevRow=function(){var t=this.parent.rows.indexOf(this);return t-1>=0?this.parent.rows[t-1]:null},e.prototype.nextRow=function(){var t=this.parent.rows.indexOf(this);return t+1<this.parent.rows.length?this.parent.rows[t+1]:null},e.prototype.firstCell=function(){return this.cells[0]},e.prototype.lastCell=function(){return this.cells[this.cells.length-1]},e.prototype.getIntervalContainCells=function(t){var e,r,n=[];try{for(var i=(0,o.__values)(this.cells),a=i.next();!a.done;a=i.next()){var s=a.value;t.isContain(s.interval)&&n.push(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},e.prototype.getIntervalIntersectCells=function(t){var e,r,n=[];try{for(var i=(0,o.__values)(this.cells),a=i.next();!a.done;a=i.next()){var s=a.value;t.isIntersect(s.interval)&&n.push(s)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n},e.prototype.getIntervalEqualCell=function(t){var e,r;try{for(var n=(0,o.__values)(this.cells),i=n.next();!i.done;i=n.next()){var a=i.value;if(a.interval.isEqual(t))return a}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return null},e.prototype.insertBefore=function(t){var e=this.parent.rows.indexOf(this);this.parent.rows.splice(e,0,t),this.isRaw||t.insertTo(this.range.begin())},e.prototype.insertAfter=function(t){var e=this.parent.rows.indexOf(this);this.parent.rows.splice(e+1,0,t),this.isRaw||t.insertTo(this.range.end())},e.prototype.getProperty=function(){return this.property},e.prototype.appendCell=function(t){return this.cells.push(t),t.parent=this,t},e.prototype.deleteRow=function(){this.fixMergedGroupWhenDelete(),this.parent.rows.splice(this.index,1),this.parent.getTableActionManager().createDeleteAction(this,this.range)},e.prototype.deletePlaceholder=function(){this.parent.getTableActionManager().createDeleteAction(this,new g.ICE(this.range.end()-1,1))},e.prototype.isEqualToContent=function(t){return this.cells.length===t.length},e.prototype.getGrids=function(){var t=[],e=this.property.wBefore.w;return e&&t.push(Number(e)),t.concat(this.cells.map((function(t){return t.width})))},e.prototype.clone=function(){return this.cloneBase((function(t){return t.clone()}))},e.prototype.cloneDeep=function(){return this.cloneBase((function(t){return t.cloneDeep()}))},e.prototype.setHeight=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableRowProperty));e.trHeight.val=t,this.setProperty(e)},e.prototype.setMainCellToNormal=function(){Tr(this.cells,(function(t){t.isMainVMergeCell()&&t.clearVMerge()}))},e.prototype.setMergedCellToNormal=function(){Tr(this.cells,(function(t){t.isVMergedCell()&&t.clearVMerge()}))},e.prototype.setMainCellToBeMerged=function(){Tr(this.cells,(function(t){t.isMainVMergeCell()&&t.setToMerged()}))},e.prototype.findCellFromCol=function(t){return this.cells.find((function(e){return e.interval.begin===t}))||null},e.prototype.insertTo=function(t){this.isRaw&&(this.parent.getTableActionManager().createInsertAction(this,t),Tr(this.cells,(function(e){e.insertTo(t)})))},e.prototype.updateCellInterval=function(){var t,e,r=g.Rh7.getWidth(this.property.wBefore);try{for(var n=(0,o.__values)(this.cells),i=n.next();!i.done;i=n.next()){var a=i.value;a.interval=(0,g.pRf)(r,r+a.width),r+=a.width}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},e.prototype.updateCellSpan=function(){var t=this;this.beforeSpan=this.parent.grid.getSpan(0,g.Rh7.getWidth(this.property.wBefore));var e=this.beforeSpan;this.cells.forEach((function(r){var n=t.parent.grid.getSpan(e,r.width);n&&(r.setGrid(e,n),e+=n)}))},e.prototype.updateCellWidth=function(){var t,e,r=this.parent.grid.getWidth(0,this.beforeSpan);r&&this.setBeforeWidth(r);var n=this.beforeSpan;try{for(var i=(0,o.__values)(this.cells),a=i.next();!a.done;a=i.next()){var s=a.value,l=s.getGridSpan(),c=this.parent.grid.getWidth(n,l);s.setWidth(c),n+=l}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e.prototype.applyInsert=function(t,e){u.Gh.insertTableRow(t,this.property,e)},e.prototype.applyModify=function(t){this.stageProperty&&(this.stageProperty.nestingLevel=this.nestingLevel,u.Gh.setTableRowProperty({property:this.stageProperty,mode:g.XS7.Merge,range:this.range},t))},e.prototype.setBeforeWidth=function(t){var e=this.createProperty();e.wBefore.w=t,e.wBefore.type=g.i7d.dxa,this.setProperty(e)},e.prototype.setProperty=function(t){this.isRaw?this.property.assign(t):(this.stageProperty||(this.property=this.property.clone(),this.stageProperty=new(g.kkf.getPropertyClass(g.uSS.TableRowProperty))),this.property.assign(t),this.stageProperty.assign(t),this.parent.getTableActionManager().createModifyAction(this))},e.prototype.createProperty=function(){return new(g.kkf.getPropertyClass(g.uSS.TableRowProperty))},e.prototype.initCells=function(){var t,e,r=this.tableStream.getCellsOfRowRange(this.range,this.nestingLevel);if(r){try{for(var n=(0,o.__values)(r.cells),i=n.next();!i.done;i=n.next()){var a=i.value,s=this.dataStream.getTextStream().createParagraphIterator();s.seek(a.contentRange.end()-1);var l=s.getProperty();if(l){var c={dataEngine:this.dataEngine,range:a.range,cellProperty:a.property,paraProperty:l,row:this,nestingLevel:this.nestingLevel,interval:a.interval,contentRange:a.contentRange},p=_r.createTableCell(c);p.parent=this,this.cacheCells.push(p)}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.hasInit=!0}},e.prototype.fixMergedGroupWhenDelete=function(){Tr(this.cells,(function(t){if(t.isMainVMergeCell())t.unVMerge();else{var e=t.prevCellOfMergedGroup();t.isVMergedCell()&&(null==e?void 0:e.isMainVMergeCell())&&!t.nextCellOfMergedGroup()&&(null==e||e.clearVMerge())}}))},e.prototype.cloneBase=function(t){var r=e.createTableRow(this.dataEngine,{property:this.property});return r.cells=this.cells.map((function(e){var n=t(e);return n.parent=r,n})),r.parent=this.parent,r},e}(Pr),wr=function(){function t(){this.tableActionQueue=[]}return t.prototype.createInsertAction=function(t,e){var r={insert:{gcp:e}};this.tableActionQueue.push({payload:t,action:r})},t.prototype.createModifyAction=function(t){this.tableActionQueue.push({payload:t,action:{modify:{}}})},t.prototype.createDeleteAction=function(t,e){var r={delete:{range:e}};this.tableActionQueue.push({payload:t,action:r})},t.prototype.consumeActionsToDelta=function(t,e){var r,n,i,a,s=e?this.getTableOrderedActionQueue(e):this.getNormalActionQueue();try{for(var l=(0,o.__values)(s),c=l.next();!c.done;c=l.next()){var p=c.value,u=p.payload,g=p.action,h=null!==(a=null===(i=g.insert)||void 0===i?void 0:i.gcp)&&void 0!==a?a:u.getRange().begin();u.invokeBeforeCreateHook(h,t),this.applyDirtyModel(u,g,t),u.invokeAfterCreateHook(h,t)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}this.clearActions()},t.prototype.clearActions=function(){this.tableActionQueue=[]},t.prototype.applyDirtyModel=function(t,e,r){e.insert?t.applyInsert(e.insert.gcp,r):(e.modify&&t.applyModify(r),e.delete&&u.Gh.deleteText(e.delete.range,r))},t.prototype.getNormalActionQueue=function(){var t,e,r=[],n=[];try{for(var i=(0,o.__values)(this.tableActionQueue),a=i.next();!a.done;a=i.next()){var s=a.value,l=s.action;(null==l?void 0:l.modify)&&!l.delete?r.push(s):n.push(s)}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}return r.concat(n)},t.prototype.getTableOrderedActionQueue=function(t){var e,r,n,i,a,s,l,c,p=[],u=new Array(t.rows.length),g=t.rows.map((function(t){return new Array(t.cells.length)})),h=[];try{for(var d=(0,o.__values)(this.tableActionQueue),f=d.next();!f.done;f=d.next()){var y=(D=f.value).payload,v=D.action;if(y instanceof xr)p.push(D);else if(y instanceof Ir)u[m=y.index]?Object.assign(u[m].action,v):u[m]=D;else if(y instanceof _r){var m=y.parent.index,S=y.index;g[m][S]?Object.assign(g[m][S].action,v):g[m][S]=D}}}catch(t){e={error:t}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(e)throw e.error}}try{for(var b=(0,o.__values)(p),C=b.next();!C.done;C=b.next())(D=C.value)&&h.push(D)}catch(t){n={error:t}}finally{try{C&&!C.done&&(i=b.return)&&i.call(b)}finally{if(n)throw n.error}}try{for(var P=(0,o.__values)(g.reverse().entries()),T=P.next();!T.done;T=P.next()){var R=(0,o.__read)(T.value,2),_=R[0],I=R[1],w=u[m=g.length-_-1];w&&h.push(w);try{for(var x=(l=void 0,(0,o.__values)(I.reverse())),E=x.next();!E.done;E=x.next()){var D;(D=E.value)&&h.push(D)}}catch(t){l={error:t}}finally{try{E&&!E.done&&(c=x.return)&&c.call(x)}finally{if(l)throw l.error}}}}catch(t){a={error:t}}finally{try{T&&!T.done&&(s=P.return)&&s.call(P)}finally{if(a)throw a.error}}return h},t}(),xr=function(t){function e(e,r){var n=t.call(this,e,r.property.nestingLevel,r.range)||this;return n.hasInit=!1,n.cacheRows=[],n.stageProperty=new(g.kkf.getPropertyClass(g.uSS.TableProperty)),n.tableActionManager=new wr,n.property=r.property,n.mergedMapping=n.dataStream.getTableStream().getMergedMapping(n.range.begin(),n.nestingLevel),n.grid=n.dataStream.getTableStream().getGridManager(n.range.begin(),n.nestingLevel),n.info=r,n}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"contentRange",{get:function(){return this.info.contentRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this.hasInit||this.initTableRows(),this.cacheRows},set:function(t){this.hasInit=!0,this.cacheRows=t},enumerable:!1,configurable:!0}),e.createTable=function(t,r,n){var i=t.getTableStream(),o=r instanceof g.ICE?r.begin():r,a=i.getTableInfo(o,n);return a?(a.property=a.property.clone(),new e(t.dataEngine,a)):null},Object.defineProperty(e.prototype,"width",{get:function(){return this.grid.totalWidth},enumerable:!1,configurable:!0}),e.prototype.getContentRange=function(){return this.contentRange},e.prototype.getCell=function(t){var e,r,n=this.getRow(t);if(!n)return null;try{for(var i=(0,o.__values)(n.cells),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.getRange().contains(t))return s}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return null},e.prototype.getRow=function(t){var e,r;try{for(var n=(0,o.__values)(this.rows),i=n.next();!i.done;i=n.next()){var a=i.value;if(a.getRange().contains(t))return a}}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return null},e.prototype.getNestingLevel=function(){return this.nestingLevel},e.prototype.intersectCellRange=function(t){var e=[];return this.rows.forEach((function(r){if(t.isIntersect(r.getRange())){var n=[];r.cells.forEach((function(e){t.isContain(e.getRange())&&n.push(e)})),n.length>0&&e.push(n)}})),e},e.prototype.columnCells=function(t){return this.rows.map((function(e){var r=e.getIntervalIntersectCells(t);return r.length>0?r:[e.cells[e.cells.length-1]]}))},e.prototype.strictColumnCells=function(t){return this.rows.map((function(e){return e.getIntervalIntersectCells(t)}))},e.prototype.firstRow=function(){return 0===this.rows.length?null:this.rows[0]},e.prototype.lastRow=function(){return 0===this.rows.length?null:this.rows[this.rows.length-1]},e.prototype.appendRow=function(t){this.rows.push(t),this.isRaw||t.insertTo(this.contentRange.end())},e.prototype.setProperty=function(t){this.property.assign(t),this.isRaw||(this.stageProperty.assign(t),this.tableActionManager.createModifyAction(this))},e.prototype.getProperty=function(){return this.property},e.prototype.deleteTable=function(){this.tableActionManager.createDeleteAction(this,this.range)},e.prototype.scaleX=function(t){this.updateCellSpanFromWidth(),this.grid.scale(t),this.updateCellWidthFromSpan()},e.prototype.toDelta=function(t){return 0===this.rows.length&&(this.tableActionManager.clearActions(),this.deleteTable()),this.getTableActionManager().consumeActionsToDelta(t),this.commandType&&t.setCommandType(this.commandType),t},e.prototype.toDeltaWithSort=function(t){return this.getTableActionManager().consumeActionsToDelta(t,this),this.commandType&&t.setCommandType(this.commandType),t},e.prototype.getRange=function(){return this.range},e.prototype.getTableActionManager=function(){return this.tableActionManager},e.prototype.fixMergedStructure=function(){this.updateCellInterval(),this.updateCellMerged(this.buildMergedMapping().getErrorCells())},e.prototype.updateCellInterval=function(){var t,e;try{for(var r=(0,o.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellInterval()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.setCommandType=function(t){this.commandType=t},e.prototype.applyInsert=function(){throw new Error("暂时不支持插入表格")},e.prototype.applyModify=function(t){this.isRaw||(this.stageProperty.nestingLevel=this.nestingLevel,u.Gh.setTableProperty({range:this.range,property:this.stageProperty,mode:g.XS7.Merge},t))},e.prototype.updateCellMerged=function(t){var e,r,n;try{for(var i=(0,o.__values)(t),a=i.next();!a.done;a=i.next()){var s=a.value,l=s.rowIndex,c=s.colBegin,p=null===(n=this.rows[l])||void 0===n?void 0:n.findCellFromCol(c);p&&p.clearVMerge()}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}},e.prototype.buildMergedMapping=function(){var t,e,r,n,i=new g.mFF;try{for(var a=(0,o.__values)(this.rows),s=a.next();!s.done;s=a.next()){var l=s.value;try{for(var c=(r=void 0,(0,o.__values)(l.cells)),p=c.next();!p.done;p=c.next()){var u=p.value;u.isMainVMergeCell()?i.addRestartItem(u.interval):u.isVMergedCell()&&i.addContinueItem(u.interval)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}i.nextRow()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}return i},e.prototype.initTableRows=function(){for(var t=this.tableStream.createRowIterator({limitRange:this.contentRange,nestingLevel:this.nestingLevel});t.hasNext();){var e=Ir.createTableRow(this.dataEngine,{range:t.getRange(!0),contentRange:t.getContentRange(!0),property:t.getCloneProperty()});e.parent=this,this.cacheRows.push(e),t.next()}this.hasInit=!0},e.prototype.updateCellSpanFromWidth=function(){var t,e;try{for(var r=(0,o.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellSpan()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e.prototype.updateCellWidthFromSpan=function(){var t,e;try{for(var r=(0,o.__values)(this.rows),n=r.next();!n.done;n=r.next())n.value.updateCellWidth()}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},e}(Pr),Er=function(){function t(t,e,r){this.table=t,this.deltaOpt=e,this.state=r}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),t.prototype.createUpdateDelta=function(){var t=this.deltaOpt.buildDelta();return this.table.toDelta(t),t},t.prototype.applyTableUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.state.applyDelta(t)},t.prototype.applyTableStructureUpdate=function(){var t=this.createUpdateDelta();this.applyTableUpdate(t)},t.prototype.forEachCell=function(t,e){0!==t.length&&function(t,e){0!==t.length&&(Array.isArray(t[0])?function(t,e){for(var r=t.length-1;r>=0;r--)for(var n=t[r].length-1;n>=0;n--)e(t[r][n])}(t,e):Tr(t,e))}(t,e)},t.prototype.cellParent=function(t){return t.parent},t.prototype.rowParent=function(t){return t.parent},t.prototype.isEntireTable=function(t){var e=this.table.getRange(),r=g.ICE.inset(e,1);return t.equal(e)||t.equal(r)},t.prototype.setCommandType=function(t){this.table.setCommandType(t)},t.prototype.deleteForEntireTable=function(t){return!!this.isEntireTable(t)&&(this.table.deleteTable(),this.setCommandType(u.wI.DocDeleteTable),this.applyTableUpdate(),!0)},t}(),Dr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.getCellProperty=function(t){var e=this.tableStream.getCellInfo(t);return e?this.state.dataEngine.getDataManager().getStyleSheetManager().mergeTableCellPropWithGcp(e.property,this.table.getProperty(),t):null},Object.defineProperty(e.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"firstCellRange",{get:function(){return this.tableSelectArea.cellRanges[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"beginCell",{get:function(){var t=this.tableSelectArea.isInnerCell()?this.tableSelectArea.selectedRange.begin():this.firstCellRange.begin,e=this.table.getRange();return this.table.getCell(t===e.begin()?t+1:t)},enumerable:!1,configurable:!0}),e.prototype.createUpdateDelta=function(){var t=this.deltaOpt.buildDelta();return this.table.toDelta(t),t},e.prototype.applyTableUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.state.applyDelta(t)},e.prototype.applyTableStructureUpdate=function(t){void 0===t&&(t=this.createUpdateDelta()),this.applyTableUpdate(t)},e.prototype.isSelectTable=function(){return this.tableSelectArea.isWholeTable()},e.prototype.keepSelectionUpdate=function(){var t=this.createUpdateDelta();t.moveTo(this.state.selection.gcpRange),this.applyTableUpdate(t)},e.prototype.deleteIfSelectTable=function(){return!!this.isSelectTable()&&(this.table.deleteTable(),this.applyTableUpdate(),!0)},e.prototype.selectedCells=function(){if(this.tableSelectArea.isInnerCell()){var t=this.table.getCell(this.tableSelectArea.selectedRange.begin());if(t)return[[t]]}if(this.firstCellRange){var e=this.table.intersectCellRange(this.firstCellRange);if(e)return e}return[]},e.prototype.setCommandType=function(t){this.table.setCommandType(t)},e.prototype.forEachSelectCell=function(t){var e=this.selectedCells();this.forEachCell(e,t)},e}(Er),kr=function(){function t(){this.horizontalIntervals=[],this.cellRowInterval=[],this.topLineIndex=Number.MAX_SAFE_INTEGER,this.bottomLineIndex=Number.MIN_SAFE_INTEGER}return Object.defineProperty(t.prototype,"horizontalInterval",{get:function(){return this.horizontalIntervals[this.horizontalIntervals.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowInterval",{get:function(){return{topIndex:this.cellRowInterval[0][0].topIndex,bottomIndex:this.cellRowInterval[this.cellRowInterval.length-1][0].bottomIndex}},enumerable:!1,configurable:!0}),t.prototype.appendRowIndex=function(t){this.topLineIndex=Math.min(t,this.topLineIndex),this.bottomLineIndex=Math.max(t,this.bottomLineIndex)},t.prototype.addHorizontalInterval=function(t,e){this.horizontalIntervals[t]?this.horizontalIntervals[t]=this.horizontalIntervals[t].union(e):this.horizontalIntervals[t]=e},t.prototype.addCellRowInterval=function(t,e){this.cellRowInterval[t]||(this.cellRowInterval[t]=[]),this.cellRowInterval[t].push(e)},t.prototype.isMatchRect=function(){return this.checkAllHorizontalIntervalIsEqual()&&this.checkAllRowIntervalIsEqual()},t.prototype.checkAllHorizontalIntervalIsEqual=function(){for(var t=this.horizontalIntervals[this.horizontalIntervals.length-1],e=this.topLineIndex;e<=this.bottomLineIndex;e++){var r=this.horizontalIntervals[e];if(!r)return!1;if(!r.isEqual(t))return!1}return!0},t.prototype.checkAllRowIntervalIsEqual=function(){var t=this.cellRowInterval[0],e=this.cellRowInterval[this.cellRowInterval.length-1],r=t[0].topIndex,n=e[0].bottomIndex;return t.every((function(t){return t.topIndex===r}))&&e.every((function(t){return t.bottomIndex===n}))},t}(),Lr=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n)||this;return o.cells=i,o.mergedMapping=e.mergedMapping,o}return(0,o.__extends)(e,t),e.create=function(t,r,n){var i=n.selection.tableSelectionArea;if(!i||!i.isInnerTable())return null;var o=i.cellRanges[0],a=t.intersectCellRange(o);return 0===a.length||e.isSingleCell(a)?null:new e(t,r,n,a)},e.isSingleCell=function(t){var e=[];return t.forEach((function(t){t.forEach((function(t){t.getProperty().vMerge!==g.m7Q.continue&&e.push(t)}))})),1===e.length},Object.defineProperty(e.prototype,"mainCell",{get:function(){return this.cells[0][0]},enumerable:!1,configurable:!0}),e.prototype.merge=function(){if(this.isAllowMerge()){this.setCommandType(u.wI.DocMergeCells);var t=this.mergeVerticalGroup(),e=t.copyCells,r=t.increaseHeight,n=t.hasMergeGroup;n||this.updateMainRowHeight(this.mainCell.parent,r);var i=this.mergeMainRowCells(e,n),o=this.cells[0][0].getRange().begin();i.moveTo(new g.ICE(o)),this.applyTableUpdate(i)}},e.prototype.updateMergeCells=function(t,e){for(var r,n,i=[],a=t.topIndex,s=t.bottomIndex,l=this.table.rows,c=a;c<=s;c++){var p=[];try{for(var u=(r=void 0,(0,o.__values)(l[c].cells)),g=u.next();!g.done;g=u.next()){var h=g.value;if(e.isLess(h.interval))break;e.isContain(h.interval)&&p.push(h)}}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}i.push(p)}this.cells=i},e.prototype.isAllowMerge=function(){for(var t,e,r=new kr,n=0;n<this.cells.length;n++){var i=this.cells[n][0].parent.index;r.appendRowIndex(i);try{for(var a=(t=void 0,(0,o.__values)(this.cells[n])),s=a.next();!s.done;s=a.next()){var l=s.value;r.addHorizontalInterval(i,l.interval),this.expandVerticalInterval(l,i,n,r)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}}var c=r.isMatchRect();return c&&this.updateMergeCells(r.rowInterval,r.horizontalInterval),c},e.prototype.expandVerticalInterval=function(t,e,r,n){var i=t.getProperty().vMerge;if(i&&i!==g.m7Q.undefined){var o=i===g.m7Q.restart?1:-1,a=this.getVMergedCount(e,t.interval,i),s=e+o*a,l=Math.min(s,e),c=Math.max(s,e);n.addCellRowInterval(r,{topIndex:l,bottomIndex:c});for(var p=1;p<=a;p++)n.addHorizontalInterval(e+o*p,t.interval)}else n.addCellRowInterval(r,{topIndex:e,bottomIndex:e})},e.prototype.getVMergedCount=function(t,e,r){if(r===g.m7Q.restart)return this.mergedMapping.getMergedCount(t,e.begin)||0;if(r===g.m7Q.continue){var n=this.mergedMapping.getMainCell(t,e.begin);if(n)return t-n.rowIndex}return 0},e.prototype.mergeVerticalGroup=function(){for(var t=[],e=0,r=!1,n=function(n){var a=0;Tr(i.cells[n],(function(e){e.isEmpty()||t.push(e),a+=e.width,e.setToMerged()}));var s=i.cells[n][0].parent;if(i.isMergedRow(s))e+=s.height,s.deleteRow();else{r=!0;var l=(0,o.__spreadArray)([],(0,o.__read)(i.cells[n]),!1),c=l.pop(),p=i.mainCell.getProperty().clone();p.tcW.w=a,p.tcW.type=g.i7d.dxa,p.vMerge=g.m7Q.continue,c.coverProperty(p),c.deleteContent(),Tr(l,(function(t){return t.deleteCell()}))}},i=this,a=this.cells.length-1;a>0;a--)n(a);return{copyCells:t,increaseHeight:e,hasMergeGroup:r}},e.prototype.isMergedRow=function(t){return t.cells.every((function(t){return t.isVMergedCell()}))},e.prototype.mergeMainRowCells=function(t,e){var r,n,i=(0,o.__spreadArray)([],(0,o.__read)(this.cells[0]),!1),a=i.pop(),s=a.width;try{for(var l=(0,o.__values)(i),c=l.next();!c.done;c=l.next())s+=c.value.width}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var p=this.mainCell.getProperty().clone();e?p.vMerge=g.m7Q.restart:p.setNull(g.kkf.getPropertyClass(g.uSS.TableCellProperty).tKeys.vMerge),p.tcW.w=s,p.tcW.type=g.i7d.dxa,a.coverProperty(p);var u=this.createUpdateDelta();return this.insertMergedContent(a.getRange().end()-1,t,u),a.isEmpty()&&(t.length>0||!this.isEmptyCells(i))&&a.deleteRange(new g.ICE(a.getContentRange().end()-1,1)),this.forEachCell(i,(function(t){t.isEmpty()?t.deleteCell():t.deletePlaceholder()})),this.table.getTableActionManager().consumeActionsToDelta(u),u},e.prototype.isEmptyCells=function(t){return t.every((function(t){return t.isEmpty()}))},e.prototype.updateMainRowHeight=function(t,e){e<=0||t.setHeight(t.height+e)},e.prototype.insertMergedContent=function(t,e,r){var n,i,a,s;try{for(var l=(0,o.__values)(e),c=l.next();!c.done;c=l.next()){var p=c.value.getContentRange(),g=u.Me.collectDataToOps(this.state.dataEngine,p);try{for(var h=(a=void 0,(0,o.__values)(g)),d=h.next();!d.done;d=h.next()){var f=d.value;u.Yy.moveOffset(f,t-p.begin()),r.addOperation(f)}}catch(t){a={error:t}}finally{try{d&&!d.done&&(s=h.return)&&s.call(h)}finally{if(a)throw a.error}}}}catch(t){n={error:t}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}},e}(Dr),Ar=function(){function t(t){this.cells=t}return t.prototype.setInsideVBorder=function(t){for(var e=0;e<this.cells.length-1;e++)for(var r=0;r<this.cells[e].length;r++)this.setBottomBorder(e,r,t)},t.prototype.setInsideHBorder=function(t){for(var e=0;e<this.cells.length;e++)for(var r=0;r<this.cells[e].length-1;r++)this.setRightBorder(e,r,t)},t.prototype.setRightBorder=function(t,e,r){var n,i,o=null===(n=this.cells[t])||void 0===n?void 0:n[e];if(o){var a=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));r?a.tcBorders.right=r:a.tcBorders.setNull(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.right),o.setProperty(a)}var s=null===(i=this.cells[t])||void 0===i?void 0:i[e+1];s&&(a=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty)),r?a.tcBorders.left=r:a.tcBorders.setNull(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.left),s.setProperty(a))},t.prototype.setBottomBorder=function(t,e,r){var n,i,o=null===(n=this.cells[t])||void 0===n?void 0:n[e];if(o){var a=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));r?a.tcBorders.bottom=r:a.tcBorders.setNull(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.bottom),o.setProperty(a)}var s=null===(i=this.cells[t+1])||void 0===i?void 0:i[e];s&&(a=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty)),r?a.tcBorders.top=r:a.tcBorders.setNull(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.top),s.setProperty(a))},t}(),Fr=function(t){function e(e,r,n,i){var o=t.call(this,e,r,n)||this;return o.vMergeGroup=null,o.cell=i,o}return(0,o.__extends)(e,t),e.create=function(t,r,n){var i=n.selection.tableSelectionArea;if(!i||!i.isInnerCell())return null;var o=i.selectedRange.begin(),a=t.getCell(o);return a?new e(t,r,n,a):null},e.prototype.split=function(t,e){if(1!==t||1!==e){var r=this.splitMainCell(t,e);this.formatBorder(r),this.setCommandType(u.wI.DocSplitCells);var n=this.createUpdateDelta();n.moveTo(new g.ICE(this.cell.getRange().begin())),this.applyTableStructureUpdate(n)}},e.prototype.getVMergeCount=function(){return this.getVMergeGroup().length},e.prototype.formatBorder=function(t){var e=new Ar(t),r=this.cell.getProperty().tcBorders;e.setInsideHBorder(r.has(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.left)?r.left.clone():null),e.setInsideVBorder(r.has(g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.top)?r.top.clone():null)},e.prototype.getVMergeGroup=function(){return this.vMergeGroup||(this.vMergeGroup=this.cell.getVMergeCells()),this.vMergeGroup},e.prototype.splitMainCell=function(t,e){return this.cell.getProperty().vMerge===g.m7Q.restart?this.unMergeVerticalGroup(t,e):this.insertRowToSplit(t,e)},e.prototype.unMergeVerticalGroup=function(t,e){for(var r=this.getVMergeGroup(),n=Math.floor(r.length/t),i=1===n,o=this.cell.getFollowParaStyle(),a=[],s=r.length-1;s>=0;s--){var l=r[s];if(s%n==0){var c=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))(this.cell.getProperty());c.vMerge=g.m7Q.restart,i?c.setNull(g.kkf.getPropertyClass(g.uSS.TableCellProperty).tKeys.vMerge):c.vMerge=g.m7Q.restart,l.setProperty(c),l!==this.cell&&(Rr(o.paragraph),l.coverParagraph(o))}a.unshift(l.splitCell(e,o))}return a},e.prototype.insertRowToSplit=function(t,e){var r=this.cell.getFollowParaStyle();if(1===t)return[this.cell.splitCell(e,r)];var n=t-1,i=this.cellParent(this.cell),a=this.cell.index,s=(0,o.__spreadArray)([],(0,o.__read)(i.cells),!1);s.splice(a,1),this.setVMerge(s,g.m7Q.restart);var l=this.insertPadRow(n,e,a);return l.unshift(this.cell.splitCell(e,r)),l},e.prototype.insertPadRow=function(t,e,r){var n=this.cellParent(this.cell),i=n.height/(t+1),a=i>0;a&&n.setHeight(i);for(var s=[],l=0;l<t;l++){var c=n.clone();a&&c.setHeight(i);var p=(0,o.__spreadArray)([],(0,o.__read)(c.cells),!1);p.splice(r,1),this.setVMerge(p,g.m7Q.continue);var u=c.cells[r];u.coverParagraph(this.cell.getFollowParaStyle()),s.unshift(u.splitCell(e)),n.insertAfter(c)}return s},e.prototype.setVMerge=function(t,e){var r=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));r.vMerge=e,this.forEachCell(t,(function(t){t.setProperty(r)}))},e}(Dr);function Mr(t,e){var r=e?e.clone():new(g.kkf.getPropertyClass(g.uSS.CTBorderWml));return r.color=t.color,r.val=t.val,r.sz=t.sz,r.space=t.space,r}function Or(t,e){if(t.isEmpty())return!1;var r=function(t,e){var r=e?e.clone():new(g.kkf.getPropertyClass(g.uSS.CTBorderWml));return t.color&&(r.color=t.color),t.val&&(r.val=t.val),t.sz&&(r.sz=t.sz),t.space&&(r.space=t.space),r}(e,t),n=!!e.reverse,i=t.equalTo(r);return i&&!n||!i&&n}function Br(t,e){var r=e.mergeStyleTableProperty(t.parent.parent.getProperty()).tblPr.tblBorders,n=t.getProperty().tcBorders.clone();return(0,g._ky)(n,g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.top)&&(n.top=t.parent.prevRow()?r.insideH:r.top),(0,g._ky)(n,g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.bottom)&&(n.bottom=t.parent.nextRow()?r.insideH:r.bottom),(0,g._ky)(n,g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.left)&&(n.left=t.prevCell()?r.insideV:r.left),(0,g._ky)(n,g.kkf.getPropertyClass(g.uSS.CTTcBorders).tKeys.right)&&(n.right=t.nextCell()?r.insideV:r.right),n}var Nr,Hr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.getBorderType=function(t){return this.tableSelectArea.isInnerTable()||this.tableSelectArea.isInnerCell()?this.getCellBorder(t):g.b0e.None},e.prototype.getCellBorder=function(t){var e=this,r=g.b0e.Total,n=this.getCells(),i=n.length>1,o=!1;n.forEach((function(i,a){i.length>1&&(o=!0),i.forEach((function(o,s){var l=e.cellRelateToSelection(a,n),c=e.cellRelateToSelection(s,i),p=Br(o,e.state.dataEngine.getDataManager().getStyleSheetManager());r=e.filterFirstRowBorderType(r,p,t,l),r=e.filterLastRowBorderType(r,p,t,l),r=e.filterMiddleRowBorderType(r,p,t,l),r=e.filterFirstColBorderType(r,p,t,c),r=e.filterLastColBorderType(r,p,t,c),r=e.filterMiddleColBorderType(r,p,t,c),Or(o.getProperty().tcBorders.tr2bl,t)||(r=(0,g.SXW)(r,g.b0e.DiagonalUp)),Or(o.getProperty().tcBorders.tl2br,t)||(r=(0,g.SXW)(r,g.b0e.DiagonalDown))}))}));var a=!1;return i&&(0,g.JAq)(r,g.b0e.Horizontal)&&(a=!0),o&&(0,g.JAq)(r,g.b0e.Vertical)&&(a=!0),a||(r=(0,g.SXW)(r,g.b0e.Horizontal,g.b0e.Vertical)),r},e.prototype.setBorder=function(t,e){var r=this,n=this.state.selection.gcpRange;if(this.tableSelectArea.isWholeTable())this.clearCellBorder(this.getCells()),this.setTableBorder(t,e);else if(this.tableSelectArea.isInnerTable()||this.tableSelectArea.isInnerCell()){var i=this.getCells();i.forEach((function(n,o){r.setLRNearCellBorder(n,t,e);var a=r.cellRelateToSelection(o,i);r.setUDNearCellBorder(t,n,e,a),n.forEach((function(i,o){var s,l=r.cellRelateToSelection(o,n);r.setFirstRowCellBorder(t,i,e,a),r.setLastRowCellBorder(t,i,e,a),r.setMiddleRowCellBorder(t,i,e,a),r.setFirstColCellBorder(t,i,e,l),r.setLastColCellBorder(t,i,e,l),r.setMiddleColCellBorder(t,i,e,l),(0,g.JAq)(t,g.b0e.DiagonalUp)&&((s=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))).tcBorders.tr2bl=Mr(e),i.setProperty(s)),(0,g.JAq)(t,g.b0e.DiagonalDown)&&((s=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))).tcBorders.tl2br=Mr(e),i.setProperty(s))}))}))}this.setCommandType(u.wI.DocModifyTableStyle);var o=this.createUpdateDelta();o.moveTo(n),this.applyTableUpdate(o)},e.prototype.cellRelateToSelection=function(t,e){var r=!1,n=!1,i=!1;return 0===t&&(r=!0),t===e.length-1&&(i=!0),r||i||(n=!0),{isBegin:r,isMiddle:n,isEnd:i}},e.prototype.filterFirstRowBorderType=function(t,e,r,n){if(!n.isBegin)return t;var i=t,o=e.top,a=e.bottom;return Or(o,r)||(i=(0,g.SXW)(i,g.b0e.Top)),Or(a,r)||n.isEnd||(i=(0,g.SXW)(i,g.b0e.Horizontal)),i},e.prototype.filterMiddleRowBorderType=function(t,e,r,n){if(!n.isMiddle)return t;var i=t,o=e.top,a=e.bottom;return Or(o,r)&&Or(a,r)||(i=(0,g.SXW)(i,g.b0e.Horizontal)),i},e.prototype.filterLastRowBorderType=function(t,e,r,n){if(!n.isEnd)return t;var i=t,o=e.top,a=e.bottom;return Or(o,r)||n.isBegin||(i=(0,g.SXW)(i,g.b0e.Horizontal)),Or(a,r)||(i=(0,g.SXW)(i,g.b0e.Bottom)),i},e.prototype.filterFirstColBorderType=function(t,e,r,n){if(!n.isBegin)return t;var i=t,o=e.left,a=e.right;return Or(o,r)||(i=(0,g.SXW)(i,g.b0e.Left)),Or(a,r)||n.isEnd||(i=(0,g.SXW)(i,g.b0e.Vertical)),i},e.prototype.filterMiddleColBorderType=function(t,e,r,n){if(!n.isMiddle)return t;var i=t,o=e.left,a=e.right;return(0,g.JAq)(t,g.b0e.Vertical)?(Or(o,r)&&Or(a,r)||(i=(0,g.SXW)(i,g.b0e.Vertical)),i):i},e.prototype.filterLastColBorderType=function(t,e,r,n){if(!n.isEnd)return t;var i=t,o=e.left,a=e.right;return Or(o,r)||n.isBegin||(i=(0,g.SXW)(i,g.b0e.Vertical)),Or(a,r)||(i=(0,g.SXW)(i,g.b0e.Right)),i},e.prototype.clearCellBorder=function(t){var e=g.kkf.getPropertyClass(g.uSS.TableCellProperty);t.forEach((function(t){t.forEach((function(t){var r=new e;r.setNull(e.tKeys.tcBorders),t.setProperty(r)}))}))},e.prototype.setTableBorder=function(t,e){var r=new(g.kkf.getPropertyClass(g.uSS.TableProperty));(0,g.JAq)(t,g.b0e.Left)&&(r.tblPr.tblBorders.left=Mr(e)),(0,g.JAq)(t,g.b0e.Right)&&(r.tblPr.tblBorders.right=Mr(e)),(0,g.JAq)(t,g.b0e.Top)&&(r.tblPr.tblBorders.top=Mr(e)),(0,g.JAq)(t,g.b0e.Bottom)&&(r.tblPr.tblBorders.bottom=Mr(e)),(0,g.JAq)(t,g.b0e.Horizontal)&&(r.tblPr.tblBorders.insideH=Mr(e)),(0,g.JAq)(t,g.b0e.Vertical)&&(r.tblPr.tblBorders.insideV=Mr(e)),this.table.setProperty(r)},e.prototype.setFirstRowCellBorder=function(t,e,r,n){if(n.isBegin){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Horizontal)&&!n.isEnd&&(i.tcBorders.bottom=Mr(r)),(0,g.JAq)(t,g.b0e.Top)&&(i.tcBorders.top=Mr(r)),e.setProperty(i)}},e.prototype.setMiddleRowCellBorder=function(t,e,r,n){if(n.isMiddle){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Horizontal)&&(i.tcBorders.top=Mr(r),i.tcBorders.bottom=Mr(r),e.setProperty(i))}},e.prototype.setLastRowCellBorder=function(t,e,r,n){if(n.isEnd){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Horizontal)&&!n.isBegin&&(i.tcBorders.top=Mr(r)),(0,g.JAq)(t,g.b0e.Bottom)&&(i.tcBorders.bottom=Mr(r)),e.setProperty(i)}},e.prototype.setFirstColCellBorder=function(t,e,r,n){if(n.isBegin){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Vertical)&&!n.isEnd&&(i.tcBorders.right=Mr(r)),(0,g.JAq)(t,g.b0e.Left)&&(i.tcBorders.left=Mr(r)),e.setProperty(i)}},e.prototype.setMiddleColCellBorder=function(t,e,r,n){if(n.isMiddle){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Vertical)&&(i.tcBorders.right=Mr(r),i.tcBorders.left=Mr(r),e.setProperty(i))}},e.prototype.setLastColCellBorder=function(t,e,r,n){if(n.isEnd){var i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));(0,g.JAq)(t,g.b0e.Vertical)&&!n.isBegin&&(i.tcBorders.left=Mr(r)),(0,g.JAq)(t,g.b0e.Right)&&(i.tcBorders.right=Mr(r)),e.setProperty(i)}},e.prototype.setLRNearCellBorder=function(t,e,r){var n,i=t[0].prevCell(),o=t[t.length-1].nextCell();i&&(0,g.JAq)(e,g.b0e.Left)&&((n=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))).tcBorders.right=Mr(r),i.setProperty(n)),o&&(0,g.JAq)(e,g.b0e.Right)&&((n=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))).tcBorders.left=Mr(r),o.setProperty(n))},e.prototype.setUDNearCellBorder=function(t,e,r,n){n.isMiddle||(this.setUpperCellBorder(t,e,r,n),this.setBelowCellBorder(t,e,r,n))},e.prototype.setUpperCellBorder=function(t,e,r,n){if(n.isBegin&&(0,g.JAq)(t,g.b0e.Top)){var i=this.getOuterEqualIntervalCell(e,!0),o=null==i?void 0:i.cells;null==o||o.forEach((function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));e.tcBorders.bottom=Mr(r),t.setProperty(e)}))}},e.prototype.setBelowCellBorder=function(t,e,r,n){if(n.isEnd&&(0,g.JAq)(t,g.b0e.Bottom)){var i=this.getOuterEqualIntervalCell(e,!1),o=null==i?void 0:i.cells;null==o||o.forEach((function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));e.tcBorders.top=Mr(r),t.setProperty(e)}))}},e.prototype.getOuterEqualIntervalCell=function(t,e){var r=this.getCellsInterval(t);if(!r)return null;var n=e?t[0].parent.prevRow():t[0].parent.nextRow();if(!n)return null;var i=n.getIntervalContainCells(r);if(!i)return null;var o=this.getCellsInterval(i);return o&&r.isEqual(o)?{cells:i,interval:o}:null},e.prototype.getCells=function(){if(this.tableSelectArea.isInnerCell()){var t=this.table.getCell(this.tableSelectArea.selectedRange.begin());return t?[[t]]:[]}return this.tableSelectArea.isCrossTable()?[[]]:this.table.intersectCellRange(this.tableSelectArea.cellRanges[0])},e.prototype.getCellsInterval=function(t){if(!t)return null;if(!t[0])return null;var e=t[0].interval;return t.slice(1).forEach((function(t){e=e.union(t.interval)})),e},e}(Dr),Wr=function(t,e,r){void 0===r&&(r=1);var n=t.getTableStream().getCellInfo(e,r);return n?function(t,e){var r=g.Rh7.getWidth(e.property.tcW),n=t.getTableStream().getTableInfo(e.range.begin(),e.property.nestingLevel);if(!n)return r;var o=g.Rh7.resolveMar(t.dataEngine.getDataManager().getStyleSheetManager().mergeStyleTableProperty(n.property),e.property);return r-(o.left.w+o.right.w)-2*(0,i.pxToTwips)(1)}(t,n):function(t,e){var r=t.followSectProp(e);return r.pgSz.w-r.pgMar.left-r.pgMar.right-(0,i.pxToTwips)(1)}(t,e)},Gr=((Nr={})[g.y83.left]=g.xxK.left,Nr[g.y83.start]=g.xxK.left,Nr[g.y83.center]=g.xxK.center,Nr[g.y83.right]=g.xxK.right,Nr[g.y83.end]=g.xxK.right,Nr),Vr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.increaseRightSideColWidth=function(t,e){var r,n,i=this.table,a=null==i?void 0:i.getCell(t);if(a&&i){var s=i.columnCells(a.interval);try{for(var l=(0,o.__values)(s),c=l.next();!c.done;c=l.next()){var p=c.value,g=p[p.length-1];g.setWidth(g.width+e)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}this.setCommandType(u.wI.DocModifyTableColumnWidth),this.applyTableStructureUpdate()}},e.prototype.setColsWidth=function(t){for(var e,r,n,i=0;i<t.length;i++)try{for(var a=(e=void 0,(0,o.__values)(this.table.rows)),s=a.next();!s.done;s=a.next())null===(n=s.value.cells[i])||void 0===n||n.setWidth(t[i])}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}this.table.fixMergedStructure(),this.setCommandType(u.wI.DocModifyTableColumnWidth),this.applyTableStructureUpdate()},e.prototype.insertColsLeft=function(t,e){var r=this,n=this.locateTargetColCells(t);if(n){var i=n.map((function(t){return t[0]}));this.fitWidth(i[0].width*e);var o=i[0].getProperty().tcW;this.forEachCell(i,(function(t){for(var n=0;n<e;n++){var i=t.clone();i.setProperty(r.createWidthProperty(o)),t.insertLeft(i)}})),this.table.fixMergedStructure(),this.setCommandType(u.wI.DocInsertColumn),this.applyTableStructureUpdate()}},e.prototype.insertColsRight=function(t,e){var r=this,n=this.locateTargetColCells(t);if(n){var i=n.map((function(t){return t[t.length-1]}));this.fitWidth(i[0].width*e);var o=i[0].getProperty().tcW;this.forEachCell(i,(function(t){for(var n=0;n<e;n++){var i=t.clone();i.setProperty(r.createWidthProperty(o)),t.insertRight(i)}})),this.table.fixMergedStructure(),this.setCommandType(u.wI.DocInsertColumn),this.applyTableStructureUpdate()}},e.prototype.removeCols=function(t){if(!this.deleteForEntireTable(t)){var e=this.selectedInterval(t);if(e){var r=this.table.strictColumnCells(e);r&&(this.removeCells(r),this.table.fixMergedStructure(),this.setCommandType(u.wI.DocDeleteTableColumn),this.applyTableStructureUpdate())}}},e.prototype.moveColsTo=function(t,e){var r=this.table;if(!r)return!1;var n=r.columnCells(t);if(n.length!==e.length)return!1;for(var i=function(t){var r=e[t],i=n[t],o=i.map((function(t){return t.getRange().len})),a=i.map((function(t){return t.cloneDeep()})),s=function(){for(var t=r,e=0;e<a.length;e++)a[e].insertTo(t),t+=o[e]},l=function(){for(var t;i.length;)null===(t=i.pop())||void 0===t||t.deleteCell()};i[0].getRange().gcpBegin>r?(l(),s()):(s(),l())},o=e.length-1;o>=0;o--)i(o);return this.setCommandType(u.wI.DocMoveTableColumn),this.applyTableStructureUpdate(),!0},e.prototype.averageColWidths=function(t){var e,r,n=this,i=this.table,o=null===(e=this.state.selection.tableSelectionArea)||void 0===e?void 0:e.cellRanges;if(Array.isArray(o)&&o.length>0&&!t){var a=o[0].getRanges()[0],s=null===(r=this.state.getTableStream().getCellsOfRowRange(a,i.getNestingLevel()))||void 0===r?void 0:r.cells;if(!s||0===s.length)return;var l=s[0].interval.union(s[s.length-1].interval);i.rows.forEach((function(t){var e=t.getIntervalIntersectCells(l),r=e.reduce((function(t,e){return t+e.width}),0),i=Math.floor(r/e.length);n.averageCellsWidth(e,i,r)}))}else i.rows.forEach((function(t){var e=t.cells;if(e&&0!==e.length){var r=e.reduce((function(t,e){return t+e.width}),0),i=Math.floor(r/e.length);n.averageCellsWidth(e,i,r)}}));this.setCommandType(u.wI.DocAverageTableColumnWidth),this.table.fixMergedStructure(),this.applyTableStructureUpdate()},e.prototype.averageCellsWidth=function(t,e,r){var n=t.length-1;t.forEach((function(t,i){if(i===n){var o=r-e*n;t.setWidth(o)}else t.setWidth(e)}))},e.prototype.removeCells=function(t){Tr(t,(function(t){if(0!==t.length){var e=t[0].parent;e.cells.length!==t.length?Tr(t,(function(t){return null==t?void 0:t.deleteCell()})):e.deleteRow()}}))},e.prototype.fitWidth=function(t){var e=Wr(this.state,this.table.getRange().begin()),r=this.table.width,n=r+t;n<e||r>e||this.table.scaleX(e/n)},e.prototype.locateTargetColCells=function(t){var e=this.selectedInterval(t);return e?this.table.columnCells(e):null},e.prototype.selectedInterval=function(t){var e=this.tableStream.getCellInterval(t.begin(),this.table.getNestingLevel()),r=Math.max(t.begin(),t.end()-1),n=this.tableStream.getCellInterval(r,this.table.getNestingLevel());return e&&n?e.union(n):null},e.prototype.createWidthProperty=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));return e.tcW=t,e},e}(Er),Ur=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.setBackgroundColor=function(t){var e=this;this.forEachSelectCell((function(r){r.setProperty(e.createColorProperty(t))})),this.setCommandType(u.wI.DocModifyTableStyle),this.keepSelectionUpdate()},e.prototype.setTableStyleTheme=function(t){var e=this.table.getProperty().clone(),r=e.tblPr.tblStyle,n=this.state.dataEngine.getDataManager().getStyleSheetManager(),i=n.getStylePropertyFromId(r),o=this.createUpdateDelta(),a=pe.generateStyleProperty(o,n,t);(null==a?void 0:a.type)===g.TAq.table&&(this.clearTablePropBeforeSetTheme(e),this.clearCellsPropBeforeSetTheme(),(null==i?void 0:i.name)!==t&&(e.tblPr.tblStyle=a.styleId,e.tblPr.tblLook.firstRow=!0,e.tblPr.tblLook.firstColumn=!0,e.tblPr.tblLook.noHBand=!1),this.table.setProperty(e),this.setCommandType(u.wI.DocModifyTable),this.table.toDelta(o),o.moveTo(this.state.selection.gcpRange),this.applyTableUpdate(o))},e.prototype.setVerticalAlign=function(t){var e=this;this.forEachSelectCell((function(r){r.setProperty(e.createVAlignProperty(t))})),this.setCommandType(u.wI.DocModifyTableStyle),this.keepSelectionUpdate()},e.prototype.getVerticalAlign=function(){var t;if(this.beginCell){var e=this.getCellProperty(null===(t=this.beginCell)||void 0===t?void 0:t.getRange().begin()),r=g.kkf.getPropertyClass(g.uSS.TableCellProperty);if(null==e?void 0:e.has(r.tKeys.vAlign))return e.vAlign}return g.lZc.top},e.prototype.clearContent=function(){this.forEachSelectCell((function(t){t.deleteContent()})),this.setCommandType(u.wI.DocDeleteText),this.applyTableUpdate()},e.prototype.clearFirstCellContent=function(){this.beginCell&&(this.beginCell.deleteContent(),this.setCommandType(u.wI.DocDeleteText),this.applyTableUpdate())},e.prototype.createColorProperty=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));return e.shd.val=g.VHU.clear,e.shd.color=g.oPf.auto,e.shd.fill=t,e},e.prototype.createVAlignProperty=function(t){var e=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));return e.vAlign=t,e},e.prototype.clearTablePropBeforeSetTheme=function(t){t.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.tblInd),t.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.tblBorders),t.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.shd),t.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.tblCellMar)},e.prototype.clearCellsPropBeforeSetTheme=function(){var t,e,r,n;try{for(var i=(0,o.__values)(this.table.rows),a=i.next();!a.done;a=i.next()){var s=a.value;try{for(var l=(r=void 0,(0,o.__values)(s.cells)),c=l.next();!c.done;c=l.next()){var p=c.value,u=p.getProperty().clone();u.setNull(g.kkf.getPropertyClass(g.uSS.CTTcPrBase).tKeys.tcBorders),u.setNull(g.kkf.getPropertyClass(g.uSS.CTTcPrBase).tKeys.shd),u.setNull(g.kkf.getPropertyClass(g.uSS.CTTcPrBase).tKeys.tcMar),u.setNull(g.kkf.getPropertyClass(g.uSS.CTTcPrBase).tKeys.vAlign),p.setProperty(u)}}catch(t){r={error:t}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},e}(Dr),Kr=function(){function t(t,e){var r;this.state=t,this.range=t.selection.gcpRange,this.delta=e.buildDelta(),this.coreRange=this.state.selection.getCoreRange(),this.nestingLevel=((null===(r=this.state.getTableStream().getCellInfo(this.range.begin()))||void 0===r?void 0:r.property.nestingLevel)||0)+1}return t.prototype.insert=function(t,e){var r=this.adjustSelectRange();this.deleteSelectRange(r),this.checkToInsertParagraph();var n=this.insertTable(r,e,t);this.followSelectBeginPara(r),this.applyDelta(n)},t.prototype.checkToInsertParagraph=function(){var t=this.range.begin();if(pe.shouldInsertParaBeforeTable(t,this.state)){var e=this.genCurrentFollowParaProp(this.coreRange.gcpRange.begin()),r=e.paraBreakSpan,n=e.paraProp;this.filterAttributeOfFollowPara(n),u.Gh.insertParagraph(this.delta.currentRange().end(),r,n,this.delta)}},t.prototype.genCurrentFollowParaProp=function(t){return{paraProp:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(this.state.currentParaProp(t)),paraBreakSpan:new(g.kkf.getPropertyClass(g.uSS.RunProperty))(this.state.followSpanProp(t))}},t.prototype.applyDelta=function(t){this.delta.setCommandType(u.wI.DocInsertTable),this.state.applyDelta(this.delta),this.state.setRangeTo(new g.ICE(t+1,0)),this.state.cusorSpanProp=null},t.prototype.followSelectBeginPara=function(t){var e=this.state.followParaProp(this.range.begin());if(this.coreRange.isParaEnd(t.end())){var r={range:new g.ICE(this.delta.currentRange().end(),1),property:e.paraProp,mode:g.XS7.Insert};u.Gh.setParagraphProperty(r,this.delta)}},t.prototype.deleteSelectRange=function(t){this.delta.moveTo(t),this.delta.deleteText(t)},t.prototype.adjustSelectRange=function(){var t=this.range.clone();return this.shouldRemainParaAfterTable()||(t.len+=1),this.coreRange.fixToValidDeleteRange(t)},t.prototype.insertTable=function(t,e,r){var n=this.delta.currentRange().end(),i=this.createTableProp(e),o=i.tableProp,a=i.colWidth,s=this.createRowProp(),l=this.createCellProp(t,a),c=l.cellProp,p=l.runProp,h=l.paraProp,d=new(g.kkf.getPropertyClass(g.uSS.TableProperty));d.nestingLevel=this.nestingLevel,u.Gh.insertTableStart(this.delta.currentRange().end(),this.delta,d);for(var f=0;f<r;f++){for(var y=0;y<e;y++)h.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.pBdr),u.Gh.insertParagraph(this.delta.currentRange().end(),p,new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(h),this.delta),u.Gh.insertTableCell(this.delta.currentRange().end(),c,this.delta);u.Gh.insertTableRow(this.delta.currentRange().end(),s,this.delta)}return u.Gh.insertTableEnd(this.delta.currentRange().end(),o,this.delta),n},t.prototype.createRowProp=function(){var t=new(g.kkf.getPropertyClass(g.uSS.TableRowProperty));return t.nestingLevel=this.nestingLevel,t},t.prototype.createCellProp=function(t,e){var r=this.genCellFollowParaProp(this.coreRange.gcpRange.begin()),n=t.isEmpty()?this.genTableCellProp(r.paraProp,r.paraBreakSpan):this.genTableCellProp();return n.cellProp.tcW.w=e,n.cellProp.tcW.type=g.i7d.dxa,n.cellProp.nestingLevel=this.nestingLevel,n},t.prototype.shouldRemainParaAfterTable=function(){if(this.range.isEmpty())return!0;var t=new En(this.state),e=t.getSelection(),r=e.relationToSelectAndPara(!1,!1,!1,!1),n=e.getParaRangeFromSelection(!1),i=Boolean(this.state.getTableStream().getTableInfo(n.end()));return!r||r&&(e.isSelectionEndAtStoryEnd(!1)||i||this.hasBottomBorder(n,t))},t.prototype.hasBottomBorder=function(t,e){var r=e.getDocument().getRange(t.begin(),t.end()).getParagraphFormat().getBorder();return r!==c.Jj.Undefined&&!r.bottom.isEmpty()},t.prototype.getTableContentWidth=function(){return Wr(this.state,this.range.begin(),Math.max(this.nestingLevel-1,1))},t.prototype.createTableProp=function(t){var e=this.getTableContentWidth(),r=(0,i.pxToTwips)(Math.floor((0,i.twipsToPx)(e/t))),n=this.getDefaultStyle(),o=g.Rh7.createTableProperty();return o.tblPr.nestingLevel=this.nestingLevel,n&&(o.tblPr.tblStyle=n),{tableProp:o,colWidth:r}},t.prototype.getDefaultStyle=function(){var t=pe.generateStyleProperty(this.delta,this.state.dataEngine.getDataManager().getStyleSheetManager(),g.keb.defaultTableStyleName);return(null==t?void 0:t.type)===g.TAq.table?t.styleId:null},t.prototype.genTableCellProp=function(t,e){var r=new(g.kkf.getPropertyClass(g.uSS.RunProperty)),n=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),i=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));return i.nestingLevel=this.nestingLevel,t&&(n.merge(t),[g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.pStyle,g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.outlineLvl,g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.ind].forEach((function(t){n.setDefault(t)}))),e&&r.merge(e),{cellProp:i,runProp:r,paraProp:n}},t.prototype.genCellFollowParaProp=function(t){var e=this.genFollowParaProp(t,[g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.pStyle,g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.outlineLvl,g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.ind,g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.numPr]);return this.filterAttributeOfFollowPara(e.paraProp),e},t.prototype.genFollowParaProp=function(t,e){var r=this.state.followParaProp(t);return e.forEach((function(t){r.paraProp.setDefault(t)})),r},t.prototype.filterAttributeOfFollowPara=function(t){t.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.pBdr)},t}(),zr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.insertRowsAbove=function(t,e){var r=this.locateRow(t.begin());if(r){var n=r.clone();n.setMainCellToNormal();for(var i=0;i<e;i++)r.insertBefore(n.clone());this.setCommandType(u.wI.DocInsertTableRow);var o=this.createUpdateDelta(),a=r.cells[0].getRange().begin();o.moveTo(new g.ICE(a)),this.applyTableUpdate(o)}},e.prototype.insertRowsBelow=function(t,e){var r=Math.max(t.begin(),t.end()-1),n=this.locateRow(r);if(n){var i=n.clone();n.cells.forEach((function(t,e){t.isLastVMergeCell()&&i.cells[e].clearVMerge()})),i.setMainCellToBeMerged();for(var o=0;o<e;o++)n.insertAfter(i.clone());this.setCommandType(u.wI.DocInsertTableRow);var a=this.createUpdateDelta(),s=n.getRange().end();a.moveTo(new g.ICE(s)),this.applyTableUpdate(a)}},e.prototype.removeRows=function(t){if(!this.deleteForEntireTable(t)){var e=this.locateRows(t);e&&(Tr(e,(function(t){t.deleteRow()})),this.setCommandType(u.wI.DocDeleteTableRow),this.applyTableStructureUpdate())}},e.prototype.moveRowsTo=function(t,e){if(!this.table)return!1;var r=this.locateRows(t);if(!r)return!1;var n=r.map((function(t){return t.cloneDeep()})),i=function(){for(var t=n.length-1;t>=0;t--)n[t].insertTo(e)},o=function(){Tr(r,(function(t){t.deleteRow()}))};t.begin()>e?(o(),i()):(i(),o()),this.setCommandType(u.wI.DocMoveTableRow),this.applyTableStructureUpdate()},e.prototype.getCellsCountOfFirstSelectedRow=function(){var t,e=null===(t=this.state.selection.tableSelectionArea)||void 0===t?void 0:t.begin;if(!e)return 0;var r=this.locateRow(e);return r?r.cells.length:0},e.prototype.locateRow=function(t){var e=this.table.getRange();return e.begin()===t?this.table.firstRow():e.end()-1===t?this.table.lastRow():this.table.getRow(t)},e.prototype.locateRows=function(t){var e=this.table.rows.filter((function(e){return e.getRange().intersect(t)}));return e.length>0?e:null},e}(Er),jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.setTableHorizonAlignment=function(t){var e=this.table.getProperty().clone();t===g.y83.left&&(e.tblPr.tblInd.w=0),e.tblPr.jc=t,e.tblPr.has(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.tblpPr)&&t!==g.y83.undefined&&(e.tblPr.tblpPr.tblpXSpec=Gr[t]),this.table.setProperty(e),this.setCommandType(u.wI.DocModifyTable);var r=this.state.selection.gcpRange,n=this.createUpdateDelta();n.moveTo(r),this.applyTableUpdate(n)},e.prototype.getTableHorizonAlignment=function(){return this.table.getProperty().tblPr.jc},e}(Er),qr=function(){function t(t){var e=this;this.state=t,this.beginCursorOfTable=function(t){var r=e.tableStream.getCellInfo(t.contentRange.begin());return r?new g.ICE(r.contentRange.begin()):null},this.endCursorOfTable=function(t){var r=e.tableStream.getCellInfo(t.contentRange.end()-3);return r?new g.ICE(r.contentRange.end()-1):null}}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectedRange",{get:function(){return this.state.selection.gcpRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isCursor",{get:function(){return 0===this.selectedRange.len},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nestingLevel",{get:function(){var t;return(null===(t=this.tableSelectArea)||void 0===t?void 0:t.nestingLevel)||0},enumerable:!1,configurable:!0}),t.prototype.isInFirstCell=function(){var t;return!!(null===(t=this.tableSelectArea)||void 0===t?void 0:t.isInnerCell())&&!this.prevValidCell(this.tableSelectArea.selectedRange.begin())},t.prototype.isInLastCell=function(){return!(!this.tableSelectArea||!this.tableSelectArea.isInnerCell()||this.nextValidCell(this.tableSelectArea.selectedRange.begin()))},t.prototype.selectFirstCellContent=function(){var t=this.getFirstCellOfSelection();t&&this.state.setRangeTo(this.cellContentRange(t))},t.prototype.toNextCell=function(){var t=this.nextValidCell(this.selectedRange.begin());t&&this.state.setRangeTo(this.cellContentRange(t))},t.prototype.getNextCellRange=function(){var t=this.nextValidCell(this.selectedRange.len?this.selectedRange.end()-1:this.selectedRange.end());return t?t.range:null},t.prototype.toPrevCell=function(){var t=this.prevValidCell(this.selectedRange.begin());t&&this.state.setRangeTo(this.cellContentRange(t))},t.prototype.getPrevCellRange=function(){var t=this.prevValidCell(this.selectedRange.begin());return t?t.range:null},t.prototype.selectCurrentTable=function(){if(this.tableSelectArea){var t=this.tableStream.getTableInfo(this.tableSelectArea.begin,this.tableSelectArea.nestingLevel);t&&this.selectTable(t)}},t.prototype.attemptForwardToTable=function(){return this.attemptToTable(this.selectedRange.begin()+1,this.beginCursorOfTable)},t.prototype.attemptBackwardToTable=function(){var t=this.selectedRange.end()-1;return!(t<0)&&this.attemptToTable(t,this.endCursorOfTable)},t.prototype.isCursorInCellBegin=function(){if(!this.isCursor)return!1;var t=this.getSelectionCell(this.selectedRange.begin());return(null==t?void 0:t.range.begin())===this.selectedRange.begin()},t.prototype.attemptSelectTableBeforeCursor=function(){if(!this.isCursor)return!1;var t=this.decrease(this.selectedRange.begin()),e=this.tableStream.getTableInfo(t,this.nestingLevel+1);return t+1===(null==e?void 0:e.range.end())&&this.selectTable(e)},t.prototype.attemptMoveCursorPrev=function(){if(!this.tableSelectArea||this.tableSelectArea.isCrossTable())return!!this.isCursor&&this.attemptBackwardToTable();if(this.tableSelectArea.isInnerTable())return!!(t=this.getSelectionCell(this.tableSelectArea.begin))&&(this.state.setRangeTo(new g.ICE(t.range.begin())),!0);if(this.isCursorInCellBegin()){var t,e=this.selectedRange.begin();return(t=this.prevValidCell(e))?this.state.setRangeTo(new g.ICE(t.contentRange.end()-1)):this.moveCursorOutOfTable(e,!1),!0}return!1},t.prototype.attemptMoveCursorNext=function(){if(!this.tableSelectArea||this.tableSelectArea.isCrossTable())return!!this.isCursor&&this.attemptForwardToTable();if(this.tableSelectArea.isInnerTable()||this.isCursorInCellEnd()){var t=this.nextValidCell(this.tableSelectArea.end+1);return t?this.state.setRangeTo(new g.ICE(t.range.begin())):this.moveCursorOutOfTable(this.selectedRange.begin(),!0),!0}return!1},t.prototype.selectTable=function(t){return this.state.setRangeTo(t.range,{scrollToView:u.hF.None}),!0},t.prototype.cellContentRange=function(t){return g.ICE.insetBoth(t.contentRange,0,1)},t.prototype.moveCursorOutOfTable=function(t,e){void 0===e&&(e=!0);var r=this.tableStream.getTableInfo(t);if(r){var n=e?r.range.end():(0,g.Jmy)(this.state.getTextStream(),r.range.begin(),[g.IfD.TableStart],-1);n<0||this.state.setRangeTo(new g.ICE(n))}},t.prototype.isCursorInCellEnd=function(){if(!this.isCursor)return!1;var t=this.getSelectionCell(this.selectedRange.begin());return!!t&&t.contentRange.end()-1===this.selectedRange.begin()},t.prototype.nextValidCell=function(t){return this.validCell(t,(function(t){return t.range.end()+1}))},t.prototype.prevValidCell=function(t){return this.validCell(t,(function(t){return t.range.begin()-2}))},t.prototype.validCell=function(t,e){var r=this.tableStream,n=r.getCellInfo(t,this.nestingLevel);if(!n)return!1;for(var i=n;i;)if((null==(i=r.getCellInfo(e(i),this.nestingLevel))?void 0:i.property)&&i.property.vMerge!==g.m7Q.continue)return i;return null},t.prototype.decrease=function(t){return Math.max(t-1,0)},t.prototype.attemptToTable=function(t,e){var r=this.tableStream.getTableInfo(t);if(!r)return!1;var n=e(r);return!!n&&(this.state.setRangeTo(n),!0)},t.prototype.getFirstCellOfSelection=function(){if(this.tableSelectArea)return this.tableStream.getNearestNextCell(this.tableSelectArea.begin,this.nestingLevel)},t.prototype.getSelectionCell=function(t){return this.tableSelectArea?this.tableStream.getCellInfo(t,this.tableSelectArea.nestingLevel):null},t}(),Xr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.isTableWrapText=function(){return this.table.getProperty().isWrapText},e.prototype.setVerticalAnchorPageType=function(t){var e=this.table.getProperty().clone();e.tblPr.tblpPr.vertAnchor=g.B6J.page,e.tblPr.tblpPr.tblpY=t.y,e.tblPr.tblpPr.tblpXSpec===g.xxK.undefined&&(e.tblPr.tblpPr.horzAnchor=g.Er3.page,e.tblPr.tblpPr.tblpX=t.x),this.table.setProperty(e),this.setCommandType(u.wI.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.setVerticalAnchorTextType=function(){var t=this.table.getProperty().clone();t.tblPr.tblpPr.vertAnchor=g.B6J.text,t.tblPr.tblpPr.tblpY=g.keb.tableTextWrap.tblpY,t.tblPr.tblpPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPPr).tKeys.tblpYSpec);var e=t.tblPr.jc;e!==g.y83.undefined&&(t.tblPr.tblpPr.tblpXSpec=Gr[e]),this.table.setProperty(t),this.setCommandType(u.wI.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.getVerticalAnchorType=function(){return this.table.getProperty().tblPr.tblpPr.vertAnchor},e.prototype.setInlineWrapType=function(){var t=this.table.getProperty().clone();t.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.tblpPr),this.table.setProperty(t),this.setCommandType(u.wI.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.setSquareWrapType=function(){var t=this.table.getProperty().clone(),e=new(g.kkf.getPropertyClass(g.uSS.CTTblPPr));e.vertAnchor=g.B6J.text,e.horzAnchor=g.Er3.text,e.leftFromText=g.keb.tableTextWrap.leftFromText,e.rightFromText=g.keb.tableTextWrap.rightFromText,t.tblPr.tblpPr=e,t.tblPr.jc!==g.y83.undefined?e.tblpXSpec=Gr[t.tblPr.jc]:(e.tblpXSpec=g.xxK.left,t.tblPr.jc=g.y83.left),this.table.setProperty(t),this.setCommandType(u.wI.DocModifyTable),this.recoverSelectionAndApplyDelta()},e.prototype.recoverSelectionAndApplyDelta=function(){var t=this.state.selection.gcpRange,e=this.createUpdateDelta();e.moveTo(t),this.applyTableUpdate(e)},e}(Dr),Qr=function(t){function e(e,r){var n=t.call(this,e,r)||this;return n.tableSelectArea=n._state.selection.tableSelectionArea,n.table=n.createSelectedTable(),n.table&&(n.columnService=new Vr(n.table,r,n._state),n.formatService=new Ur(n.table,r,n._state),n.rowService=new zr(n.table,r,n._state),n.splitService=Fr.create(n.table,r,n._state),n.borderService=new Hr(n.table,r,n._state),n.tableAlignService=new jr(n.table,r,n._state),n.tableWrapTextService=new Xr(n.table,r,n._state)),n.controlSelectService=new qr(n._state),n}return(0,o.__extends)(e,t),e.create=function(t,r){return new e(t,r)},Object.defineProperty(e.prototype,"insertColCount",{get:function(){var t,e;return(null===(e=null===(t=this.tableSelectArea)||void 0===t?void 0:t.cellRanges[0])||void 0===e?void 0:e.colCount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"insertRowCount",{get:function(){var t,e;return(null===(e=null===(t=this.tableSelectArea)||void 0===t?void 0:t.cellRanges[0])||void 0===e?void 0:e.rowCount)||0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mergeService",{get:function(){return this.table?(this.cacheMergeService||(this.cacheMergeService=Lr.create(this.table,this._deltaOpt,this._state)),this.cacheMergeService):null},enumerable:!1,configurable:!0}),e.prototype.insertTable=function(t,e){new Kr(this._state,this._deltaOpt).insert(t,e)},e.prototype.insertColsLeft=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.columnService)||void 0===e||e.insertColsLeft(this.tableSelectArea.selectedRange,t))},e.prototype.insertColsRight=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.columnService)||void 0===e||e.insertColsRight(this.tableSelectArea.selectedRange,t))},e.prototype.removeCols=function(){var t;this.isLocatedInSingleTable()&&(null===(t=this.columnService)||void 0===t||t.removeCols(this.tableSelectArea.selectedRange))},e.prototype.setBackgroundColor=function(t){var e;null===(e=this.formatService)||void 0===e||e.setBackgroundColor(t)},e.prototype.setVerticalAlign=function(t){var e;null===(e=this.formatService)||void 0===e||e.setVerticalAlign(t)},e.prototype.getVerticalAlign=function(){var t;return(null===(t=this.formatService)||void 0===t?void 0:t.getVerticalAlign())||g.lZc.center},e.prototype.insertRowsAbove=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.rowService)||void 0===e||e.insertRowsAbove(this.tableSelectArea.selectedRange,t))},e.prototype.insertRowsBelow=function(t){var e;this.isLocatedInSingleTable()&&(null===(e=this.rowService)||void 0===e||e.insertRowsBelow(this.tableSelectArea.selectedRange,t))},e.prototype.removeRows=function(){var t;this.isLocatedInSingleTable()&&(null===(t=this.rowService)||void 0===t||t.removeRows(this.tableSelectArea.selectedRange))},e.prototype.canMerge=function(){var t;return(null===(t=this.mergeService)||void 0===t?void 0:t.isAllowMerge())||!1},e.prototype.merge=function(){var t;null===(t=this.mergeService)||void 0===t||t.merge()},e.prototype.canSplit=function(){return!!this.splitService},e.prototype.split=function(t,e){var r;null===(r=this.splitService)||void 0===r||r.split(t,e)},e.prototype.clearContent=function(){var t;null===(t=this.formatService)||void 0===t||t.clearContent()},e.prototype.getBorderType=function(t){var e;return(null===(e=this.borderService)||void 0===e?void 0:e.getBorderType(t))||g.b0e.None},e.prototype.setBorder=function(t,e){var r;null===(r=this.borderService)||void 0===r||r.setBorder(t,e)},e.prototype.setTableHorizonAlignment=function(t){var e;null===(e=this.tableAlignService)||void 0===e||e.setTableHorizonAlignment(t)},e.prototype.getTableHorizonAlignment=function(){return this.tableAlignService?this.tableAlignService.getTableHorizonAlignment():g.y83.undefined},e.prototype.getCellProperty=function(t){var e;return(null===(e=this.formatService)||void 0===e?void 0:e.getCellProperty(t))||null},e.prototype.setTableVerticalAnchorTextType=function(){this.tableWrapTextService.setVerticalAnchorTextType()},e.prototype.isTableWrapText=function(){return this.tableWrapTextService.isTableWrapText()},e.prototype.setTableVerticalAnchorPageType=function(t){this.tableWrapTextService.setVerticalAnchorPageType(t)},e.prototype.getTableVerticalAnchorType=function(){return this.tableWrapTextService.getVerticalAnchorType()},e.prototype.setTableInlineWrapType=function(){this.tableWrapTextService.setInlineWrapType()},e.prototype.setTableSquareWrapType=function(){this.tableWrapTextService.setSquareWrapType()},e.prototype.getSelectedTable=function(){return this.table},e.prototype.getCellsCountOfFirstSelectedRow=function(){var t;return(null===(t=this.rowService)||void 0===t?void 0:t.getCellsCountOfFirstSelectedRow())||0},e.prototype.getTableInfo=function(){if(this._deltaOpt&&this.tableSelectArea){var t=this._state.getTableStream().getTableInfo(this._deltaOpt.originRange.begin(),this.tableSelectArea.nestingLevel);if(t)return t}return null},e.prototype.getTableCellInfo=function(t){return this.tableSelectArea?this._state.getTableStream().getCellInfo(t.begin(),this.tableSelectArea.nestingLevel):null},e.prototype.removeTable=function(){if(this._state&&this._deltaOpt){var t=this._deltaOpt.buildDelta();this.table&&(this.table.deleteTable(),this.table.getTableActionManager().consumeActionsToDelta(t),t.setCommandType(u.wI.DocDeleteTable),this._state.applyDelta(t))}},e.prototype.getVMergeCount=function(){var t;return(null===(t=this.splitService)||void 0===t?void 0:t.getVMergeCount())||0},e.prototype.isInFirstCell=function(){return this.controlSelectService.isInFirstCell()},e.prototype.isInLastCell=function(){return this.controlSelectService.isInLastCell()},e.prototype.selectFirstCellContent=function(){return this.controlSelectService.selectFirstCellContent()},e.prototype.toNextCell=function(){return this.controlSelectService.toNextCell()},e.prototype.toPrevCell=function(){return this.controlSelectService.toPrevCell()},e.prototype.getPrevCellRange=function(){return this.controlSelectService.getPrevCellRange()},e.prototype.getNextCellRange=function(){return this.controlSelectService.getNextCellRange()},e.prototype.selectCurrentTable=function(){return this.controlSelectService.selectCurrentTable()},e.prototype.attemptBackwardToTable=function(){return this.controlSelectService.attemptBackwardToTable()},e.prototype.attemptForwardToTable=function(){return this.controlSelectService.attemptForwardToTable()},e.prototype.attemptSelectTableBeforeCursor=function(){return this.controlSelectService.attemptSelectTableBeforeCursor()},e.prototype.isCursorInCellBegin=function(){return this.controlSelectService.isCursorInCellBegin()},e.prototype.clearFirstCellContent=function(){var t;return null===(t=this.formatService)||void 0===t?void 0:t.clearFirstCellContent()},e.prototype.attemptMoveCursorPrev=function(){return this.controlSelectService.attemptMoveCursorPrev()},e.prototype.attemptMoveCursorNext=function(){return this.controlSelectService.attemptMoveCursorNext()},e.prototype.setTableStyleTheme=function(t){var e;return null===(e=this.formatService)||void 0===e?void 0:e.setTableStyleTheme(t)},e.prototype.isLocatedInSingleTable=function(){return this.tableSelectArea&&!this.tableSelectArea.isCrossTable()},e.prototype.createSelectedTable=function(){if(!this.tableSelectArea)return null;var t=null;return this.tableSelectArea.isInnerCell()&&(t=this.tableSelectArea.selectedRange.begin()),this.tableSelectArea.isInnerTable()&&(t=this.tableSelectArea.cellRanges[0].begin),null===t?null:xr.createTable(this._state,t,this.tableSelectArea.nestingLevel)},e}(Qe),Yr=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.originFieldInfo=n,i}return(0,o.__extends)(e,t),e.createStateField=function(t,r,n){return new e(t,r,n)},e.prototype.getFieldInfo=function(){return this.originFieldInfo},e.prototype.getCode=function(){if(this._state){var t=this.originFieldInfo.fieldCode.range;return this._state.getTextStream().readText(t.begin(),t.length())}return""},e.prototype.getResult=function(){var t,e=(null!==(t=this.originFieldInfo.fieldResult)&&void 0!==t?t:{}).range;return this._state&&e?this._state.getTextStream().readText(e.begin(),e.length()):""},e.prototype.getType=function(){var t=this.getCode().trim();if(t.length>0){var e=t.split(" ");if(e.length>0){var r=e[0];for(var n in c.X5)if(Object.prototype.hasOwnProperty.call(c.X5,n)&&r===c.X5[n])return c.X5[n]}}return c.X5.fieldEmpty},e.prototype.getNext=function(){var t;if(this._state&&this._deltaOpt){var r=this._state.getFieldStream();if(r){var n=r.createFieldIterator({limitRange:this._deltaOpt.originRange}),i=this.getRange();if(n.seek(i.begin()),n.hasNext()){n.next();var o=r.getDecodedFieldInfo(n.getRange().begin(),null===(t=this.originFieldInfo)||void 0===t?void 0:t.nestingLevel);if(o){var a=u.C1.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,a,o)}}}}},e.prototype.getPrev=function(){var t;if(this._state&&this._deltaOpt){var r=this._state.getFieldStream();if(r){var n=r.createFieldIterator({limitRange:this._deltaOpt.originRange}),i=this.getRange();if(n.seek(i.begin()),n.hasPrev()){n.prev();var o=r.getDecodedFieldInfo(n.getRange().begin(),null===(t=this.originFieldInfo)||void 0===t?void 0:t.nestingLevel);if(o){var a=u.C1.createLocalDeltaOption(n.getRange(),this._deltaOpt.updateSelection);return e.createStateField(this._state,a,o)}}}}},e}(Qe),Jr=function(t){function e(e,r,n){void 0===n&&(n=1);var i=t.call(this,e,r)||this;return i.nestingLevel=n,i}return(0,o.__extends)(e,t),e.createStateFields=function(t,r,n){return new e(t,r,n)},e.prototype.add=function(t,e,r,n){var i=e!==c.X5.fieldEmpty?" ".concat(e," "):" ";i+=r,n&&(i+=" ".concat("\\* MERGEFORMAT")),i+=" ",t.insertField(i,"xxx")},e.prototype.createIterator=function(){var t,e,r,n;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:if(!this._state||!this._deltaOpt)return[3,4];if(!(t=this._state.getFieldStream()))return[3,4];e=t.createFieldIterator({limitRange:this._deltaOpt.originRange}),i.label=1;case 1:return e.hasNext()?(r=t.getDecodedFieldInfo(e.getRange().begin(),this.nestingLevel),e.next(),r?((n=this._deltaOpt.copy()).originRange=r.fieldRange.clone(),[4,Yr.createStateField(this._state,n,r)]):[3,3]):[3,4];case 2:i.sent(),i.label=3;case 3:return[3,1];case 4:return[2]}}))},e}($e),Zr=r(63184);function $r(t,e,r,n,i){var o;void 0===i&&(i=!1);var a=null!=n?n:new(g.kkf.getPropertyClass(g.uSS.RunProperty));if((null===(o=g.BqD.decodeFieldCode(r))||void 0===o?void 0:o.name)===g.Lpg.HYPERLINK){var s=pe.generateStyleProperty(e,t,"Hyperlink");(null==s?void 0:s.type)===g.TAq.character&&((i||s.rPr.color.val===a.color.val)&&a.setDefault(a.tKeys.color),a.setDefault(a.tKeys.u),a.rStyle=s.styleId)}return a}var tn=function(){function t(t,e,r,n){this._state=t,this._updateSelection=r,this._coreRange=new l.wA(this._state.dataEngine,e,this._updateSelection,n),this._beforeDeleteApplyHooks=[Ie]}return t.createStateRange=function(e,r,n,i){return void 0===n&&(n=!1),void 0===i&&(i=!0),new t(e,r,n,i)},t.prototype.getFont=function(){return Ze.createStateFont(this._state,this._deltaOption())},t.prototype.setFont=function(t){this.getFont().setFont(t)},t.prototype.filterRangeByTable=function(t){var e;if(null===(e=this.getTableSelectionArea())||void 0===e?void 0:e.isInnerTable()){var r=[];return t.splitValidRange(this._state.getTableStream(),(function(t){r.push(t)})),(0,o.__spreadArray)([],(0,o.__read)(this.getSpans()),!1).filter((function(t){return r.find((function(e){return e.contains(t.getRange())}))}))}return(0,o.__spreadArray)([],(0,o.__read)(this.getSpans()),!1)},t.prototype.modifyFontSizeRelatively=function(t){var e=this,r=function(e){return(0,i.ptToTwips)(Math.max((0,i.twipsToPt)(e)+t,1))};if(0!==this.range().length()){var n=this._deltaOption().buildDelta().setUpdateSelection(!1);n.setCommandType(u.wI.DocModifyText);var o=!1;this.filterRangeByTable(n).forEach((function(t){var i=t.getFont().getFontSize(),a=r(i);o=o||i!==a;var s=t.getAttributes().clone();s.sz=a,u.Gh.setRunProperty(t.getRange().intersectRange(e.range()),s,n,g.XS7.Merge)})),o&&this._state.applyDelta(n)}else{var a=r(this.getFont().getFontSize());this.getFont().setFontSize(a)}},t.prototype.getSpans=function(){return er.createStateSpans(this._state,this._deltaOption())},t.prototype.getParagraphFormat=function(){return nr.createStateParagraphFormat(this._state,this._deltaOption())},t.prototype.setParagraphFormat=function(t,e){this.getParagraphFormat().setFormat(t,e)},t.prototype.getParagraphs=function(){return or.createStateParagraphs(this._state,this._deltaOption())},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return ar.createStateSectionFormat(this._state,this._deltaOption())},t.prototype.getSections=function(){return lr.createStateSections(this._state,this._deltaOption())},t.prototype.getInlineShapes=function(){return hr.createStateInlineShapes(this._state,this._deltaOption())},t.prototype.getInlinePlugins=function(){return Cr.createStateInlinePlugins(this._state,this._deltaOption())},t.prototype.getTextframes=function(){return vr.create(this._state,this._deltaOption())},t.prototype.getCodeblocks=function(){return Sr.create(this._state,this._deltaOption())},t.prototype.getShapes=function(){return gr.create(this._state,this._deltaOption())},t.prototype.getTableSelectionArea=function(){return this._coreRange.tableSelectionArea},t.prototype.getTableSelectionService=function(){return Qr.create(this._state,this._deltaOption())},t.prototype.getFields=function(){return Jr.createStateFields(this._state,this._deltaOption())},t.prototype.range=function(){return this._coreRange.gcpRange},t.prototype.setRange=function(t,e,r){var n=this._coreRange.setRangeTo(new g.ICE(t,e-t),r);return n&&this._updateSelection&&this._state.setRangeTo(this._coreRange.gcpRange,r),n},t.prototype.getStart=function(){return this._coreRange.gcpRange.begin()},t.prototype.setStart=function(t){return this.setRange(t,this._coreRange.gcpRange.end())},t.prototype.getEnd=function(){return this._coreRange.gcpRange.end()},t.prototype.setEnd=function(t){return this.setRange(this._coreRange.gcpRange.begin(),t)},t.prototype.select=function(){this._state.setRangeTo(this._coreRange.gcpRange)},t.prototype.wholeStory=function(){this._state.setRangeTo(this._coreRange.storyValidRange(),{scrollToView:u.hF.None,mobileContextMenu:u.A6.Show})},t.prototype.storyRange=function(){return this._coreRange.storyValidRange()},t.prototype.storyLength=function(){return this._coreRange.storyValidRange().length()},t.prototype.storyType=function(){return this._coreRange.subStoryInfo.storyProp.storyType},t.prototype.storyId=function(){return this._coreRange.subStoryInfo.subStoryProp.id},t.prototype.storyProperty=function(){return this._coreRange.subStoryInfo.subStoryProp},t.prototype.textBoxHostStoryType=function(){return this._coreRange.textboxHostStoryInfo.storyProp.storyType},t.prototype.textBoxHostStoryId=function(){return this._coreRange.textboxHostStoryInfo.subStoryProp.id},t.prototype.textBoxHostStoryProperty=function(){return this._coreRange.textboxHostStoryInfo.subStoryProp},t.prototype.collapse=function(t){void 0===t&&(t=c.k8.CollapseStart);var e=this._coreRange.gcpRange;switch(t){case c.k8.CollapseStart:e.len=0;break;case c.k8.CollapseEnd:e.gcpBegin+=e.length(),e.len=0}this.setRange(e.begin(),e.end())},t.prototype.inRange=function(t){return t.range().contains(this.range())},t.prototype.isEqual=function(e){return e instanceof t&&this===e||e.range().equal(this.range())},t.prototype.getText=function(){return this._state.getTextStream().readText(this.range().begin(),this.range().length())},t.prototype.getPlainText=function(){var t="";if(0===this.range().length())return t;var e=this._state.getTextStream().createRunIterator(this.range());do{var r=e.getRange(!0);t+=(0,g.GDL)(this._state.getTextStream().readText(r.begin(),r.length()))}while(e.next());return t},t.prototype.getTextAndImage=function(){var t=[];if(0===this.range().length())return t;var e=this._state.getTextStream().createRunIterator(this.range());do{var r=e.getRange(!0),n=e.getProperty();if(n)if(n.isPlaceholder){if(n.isPlaceholder){var i=g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),r.begin());i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&t.push({type:"image",value:pe.getImageInfo(i)})}}else{var o=this._state.getTextStream().readText(r.begin(),r.length());t.push({type:"text",value:o})}}while(e.next());return t},t.prototype.setText=function(t){var e=this._deltaOption().buildDelta();e.setCommandType(u.wI.DocInsertText);var r=this._validTypeRange(),n=this._state.getTextStream().createParagraphIterator(r).getRange();(r.equal(n)||r.end()===n.end()&&1===r.length())&&(r.len-=1),this.deleteWithDelta(r,e);var i=this._state.followSpanProp(r.begin());u.Gh.insertText(r.begin(),t,i,e),this._state.applyDelta(e)},t.prototype.insertAfter=function(t){var e=this._coreRange.gcpRange.end();e=this._coreRange.fixToValidRange(new g.ICE(e,0)).end();var r=this._deltaOption().buildDelta();r.setCommandType(u.wI.DocInsertText);var n=this._state.followSpanProp(e);u.Gh.insertText(e,t,n,r),this._state.applyDelta(r)},t.prototype.insertBefore=function(t){var e=this._deltaOption().buildDelta();e.setCommandType(u.wI.DocInsertText);var r=e.currentRange().begin(),n=this._state.followSpanProp(r);u.Gh.insertText(r,t,n,e),this._state.applyDelta(e)},t.prototype.insertParagraph=function(t){var e=this._validTypeRange(t),r=e.begin(),n=e.end();this.doInsertParagraph(r,n,e)},t.prototype.insertParagraphAndTextAfterRange=function(t,e,r){var n=this._deltaOption().buildDelta();n.setCommandType(u.wI.DocInsertParagraph);var i=this._state.getTextStream().createParagraphIterator(),o=this._state.getTextStream().createRunIterator();i.seek(t.begin());var a=i.getRange().end()-1;o.seek(a);var s=o.getCloneProperty();s?s.setDefault(g.kkf.getPropertyClass(g.uSS.RunProperty).tKeys.isPlaceholder):s=new(g.kkf.getPropertyClass(g.uSS.RunProperty));for(var l=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),c=0;c<e;c++)this.insertParagraphWithTargetProperty(a,a,n,l,s);if(!r){var p=new g.ICE(t.end()-1+e,0);return n.moveTo(p),void this._state.applyDelta(n)}var h=new g.ICE(t.end()-1,e);u.Gh.insertText(h.end(),r,s,n),this._state.applyDelta(n)},t.prototype.insertParagraphWithTargetProperty=function(t,e,r,n,i){var o=this._state.currentParaProp(t),a=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(o);if(u.Gh.insertParagraph(t,i,a,r),this._coreRange.isParaEnd(e)){var s={range:new g.ICE(t+1,1),property:n,mode:g.XS7.Cover};u.Gh.setParagraphProperty(s,r),r.moveTo(new g.ICE(t+1,0)),r.globalOpts.updateSelection&&(this._state.cusorSpanProp=i)}},t.prototype.insertParagraphAfter=function(t){var e,r=null!==(e=null==t?void 0:t.end())&&void 0!==e?e:this._coreRange.gcpRange.end();this.doInsertParagraph(r,r,g.ICE.emptyRange())},t.prototype.insertParagraphBefore=function(t){var e,r=null!==(e=null==t?void 0:t.begin())&&void 0!==e?e:this._coreRange.gcpRange.begin();this.doInsertParagraph(r,r,g.ICE.emptyRange())},t.prototype.doInsertParagraph=function(t,e,r,n,i,o){var a=n||this._deltaOption().buildDelta();a.setCommandType(u.wI.DocInsertParagraph),r&&this.deleteWithDelta(r,a);var s,l=this._state.currentParaProp(t);if(l.has(l.tKeys.numPr)&&l.numPr.numId){var c=this._state.getTextStream().createParagraphIterator();c.seek(t);var p=c.getRange(),h=this._state.getTextStream().createRunIterator();h.seek(p.end()-1),s=new(g.kkf.getPropertyClass(g.uSS.RunProperty))(h.getCloneProperty()||new(g.kkf.getPropertyClass(g.uSS.RunProperty)))}else s=o?new(g.kkf.getPropertyClass(g.uSS.RunProperty))(this._state.followSpanProp(e)):new(g.kkf.getPropertyClass(g.uSS.RunProperty))(this._state.followSpanProp(t));var d=this._state.followParaProp(e),f=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(l),y=this._state.dataEngine.getDataManager().getStyleSheetManager();!function(t,e){var r=g.kkf.getPropertyClass(g.uSS.CTPBdr);t.forEach((function(t){t.pBdr.setDefault(r.tKeys.bottom),t.pBdr.setDefault(r.tKeys.top);var n=e.mergeStyleParagraphProperty(t);n.pBdr.has(r.tKeys.bottom)&&(t.pBdr.bottom.val=g.EJ9.none),n.pBdr.has(r.tKeys.top)&&(t.pBdr.top.val=g.EJ9.none)}))}([f],y),i&&f.merge(i),u.Gh.insertParagraph(t,s,f,a);var v=!1;if(this._coreRange.isParaEnd(e)){var m=d.paraProp;this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParaPropWithGcp(l,t).outlineLvl<g.ilm.LevelNone&&m.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.numPr);var S={range:new g.ICE(t+1,1),property:m,mode:g.XS7.Merge};u.Gh.setParagraphProperty(S,a);var b=l.pStyle,C=y.getStylePropertyFromId(b);d.paraBreakSpan.merge(pe.createClearRunProperty()),(null==C?void 0:C.next)&&u.Gh.setRunProperty(new g.ICE(t+1,1),pe.createClearRunProperty(),a,g.XS7.Merge),a.moveTo(new g.ICE(t+1,0)),v=!0}else if(l.taskPr.taskState===g.RWe.done){var P=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(l);P.taskPr.taskState=g.RWe.todo,S={range:new g.ICE(t+1,1),property:P,mode:g.XS7.Merge},u.Gh.setParagraphProperty(S,a)}n||this._state.applyDelta(a),v&&a.globalOpts.updateSelection&&(this._state.cusorSpanProp=d.paraBreakSpan)},t.prototype.breakTypeToSectType=function(t){var e=g.SN$.nextPage;switch(t){case c.EQ.SectionBreakNextPage:e=g.SN$.nextPage;break;case c.EQ.SectionBreakContinuous:e=g.SN$.continuous;break;case c.EQ.SectionBreakEvenPage:e=g.SN$.evenPage;break;case c.EQ.SectionBreakOddPage:e=g.SN$.oddPage}return e},t.prototype.insertBreak=function(t){var e;switch(t){case c.EQ.PageBreak:(i=this._deltaOption().buildDelta()).setCommandType(u.wI.DocInsertPage);var r=this._validDeleteRange();this.deleteWithDelta(r,i);var n=this._state.followParaProp(r.begin());u.Gh.insertParagraph(r.begin(),n.paraBreakSpan,n.paraProp,i),u.Gh.insertText(i.currentRange().end(),g.IfD.PageBreak,new(g.kkf.getPropertyClass(g.uSS.RunProperty))(n.paraBreakSpan),i),u.Gh.insertParagraph(i.currentRange().end(),n.paraBreakSpan,n.paraProp,i),this._state.applyDelta(i);break;case c.EQ.SectionBreakNextPage:case c.EQ.SectionBreakContinuous:case c.EQ.SectionBreakEvenPage:case c.EQ.SectionBreakOddPage:var i,o=this.getSections().item(0);if(!o)break;(i=this._deltaOption().buildDelta()).setCommandType(u.wI.DocInsertSection),r=this._validDeleteRange();var a=g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),s=(n=this._state.followParaProp(r.begin()),null!==(e=o.getAttributes())&&void 0!==e?e:new(g.kkf.getPropertyClass(g.uSS.SectionProperty))),l=this.breakTypeToSectType(t);l!==(s.type===g.SN$.undefined?g.SN$.nextPage:s.type)&&o.setSectType(l,i);var p=new(g.kkf.getPropertyClass(g.uSS.SectionProperty));p.setNull(p.tKeys.headerReference),p.setNull(p.tKeys.footerReference),u.Gh.setSectionProperty(r,p,i,g.XS7.Merge),u.Gh.insertSection(r.begin(),a,n.paraProp,s,i),this._state.applyDelta(i)}},t.prototype.insertImage=function(t,e,r,n){this.getInlineShapes().addImage(t,e,r,n)},t.prototype.replaceImage=function(t,e){this.getInlineShapes().replaceImage(t,e)},t.prototype.movePlugin=function(t,e){this.getInlinePlugins().movePlugin(t,e)},t.prototype.insertSplitline=function(t,e,r,n){var i=n||this._deltaOption().buildDelta();i.setCommandType(u.wI.DocInsertParagraph);var o=new(g.kkf.getPropertyClass(g.uSS.CTBorderWml));o.val=t,o.color=e,o.color=pe.adjustColor(o.color),o.sz=8*r;var a=this._coreRange.gcpRange.begin(),s=this._state.getTextStream().createParagraphIterator();s.seek(a);var l=s.getCloneProperty();if(l){s.prev();var c,p=s.getCloneProperty();this._coreRange.isParaEnd(a)?this._coreRange.isStoryEnd(a)?((c=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))).pBdr.bottom=o,p&&p.pBdr.bottom.equalTo(o)&&(c.pBdr.top.color=o.color,this.setBottomSplitline(i,a)),this.doInsertParagraph(a,a,g.ICE.emptyRange(),i,c)):g.vCY.isValidBorder(l.pBdr.bottom)&&l.pBdr.bottom.equalTo(o)||this.setBottomSplitline(i,a,o):((c=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))).pBdr.bottom=o,p&&p.pBdr.bottom.equalTo(o)&&(c.pBdr.top.color=o.color,this.setBottomSplitline(i,a)),c.pBdr.bottom=o,this.doInsertParagraph(a,a,g.ICE.emptyRange(),i,c)),i.moveTo(new g.ICE(a+1)),n||this._state.applyDelta(i)}},t.prototype.setBottomSplitline=function(t,e,r){var n=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));r?n.pBdr.bottom=r:n.pBdr.setNull(g.kkf.getPropertyClass(g.uSS.CTPBdr).tKeys.bottom);var i={range:new g.ICE(e,0),property:n,mode:g.XS7.Merge};u.Gh.setParagraphProperty(i,t)},t.prototype.getTextFromRange=function(t){return this._state.getTextStream().readText(t.gcpBegin,t.len)},t.prototype.clearFormatting=function(){var t=this._coreRange.gcpRange,e=this._state.getTextStream().createParagraphIterator(t).getRange(),r=!1,n=!1;e.contains(t)?t.length()<=0?(n=!0,this._state.cusorSpanProp=null):t.begin()===e.begin()&&t.length()>=e.length()-1?(r=!0,n=!0):r=!0:(r=!0,n=!0);var i=this._deltaOption().buildDelta();i.setCommandType(u.wI.DocClearTextStyle),r&&i.splitValidRange(this._state.getTableStream(),(function(t){u.Gh.setRunProperty(t,pe.createClearRunProperty(),i,g.XS7.Merge)})),n&&i.splitValidRange(this._state.getTableStream(),(function(t){var e={range:t,property:g.vCY.createClearParagraphProperty(),mode:g.XS7.Merge};u.Gh.setParagraphProperty(e,i)})),this._state.applyDelta(i),this._state.cusorSpanProp=null},t.prototype.formatBrush=function(t,e,r){var n=this,i=this._deltaOption().buildDelta();if(i.setCommandType(u.wI.DocModifyText),t&&i.splitValidRange(this._state.getTableStream(),(function(e){var o=function(t,e,r){var n={range:t,property:new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(e),mode:g.XS7.Cover};if(r)return n;var i=e.clone();return i.setNull(e.tKeys.numPr),i.setNull(e.tKeys.taskPr),n.property=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))(i),n}(e,t,r);u.Gh.setParagraphProperty(o,i),xe(e,n._state,i,t,r)})),e){var o=new(g.kkf.getPropertyClass(g.uSS.RunProperty))(e);i.splitValidRange(this._state.getTableStream(),(function(t){u.Gh.setRunProperty(t,o,i,g.XS7.Cover)})),this.getFieldRanges().map((function(t){var e=t.fieldResultRange,r=t.fieldCodeRange,a=n._state.getTextStream().readText(r.begin(),r.len),s=n.generateFieldResultProp(i,a,o);u.Gh.setRunProperty(e,s,i,g.XS7.Merge)}))}this._state.applyDelta(i)},t.prototype.deleteWithDelta=function(t,e){var r=this,n=this._validDeleteRange(t);if(!n.isEmpty()){var i=e||this._deltaOption().buildDelta();i.setCommandType(u.wI.DocDeleteText),this._beforeDeleteApplyHooks.forEach((function(t){return t(n,r._state,i)})),this._state.deleteText(n,i),e||this._state.applyDelta(i)}},t.prototype.delete=function(t){this.deleteWithDelta(t)},t.prototype.deleteWithMultiRanges=function(t,e){var r,n=this;if(t&&!(t.length<=0)){var i=this._deltaOption().buildDelta();i.setCommandType(u.wI.DocPaste);var o=null!=e?e:{},a=o.fixRange,s=void 0===a||a,l=o.willInsertGcp,c=void 0===l?-1:l;c&&(null===(r=this._state.getStoryStream().getMainStoryInfo())||void 0===r?void 0:r.range.end())===c+1&&u.Gh.insertParagraph(c,new(g.kkf.getPropertyClass(g.uSS.RunProperty)),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),i),t.sort((function(t,e){return e.begin()-t.begin()})),t.forEach((function(t){var e=s?n._validDeleteRange(t):t;e.isEmpty()||u.Gh.deleteText(e,i)})),this._state.applyDelta(i)}},t.prototype.setLink=function(t,e){this.insertField(t,e)},t.prototype.getStyleName=function(t){var e=c.Jj.Undefined;switch(t){case g.TAq.character:e=this.getFont().getStyleName();break;case g.TAq.paragraph:e=this.getParagraphFormat().getStyleName();break;default:(e=this.getFont().getStyleName())===c.Jj.Undefined&&(e=this.getParagraphFormat().getStyleName())}return e},t.prototype.getStyleShowName=function(t){var e=c.Jj.Undefined;switch(t){case g.TAq.character:e=this.getFont().getStyleShowName();break;case g.TAq.paragraph:e=this.getParagraphFormat().getStyleShowName();break;default:(e=this.getFont().getStyleShowName())===c.Jj.Undefined&&(e=this.getParagraphFormat().getStyleShowName())}return e},t.prototype.setHeadingStyleWithMutiRange=function(t,e){var r=this;if(!this._state)throw new Error("State is undefined");var n=this._deltaOption().buildDelta(),i=pe.generateStyleProperty(n,this._state.dataEngine.getDataManager().getStyleSheetManager(),t);i&&(this.getParagraphFormat().setHeadingWithMultiRanges(i,e,n),e.forEach((function(t){var e=r.getParaRange(t.begin()).begin(),i=r.getParaRange(t.end()-1).end(),o=new g.ICE(e,i-e);n.moveTo(o),n.splitValidRange(r._state.getTableStream(),(function(t){u.Gh.setRunProperty(t,pe.createClearRunProperty(),n,g.XS7.Merge)})),n.moveTo(o)})),this._state.applyDelta(n))},t.prototype.getParaRange=function(t){return this._state.getTextStream().createParagraphIterator(new g.ICE(t,0)).getRange()},t.prototype.setStyle=function(t,e,r){if(!this._state)throw new Error("State is undefined");var n=e||this._deltaOption().buildDelta();n.globalOpts.updateSelection=!1;var i=pe.generateStyleProperty(n,this._state.dataEngine.getDataManager().getStyleSheetManager(),t);Array.isArray(r)&&i?(null==i?void 0:i.type)===g.TAq.paragraph?(this.getParagraphFormat().setStyle(i,n,r),_e(this._state,i,n,r)):i&&(null==i?void 0:i.type)===g.TAq.character&&this.getFont().setStyle(i,n,r):(null==i?void 0:i.type)===g.TAq.paragraph?(this.getParagraphFormat().setStyle(i,n),_e(this._state,i,n)):i&&(null==i?void 0:i.type)===g.TAq.character&&this.getFont().setStyle(i,n),e||this._state.applyDelta(n)},t.prototype.getLastParaStartPos=function(){var t=this._state.getStoryStream().getMainStoryInfo();if(null===t)return 1;var e=t.contentRange.end()-2;return this.getParaRange(e).gcpBegin},t.prototype.countWord=function(){var t=0,e=0,r=0,n=0,i=this._state.getTextStream(),o=i.createParagraphIterator(this._coreRange.gcpRange),a=this.getLastParaStartPos();do{var s=o.getRange(!0),l=s.gcpBegin,c=s.len,p=i.readText(l,c),h=l===a,d=l===o.getRange().begin();if(p.replace(/(\r|\n)/g,"").length||!h&&d){var f=p,y=0;if(d){var v=this._state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(new g.ICE(l));(null==v?void 0:v.actualText)&&(f="".concat(v.actualText," ").concat(f))}f=(0,u.S3)(f),f=(0,u._j)(f);var m=(0,u.Td)({dataEngine:this._state.dataEngine,textStream:this._state.getTextStream(),text:f,startGcp:l});f=m.text,y+=m.addSpaceLength,f=(0,u.ol)(f);var S=(0,u.Gb)(f);t+=S.wordCount,n+=S.wordCountNoPunctuation,e+=S.charactersNumber,r+=S.charactersNumberNoSpaces,e-=y}}while(o.next());return{wordCount:t,wordCountNoPunctuation:n,charactersNumber:e,charactersNumberNoSpaces:r}},t.prototype.getFieldInfo=function(t){return this._state?this._state.getFieldStream().getFieldInfo(t):null},t.prototype.getDecodedFieldInfo=function(t,e){return this._state?this._state.getFieldStream().getDecodedFieldInfo(t,e):null},t.prototype.getDecodedFieldInfos=function(t){if(!this._state)return[];var e=this._coreRange.gcpRange;return this._state.getFieldStream().getDecodedFieldInfos(e,t)},t.prototype.getFieldRanges=function(){var t=this._coreRange.gcpRange,e=this._state.dataEngine.getDataStream().getFieldStream();if(0===t.len){var r=e.getFieldRange(t.begin());return r?[r]:[]}return e.getFieldRanges(t)},t.prototype.insertFields=function(t){var e=this,r=this._deltaOption().buildDelta();r.globalOpts.updateSelection=!0,r.setCommandType(u.wI.DocInsertField);var n=this.validDeleteFieldRange();this.deleteWithDelta(n,r);var i=this._state.followSpanProp(n.begin()),o=this._state.followParaProp(n.begin()),a=o.paraBreakSpan,s=o.paraProp;r.moveTo(new g.ICE(n.begin(),0)),t.forEach((function(t){var n,o=null!==(n=t.options)&&void 0!==n?n:{},l=o.wrapBefore,c=o.wrapAfter;l&&u.Gh.insertParagraph(r.currentRange().end(),a,s,r);var p=t.fieldCode,g=t.fieldResult,h=e.generateFieldResultProp(r,p,i,!0);u.Gh.insertField(p,g,i,r,h),c&&u.Gh.insertParagraph(r.currentRange().end(),a,s,r)})),this._state.applyDelta(r)},t.prototype.insertField=function(t,e,r){var n;void 0===r&&(r={});var o,a=r.nestingLevel,s=void 0===a?1:a,l=r.followProperty,c=void 0===l||l,p=r.wrapAfter,h=r.wrapBefore;o=r.outerDelta&&r.outerDelta||this._deltaOption().buildDelta();var d=null!==(n=r.undoEventId)&&void 0!==n?n:i.StringUtil.generateRandomId();o.globalOpts.undoOption.undoEventId=d,o.globalOpts.updateSelection=!0,o.setCommandType(u.wI.DocInsertField);var f=this.validDeleteRangeWithoutComment(),y=this.validDeleteFieldRange(),v=this._state.getTextStream().readText(y.begin(),y.length()),m=new(g.kkf.getPropertyClass(g.uSS.RunProperty));c&&(m=this._state.followSpanProp(y.begin())),this.deleteWithDelta(y,o),o.moveTo(new g.ICE(y.begin(),0));var S=r.keepRangeText||e===v;i.Logger.info("Field","insert field,",y,"|".concat(t,"|"),"|".concat(e,"|"),"|".concat(v,"|"),S),this.internalInsertField(o,y,{fieldCode:t,fieldResult:e,runProperty:m,nestingLevel:s,needCover:!0,originRange:f},{wrapAfter:p,wrapBefore:h,keepRangeText:S}),r.notApplyDelta||this._state.applyDelta(o)},t.prototype.insertFieldStart=function(t,e,r){var n=this;this._state.insertTextStart(r,this._deltaOption(),(function(r){n.insertField(t,e,{outerDelta:r,notApplyDelta:!0})}))},t.prototype.insertFieldFinish=function(t,e,r){var n=this;this._state.insertTextFinish(r,this._deltaOption(),(function(r){r.setCommandType(u.wI.DocInsertField),n.insertField(t,e,{notApplyDelta:!0,outerDelta:r})}))},t.prototype.insertFieldCancel=function(t){this._state.insertTextCancel(t)},t.prototype.updateField=function(t,e,r){var n;void 0===r&&(r={});var o=r.needInverse,a=void 0===o||o,s=null!==(n=r.undoEventId)&&void 0!==n?n:i.StringUtil.generateRandomId(),l=this._deltaOption();l.updateSelection=!0,l.undoOption.needInverse=a,l.undoOption.undoEventId=s;var c=l.buildDelta();c.setCommandType(u.wI.DocUpdateField);var p=this.validDeleteFieldRange();u.Gh.deleteText(p,c),c.moveTo(new g.ICE(p.begin(),0));var h=this._state.dataEngine.getDataStream().getFieldStream(),d=null==h?void 0:h.getDecodedFieldInfo(p.begin()),f=null!=d?d:{},y=f.fieldRange,v=f.fieldCode,m=f.fieldResult,S=f.nestingLevel,b=null==v?void 0:v.range,C=null==m?void 0:m.range;if(null==d?void 0:d.hasNestField)i.Logger.warn("不支持更新包含嵌套域的域",y);else{var P,T=r.wrapBefore,R=r.wrapAfter,_=r.keepRangeText||e===(null==m?void 0:m.result),I=new(g.kkf.getPropertyClass(g.uSS.RunProperty));b&&(I=this._state.currentSpanProp(b.begin())),C&&(P=this._state.currentSpanProp(C.begin())),i.Logger.info("Field","update field,",p,"|".concat(t,"|"),"|".concat(e,"|"),d,_),this.internalInsertField(c,p,{fieldCode:t,fieldResult:e,fieldResultRange:C,fieldResultProperty:P,runProperty:I,nestingLevel:S,originRange:y},{wrapAfter:R,wrapBefore:T,keepRangeText:_}),this._state.applyDelta(c)}},t.prototype.moveField=function(t,e){if(t!==e){var r=this._state.dataEngine.getDataStream().getFieldStream(),n=null==r?void 0:r.getDecodedFieldInfo(t);if(n){var i=this._deltaOption().buildDelta(),o=n.fieldRange,a=n.fieldResult,s=null==a?void 0:a.range,l=this.validDeleteFieldRange(o);u.Gh.deleteText(l,i),t<e&&(e-=l.length()),i.moveTo(new g.ICE(e,0));var c=this._state.followSpanProp(t),p=this._state.followSpanProp(s.begin()),h=g.BqD.encodeField(n);this.internalInsertField(i,new g.ICE(e,l.len),{fieldCode:h.fieldCode,fieldResult:h.fieldResult,fieldResultRange:s,fieldResultProperty:p,runProperty:c,nestingLevel:null==n?void 0:n.nestingLevel,originRange:o},{keepRangeText:!0,isMoveFiled:!0}),this._state.applyDelta(i)}}},t.prototype.internalInsertField=function(t,e,r,n){var a,s,l=this,c=n.wrapBefore,p=n.wrapAfter,h=n.keepRangeText,d=this._state.followParaProp(e.begin()),f=d.paraBreakSpan,y=d.paraProp;c&&u.Gh.insertParagraph(t.currentRange().end(),f,y,t);var v=r.fieldCode,m=r.fieldResult,S=r.fieldResultRange,b=r.fieldResultProperty,C=r.nestingLevel,P=r.runProperty,T=r.needCover,R=r.originRange,_=[],I=this._state.dataEngine.getDataManager().getStyleSheetManager(),w=this.findCommentsAfterRange(null!=R?R:e);if(h){var x=null!=S?S:e;u.Gh.insertFieldByRange(v,P,t,(function(t){_.push.apply(_,(0,o.__spreadArray)([],(0,o.__read)(u.Me.collectDataToDelta(l._state.dataEngine,t,x,!0,!0)),!1)),b||function(t,e,r,n){void 0===n&&(n=!1);for(var i=length;i<e.operations.length;i++){var o=e.operations[i];if(o instanceof u.jb){var a=$r(t,e,r,o.param.property,n);o.param.property=a}}}(I,t,v,!0)}),C),function(t,e){var r=new Map;t.operations.forEach((function(t){if(t instanceof u.I&&t.param.rangeType===g.LK6.commentRange){var e=t.param,n=e.id,o=i.StringUtil.generateRandomId();r.set(n,o),e.id=o,(a=t.param.property).id=o}else if(t instanceof u.Zw){var a;n=(a=t.param.property).id,(o=r.get(n))&&(a.id=o)}})),e.forEach((function(t){var e="c_".concat(i.StringUtil.generateRandomId());t.storyId=e,t.delta.operations.forEach((function(t){if(t instanceof u.di&&t.param.property instanceof g.kkf.getPropertyClass(g.uSS.CommentStoryProperty)){var n=t.param.property,i=n.refId,o=r.get(i);o&&(n.id=e,n.refId=o)}}))}))}(t,_)}else{var E=null!=b?b:$r(I,t,v,P,T);u.Gh.insertField(v,m,P,t,E)}if(w.length>0&&function(t,e,r,n,o){void 0===o&&(o=!1);var a=e.currentRange().end(),s=[];r.forEach((function(r){var l=t.getStoryStream().collectCommentStoryInfosFromId(r.refProp.id);if(0!==l.length){var c=i.StringUtil.generateRandomId(),p=o?n.begin():r.annotationRange.begin(),h=new(g.kkf.getPropertyClass(g.uSS.CommentReferenceProperty))(r.refProp);h.id=c;var d=new g.ICE(p,a-p),f=e.currentRange().end();u.Gh.insertCommentReference(f,d,h,e),e.moveTo(new g.ICE(f+1,0)),l.forEach((function(e){var r=e.contentRange,n=e.subStoryProp;n.refId=c,n.id="c_".concat(i.StringUtil.generateRandomId());var o=t.getTextStream().readText(r.gcpBegin,r.len-1);s.push({text:o,subStoryProp:n})}))}}));var l=e.currentRange().end()-n.end(),c=t.getStoryStream().getStoryLastPos(g.AHI.commentContent),p=c+l;c<n.end()&&(p=c),e.moveTo(new g.ICE(p,0)),s.forEach((function(t){var r=t.text,n=t.subStoryProp;u.Gh.insertCommentStory(n,e.currentRange().end(),JSON.stringify([{text:r}]),e)})),e.moveTo(new g.ICE(a,0))}(this._state,t,w,e,n.isMoveFiled),p&&u.Gh.insertParagraph(t.currentRange().end(),f,y,t),_.length>0){var D=t.globalOpts.buildDelta();!function(t,e,r,n){var i=t.context,o=t.dataEngine,a=[];n.forEach((function(t){if(t.storyType===g.AHI.commentContent){var e=[];i.run(Zr.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,o),a.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})}}));var s=t.getDataStream().getStoryStream();i.run(Zr.aU.TRANS_OPERATION_DATA_TO_DELTA,r,s,i,[],a,e,0)}(this._state,e,D,_),this._state.getStoryStream().getStoryLastPos(g.AHI.commentContent)>e.end()?(a=t.operations).unshift.apply(a,(0,o.__spreadArray)([],(0,o.__read)(D.operations),!1)):(s=t.operations).push.apply(s,(0,o.__spreadArray)([],(0,o.__read)(D.operations),!1))}},t.prototype.setGCPRange=function(t){return this._coreRange.setRangeTo(t)},t.prototype.generateFieldResultProp=function(t,e,r,n){return void 0===n&&(n=!1),$r(this._state.dataEngine.getDataManager().getStyleSheetManager(),t,e,r,n)},t.prototype._deltaOption=function(){return u.C1.createLocalDeltaOption(this._coreRange.gcpRange,this._updateSelection,void 0)},t.prototype._validDeleteRange=function(t){return this._coreRange.fixToValidDeleteRange(t||this._coreRange.gcpRange)},t.prototype.validDeleteRangeWithoutComment=function(t){var e=t||this._coreRange.gcpRange;return e=this._coreRange.fixToValidDeleteRange(e),e=this._coreRange.fixToValidDelFieldRange(e)},t.prototype.validDeleteFieldRange=function(t){var e=this.validDeleteRangeWithoutComment(t),r=this.findCommentsAfterRange(e);return r.length>0&&(e=new g.ICE(e.begin(),e.length()+r.length)),e},t.prototype.findCommentsAfterRange=function(t){return this._state.context.service.getComment().collectCommentInfosFromGcpRanges(t).filter((function(e){return e.annotationRange&&e.annotationRange.contains(t)&&t.end()===e.annotationRange.end()}))},t.prototype._validTypeRange=function(t){return this._coreRange.fixToValidReplaceRange(null!=t?t:this._coreRange.gcpRange)},t.prototype.insertLineBreak=function(){var t=this._deltaOption().buildDelta();t.globalOpts.commandType=u.wI.DocInsertText;var e=t.currentRange().begin();u.Gh.insertText(e,g.IfD.LineBreak,g.kkf.getPropertyClass(g.uSS.RunProperty).createPlaceholderRun(),t),this._state.applyDelta(t)},t}(),en=r(95303),rn=function(){function t(t){this._state=t,this._range=null}return t.createStateSelection=function(e){return new t(e)},t.prototype.getRange=function(){return this._getRange()},t.prototype.getFont=function(){return this._getRange().getFont()},t.prototype.setFont=function(t){this._getRange().setFont(t)},t.prototype.getTextStyle=function(){var t=this,e=this._gcpRange(),r=null;if(0===e.length())if(this._state.isRangeBeginAtParaStart(e)&&this._state.listMarkerSpanProp){var n=this._state.currentParaProp(e.begin());r=this._state.listMarkerSpanProp,n&&r&&(r=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(r,n,e.begin()))}else n=this._state.currentParaProp(e.begin()),r=this._state.followSpanProp(e.begin()),n&&r&&(r=this._state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(r,n,e.begin()));return r||u.Yy.splitCellRange(this._state.dataEngine.getDataStream().getTableStream(),e,(function(e){var n=t._state.getTextStream().createRunIterator(e);if(!(r=n.getCloneProperty()))return r=new(g.kkf.getPropertyClass(g.uSS.RunProperty)),!1;for(;n.next();){var i=n.getCloneProperty();i&&r.common(i)}return!0})),r||new(g.kkf.getPropertyClass(g.uSS.RunProperty))},t.prototype.getParagraphStyle=function(){var t=this,e=null;return u.Yy.splitCellRange(this._state.dataEngine.getDataStream().getTableStream(),this._gcpRange(),(function(r){var n=t._state.getTextStream().createParagraphIterator(r),i=n.getCloneProperty();if(!i)return!1;for(e?e.common(i):e=i;n.next();){var o=n.getCloneProperty();o&&(null==e||e.common(o))}return!0})),e||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty))},t.prototype.getSpans=function(){return this._getRange().getSpans()},t.prototype.getParagraphFormat=function(){return this._getRange().getParagraphFormat()},t.prototype.setParagraphFormat=function(t,e){this._getRange().setParagraphFormat(t,e)},t.prototype.getParagraphs=function(){return this._getRange().getParagraphs()},t.prototype.setHeadingStyleWithMutiRange=function(t,e){this._getRange().setHeadingStyleWithMutiRange(t,e)},t.prototype.setSectionFormat=function(t){this._getRange().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return this._getRange().getSectionFormat()},t.prototype.getSections=function(){return this._getRange().getSections()},t.prototype.getInlineShapes=function(){return this._getRange().getInlineShapes()},t.prototype.getInlinePlugins=function(){return this._getRange().getInlinePlugins()},t.prototype.getTextframes=function(){return this._getRange().getTextframes()},t.prototype.getCodeblocks=function(){return this._getRange().getCodeblocks()},t.prototype.getTableSelectionArea=function(){return this._getRange().getTableSelectionArea()},t.prototype.getTableSelectionService=function(){return this._getRange().getTableSelectionService()},t.prototype.range=function(){return this._getRange().range()},t.prototype.setRange=function(t,e,r){return this._getRange().setRange(t,e,r)},t.prototype.getStart=function(){return this._getRange().getStart()},t.prototype.setStart=function(t){return this._getRange().setStart(t)},t.prototype.getEnd=function(){return this._getRange().getEnd()},t.prototype.setEnd=function(t){return this._getRange().setEnd(t)},t.prototype.wholeStory=function(){this._getRange().wholeStory()},t.prototype.storyRange=function(){return this._getRange().storyRange()},t.prototype.storyLength=function(){return this._getRange().storyLength()},t.prototype.storyType=function(){return this._getRange().storyType()},t.prototype.storyId=function(){return this._getRange().storyId()},t.prototype.storyProperty=function(){return this._getRange().storyProperty()},t.prototype.textBoxHostStoryType=function(){return this._getRange().textBoxHostStoryType()},t.prototype.textBoxHostStoryId=function(){return this._getRange().textBoxHostStoryId()},t.prototype.textBoxHostStoryProperty=function(){return this._getRange().textBoxHostStoryProperty()},t.prototype.collapse=function(t){void 0===t&&(t=c.k8.CollapseStart),this._getRange().collapse(t)},t.prototype.inRange=function(t){return this._getRange().inRange(t)},t.prototype.isEqual=function(t){return this._getRange().isEqual(t)},t.prototype.getText=function(){return this._getRange().getText()},t.prototype.getPlainText=function(){return this._getRange().getPlainText()},t.prototype.getTextAndImage=function(){return this._getRange().getTextAndImage()},t.prototype.setText=function(t){this._getRange().setText(t)},t.prototype.insertAfter=function(t){this._getRange().insertAfter(t)},t.prototype.insertBefore=function(t){this._getRange().insertBefore(t)},t.prototype.insertParagraph=function(t){this._getRange().insertParagraph(t)},t.prototype.insertParagraphAndTextAfterRange=function(t,e,r){this._getRange().insertParagraphAndTextAfterRange(t,e,r)},t.prototype.insertParagraphAfter=function(t){this._getRange().insertParagraphAfter(t)},t.prototype.insertParagraphBefore=function(t){this._getRange().insertParagraphBefore(t)},t.prototype.insertBreak=function(t){this._getRange().insertBreak(t)},t.prototype.insertImage=function(t,e,r,n){this._getRange().insertImage(t,e,r,n)},t.prototype.replaceImage=function(t,e){this._getRange().replaceImage(t,e)},t.prototype.movePlugin=function(t,e){this._getRange().movePlugin(t,e)},t.prototype.insertSplitline=function(t,e,r){this._getRange().insertSplitline(t,e,r)},t.prototype.clearFormatting=function(){this._getRange().clearFormatting()},t.prototype.formatBrush=function(t,e,r){if(0===this.range().len){var n=(0,o.__spreadArray)([],(0,o.__read)(this._getRange().getParagraphs()),!1)[0].getRange();this.setRange(n.begin(),n.end())}this._getRange().formatBrush(t,e,r)},t.prototype.delete=function(t){void 0===t&&(t=null);var e=t||this._gcpRange();e.isEmpty()&&(e=this.getDeleteNextBreakRange(e.begin())),this._getRange().delete(e)},t.prototype.getDeleteNextBreakRange=function(t){var e=l._l.nextTextBreak(this._state.getTextStream(),t);return e=this.fixToDeleteRangeByField(t,e),e=this.nextMathPosition(e),e=this.nextSdtPosition(e),e=this.nextFootnoteOrEndnotePosition(e),e=this.nextPicturePosition(e),new g.ICE(t,e-t)},t.prototype.fixToDeleteRangeByField=function(t,e){var r,n=null!==(r=this.getFieldInfoByGcp(e))&&void 0!==r?r:{},i=n.fieldInfo,o=n.fieldRangeInfo;if(!o||!i)return e;var a=o.fieldResultRange;return i.canFocusInField&&t>a.begin()&&e===a.end()?e:this.nextFieldPosition(e)},t.prototype.deleteWithMultiRanges=function(t,e){this._getRange().deleteWithMultiRanges(t,e)},t.prototype.setLink=function(t,e){this._getRange().setLink(t,e)},t.prototype.getStyleName=function(t){return this._getRange().getStyleName(t)},t.prototype.getStyleShowName=function(t){return this._getRange().getStyleShowName(t)},t.prototype.getSentenceByGCP=function(t){if(!(t<0)){var e=this._state.getTextStream(),r=this.getShouldBreakParaRange(t),n=r&&r.realRange;return{text:n&&e.readText(n.begin(),n.length())||"",range:n||new g.ICE(t,0)}}},t.prototype.findClosedPunctuationPos=function(t,e,r,n){var i=/[!?。！？\n]/g,o=e.match(i),a=r.match(i),s=t.begin(),l=t.end();a&&a.length>0&&(s=s+r.lastIndexOf(a[a.length-1])+1),s===t.end()&&(s=a&&a.length>1?t.begin()+r.substr(0,r.length-1).lastIndexOf(a[a.length-2])+1:t.begin()),o&&o.length>0&&(l=e.indexOf(o[0])+1+n);var c=this.getFieldRange(new g.ICE(n,e.length)),p=this.getFieldRange(new g.ICE(t.begin(),r.length));return c&&l>c.begin()&&l<c.end()&&(l=c.begin()+c.length()),p&&s>p.begin()&&s<p.end()&&(s=p.begin()),this.convertRangeFilterSpecial(new g.ICE(s,l-s))},t.prototype.convertRangeFilterSpecial=function(t){var e=this.filterSpecialChar(t),r=e.text,n=e.commentRefCount;return{realRange:new g.ICE(t.begin(),r.length),reflexRange:new g.ICE(t.begin(),r.length+n)}},t.prototype.filterSpecialChar=function(t){var e=this._state.getTextStream().readText(t.begin(),t.length()),r=0,n=e.split("").filter((function(t,e){return t===g.IfD.CommentReference&&(r+=1),t&&![g.IfD.SectionBreak,g.IfD.ParagraphBreak,g.IfD.CommentReference].includes(t)})).join("");return{commentRefCount:r,filterCount:e.length-n.length,text:n}},t.prototype.filterCommentPlaceholder=function(t){if(!this._state.getTextStream().readText(t.begin(),t.length()).split("").some((function(t){return t!==g.IfD.CommentReference}))){var e=this.prevWordBreak(t.begin());return new g.ICE(e,t.end()-e)}return t},t.prototype.setStyle=function(t,e){this._getRange().setStyle(t,void 0,e)},t.prototype.typeText=function(t){var e=this._getRange();this.isSelectionAtShape()?vr.inputTextframe(this._state,t,e):e.setText(t)},t.prototype.typeParagraph=function(){this._getRange().insertParagraph()},t.prototype.typeBackspace=function(t){var e=this._gcpRange();if(e.isEmpty()){var r=this.skipAnchors(e.begin(),!0,t),n=this.skipAnchors(r,!0,t),i=this.prevTextBreak(n,{isBackspace:!0}),o=r-i;this._getRange(new g.ICE(i,o)).delete()}else this._getRange().delete()},t.prototype.skipAnchors=function(t,e,r){if(void 0===r&&(r=!0),!this.shouldSkipAnchors(t,e,r))return t;var n=this._state.getDrawingStream().createDrawingIterator();return n.seek(t+(e?-1:0)),t+this.proceedSpanIterForSkippingAnchors(n,e)},t.prototype.proceedSpanIterForSkippingAnchors=function(t,e){for(var r,n=0,i=t.getRange().begin();(e?t.hasPrev():t.hasNext())&&t.getPropertyType()===g.uSS.DrawingProperty&&(null===(r=t.getProperty())||void 0===r?void 0:r.drawingStates)!==g.Akw.Inline&&i===t.getRange().begin();)n+=e?-1:1,i+=t.getRange().len*(e?-1:1),e?t.prev():t.next();return n},t.prototype.shouldSkipAnchors=function(t,e,r){var n=this._state.getTextStream().readText(t+(e?-1:0),1);return!!r&&n===g.IfD.DrawingAnchor},t.prototype.countWord=function(){return this._getRange().countWord()},t.prototype.prevMathPosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getTextStream().readText(e,1),n=this._state.dataEngine.getDataStream().getMathStream(),i=null;return r===g.IfD.MathEnd?i=n.getMathInfo(e,1):r===g.IfD.MathObjectEnd&&(i=n.getMathObjectInfo(e,1)),i&&e>=i.range.begin()&&e<=i.range.end()&&(e=this.prevTextBreak(i.range.begin())),e},t.prototype.prevSdtPosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getSdtStream().getSdtInfo(e,1);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=this.prevTextBreak(r.range.begin())),e},t.prototype.prevFieldPosition=function(t,e){var r=this._state.dataEngine.getDataStream().getFieldStream();if(!r.getFieldRange(t))return t;var n=r.getNestingFieldInfo(t),i=r.getFieldRange(t,null==n?void 0:n.nestingLevel);(null==n?void 0:n.nestingLevel)&&(null==n?void 0:n.nestingLevel)>1&&(t=this.prevTextBreak(i.fieldRange.begin()));var o=r.getDecodedFieldInfo(t),a=o.fieldRange,s=o.fieldResult;return!o.canFocusInField||(null==e?void 0:e.skipField)?a.begin():(t===s.range.end()&&(t-=1),(null==e?void 0:e.isBackspace)||t!==s.range.begin()?t:a.begin())},t.prototype.prevFootnoteOrEndnotePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getNotesStream(),n=r.getFootnoteInfoFromGcp(e)||r.getEndnoteInfoFromGcp(e);return n&&e>=n.range.begin()&&e<=n.range.end()&&(e=this.prevTextBreak(n.range.begin())),e},t.prototype.prevPicturePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getDrawingStream().getPictureInfoFromGcp(e);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=this.prevTextBreak(r.range.begin())),e},t.prototype.prevTextBreak=function(t,e){var r=l._l.previousTextBreak(this._state.getTextStream(),t);return this.checkAndIgnorePlaceholderForward(r,e)},t.prototype.checkAndIgnorePlaceholderForward=function(t,e){return t=this.prevFieldPosition(t,e),t=this.prevMathPosition(t),t=this.prevSdtPosition(t),t=this.prevFootnoteOrEndnotePosition(t),t=this.prevPicturePosition(t)},t.prototype.nextMathPosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getTextStream().readText(e,1),n=this._state.dataEngine.getDataStream().getMathStream(),i=null;return r===g.IfD.MathStart?i=n.getMathInfo(e,1):r===g.IfD.MathObjectStart&&(i=n.getMathObjectInfo(e,1)),i&&e>=i.range.begin()&&e<=i.range.end()&&(e=i.range.end()),e},t.prototype.getFieldInfoByGcp=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream(),r=e.getFieldRange(t);if(!r)return null;var n=e.getNestingFieldInfo(t),i=e.getFieldRange(t,null==n?void 0:n.nestingLevel);(null==n?void 0:n.nestingLevel)&&(null==n?void 0:n.nestingLevel)>1&&(t=this.nextTextBreak(i.fieldRange.end()));var o=r.fieldRange;return{fieldRangeInfo:r,fieldInfo:e.getDecodedFieldInfo(o.gcpBegin)}},t.prototype.nextFieldPosition=function(t,e){var r,n=null!==(r=this.getFieldInfoByGcp(t))&&void 0!==r?r:{},i=n.fieldInfo,o=n.fieldRangeInfo;if(!o||!i)return t;var a=o.fieldRange,s=o.fieldResultRange,l=o.fieldCodeRange;if(t===a.begin())return t;if(!i.canFocusInField||(null==e?void 0:e.skipField))return a.end();if(t===l.begin()){if(!i.canFocusInField||(null==e?void 0:e.skipField))return a.end();t=s.begin()+1}return t===s.end()?a.end():t},t.prototype.nextSdtPosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getSdtStream().getSdtInfo(e,1);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=r.range.end()),e},t.prototype.nextFootnoteOrEndnotePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getNotesStream(),n=r.getFootnoteInfoFromGcp(e)||r.getEndnoteInfoFromGcp(e);return n&&e>=n.range.begin()&&e<=n.range.end()&&(e=n.range.end()),e},t.prototype.nextPicturePosition=function(t){var e=t,r=this._state.dataEngine.getDataStream().getDrawingStream().getPictureInfoFromGcp(e);return r&&e>=r.range.begin()&&e<=r.range.end()&&(e=r.range.end()),e},t.prototype.nextTextBreak=function(t,e){var r=l._l.nextTextBreak(this._state.getTextStream(),t);return this.checkAndIgnorePlaceholderBackward(r,e)},t.prototype.checkAndIgnorePlaceholderBackward=function(t,e){return t=this.nextFieldPosition(t,e),t=this.nextMathPosition(t),t=this.nextSdtPosition(t),t=this.nextFootnoteOrEndnotePosition(t),t=this.nextPicturePosition(t)},t.prototype.prevWordBreak=function(t,e){var r=this._state.getTextStream();if(t<=0||t>r.getLength()-1)return t;if(this.isSelectionCollapseAtParaStart())return t-1;var n=this.prevTextBreak(t,e);if(n-t>1)return n;var o=r.readText(t-1,1).charCodeAt(0);if(!i.StringUtil.isAlphabetOrNumber(o)&&!this.isCaretAtCommentReference(t))return n;var a=r.createParagraphIterator();a.seek(t);for(var s=a.getRange(),l=s.begin(),c=t;c>=s.begin()+1;c--){var p=r.readText(c-1,1).charCodeAt(0);if(!i.StringUtil.isAlphabetOrNumber(p)&&!this.isCaretAtCommentReference(c)){l=c;break}}return l=this.checkAndIgnorePlaceholderForward(l)},t.prototype.nextWordBreak=function(t,e){var r=this._state.getTextStream();if(t<0||t>=r.getLength()-1)return t;if(this.isSelectionCollapseAtParaEnd())return t+1;var n=this.nextTextBreak(t,e);if(n-t>1)return n;var o=r.readText(t,1).charCodeAt(0);if(!i.StringUtil.isAlphabetOrNumber(o))return n;var a=r.createParagraphIterator();a.seek(t);for(var s=a.getRange(),l=s.end()-1,c=t;c<s.end()-1;c++){var p=r.readText(c,1).charCodeAt(0);if(!i.StringUtil.isAlphabetOrNumber(p)){l=c;break}}return l=this.checkAndIgnorePlaceholderBackward(l)},t.prototype.prevSkipSpace=function(t){var e=this._state.getTextStream();if(t<=0||t>e.getLength()-1)return t;var r=e.readText(t-1,1).charCodeAt(0);if(!i.StringUtil.isSpace(r))return t;var n=e.createParagraphIterator();n.seek(t);for(var o=n.getRange(),a=o.begin(),s=t;s>o.begin()+1;s--)if(r=e.readText(s-1,1).charCodeAt(0),!i.StringUtil.isSpace(r)){a=s;break}return a},t.prototype.nextSkipSpace=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return t;var r=e.readText(t,1).charCodeAt(0);if(!i.StringUtil.isSpace(r))return t;var n=e.createParagraphIterator();n.seek(t);for(var o=n.getRange(),a=o.end()-1,s=t;s<o.end()-1;s++)if(r=e.readText(s,1).charCodeAt(0),!i.StringUtil.isSpace(r)){a=s;break}return a},t.prototype.selectWord=function(t,e){var r=this._state.getTextStream();if(!(t<0||t>=r.getLength()-1)&&null===this._state.listMarkerSpanProp){var n=r.readText(t,1);if(n!==g.IfD.CommentReference){var a=n.charCodeAt(0),s={scrollToView:u.hF.None,forceFocus:!1,mobileContextMenu:u.A6.Show},l=!1;if((0,g.jUV)(a)&&(l=!0),i.StringUtil.isSpace(a)){var c=this.prevSkipSpace(t),p=this.nextSkipSpace(t);this.setRange(c,p,s)}else if(l){var h=this.getParaRange(t);if(c=this.prevWordBreak(t),h&&!h.contains(c))return;var d=this.filterCommentPlaceholder(new g.ICE(c,t-c));this.setRange(d.begin(),d.end(),s)}else if(i.StringUtil.isAlphabetOrNumber(a))c=this.prevWordBreak(t),p=this.nextWordBreak(t),d=this.filterCommentPlaceholder(new g.ICE(c,p-c)),this.setRange(d.begin(),d.end(),s);else if((0,en.isHanScript)(a)&&void 0!==Intl.Segmenter){var f=Math.max(0,t-10),y=r.readText(f,20),v=(0,o.__read)(function(t,e){var r,n,i=new Intl.Segmenter("zh",{granularity:"word"}).segment(t);try{for(var a=(0,o.__values)(i),s=a.next();!s.done;s=a.next()){var l=s.value;if(e>=l.index&&e<l.index+l.segment.length)return[l.index-e,l.index+l.segment.length-e]}}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return[0,0]}(y,t-f),2);c=v[0],p=v[1],this.setRange(c+t,p+t,s)}else e?(c=this.prevTextBreak(t),this.setRange(c,t,s)):(p=this.nextTextBreak(t),this.setRange(t,p,s))}else this.selectWord(t+1,e)}},t.prototype.getParaRange=function(t){var e=this._state.getTextStream();if(t<0||t>=e.getLength()-1)return null;var r=e.createParagraphIterator();return r.seek(t),r.getRange()},t.prototype.getShouldBreakParaRange=function(t){var e=this._state.getTextStream(),r=this.getParaRange(t);if(r){if(e.readText(r.end()-1,1)===g.IfD.ParagraphReturn&&(r=new g.ICE(r.begin(),r.length()-1)),r.isEmpty())return null;var n=t-r.begin(),i=r.length()-n,o=e.readText(t,i),a=e.readText(r.begin(),n);return this.findClosedPunctuationPos(r,o,a,t)}return null},t.prototype.getContentTextByRange=function(t){if(t){var e=this._state.getTextStream(),r=t.begin(),n=t.length();return e.readText(r,n)}return""},t.prototype.selectParagraph=function(t){var e=this.getParaRange(t);if(e){var r=this._state.getTextStream();if(1===e.len&&(0,g.jUV)(r.readText(t,1).charCodeAt(0)))return;this.setRange(e.begin(),e.end(),{scrollToView:u.hF.None,forceFocus:!1,mobileContextMenu:u.A6.Show})}},t.prototype.getSpanPropAtParaStart=function(){var t=this._state.getTextStream(),e=t.createParagraphIterator();e.seek(this._gcpRange().begin());var r=e.getRange(),n=t.createRunIterator();return n.seek(r.begin()),n.getCloneProperty()},t.prototype.getParaRangeFromSelection=function(t){var e=this._state.getTextStream().createParagraphIterator();return t?e.seek(this._gcpRange().begin()):0===this._gcpRange().len?e.seek(this._gcpRange().end()):e.seek(this._gcpRange().end()-1),e.getRange()},t.prototype.isSelectionBeginAtStoryBegin=function(){return this._gcpRange().begin()===this.storyRange().begin()},t.prototype.isSelectionEndAtStoryEnd=function(t){return void 0===t&&(t=!0),t?this._gcpRange().end()===this.storyRange().end():this._gcpRange().end()===this.storyRange().end()-1},t.prototype.relationToSelectAndPara=function(t,e,r,n){void 0===n&&(n=!0);var i=this.getParaRangeFromSelection(r),o=this._gcpRange().begin(),a=this._gcpRange().end();return t?e?o===i.begin():!n&&o===i.end()-1:e?a===i.begin():n?a===i.end():a===i.end()-1},t.prototype.isSelectAllParagraph=function(){return this.relationToSelectAndPara(!0,!0,!0)&&this.relationToSelectAndPara(!1,!1,!0)},t.prototype.isSelectWholeTable=function(){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0);return this._state.getTextStream().readText(e.begin(),1)===g.IfD.TableStart},t.prototype.isSelectionAtTableCell=function(){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0);return this._state.getTextStream().readText(e.begin(),1)===g.IfD.TableCellBreak},t.prototype.isGCPAtTableCell=function(t){return!!this._state.getTableStream().getCellInfo(t)},t.prototype.isSelectionCollapseAtParaStart=function(){return!!this._coreSelection().isCollapse()&&this.relationToSelectAndPara(!0,!0,!0)},t.prototype.isSelectionAtDrawing=function(t){if(1===this._gcpRange().len){var e=this._state.getTextStream().createRunIterator();e.seek(this._gcpRange().begin());var r=e.getProperty(),n=e.getRange();if(null==r?void 0:r.isPlaceholder){var i=g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),n.begin());return i instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&(!t||i.drawingType===t)}}return!1},t.prototype.isSelectionAtShape=function(){return this.isSelectionAtDrawing(g.HgR.WordprocessingShape)},t.prototype.isSelectionAtImage=function(){return this.isSelectionAtDrawing(g.HgR.Picture)},t.prototype.isSelectionAtEmbeddedObject=function(){var t=this.getRange().range(),e=t.gcpBegin,r=t.len;return 1===r&&this._state.getTextStream().readText(e,r)===g.IfD.EmbeddedObjectAnchor},t.prototype.isSelectionAtAnchorContainer=function(){if(1===this._gcpRange().len){var t=this._state.getDrawingStream().createDrawingIterator();t.seek(this._gcpRange().begin());var e=t.getProperty();if(e instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)&&e.drawingStates===g.Akw.Floating)return!0}return!1},t.prototype.isSelectionAtPlugin=function(){var t=this._gcpRange().begin(),e=this._state.getFieldStream().getDecodedFieldInfo(t),r=g.BqD.getComplexFieldSubType(null==e?void 0:e.fieldCode.switches);return!(!e||!r)&&["tdSheetIframe","addonHina","addonIframe"].includes(r)},t.prototype.isSelectionAtField=function(t){void 0===t&&(t="");var e=this._state.dataEngine.getDataStream().getFieldStream().getDecodedFieldInfo(this._gcpRange().begin());return!!e&&!(e.fieldRange.begin()>=this._gcpRange().begin())&&e.fieldCode.name.startsWith(t)},t.prototype.isSelectionAtTextLink=function(){var t,e,r=this._state.dataEngine.getDataStream().getFieldStream().getDecodedFieldInfo(this._gcpRange().begin());return!!r&&!(r.fieldCode.range.begin()>=this._gcpRange().begin())&&null!==(e=(null===(t=r.fieldCode.switches)||void 0===t?void 0:t[g.VEu.displayLayoutType])===g.dLA.Text)&&void 0!==e&&e},t.prototype.isSelectionInsideField=function(){var t,e=null===(t=this._state.dataEngine.getDataStream().getFieldStream().getFieldRange(this._gcpRange().begin()))||void 0===t?void 0:t.fieldRange;return(0!==this._gcpRange().len||(null==e?void 0:e.begin())!==this._gcpRange().begin())&&!!e&&e.contains(this._gcpRange())},t.prototype.isSelectionEndAtParaBreak=function(){if(this._gcpRange().len<=0)return!1;var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().end()-1);var e=t.getRange(!0),r=this._state.getTextStream().readText(e.begin(),e.len);return[g.IfD.ParagraphReturn,g.IfD.ParagraphBreak].includes(r)},t.prototype.isSelectionAtParaBreak=function(){if(1===this._gcpRange().len){var t=this._state.getTextStream().createRunIterator();t.seek(this._gcpRange().begin());var e=t.getRange(!0),r=this._state.getTextStream().readText(e.begin(),e.len);return[g.IfD.ParagraphReturn,g.IfD.ParagraphBreak].includes(r)}return!1},t.prototype.isSelectionAtTextFrame=function(t){if(this.storyType()!==g.AHI.textboxContent)return!1;var e=this.storyProperty(),r=g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty);return t?e instanceof r&&e.textBoxType===t:e instanceof r},t.prototype.isSelectionAtCodeblock=function(){return this.isSelectionAtTextFrame(g.Xbc.CodeBlock)},t.prototype.isSelectionAtLightblock=function(){return this.isSelectionAtTextFrame(g.Xbc.LightBlock)},t.prototype.isSelectionCollapseAtParaEnd=function(){return!!this._coreSelection().isCollapse()&&this.relationToSelectAndPara(!0,!1,!0,!1)},t.prototype.isSelectionAtListStart=function(){var t=this._state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(this._gcpRange());return null!==t&&0===t.order&&0===t.listLevel},t.prototype.isSelectionBelongsToSameList=function(){return!0},t.prototype.isSelectWholeList=function(t){var e=this,r=this._state.dataEngine.getDataManager().getNumberingManager().getWholeListByListId(t);return 0!==r.length&&r.every((function(t){return e._gcpRange().contains(t.gcp-1)}))},t.prototype.isSelectionAtMention=function(){if(0===this._gcpRange().len){var t=this._state.dataEngine.getDataStream().getFieldStream();if(null==t?void 0:t.getFieldRange(this._gcpRange().begin()))return!0}return!1},t.prototype.isSelectionAtCard=function(){var t=this._state.getFieldStream(),e=null==t?void 0:t.getDecodedFieldInfo(this._gcpRange().begin());return!(!e||![g.Lpg.GROUP_CONTACT_CARD,g.Lpg.MEMBER_CONTACT_CARD,g.Lpg.WXWORK_APP,g.Lpg.WXWORK_CALENDER,g.Lpg.WXWORK_GROUP_CHAT].includes(e.fieldCode.name))},t.prototype.isCaretAtCommentReference=function(t){return!(!t&&(!this._gcpRange().begin()||this._gcpRange().len>0))&&g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),(t||this._gcpRange().begin())-1)instanceof g.kkf.getPropertyClass(g.uSS.CommentReferenceProperty)},t.prototype.getFirstListInfoInSelection=function(t){var e,r;return null!==(r=null===(e=this._state.dataEngine.getDataManager().getNumberingManager())||void 0===e?void 0:e.getListInfoFromGcpRange(t||this._gcpRange()))&&void 0!==r?r:null},t.prototype.getParaRangeIfCollapsed=function(){if(!this._coreSelection().isCollapse())return null;var t=this._state.getTextStream().createParagraphIterator();t.seek(this._gcpRange().begin());var e=t.getRange();return tn.createStateRange(this._state,e)},t.prototype.validDeleteRange=function(){return this._coreSelection().validDeleteRange()},t.prototype._getRange=function(t){this._range||(this._range=tn.createStateRange(this._state,this._gcpRange(),!0));var e=t||this._gcpRange(),r=this._range.getTableSelectionArea();return(e.notEqual(this._range.range())||r&&e.notEqual(r.selectedRange))&&this._range.setGCPRange(e),this._range},t.prototype._gcpRange=function(){return this._state.selection.gcpRange},t.prototype._coreSelection=function(){return this._state.selection},t.prototype.getFieldInfo=function(t){return this._getRange().getFieldInfo(t)},t.prototype.getDecodedFieldInfo=function(t,e){return this._getRange().getDecodedFieldInfo(t,e)},t.prototype.getDecodedFieldInfos=function(t){return this._getRange().getDecodedFieldInfos(t)},t.prototype.getFieldRanges=function(){return this._getRange().getFieldRanges()},t.prototype.insertField=function(t,e,r){this._getRange().insertField(t,e,r)},t.prototype.insertFields=function(t){this._getRange().insertFields(t)},t.prototype.insertFieldStart=function(t,e,r){this._getRange().insertFieldStart(t,e,r)},t.prototype.insertFieldFinish=function(t,e,r){this._getRange().insertFieldFinish(t,e,r)},t.prototype.insertFieldCancel=function(t){this._getRange().insertFieldCancel(t)},t.prototype.updateField=function(t,e,r){this._getRange().updateField(t,e,r)},t.prototype.moveField=function(t,e){this._getRange().moveField(t,e)},t.prototype.getSelectionContent=function(){return this.getTextAndImage()},t.prototype.insertTextAndSelected=function(t){var e=this.range();if(e&&t&&t.length>0){var r=e.begin();this.setText(t),this._state.setRangeTo(new g.ICE(r,t.length))}},t.prototype.isSelectionAtIframePlugin=function(){var t=this._gcpRange();if(t.len>1){var e=this._state.getFieldStream().getDecodedFieldInfo(t.begin());if(e)return g.BqD.isContainerField(e.fieldCode.switches)&&t.equal(e.fieldRange)}return!1},t.prototype.increaseFontSize=function(){return this._getRange().modifyFontSizeRelatively(1)},t.prototype.decreaseFontSize=function(){return this._getRange().modifyFontSizeRelatively(-1)},t.prototype.typeLineBreak=function(){this._getRange().insertLineBreak()},t.prototype.getSelectedPropertyInfo=function(t){var e;if(!t||t.isEmpty()||t.isNull())return[];var r=this._state.getTextStream().createRunIterator(t),n=[];do{var i=r.getRange(!0),o=(null===(e=r.getCloneProperty())||void 0===e?void 0:e.isPlaceholder)?g.vCY.findPlaceholderCharProperty(this._state.getDataStream(),i.begin()):r.getCloneProperty();o&&n.push({range:i,property:o})}while(r.next());return n},t.prototype.filterFieldCodeRange=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream();return e?t.filter((function(t){var r;return!(e.isRangeInField(t)&&(null===(r=e.getDecodedFieldInfo(t.begin()))||void 0===r?void 0:r.layoutType)!==g.Zjt.Text)})):t},t.prototype.isRangeInFieldCode=function(t){var e=this._state.dataEngine.getDataStream().getFieldStream();return null==e?void 0:e.isRangeInField(t)},t.prototype.isInTable=function(){var t=this.getTableSelectionArea();return!(!(null==t?void 0:t.isInnerCell())&&!(null==t?void 0:t.isInnerTable()))},t.prototype.isInCellsOfTable=function(){var t;return!!(null===(t=this.getTableSelectionArea())||void 0===t?void 0:t.isInnerTable())},t.prototype.isInMainDocument=function(){return this.storyType()===g.AHI.mainDocument},t.prototype.isInHeaderFooter=function(){return this.storyType()===g.AHI.headerContent||this.storyType()===g.AHI.footerContent},t.prototype.getFieldRange=function(t){var e,r=this._state.getTextStream().readText(t.begin(),t.length()).indexOf(g.IfD.FieldBegin);if(r<0)return null;var n=this._state.dataEngine.getDataStream().getFieldStream(),i=null===(e=null==n?void 0:n.getFieldRange(t.begin()+r))||void 0===e?void 0:e.fieldRange;return i||null},t.prototype.isIncludeExtContainer=function(){var t=this;return(0,o.__spreadArray)([],(0,o.__read)(this._getRange().getInlinePlugins()),!1).some((function(e){var r=e.getRange(),n=t._state.getTextStream().readText(r.begin(),r.length());return g.YU5.getInstance().isContainerField(n)}))},t}(),nn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.setCellHeight=function(t,e){var r=this.findBottomRow(t);if(r){var n=new(g.kkf.getPropertyClass(g.uSS.TableRowProperty));n.trHeight.val=e,r.setProperty(n),this.setCommandType(u.wI.DocModifyTableRowHeight),this.applyTableStructureUpdate()}},e.prototype.findBottomRow=function(t){var e,r=null===(e=this.table)||void 0===e?void 0:e.getCell(t),n=null==r?void 0:r.getVMergeCells();return n?n[n.length-1].parent:null},e}(Er),on=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),e.prototype.moveTo=function(t){var e=this,r=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!0,!0).buildDelta(),n=this.table.getRange(),i=u.C1.createLocalDeltaOption(new g.ICE(n.begin()),!0,!0).buildDelta();u.Me.collectDataToDelta(this.state.dataEngine,i,n);var o=this.state.followParaProp(t),a=this.cursorOffset(n.begin()),s=function(){var a=t-n.begin();i.operations.forEach((function(t){var e=u.Yy.moveOffset(t,a);r.addOperation(e||t)})),pe.shouldInsertParaBeforeTable(t,e.state)&&u.Gh.insertParagraph(t,o.paraBreakSpan,o.paraProp,r)};n.begin()>t?(u.Gh.deleteText(n,r),s(),r.moveTo(new g.ICE(t+a,0))):(s(),u.Gh.deleteText(n,r),r.moveTo(new g.ICE(t-n.len+a,0))),r.setCommandType(u.wI.DocMoveContent),this.state.applyDelta(r)},e.prototype.moveOnSquareWrapType=function(t,e){var r=this.table.getRange(),n=this.table.getProperty().clone();if(n.tblPr.tblpPr.horzAnchor=g.Er3.page,n.tblPr.tblpPr.vertAnchor===g.B6J.margin&&(n.tblPr.tblpPr.vertAnchor=g.B6J.page),n.tblPr.tblOverlap=g.wD4.overlap,n.tblPr.tblpPr.tblpX=t.x,n.tblPr.tblpPr.tblpY=t.y,n.tblPr.tblpPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPPr).tKeys.tblpXSpec),n.tblPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPrBase).tKeys.jc),n.tblPr.tblpPr.setNull(g.kkf.getPropertyClass(g.uSS.CTTblPPr).tKeys.tblpYSpec),this.table.setProperty(n),this.setCommandType(u.wI.DocModifyTable),this.applyTableUpdate(),void 0!==e){var i=this.state.getTableStream().getTableInfo(e,g.AQ),o=i?i.range.begin():e;if(r.end()!==o)return void this.moveTo(o)}},e.prototype.cursorOffset=function(t){return this.state.selection.getCoreRange().fixToValidRange(new g.ICE(t,0)).begin()-t},e}(Er);function an(t,e,r){var n=e.begin,i=e.end,o=r.begin,a=r.end,s=t.selfLeft?n:i;return!(!t.otherLeft||s!==o)||!(!t.otherRight||s!==a)||!!(t.otherContain&&s>o&&s<a)}function sn(t,e,r){var n=[];return Array.isArray(e)?e.forEach((function(e){e.some((function(e){return!!an(r,t.interval,e.interval)&&(n.push(e),!0)}))})):e.rows.forEach((function(e){e.cells.some((function(e){return!!an(r,t.interval,e.interval)&&(n.push(e),!0)}))})),n}var ln,cn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"tableSelectArea",{get:function(){return this.state.selection.tableSelectionArea},enumerable:!1,configurable:!0}),e.prototype.getCellContentWidth=function(t){var e=this.table.getCell(t);if(!e)return null;var r=this.state.dataEngine.getDataManager().getStyleSheetManager(),n=r.mergeStyleTableProperty(this.table.getProperty()),a=r.mergeTableCellPropWithGcp(e.getProperty().clone(),n,t),s=(0,g.dv7)(a,n).tcMar,l=(0,o.__read)([s.left.w,s.right.w],2),c=l[0],p=l[1],u=Br(e,r),h=function(t){return(0,i.ptToTwips)(t/8)},d=(0,o.__read)([h(u.left.sz),h(u.right.sz)],2),f=d[0],y=d[1];return e.width-(c+p)-(f+y)},e.prototype.setColumnWidth=function(t,e,r,n){var i=this.table.getCell(t);if(i){var o=n?this.getVerticalCellAffectedBySelection(i,r):sn(i,this.table,r),a=this.findAllNear(o,r);this.legalToChangeWidth(a,o)&&(o.forEach((function(t){var r=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));r.tcW.w=e,t.setProperty(r)})),this.setCommandType(u.wI.DocModifyTableColumnWidth),this.applyTableStructureUpdate())}},e.prototype.setCellWidth=function(t,e,r,n){var i=this,o=this.table.getCell(t);if(o){var a=e-o.getProperty().tcW.w,s=this.getDiffByAutoAline(o,a,r),l=n?this.getVerticalCellAffectedBySelection(o,r):sn(o,this.table,r),c=this.findAllNear(l,r);if(this.legalToChangeWidth(c,l)){var p=s>0?this.findAdjustableDiff(c.nearCells):this.findAdjustableDiff(l);null===p&&(p=s);var g=Math.min(Math.abs(p),Math.abs(s)),h=s>0?g:-g,d=-h;l.forEach((function(t){i.setCellWidthByDiff(t,h)})),c.nearCells.forEach((function(t){i.setCellWidthByDiff(t,d)})),this.hasWBefore(this.table.rows)&&this.table.fixMergedStructure(),this.setCommandType(u.wI.DocModifyTableColumnWidth),this.applyTableStructureUpdate()}}},e.prototype.hasWBefore=function(t){return t.some((function(t){return g.Rh7.getWidth(t.getProperty().wBefore)>0}))},e.prototype.getDiffByAutoAline=function(t,e,r){var n=null,i=function(t,e){var r=t,n=t;return e.rows.forEach((function(e){e.cells.forEach((function(e){var i=Math.abs(t-e.interval.begin);0!==i&&r>i&&(r=i,n=e.interval.begin),0!==(i=Math.abs(t-e.interval.end))&&r>i&&(r=i,n=e.interval.end)}))})),n}(n=r.selfLeft?t.interval.begin+e:t.interval.end+e,this.table);return Math.abs(n-i)>50?e:e+i-n},e.prototype.getVerticalCellAffectedBySelection=function(t,e){if(!this.tableSelectArea||this.tableSelectArea.isInnerCell()||this.tableSelectArea.isCrossTable())return sn(t,this.table,e);if(this.tableSelectArea.isInnerTable()){var r=this.table.intersectCellRange(this.tableSelectArea.cellRanges[0]);if(this.hasCell(t,r))return sn(t,r,e);var n=t.nextCell();if(n&&this.hasCell(n,r))return sn(t,this.mergePrevCell(r),e);var i=t.prevCell();if(i&&this.hasCell(i,r))return sn(t,this.mergeNextCell(r),e)}return sn(t,this.table,e)},e.prototype.findAllNear=function(t,e){return e.selfLeft?this.findAllPrev(t):this.findAllNext(t)},e.prototype.findAllPrev=function(t){var e=[],r=[];return t.forEach((function(t){var n=t.prevCell();n?e.push(n):r.push(t.parent)})),{nearCells:e,nearRows:r}},e.prototype.findAllNext=function(t){var e=[];return t.forEach((function(t){var r=t.nextCell();r&&e.push(r)})),{nearCells:e,nearRows:[]}},e.prototype.findAdjustableDiff=function(t){if(!t[0])return null;var e=t[0].getProperty().tcW.w-236;return t.slice(1).forEach((function(t){var r=t.getProperty().tcW.w-236;e=Math.min(e,r)})),e},e.prototype.adjustTableIndent=function(){var t=this,e=Number.MAX_SAFE_INTEGER;this.table.rows.forEach((function(t){e=Math.min(t.getProperty().wBefore.w,e)})),this.setTableIndentByDiff(this.table,e),this.table.rows.forEach((function(r){t.setRowBeforeWidth(r,-e)}))},e.prototype.setCellWidthByDiff=function(t,e){var r=t.getProperty().tcW.w,n=new(g.kkf.getPropertyClass(g.uSS.TableCellProperty));n.tcW.w=r+e,t.setProperty(n)},e.prototype.setTableIndentByDiff=function(t,e){var r=t.getProperty().tblPr.tblInd.w,n=new(g.kkf.getPropertyClass(g.uSS.TableProperty));n.tblPr.tblInd.w=r+e,t.setProperty(n)},e.prototype.setRowBeforeWidth=function(t,e){var r=t.getProperty().wBefore.w,n=new(g.kkf.getPropertyClass(g.uSS.TableRowProperty));n.wBefore.w=r+e,t.setProperty(n)},e.prototype.hasCell=function(t,e){var r=t.getRange();return e.some((function(t){return t.some((function(t){return r.intersect(t.getRange())}))}))},e.prototype.mergePrevCell=function(t){return t.slice(0).map((function(t){var e=t[0].prevCell();return e?(t.unshift(e),t):t}))},e.prototype.mergeNextCell=function(t){return t.slice(0).map((function(t){var e=t[t.length-1].nextCell();return e?(t.push(e),t):t}))},e.prototype.legalToChangeWidth=function(t,e){var r=t.nearCells[0],n=e[0],i=t.nearCells[t.nearCells.length-1],o=e[e.length-1];return!r||[r,n].every((function(t){return!t.isVMergedCell()}))&&[i,o].every((function(t){return!t.nextCellOfMergedGroup()}))},e}(Er),pn=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.table=n,i.widthService=new cn(i.table,r,i._state),i.heightService=new nn(i.table,r,i._state),i.moveService=new on(i.table,r,i._state),i.columnService=new Vr(i.table,r,i._state),i.rowService=new zr(i.table,r,e),i.tableWrapTextService=new Xr(i.table,r,i._state),i}return(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"controlService",{get:function(){return new qr(this._state)},enumerable:!1,configurable:!0}),e.create=function(t,r,n){return new e(t,r,n)},e.prototype.getCellContentWidth=function(t){return this.widthService.getCellContentWidth(t)},e.prototype.setColumnWidth=function(t,e,r,n){void 0===n&&(n=!1),this.widthService.setColumnWidth(t,e,r,n)},e.prototype.setCellWidth=function(t,e,r,n){void 0===n&&(n=!1),this.widthService.setCellWidth(t,e,r,n)},e.prototype.setCellHeight=function(t,e){this.heightService.setCellHeight(t,e)},e.prototype.moveTo=function(t){this.moveService.moveTo(t)},e.prototype.moveOnSquareWrapType=function(t,e){this.moveService.moveOnSquareWrapType(t,e)},e.prototype.increaseRightSideColWidth=function(t,e){this.columnService.increaseRightSideColWidth(t,e)},e.prototype.setColsWidth=function(t){this.columnService.setColsWidth(t)},e.prototype.insertRowsAbove=function(t,e){void 0===e&&(e=1),this.rowService.insertRowsAbove(t,e)},e.prototype.insertRowsBelow=function(t,e){void 0===e&&(e=1),this.rowService.insertRowsBelow(t,e)},e.prototype.insertColsLeft=function(t,e){void 0===e&&(e=1),this.columnService.insertColsLeft(t,e)},e.prototype.insertColsRight=function(t,e){void 0===e&&(e=1),this.columnService.insertColsRight(t,e)},e.prototype.removeCols=function(t){this.columnService.removeCols(t)},e.prototype.removeRows=function(t){this.rowService.removeRows(t)},e.prototype.moveColsTo=function(t,e){this.columnService.moveColsTo(t,e)},e.prototype.moveRowsTo=function(t,e){this.rowService.moveRowsTo(t,e)},e.prototype.averageColWidths=function(t){this.columnService.averageColWidths(t)},e.prototype.selectTable=function(){this.controlService.selectTable(this.table.info)},e.prototype.isTableWrapText=function(){return this.tableWrapTextService.isTableWrapText()},e.prototype.scaleTable=function(t,e,r){if(t>0&&this.table.scaleX(t),e&&e.length>0){var n=this.table.rows.findIndex((function(t){return t.getRange().begin()===r.begin()}));Tr(this.table.rows.slice(n),(function(t,r){t.setHeight(e[r])}))}var i=this.table.toDelta(this._deltaOpt.buildDelta());i.setCommandType(u.wI.DocScaleTable),this._state.applyDelta(i)},e}(Qe),un=function(){function t(){this.description="Error Merge Group"}return t.prototype.fixDelta=function(t,e){var r,n,i=t.getDataStream().getTableStream().getMergedMapping(e.range.begin());if(!i)return null;var a=i.getErrorCells();if(0===a.length)return null;var s=xr.createTable(t,e.range.begin());if(!s)return null;var l=function(t,e){var r=s.rows[t];if(!r)return"continue";var n=r.cells.find((function(t){return t.interval.begin===e}));if(!n)return"continue";n.clearVMerge()};try{for(var c=(0,o.__values)(a),p=c.next();!p.done;p=c.next()){var u=p.value;l(u.rowIndex,u.colBegin)}}catch(t){r={error:t}}finally{try{p&&!p.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}var g=t.delta();return s.toDelta(g),g},t.prototype.check=function(t,e,r){var n=t.getTableStream(),i=n.getTableInfo(e.range.begin());if(!i)return!0;var o=n.getMergedMapping(e.range.begin(),i.property.nestingLevel);return!(!o||o.getErrorMergedCells().length>0)},t.prototype.assertSuccess=function(t,e,r){if(!this.check(t,e,r)){var n=t.getTableStream().getMergedMapping(e.range.begin());if(!n)throw{type:this.description,describe:"build merged map error"};var i=n.getErrorMergedCells().length;throw{type:this.description,describe:"error continue cells ".concat(i)}}},t}(),gn={description:"Error Table Range",check:function(t,e){try{return this.assertSuccess(t,e),!0}catch(t){return!1}},fixDelta:function(){return u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1,!0).buildDelta()},assertSuccess:function(t,e){for(var r=t.getTableStream(),n=t.getTextStream(),i=r.createTableIterator({nestingLevel:e.property.nestingLevel});i.hasNext();){var o=i.getRange(),a=n.readText(o.begin(),1)!==g.IfD.TableStart,s=n.readText(o.end()-1,1)!==g.IfD.TableEnd;if(a||s)throw{describe:"error ".concat(a?"start":"end"," placeholder"),type:this.description};if(o.len<5)throw{describe:"the contents of table are empty",type:this.description};i.next()}}},hn=function(){function t(){this.description="Cell Miss Paragraph",this.errorCells=[],this.errorRows=[]}return t.prototype.check=function(t,e,r){if(this.errorCells.length>0)return!1;var n=t.getTableStream(),i=t.getTextStream(),o=i.createParagraphIterator();o.seek(e.range.begin());var a=1!==o.getRange().len,s=i.readText(e.contentRange.end()-1,1)!==g.IfD.TableRowBreak;if(a||s){var l=a?"prev-start":"prev-end",c=a?e.range.begin():e.range.end();(0,u.j_)(r,"structure error type:".concat(l," gcp:").concat(c))}for(var p=e.property.nestingLevel,h=n.createRowIterator({limitRange:e.contentRange,nestingLevel:p});h.hasNext();){for(var d=h.getContentRange(!0),f=n.createCellIterator({limitRange:d,nestingLevel:p}),y=0,v=0;f.hasNext();){var m=f.getContentRange(!0);m.isEmpty()&&this.errorCells.push(m.begin()),i.readText(m.end()-1,1)!==g.IfD.ParagraphReturn&&(0,u.j_)(r,"char before cell-break invalid gcp:".concat(m.end()-1)),y+=1,v+=f.getRange(!0).len,f.next()}0===y&&this.errorRows.push(h.getRange(!0)),v!==d.len&&(0,u.j_)(r,"cell length not match row"),i.readText(d.end()-1,1)!==g.IfD.TableCellBreak&&(0,u.j_)(r,"char before row-break invalid gcp:".concat(d.end()-1)),h.next()}return 0===this.errorCells.length&&0===this.errorRows.length},t.prototype.fixDelta=function(t){var e,r,n=t.delta();this.errorCells.sort((function(t,e){return e-t}));try{for(var i=(0,o.__values)(this.errorCells),a=i.next();!a.done;a=i.next()){var s=a.value;u.Gh.insertParagraph(s,new(g.kkf.getPropertyClass(g.uSS.RunProperty)),new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),n)}}catch(t){e={error:t}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return this.errorCells=[],n},t.prototype.assertSuccess=function(t,e,r){if(!this.check(t,e,r))throw{type:this.description,describe:"".concat(this.errorCells.length," cells miss paragraph")}},t}(),dn=function(){function t(t,e){var r;this.tableInfo=null,this.state=t,this.handlers=[new hn,gn,new un],this.tableInfo=this.tableStream.getTableInfo(e.begin()),this.range=(null===(r=this.tableInfo)||void 0===r?void 0:r.range)||e}return Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.state.getTableStream()},enumerable:!1,configurable:!0}),t.prototype.check=function(t){var e,r;if(!this.tableInfo)return{result:!0};try{try{for(var n=(0,o.__values)(this.handlers),i=n.next();!i.done;i=n.next())i.value.assertSuccess(this.state.getDataStream(),this.tableInfo,t)}catch(t){e={error:t}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}return{result:!0}}catch(t){return{result:!1,errType:t.type,errDescription:t.description}}},t}(),fn=function(){function t(t){this.cachedWordCount=0,this.state=t,this.dataEngine=this.state.dataEngine}return t.prototype.deltaOption=function(t){return u.C1.createLocalDeltaOption(new g.ICE(0,this.textStream.getLength()),!!t)},t.prototype.mainDocDeltaOption=function(){return u.C1.createLocalDeltaOption(this.getMainStoryRange()||new g.ICE(0,0),!1)},Object.defineProperty(t.prototype,"textStream",{get:function(){return this.dataEngine.getDataStream().getTextStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storyStream",{get:function(){return this.dataEngine.getDataStream().getStoryStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tableStream",{get:function(){return this.dataEngine.getDataStream().getTableStream()},enumerable:!1,configurable:!0}),t.prototype.getTableFromGcp=function(t,e){var r=this.tableStream.getTableInfo(t,e);return r?xr.createTable(this.state,r.range.begin(),r.property.nestingLevel):null},t.prototype.hasTable=function(t,e){return!!this.tableStream.getTableInfo(t,e)},t.prototype.hasEmptyTable=function(){for(var t=this.tableStream.createTableIterator();t.hasNext();){if(t.getContentRange(!0).isEmpty())return!0;t.next()}return!1},t.prototype.getTableCount=function(t,e){for(var r=this.tableStream.createTableIterator({limitRange:t,nestingLevel:e}),n=0;r.hasNext();)n+=1,r.next();return n},t.prototype.getSubtableCountFromGcp=function(t,e){return this.getTableCount(t,e)},t.prototype.getListInfoFromGcpRange=function(t){return this.state.dataEngine.getDataManager().getNumberingManager()?this.state.dataEngine.getDataManager().getNumberingManager().getListInfoFromGcpRange(t):null},t.prototype.getListInfoArrayFromGcpRange=function(t){return this.state.dataEngine.getDataManager().getNumberingManager()?this.state.dataEngine.getDataManager().getNumberingManager().getListInfoArrayFromGcpRange(t):[]},t.prototype.getFields=function(){return Jr.createStateFields(this.state,this.deltaOption())},t.prototype.getSpans=function(){return er.createStateSpans(this.state,this.deltaOption())},t.prototype.getParagraphs=function(){return or.createStateParagraphs(this.state,this.deltaOption())},t.prototype.setSectionFormat=function(t){this.getSectionFormat().setSectionFormat(t)},t.prototype.getSectionFormat=function(){return ar.createStateSectionFormat(this.state,this.mainDocDeltaOption())},t.prototype.getSections=function(){return lr.createStateSections(this.state,this.mainDocDeltaOption())},t.prototype.getTableService=function(t,e,r){var n=this.getTableFromGcp(t.begin(),e);return n?pn.create(this.state,this.deltaOption(r),n):null},t.prototype.getRange=function(t,e,r){return tn.createStateRange(this.state,new g.ICE(t,e-t),null==r?void 0:r.updateSelection,null==r?void 0:r.fixRange)},t.prototype.getSelection=function(){return rn.createStateSelection(this.state)},t.prototype.select=function(){tn.createStateRange(this.state,this.state.selection.gcpRange).wholeStory()},t.prototype.getInlineShapes=function(){return hr.createStateInlineShapes(this.state,this.deltaOption())},t.prototype.getInlinePlugins=function(){return Cr.createStateInlinePlugins(this.state,this.deltaOption())},t.prototype.getTextframes=function(){return vr.create(this.state,this.deltaOption())},t.prototype.getCodeblocks=function(){return Sr.create(this.state,this.deltaOption())},t.prototype.getShapes=function(){return gr.create(this.state,this.deltaOption())},t.prototype.onCompositionStart=function(t){this.state.compositionStart(t)},t.prototype.onCompositionUpdate=function(t,e){this.state.compositionUpdate(t,e)},t.prototype.onCompositionEnd=function(t,e){this.state.compositionEnd(t,e)},t.prototype.getRunPropertyFromGCPRange=function(t){var e=this.state.getTextStream().createRunIterator(t),r=[];do{var n=e.getProperty();n&&r.push(n)}while(e.next());return r},t.prototype.isCanBeReplace=function(t){var e=this.state.dataEngine.getDataStream().getFieldStream(),r=e.getDecodedFieldInfo(t.begin());return r?r.layoutType===g.Zjt.Text:!(null==e?void 0:e.isRangeInField(t))},t.prototype.search=function(t){var e=[],r=t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),n=new RegExp("".concat(r),"gi"),i=new RegExp("".concat(g.IfD.DrawingAnchor),"gi"),a=this.textStream.createParagraphIterator();a.seek(0);do{var s=a.getContentRange(),l=this.textStream.readText(s.begin(),s.length());if(s.begin()>=this.getDocumentEndPos())break;if(!this.isInCommentRange(s.begin()))for(var c=n.exec(l),p=i.exec(l);c||p;)if(c){var u=this.searchInParagraph(t,c,s);u&&e.push(u),c=n.exec(l)}else if(p){var h=this.searchInSubStory(t,p,s,n);h.length>0&&(e=(0,o.__spreadArray)((0,o.__spreadArray)([],(0,o.__read)(e),!1),(0,o.__read)(h),!1)),p=i.exec(l)}}while(a.next());return e},t.prototype.searchInParagraph=function(t,e,r){var n=this.state.dataEngine.getDataStream().getFieldStream(),i=new g.ICE(r.begin()+e.index,t.length),o=n&&n.getFieldRange(i.begin());if(null==n?void 0:n.isRangeInField(i)){var a=null==n?void 0:n.getDecodedFieldInfo(i.begin()),s=a.fieldResult,l=a.isAutoUpdate,c=a.layoutType,p=a.displayLayoutType;if((null==s?void 0:s.range.contains(i))&&!l&&(c!==g.Zjt.Container||p===g.dLA.Inline))return{logicalRange:i,realRange:i}}else{if(!o)return{logicalRange:i,realRange:i};if(o.fieldResultRange.contains(i))return{logicalRange:i,realRange:i}}},t.prototype.searchInSubStory=function(t,e,r,n){var i,o=[],a=new g.ICE(r.begin()+e.index,g.IfD.DrawingAnchor.length),s=null===(i=this.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromGcp(a.begin()))||void 0===i?void 0:i.property,l=this.state.dataEngine.getDataStream().getFieldStream();if(s&&s.hasContentId()){var c=this.storyStream.getSubStoryInfoFromId(s.drawing.graphic.graphicData.wsp.txbx.contentId);if(c)for(var p=c.range,u=this.textStream.readText(p.begin(),p.length()),h=n.exec(u);h;){var d=new g.ICE(p.begin()+h.index,t.length),f=l&&l.getFieldRange(d.begin());f?f.fieldResultRange.contains(d)&&o.push({logicalRange:a,realRange:d,isStory:!0}):o.push({logicalRange:a,realRange:d,isStory:!0}),h=n.exec(u)}}return o},t.prototype.replaceAll=function(t,e,r){for(var n=this.state.delta(),i=0,o=t.length-1;o>=0;o--){var a=t[o].clone();if(this.isCanBeReplace(a))if(u.Gh.deleteText(a,n),i+=1,r){var s=t.reduce((function(t,e){return e.length()+t}),0),l=this.textStream.createRunIterator(a),c=a.begin();do{var p=l.getCloneProperty();if(s!==e.length&&p){u.Gh.insertText(c,e,p,n);break}var g=c-a.begin(),h=l.getContentRange(),d=h.gcpBegin+h.length()-g-a.begin();p&&(u.Gh.insertNormalTextVaild(e.substr(g,d)),u.Gh.insertText(c,e.substr(g,d),p,n)),c+=d}while(l.next())}else{var f=this.state.followSpanProp(a.begin());f&&(u.Gh.insertNormalTextVaild(e),u.Gh.insertText(a.begin(),e,f,n))}}return n.setCommandType(u.wI.DocReplaceAllText),this.state.applyDelta(n),i},t.prototype.countWord=function(t){if(void 0===t&&(t=!1),t)return this.cachedWordCount;var e=0,r=this.storyStream.getMainStoryInfo();if(null===r)return this.cachedWordCount=0,this.cachedWordCount;var n=this.textStream.createParagraphIterator(r.contentRange);do{var o=n.getRange(),a=this.textStream.readText(o.begin(),o.length());e+=i.StringUtil.countWordReg(a)}while(n.next());return this.cachedWordCount=e-1,this.cachedWordCount},t.prototype.docIsEmpty=function(){var t=this.textStream.readText(0,11);return["\0","\r\0","\r\0","\r\r\0"].indexOf(t)>-1},t.prototype.getCurLastStoryEndPos=function(t){return this.storyStream.getStoryLastPos(t)},t.prototype.getFirstParamText=function(){var t="",e=g.ICE.emptyRange(),r=this.storyStream.getMainStoryInfo();if(r){var n=r.range,i=this.textStream.createParagraphIterator(n),o=/(^\s*)|(\s*$)|\n/g;do{var a=i.getRange(),s="",l=!0,c="",p=this.textStream.createRunIterator(a);do{var u=p.getRange(!0),h=this.textStream.readText(u.begin(),u.len),d=p.getProperty();l=this.updateIsFieldCodeComplete(h,l),!d||d.isPlaceholder&&!(0,g.Eo8)(h.charCodeAt(0))||(!c&&l?s+=h=h.replace(o,""):l?(c+=h,s+=g.YU5.filterFieldCode(c),c=""):c+=h)}while(p.next());s&&s.length>0&&s!==g.IfD.SectionBreak&&(t=s,e=a)}while(i.next()&&0===t.length)}return{content:t,range:e}},t.prototype.getFirstParaTextRegardless=function(){var t="",e=g.ICE.emptyRange(),r=this.storyStream.getMainStoryInfo();if(r){var n=r.range,i=/(^\s*)|(\s*$)|\n/g,o=this.textStream.createParagraphIterator(n).getRange(),a="",s=!0,l="",c=this.textStream.createRunIterator(o);do{var p=c.getRange(!0),u=this.textStream.readText(p.begin(),p.len),h=c.getCloneProperty();s=this.updateIsFieldCodeComplete(u,s),!h||h.isPlaceholder&&!(0,g.Eo8)(u.charCodeAt(0))||(!l&&s?a+=u=u.replace(i,""):s?(l+=u,a+=g.YU5.filterFieldCode(l),l=""):l+=u)}while(c.next());a&&a!==g.IfD.SectionBreak&&(t=a,e=o)}return{content:t,range:e}},t.prototype.getFirstParaRange=function(){return this.textStream.createParagraphIterator().getRange()},t.prototype.isParaEmpty=function(t){var e=this.textStream.createParagraphIterator();e.seek(t);var r=e.getRange();return r.length()>0&&r.begin()===t&&r.end()-1===t},t.prototype.isInCommentRange=function(t){var e=this.storyStream.getStoryInfoFromGcp(t);return(null==e?void 0:e.storyProp.storyType)===g.AHI.commentContent},t.prototype.getCommandTypeFromStoryType=function(t){var e=u.wI.Empty;switch(t){case g.AHI.headerContent:e=u.wI.DocInsertHeader;break;case g.AHI.footerContent:e=u.wI.DocInsertFooter;break;case g.AHI.footnoteContent:e=u.wI.DocInsertFootnote;break;case g.AHI.endnoteContent:e=u.wI.DocInsertEndnote;break;case g.AHI.commentContent:e=u.wI.DocInsertComment;break;case g.AHI.textboxContent:e=u.wI.DocInsertTextbox}return e},t.prototype.insertStory=function(t,e,r,n){if(this.state){var i=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();i.setCommandType(this.getCommandTypeFromStoryType(t));var o=pe.createStoryPropertyFromType(t);if(o){o.id=e;var a=this.storyStream.getStoryLastPos(t);a!==pe.defaultCp&&(u.Gh.insertSubStory(a,o,g.IfD.SubStoryBegin,i,g.XS7.Insert),u.Gh.insertParagraph(i.currentRange().end(),n||new(g.kkf.getPropertyClass(g.uSS.RunProperty)),r||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),i),u.Gh.insertSubStory(i.currentRange().end(),o.clone(),g.IfD.SubStoryEnd,i,g.XS7.Insert),this.state.applyDelta(i))}}},t.prototype.getSubStoryInfoFromId=function(t,e,r){return this.storyStream.getSubStoryInfoFromId(t,e,r)},t.prototype.toApplyDelta=function(t){this.state.applyDelta(t)},t.prototype.getParamInfoFromGcpRange=function(t){var e=this.textStream.createParagraphIterator();e.seek(t.begin());var r=e.getRange().begin();e.seek(t.end()-1);var n=e.getRange().end()-r;return{content:this.textStream.readText(r,n),range:new g.ICE(r,n)}},t.prototype.findContentFromId=function(t,e,r){var n=r||this.storyStream.getSubStoryInfoFromId(t,e);if(n){var i=n.contentRange;return this.textStream.readText(i.begin(),i.length())}return""},t.prototype.getStoryLastPos=function(t){return this.storyStream.getStoryLastPos(t)},t.prototype.getIndentFromGcp=function(t){var e=this.getParamInfoFromGcpRange(new g.ICE(t,0)),r=e.content,n=e.range;if(r&&r.length>0){var i=r.match(/^ +/g);if(i&&i.length>0)return new g.ICE(n.begin(),i[0].length)}return new g.ICE(n.begin(),0)},t.prototype.getLineNumber=function(t,e){var r=this.storyStream.getSubStoryInfoFromId(e,t);if(r){var n=0,i=this.textStream.createParagraphIterator(r.contentRange);do{n+=1}while(i.next());return n}return 0},t.prototype.getSubStoryInfoFromGcp=function(t){return this.storyStream.getSubStoryInfoFromGcp(t)},t.prototype.removeContainerStories=function(t,e){var r=this,n=[],i=this.storyStream.createSubStoryIterator();do{var o=i.getProperty();o&&t.includes(o.id)&&n.push(i.getRange())}while(i.hasNext()&&i.next());if(n.length>0){var a=this.deltaOption().buildDelta();a.setCommandType(e),n.reverse().forEach((function(t){r.state.deleteText(t,a)})),this.state.applyDelta(a)}},t.prototype.getShadingProperty=function(){return this.state.dataEngine.getDataManager().getSettingsManager().getShadingProperty()},t.prototype.setDocSettingProperty=function(t){var e=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1).buildDelta();e.setCommandType(u.wI.DocSetSettings),u.Gh.setSettingProperty(t,g.LK6.settings,e),this.state.applyDelta(e)},t.prototype.collectSpans=function(t,e){var r=[],n=this.textStream.createRunIterator(e);do{var i=n.getProperty();if(i){var o=n.getRange();t(i,o)&&r.push(o)}}while(n.next());return r},t.prototype.collectOutlineParagraph=function(t){var e=t.limitRange,r=t.maxTextLength,n=void 0===r?200:r,i=t.getRefText,o=[],a=this.storyStream.getMainStoryInfo();if(null===a||e&&!a.range.contains(e))return o;var s=null!=e?e:a.range;this.state.dataEngine.getIsChunkLoading()&&(s=new g.ICE(0,this.state.dataEngine.getGCPChunkEnd()));var l=this.textStream.createParagraphIterator(s),c=this.state.dataEngine.getDataManager().getStyleSheetManager();do{var p=l.getContentRange().end(),u=l.getProperty();if(u&&this.getMergedStyleOutlineLvl(c,u).outlineLvl!==g.ilm.LevelNone&&!this.tableStream.getTableInfo(p)&&(u&&(u=c.mergeStyleParaPropWithGcp(u,p)),u&&u.outlineLvl!==g.ilm.LevelNone)){var h=this.getOutlineFromStream(u,l,n,i);h.text!==g.IfD.SectionBreak&&o.push(h)}}while(l.next());return o},t.prototype.getMergedStyleOutlineLvl=function(t,e){var r=e.has(e.tKeys.outlineLvl)?e.outlineLvl:g.ilm.LevelNone;return t.traceToParagraphBaseStyle(e,(function(t){return!(r!==g.ilm.LevelNone||!t.has(t.tKeys.outlineLvl)||t.outlineLvl===g.ilm.LevelNone||(r=t.outlineLvl,0))}),!0),{outlineLvl:r}},t.prototype.collectPrevOutlineParagraph=function(t,e){void 0===e&&(e=100);var r=null,n=this.storyStream.getMainStoryInfo();if(null===n)return null;var i=this.textStream.createParagraphIterator(n.range);do{var o=i.getProperty();if(o&&(o=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParaPropWithGcp(o,i.getRange().begin())),o){if(r&&t.range().intersect(i.getRange()))return r;o.outlineLvl<g.ilm.LevelNone&&(r=this.getOutlineFromStream(o,i,e))}}while(i.next());return null},t.prototype.getTableFixer=function(t){return new dn(this.state,t)},t.prototype.convertToTableRanges=function(t){return this.tableStream.convertToTableRanges(t)},t.prototype.getOutlineFromStream=function(t,e,r,n){var i=this,o=this.state.dataEngine.getDataManager().getNumberingManager(),a=this.textStream.createRunIterator(),s=e.getRange(),l=this.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(t.pStyle),c="";if(n)return{text:c=n(s).replace(/\r\n?/g,""),range:s,outlineLevel:t.outlineLvl,styleName:(null==l?void 0:l.name)||"",paraId:t.paraId};c+=this.getListInfoActualText(o,t,s);var p=!0;a.setLimitRange(new g.ICE(s.begin(),s.length()));var u=!0,h="",d=function(){var t=a.getRange(!0),e=f.textStream.readText(t.begin(),t.len);if(u=f.updateIsFieldCodeComplete(e,u),f.notContainsSpecialChar(e))!h&&u?c+=e:h+=e,p=!1;else if(f.containsDrawingType(e)){var r=g.vCY.findPlaceholderCharProperty(f.dataEngine.getDataStream(),t.begin());if(r instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)){var n=f.collectOutlineFromDrawingType(r);c+=n,p=!n}}else if(p){var o=0,l=!0,d=Array.from(e).filter((function(t){return i.notContainsSpecialChar(t)?(l=!1,!0):(l&&(o+=1),!1)}));c+=d.join(""),s.gcpBegin+=o,s.len-=o}u&&h&&(c+=g.YU5.filterFieldCode(h),h="")},f=this;do{d()}while(a.next()&&(c.length<r||!u));return{text:c,range:s,outlineLevel:t.outlineLvl,styleName:(null==l?void 0:l.name)||"",paraId:t.paraId}},t.prototype.getListInfoActualText=function(t,e,r){if(null==t?void 0:t.isListParagraph(e)){var n=t.getListInfoFromGcpRange(r);if(null==n?void 0:n.actualText)return"".concat(n.actualText," ")}return""},t.prototype.updateIsFieldCodeComplete=function(t,e){var r=e;return t===g.IfD.FieldBegin&&(r=!1),t===g.IfD.FieldEnd&&(r=!0),r},t.prototype.notContainsSpecialChar=function(t){if(!t)return!1;var e=t.charCodeAt(0);return!(isNaN(e)||e!==g.ghV.FieldBegin&&e!==g.ghV.FieldSeparate&&e!==g.ghV.FieldEnd&&(0,g.Jn0)(e))},t.prototype.containsDrawingType=function(t){return t===g.IfD.DrawingAnchor},t.prototype.collectOutlineWithoutTitleSubtitle=function(t){void 0===t&&(t=200);var e=[],r=this.storyStream.getMainStoryInfo();if(null===r)return e;var n=this.textStream.createRunIterator(),i=this.textStream.createParagraphIterator(r.range);do{var o=i.getProperty();if(o&&(o=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleParaPropWithGcp(o,i.getRange().begin())),o&&o.outlineLvl!==g.ilm.LevelNone){var a=o instanceof g.Jhz?o.paragraphStyle:o.pStyle;if(a===g.HiI.Title||a===g.HiI.Subtitle)continue;var s=i.getRange(),l="";l+=this.collectList(o,s),n.setLimitRange(new g.ICE(s.begin(),s.length())),l+=this.getSpanText(n,s,t),l=g.BqD.getFilterFieldCodeText(l);var c=this.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(o.pStyle),p={text:l,range:s,outlineLevel:o.outlineLvl,styleName:(null==c?void 0:c.name)||"",paraId:o.paraId};e.push(p)}}while(i.next());return e},t.prototype.getSpanText=function(t,e,r){var n,i=!0,o="";do{i=(n=this.collectSpanText(t,e)).isFieldCodeComplete,o+=n.newText}while(t.next()&&(o.length<r||!i));return o},t.prototype.collectSpanText=function(t,e){var r=t.getRange(!0),n=this.textStream.readText(r.begin(),r.len),i=!0,o="",a=e,s=this.isFieldCodeComplete(n);if([g.IfD.DrawingAnchor,g.IfD.SectionBreak,g.IfD.PageBreak].includes(n))if(this.containsDrawingType(n)){var l=g.vCY.findPlaceholderCharProperty(this.dataEngine.getDataStream(),r.begin());if(l instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)){var c=this.collectOutlineFromDrawingType(l);o+=c,i=!c}}else i&&(a.gcpBegin+=r.length(),a.len-=r.length());else o+=n,i=!1;return{isFieldCodeComplete:s,newText:o}},t.prototype.collectList=function(t,e){var r="",n=this.state.dataEngine.getDataManager().getNumberingManager();if(null==n?void 0:n.isListParagraph(t)){var i=n.getListInfoFromGcpRange(e);(null==i?void 0:i.isNumbered)&&i.actualText&&(r+="".concat(i.actualText," "))}return r},t.prototype.collectOutlineFromDrawingType=function(t){var e="",r=t.drawingType;if(r===g.HgR.Picture)switch(t.drawing.addonSource){case g.SfV.latex:e="[公式]";break;case g.SfV.sign:case g.SfV.signbar:e="[电子签名]";break;default:e="[图片]"}else if(r===g.HgR.WordprocessingShape){var n=t.drawing.graphic.graphicData.wsp.txbx.contentId,i=this.state.getStoryStream().getSubStoryInfoFromId(n,g.AHI.textboxContent);if((null==i?void 0:i.subStoryProp)&&i.subStoryProp instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)){var o=i.subStoryProp;(o.textBoxType===g.Xbc.CodeBlock||o.has(g.kkf.getPropertyClass(g.uSS.CTTextBoxStoryPr).tKeys.language))&&(e="[代码块]"),o.textBoxType===g.Xbc.LightBlock&&(e="[高亮块]")}else e="[图形]"}return e},t.prototype.collectOutLineFromParaPropertyType=function(t){return t.pBdr.bottom?"[分割线]":""},t.prototype.getMainStoryRange=function(){var t=this.storyStream.getMainStoryInfo();return null==t?void 0:t.contentRange},t.prototype.isFieldCodeComplete=function(t){return t===g.IfD.FieldEnd},t.prototype.getParaCount=function(){var t=0,e=this.storyStream.getMainStoryInfo();if(null===e)return t;for(var r=this.textStream.createParagraphIterator(e.contentRange);r.next();)t+=1;return t},t.prototype.isParaCountMoreThan=function(t){var e=0,r=this.storyStream.getMainStoryInfo();if(null===r)return!1;for(var n=this.textStream.createParagraphIterator(r.contentRange);n.next();){if(e+1>t)return!0;e+=1}return!1},t.prototype.getTextFromGcpRange=function(t){return this.textStream.readText(t.begin(),t.length())},t.prototype.getTextStyleAtRange=function(t){var e=this.state.getTextStream().createRunIterator(t),r=[];do{var n=e.getCloneProperty();n&&r.push(n)}while(e.next());return r},t.prototype.nextTextBreak=function(t){return l._l.previousTextBreak(this.textStream,t)},t.prototype.previousTextBreak=function(t){return l._l.previousTextBreak(this.textStream,t)},t.prototype.getParaStyleAtRange=function(t,e){void 0===e&&(e=!1);var r=this.textStream.createParagraphIterator(t),n=this.state.dataEngine.getDataManager().getStyleSheetManager(),i=[];do{var o=r.getCloneProperty();o&&(o=e?n.mergeStyleParaPropWithGcp(o,t.begin()):o,i.push(o))}while(r.next());return i},t.prototype.getDocLength=function(){return this.textStream.getLength()},t.prototype.collectDiffRanges=function(){var t,e,r,n=this.textStream.createRunIterator(),i=[];do{var o=n.getRange(),a=n.getCloneProperty();if(a&&a.diff){var s=i[i.length-1];s&&s[0].end()===o.begin()&&(r=a,(e=t).diff&&e.diff===r.diff&&e.author===r.author)?s[0].len+=o.len:a.isPlaceholder&&(0,g.jUV)(this.textStream.charCodeAt(0))||(t=a,i.push([o,a.author]))}}while(n.next());return i},t.prototype.getPlaceholderGcp=function(t){var e;return null===(e=this.dataEngine.getDataStream().getDrawingStream().getDrawingInfoFromContentId(t))||void 0===e?void 0:e.range},t.prototype.generateStyleProperty=function(t,e){var r=this.state.dataEngine.getDataManager().getStyleSheetManager();return pe.generateStyleProperty(t,r,e)},Object.defineProperty(t.prototype,"storyId",{get:function(){return this.state.selection.subStoryInfo.subStoryProp.id},enumerable:!1,configurable:!0}),t.prototype.clearIteratorCache=function(){Ye.clearIteratorCache()},t.prototype.collectListInfo=function(t){var e=this.state.dataEngine.getDataManager().getNumberingManager();return(null==e?void 0:e.collectListInfo(t))||null},t.prototype.getDocumentEndPos=function(){var t=this.storyStream.getMainStoryInfo();return null===t?1:t.contentRange.end()-1},t.prototype.isSelectionAtTextFrame=function(t,e){var r=this.storyStream.getSubStoryInfoFromGcp(t);if(!r)return!1;var n=r.storyProp,i=r.subStoryProp,o=n.storyType===g.AHI.textboxContent,a=g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty);return e?o&&i instanceof a&&i.textBoxType===e:o&&i instanceof a},t.prototype.isSelectionAtCodeblock=function(t){return this.isSelectionAtTextFrame(t,g.Xbc.CodeBlock)},t.prototype.isSelectionAtLightblock=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(!e)return!1;var r=e.storyProp,n=e.subStoryProp;return r.storyType===g.AHI.textboxContent&&n instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)&&n.isLightBlock},t.prototype.getDocSettingsProperty=function(){return this.state.dataEngine.getDataManager().getSettingsManager().getDocSettingsProperty()},t.prototype.getConstraintSpace=function(){return this.state.context.constraintSpace},t.prototype.getSelectionFrameType=function(t){var e=this.storyStream.getSubStoryInfoFromGcp(t);if(e){var r=e.storyProp,n=e.subStoryProp;return r.storyType===g.AHI.textboxContent&&n instanceof g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty)?n.textBoxType:void 0}},t}(),yn=r(20113),vn=function(){function t(t,e){this._state=t,this._dataStream=this._state.getDataStream(),this.document=e}return t.prototype.getCheckText=function(){var t,e,r="",n=this._dataStream.getStoryStream().getMainStoryInfo();if(null===n)return"";var i=this._dataStream.getTextStream().createParagraphIterator(n.range);do{var a=i.getRange(),s=this.document.getRange(a.begin(),a.end(),{fixRange:!1}).getSpans();try{for(var l=(t=void 0,(0,o.__values)((0,o.__spreadArray)([],(0,o.__read)(s),!1))),c=l.next();!c.done;c=l.next()){var p=c.value,u=p.getRange(),g=this.document.getTextFromGcpRange(u),h=p.getFont().getAttributes(!1),d=this.isValid(g,h,u),f=d.translatable,y=d.preservable;f&&y&&(r+=g)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(e=l.return)&&e.call(l)}finally{if(t)throw t.error}}if((r+="\n").length>100){r=r.substring(0,100);break}}while(i.next());return r},t.prototype.insertSection=function(t,e,r,n){if(e&&r&&n){var i=u.C1.createServerDeltaOption(new g.ICE(t,0)).buildDelta();i.globalOpts.fromServer=!1,i.setUpdateSelection(!1),u.Gh.insertSection(i.currentRange().end(),e,n,r,i),this._state.applyDelta(i)}},t.prototype.insertParagraph=function(t,e){var r=u.C1.createLocalDeltaOption(new g.ICE(t,0)).buildDelta();r.setUpdateSelection(!1),this.buildDeltaTranslate(r,e);var n=r.currentRange().end();return this._state.applyDelta(r),n},t.prototype.deleteLastParaBreak=function(t){var e=u.C1.createLocalDeltaOption(new g.ICE(t,0)).buildDelta();return e.setUpdateSelection(!1),u.Gh.deleteText(new g.ICE(t,1),e),this._state.applyDelta(e),t},t.prototype.replaceDiff=function(t,e){var r=u.C1.createLocalDeltaOption(t).buildDelta();r.setUpdateSelection(!1),u.Gh.deleteText(t,r),this.buildDeltaTranslate(r,e),this._state.applyDelta(r)},t.prototype.isFieldBegin=function(t){return!(!t||t!==g.IfD.FieldBegin)},t.prototype.isFieldEnd=function(t){return!(!t||t!==g.IfD.FieldEnd)},t.prototype.isDrawingAnchor=function(t){return!(!t||t!==g.IfD.DrawingAnchor)},t.prototype.isTableCell=function(t){return!(!t||t!==g.IfD.TableCellBreak)},t.prototype.isTableRow=function(t){return!(!t||t!==g.IfD.TableRowBreak)},t.prototype.isTableStart=function(t){return!(!t||t!==g.IfD.TableStart)},t.prototype.isTableEnd=function(t){return!(!t||t!==g.IfD.TableEnd)},t.prototype.isParagraphEnd=function(t){return!(!t||t!==g.IfD.ParagraphBreak&&t!==g.IfD.ParagraphReturn)},t.prototype.isTextRun=function(t){return!(!t||!(0,g.b4K)(t))},t.prototype.isContainFieldCode=function(t){var e=Object.keys(g.Lpg),r=!1;return e.forEach((function(e){t.includes(e)&&(r=!0)})),r},t.prototype.getTableProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getTableInfo(t.begin()))||void 0===e?void 0:e.property)||new(g.kkf.getPropertyClass(g.uSS.TableProperty))},t.prototype.getTableRowProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getRowInfo(t.begin()))||void 0===e?void 0:e.property)||new(g.kkf.getPropertyClass(g.uSS.TableRowProperty))},t.prototype.getTableCellProperty=function(t){var e;return(null===(e=this._dataStream.getTableStream().getCellInfo(t.begin()))||void 0===e?void 0:e.property)||new(g.kkf.getPropertyClass(g.uSS.TableCellProperty))},t.prototype.getDrawingProperty=function(t){var e=g.vCY.findPlaceholderCharProperty(this._dataStream,t.begin());return e instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)?e:new(g.kkf.getPropertyClass(g.uSS.DrawingProperty))},t.prototype.buildDeltaTranslate=function(t,e){var r=this;e.forEach((function(n,o){var a=n.text,s=n.translateText,l=n.itemProp;if(l)if(r.isParagraphEnd(a)){var c=l.paragraphProp||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));u.Gh.insertParagraph(t.currentRange().end(),l.runProp,c,t)}else r.isTextRun(a)?u.Gh.insertText(t.currentRange().end(),i.StringUtil.isEmpty(s)?a:s,l.runProp,t):r.isTableStart(a)?u.Gh.insertTableStart(t.currentRange().end(),t,new(g.kkf.getPropertyClass(g.uSS.TableProperty))(l.contentProp),l.paragraphProp):r.isTableEnd(a)?(c=l.contentProp||new(g.kkf.getPropertyClass(g.uSS.TableProperty)),u.Gh.insertTableEnd(t.currentRange().end(),c,t,l.paragraphProp)):r.isTableRow(a)?(c=l.contentProp||new(g.kkf.getPropertyClass(g.uSS.TableRowProperty)),u.Gh.insertTableRow(t.currentRange().end(),c,t,l.paragraphProp)):r.isTableCell(a)?(c=l.contentProp||new(g.kkf.getPropertyClass(g.uSS.TableCellProperty)),u.Gh.insertTableCell(t.currentRange().end(),c,t,l.paragraphProp)):r.isFieldBegin(a)?r.insertField(e,t,o):r.isDrawingAnchor(a)&&(c=l.contentProp||new(g.kkf.getPropertyClass(g.uSS.DrawingProperty)),u.Gh.insertDrawing(t.currentRange().end(),c,t))}))},t.prototype.insertField=function(t,e,r){for(var n=r,i=new(g.kkf.getPropertyClass(g.uSS.FieldCharProperty));n<t.length;n++){var o=t[n],a=o.text,s=o.itemProp,l=o.translateText,c=o.translatable,p=s.runProp;if(a===g.IfD.FieldEnd){i.fldCharType=g.P1W.end,u.Gh.insertFieldChar(e.currentRange().end(),p,i,e);break}switch(a){case g.IfD.FieldBegin:i.fldCharType=g.P1W.begin,u.Gh.insertFieldChar(e.currentRange().end(),p,i,e);continue;case g.IfD.FieldSeparate:i.fldCharType=g.P1W.separate,u.Gh.insertFieldChar(e.currentRange().end(),p,i,e);continue;default:u.Gh.insertText(e.currentRange().end(),c?l:a,p,e)}}t.splice(r,n-r)},t.prototype.buildFieldText=function(t){return i.StringUtil.isEmpty(t.translateText)||this.isContainFieldCode(t.text)?t.text:t.translateText},t.prototype.isSpecialChar=function(t,e){if(t===g.IfD.Space||t===g.IfD.FullWidthSpace||t===g.IfD.ZeroSpace||t===g.IfD.NonBreakSpace||t===g.IfD.NoWidthOptionalBreak||t===g.IfD.NoWidthNoBreak||t===g.IfD.Tab)return!0;var r=t.codePointAt(0);return!(!r||!(0,yn.isExtPictographic)(r))||e.isPlaceholder&&!(0,g.b4K)(t)},t.prototype.isFieldCode=function(t,e){var r=this._state.dataEngine.getDataStream().getFieldStream();return!(!(null==r?void 0:r.isRangeInFieldCode(e))&&!(null==r?void 0:r.isRangeInFieldResult(e)))},t.prototype.isValid=function(t,e,r){return e instanceof g.kkf.getPropertyClass(g.uSS.RunProperty)&&(0===t.length||this.isSpecialChar(t,e)||this.isFieldCode(e,r))?{translatable:!1,preservable:!0,checkable:!1}:{translatable:!0,preservable:!0,checkable:!0}},t.prototype.getTranslateDeltaData=function(){var t=this._dataStream.getStoryStream().createStoryIterator().getRange();if(null===t)return null;var e=u.C1.createLocalDeltaOption(g.ICE.emptyRange(),!1,!1).buildDelta();return u.Me.collectDataToDelta(this._state.dataEngine,e,t),e},t}(),mn=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty)),Sn=function(){function t(t,e){var r=this;this.findListCache=new Map,this.templateLevelCache=new Map,this.onListModelChange=function(t){var e=r.numberingManager.getListInfoFromGcpRange(r.selection.range());if(e){var n=e.listId,i=r.deltaOption().buildDelta();i.setCommandType(u.wI.DocSetNumbering),r.forEachTemplates(n,(function(o){if(r.isSelectAllLevel||o.ilvl===e.listLevel){var a=g.g85.setLevelRunProperty(r.numberingManager.getNumberingProperty(),n,e.listLevel,t.listMarkerSpanProperty);return u.Gh.setSettingProperty(a,g.LK6.numbering,i),!r.isSelectAllLevel}return!1})),r.state.applyDelta(i)}},this.state=t,this.dataStream=this.state.dataEngine.getDataStream(),this.selection=e,this.numberingManager=t.dataEngine.getDataManager().getNumberingManager(),this.state.context.on(u.at.ListModelShouldChange,this.onListModelChange,this)}return Object.defineProperty(t.prototype,"selectionRange",{get:function(){return this.state.selection.gcpRange},enumerable:!1,configurable:!0}),t.prototype.deltaOption=function(t,e){return void 0===e&&(e=!1),u.C1.createLocalDeltaOption(t||this.selectionRange,e)},t.prototype.isSingleLevelList=function(t){return 1===this.numberingManager.getExistsListLevels(t.listId).length},t.prototype.createFindIterator=function(t,e){var r=this.dataStream.createDataIterator(),n=this.dataStream.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(n&&r.setLimitRange(n.range),e===c.Sd.Prev){r.seek(t.gcpBegin);var i=this.dataStream.getTextStream().readText(r.getRange().begin(),1);i&&pe.isTableSeperate(i)?r.seek(t.gcpBegin+1):r.seek(t.gcpBegin)}else r.seek(t.end()-(t.len>0?1:0));return r},t.prototype.matchType=function(t,e){return e.listType===t},t.prototype.matchStyle=function(t,e){return e.listFmt===t.listFormat&&e.lvlText===t.listText},t.prototype.matchTemplatesWithStylesetsAt=function(t,e,r){for(var n=0,i=r;i<t.length&&n<e.length;++i){var o=e[n];if(!o||t[i].numFmt.val!==o.listFormat||t[i].lvlText.val!==o.listText)return!1;n+=1}return n===e.length},t.prototype.matchFullStyleset=function(t,e){var r=String(e.listId),n=this.findListCache.get(r);if(void 0===n){var i=this.getTemplatesById(e.listId),o=this.matchTemplatesWithStylesetsAt(i,t,0);return this.findListCache.set(r,o),o}return n},t.prototype.matchPartialStyleset=function(t,e){var r="_".concat(e.listId),n=this.findListCache.get(r);if(void 0===n){for(var i=this.getTemplatesById(e.listId),o=0;o<g.keb.listLevelLimit-t.length;++o)if(this.matchTemplatesWithStylesetsAt(i,t,o))return this.findListCache.set(r,!0),!0;return this.findListCache.set(r,!1),!1}return n},t.prototype.createTraitPredicateMethod=function(t){var e=[];return void 0!==t.style&&e.push(this.matchStyle.bind(this,t.style)),void 0!==t.fullStyleset?e.push(this.matchFullStyleset.bind(this,t.fullStyleset)):t.partialStyleset&&e.push(this.matchPartialStyleset.bind(this,t.partialStyleset)),void 0!==t.type&&e.push(this.matchType.bind(this,t.type)),function(t){return e.every((function(e){return e(t)}))}},t.prototype.createCanMoveFunction=function(t,e,r){var n=e===c.Sd.Prev?function(){return t.prev(g.kbS.Paragraph)}:function(){return t.next(g.kbS.Paragraph)};return r?function(){for(;n();)if(r(t.getRange(g.kbS.Paragraph)))return!0;return!1}:n},t.prototype.unidirectionalFindList=function(t,e,r,n,i){var o=this.createTraitPredicateMethod(n),a=this.createFindIterator(t,e),s=this.createCanMoveFunction(a,e,i);if(!s())return null;do{var l=this.numberingManager.getListInfoFromGcpRange(a.getRange());if(l&&o(l))return l}while(s()&&r);return null},t.prototype.findList=function(t,e){this.findListCache.clear();for(var r=Array.isArray(e.crossParagraph)?e.crossParagraph:e.directions.map((function(){return!!e.crossParagraph})),n=0;n<e.directions.length;++n){var i=this.unidirectionalFindList(t,e.directions[n],!!r[n],e.traits,e.paragraphFilter);if(i)return i}return null},t.prototype.applyDelta=function(t,e){t.operations.length>0&&!e&&this.state.applyDelta(t)},t.prototype.getValidListOpRange=function(t){var e=this.dataStream.getStoryStream().getSubStoryInfoFromGcp(t.gcpBegin);if(!e)throw Error("invalid gcp range for list operation");return t.end()>e.range.end()?e.range.intersectRange(t):t},t.prototype.getParaStartTabNum=function(t){var e,r,n=this.dataStream.getTextStream().readText(t.begin(),t.len),i=0;try{for(var a=(0,o.__values)(n),s=a.next();!s.done&&"\t"===s.value;s=a.next())i+=1}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return i},t.prototype.deleteParaStartTab=function(t,e){var r=this.dataStream.getTextStream().createParagraphIterator(t),n=0;do{var i=r.getRange(),o=this.getParaStartTabNum(i),a=new g.ICE(i.begin()-n,o);n+=o,u.Gh.deleteText(a,e)}while(r.next())},t.prototype.createListInRange=function(t,e,r){void 0===r&&(r=!0);var n=this.getValidListOpRange(t),i=this.deltaOption(n).buildDelta();i.setCommandType(u.wI.DocModifyParagraphNumbering),i.globalOpts.undoOption.isUnMerge=r;var o=e.styleset;if(!(o.length<=0)){var a=this.createTemplatesFromStyleset(o,e.listLevelLimit,n),s=a.paragraphs,l=a.spans;if(s){var c=g.g85.createId(),p=g.g85.isTaskFormat(o[0].listFormat)&&o[0].listText===g.MJL.Done?g.RWe.done:g.RWe.todo;return this.insertListTemplates(c,s,i,l),this.setListParaPropsInRange(n,c,s[0],e.listLevelRule,p,i),this.deleteParaStartTab(n,i),this.applyDelta(i),i.operations.length>0?{listId:c,range:n}:void 0}}},t.prototype.createRootTemplateParagraphByIndents=function(t,e){void 0===e&&(e=0);var r=Number.MAX_SAFE_INTEGER;if(t){var n=this.dataStream.getTextStream().createParagraphIterator(t);do{var i=n.getCloneProperty(),o=n.getRange();if(i){if(i.numPr.isEmpty(g.kkf.getPropertyClass(g.uSS.CTNumPr).tKeys.numId)||this.isTaskList(i.numPr.numId)){var a=this.combineIndents(i,o),s=a.valueIndent||a.characterUnitIndent/g.jLu.indentChars*g.keb.fontSize;s+a.extraIndent<r&&(r=s+a.extraIndent)}}else r=0}while(n.next()&&r>0)}r===Number.MAX_SAFE_INTEGER&&(r=e);var l=new(g.kkf.getPropertyClass(g.uSS.CTLvlWml));return l.pPr.ind.hanging=g.keb.listDefaultHanging,l.pPr.ind.left=r+l.pPr.ind.hanging,l},t.prototype.createTemplatesFromStyleset=function(t,e,r){var n=this.createRootTemplateParagraphByIndents(r,t[0].listLeftIndent);n.ilvl=0,n.start=1,n.lvlJc=g.aLG.left;var i=(0,o.__read)(t,1)[0];n.numFmt.val=i.listFormat,(g.g85.isBulletFormat(i.listFormat)||g.g85.isTaskFormat(i.listFormat))&&g.g85.setSpanFont(n.rPr,"wingdings");var a=[];if(g.g85.isBulletFormat(i.listFormat)||g.g85.isNumberedFormat(i.listFormat)){n.lvlText.val=i.listText,void 0!==i.listHangingIndent&&(n.pPr.ind.left-=n.pPr.ind.hanging,n.pPr.ind.hanging=i.listHangingIndent,n.pPr.ind.left+=n.pPr.ind.hanging),a.push(n);for(var s=1;s<t.length;++s){var l=new(g.kkf.getPropertyClass(g.uSS.CTLvlWml));l.ilvl=s,l.start=1,l.lvlJc=g.aLG.left,l.numFmt.val=t[s].listFormat,l.lvlText.val=t[s].listText,l.pPr.ind.hanging=t[s].listHangingIndent||g.keb.listDefaultHanging,t[s].listLeftIndent&&(l.pPr.ind.left=n.pPr.ind.left-n.pPr.ind.hanging+(t[s].listLeftIndent-(t[0].listLeftIndent||0))+l.pPr.ind.hanging),a.push(l)}}else g.g85.isTaskFormat(i.listFormat)&&(n.numFmt.val=i.listFormat,n.lvlText.val=i.listText,a.push(n));return g.g85.completeListTemplateParagraphs(a[0],a,Math.min(e||g.keb.listLevelLimit,g.keb.maxSupportListLevelLimit)),{paragraphs:a,spans:void 0}},t.prototype.splitValidParaRange=function(t){var e=this,r=[];return u.Yy.splitCellRange(this.state.dataEngine.getDataStream().getTableStream(),t,(function(t){var n=e.dataStream.getTextStream().createParagraphIterator(t),i=e.dataStream.getTextStream().createRunIterator();do{var o=n.getRange();i.seek(o.end()-1);var a=e.dataStream.getTextStream().readText(o.begin(),1);a&&!pe.isTableSeperate(a)&&r.push(o)}while(n.next());return!0})),r},t.prototype.createListParaProperty=function(t,e,r,n){var i=mn.clone();return void 0!==e&&(i.numPr.numId=e),t.type===c.sy.absolute&&void 0!==t.value&&(i.numPr.ilvl=t.value),r&&(g.g85.isTaskFormat(r)?n&&(i.taskPr.taskState=n):i.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.taskPr)),i},t.prototype.getListLevelLimit=function(t){if(t){var e=this.templateLevelCache.get(t);if(void 0!==e)return e;var r=this.getRawTemplatesById(t),n=r.length>0?this.parseTemplateLeveLimit(r):g.keb.listLevelLimit;return this.templateLevelCache.set(t,n),n}return g.keb.listLevelLimit},t.prototype.getValidLevel=function(t,e){return Math.max(0,Math.min(t,e-1))},t.prototype.isTaskList=function(t){return this.numberingManager.getListTypeByListId(t)===g.RHh.Task},t.prototype.isParaHasNumPr=function(t){return t.numPr.isEmpty(g.kkf.getPropertyClass(g.uSS.CTNumPr).tKeys.ilvl)||t.numPr.isEmpty(g.kkf.getPropertyClass(g.uSS.CTNumPr).tKeys.numId)},t.prototype.setListParaPropsInRange=function(t,e,r,n,i,a){var s=this,l=a||this.deltaOption(this.selectionRange).buildDelta();l.setCommandType(u.wI.DocModifyParagraphNumbering);var p=g.g85.isTaskFormat(r.numFmt.val)?{type:c.sy.absolute,value:0}:(0,o.__assign)({type:c.sy.auto},n),h=this.createListParaProperty(p,e,r.numFmt.val,i),d=this.dataStream.getTextStream().createParagraphIterator();this.splitValidParaRange(t).forEach((function(t){var n=-1,i=-1;d.seek(t.gcpBegin);var o=d.getCloneProperty();if(o){var a=s.getListLevelLimit(e);if(p.type===c.sy.auto){if(s.isParaHasNumPr(o)||s.isTaskList(o.numPr.numId)){var f=s.combineIndents(o,t),y=f.valueIndent||f.characterUnitIndent/g.jLu.indentChars*g.keb.fontSize,v=r.pPr.ind.left-r.pPr.ind.hanging;i=s.getValidLevel(Math.floor(((y+f.extraIndent-v)/g.keb.fontSize+1)/2),a)}}else p.type===c.sy.relative&&p.value&&(n=o.numPr.ilvl,i=s.getValidLevel(n+p.value,a))}var m=h;if(i!==n&&((m=h.clone()).numPr.ilvl=i),!m.equalTo(mn)){var S=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));S.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.ind);var b={range:t,property:S,mode:g.XS7.Clean};u.Gh.setParagraphProperty(b,l),b.property=m,b.mode=g.XS7.Merge,b.property.ind=new(g.kkf.getPropertyClass(g.uSS.CTInd)),u.Gh.setParagraphProperty(b,l)}})),this.applyDelta(l,a)},t.prototype.replaceListInRange=function(t,e){var r=this.getTemplateById(e.listId,0);if(r){var n=this.getValidListOpRange(t),i=this.deltaOption().buildDelta();i.setCommandType(u.wI.DocModifyParagraphNumbering),i.globalOpts.undoOption.undoListener=e.notifyUndo,this.setListParaPropsInRange(n,e.listId,r,e.listLevelRule,void 0,i),this.applyDelta(i)}},t.prototype.getListUndoParaRange=function(){return this.selection.getParaRange(this.numberingManager.lastUpdateGcp-1)},t.prototype.replaceList=function(t,e,r){e.listId&&this.modifyListParaProps(t,e.listId,e.listLevelRule,r)},t.prototype.modifyListParaProps=function(t,e,r,n,i){var a=this,s=i||this.deltaOption(this.selectionRange).buildDelta();s.setCommandType(u.wI.DocModifyParagraphNumbering);var l=this.numberingManager.getWholeListByListId(t);if(l.length>0){var p=this.getListLevelLimit(l[0].listId),h=l[0].listId,d=(0,o.__assign)({type:c.sy.auto},r),f=this.createListParaProperty(d,e,l[0].listFmt),y=0;l.forEach((function(t){if(!n||n(t)){var e=new g.ICE(t.gcp-1,1),r=f;if(d.type===c.sy.relative&&d.value){var i=a.getValidLevel(t.listLevel+d.value,p);i!==t.listLevel&&((r=f.clone()).numPr.ilvl=i)}if(!r.equalTo(mn)){var o={range:e,property:r,mode:g.XS7.Merge};u.Gh.setParagraphProperty(o,s)}y+=1}})),this.numberingManager.getListsByListTemplateId(h).length===y&&this.removeTemplatesById(h,s)}this.applyDelta(s,i)},t.prototype.modifyListStyleset=function(t,e,r){var n=r||this.deltaOption(this.selectionRange).buildDelta();n.setCommandType(u.wI.DocModifyParagraphNumbering);var i=g.g85.getPeriodListStyleset(e),o=[];this.forEachTemplates(t,(function(t){var e=t.clone(),r=i[t.ilvl%i.length];return e.ilvl=t.ilvl,e.numFmt.val=r.listFormat,e.lvlText.val=r.listText,e.pPr.ind.left-=e.pPr.ind.hanging,e.pPr.ind.hanging=r.listHangingIndent||g.keb.listDefaultHanging,e.pPr.ind.left+=e.pPr.ind.hanging,void 0!==r.listLeftIndent&&(e.pPr.ind.left=r.listLeftIndent+e.pPr.ind.hanging),""!==e.rPr.rFonts.eastAsia&&"wingdings"!==e.rPr.rFonts.eastAsia||(g.g85.isBulletFormat(e.numFmt.val)||g.g85.isTaskFormat(e.numFmt.val)?g.g85.setSpanFont(e.rPr,"wingdings"):g.g85.setSpanFont(e.rPr,"")),o.push(e),!1}));var a=g.g85.insertLevelsType(new(g.kkf.getPropertyClass(g.uSS.NumberingProperty)),t,o);u.Gh.setSettingProperty(a,g.LK6.numbering,n),this.applyDelta(n,r)},t.prototype.modifyList=function(t,e,r){var n=e.styleset&&e.styleset.length>0;if(e.listLevelRule||n){var i=void 0,o=this.deltaOption().buildDelta();if(o.setCommandType(u.wI.DocModifyParagraphNumbering),(r||0===this.getRawTemplatesById(t).length)&&n){var a=this.getListLevelLimit(t),s=this.createTemplatesFromStyleset(e.styleset,a),l=s.paragraphs,c=s.spans;l&&(i=g.g85.createId(),this.insertListTemplates(i,l,o,c),this.modifyListParaProps(t,i,e.listLevelRule,r,o))}else e.listLevelRule&&this.modifyListParaProps(t,void 0,e.listLevelRule,r,o),n&&this.modifyListStyleset(t,e.styleset,o);return this.applyDelta(o),i}},t.prototype.combineIndents=function(t,e,r){var n=this.dataStream.getTextStream().createParagraphIterator(e),i=n.getRange(),a=this.getParaStartTabNum(i),s=g.keb.fontSize*a*2,l={valueIndent:Number(t.ind.left)-Number(t.ind.hanging),characterUnitIndent:t.ind.leftChars,extraIndent:s},c={valueIndent:Number(t.ind.hanging||t.ind.firstLine),characterUnitIndent:t.ind.hangingChars||t.ind.firstLineChars},p=(0,o.__assign)({ignoreHangingIndent:!0,characterUnit:!1},r);if(0===c.characterUnitIndent&&0===c.valueIndent)return l;if((t.ind.hanging>0||t.ind.hangingChars>0)&&p.ignoreHangingIndent)return l;var u=c.valueIndent;if(0!==c.characterUnitIndent){var h=this.dataStream.getTextStream().createRunIterator(e);h.seek(e.begin());var d=h.getProperty()||new(g.kkf.getPropertyClass(g.uSS.RunProperty)),f=n.getProperty()||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));u=((d=this.state.dataEngine.getDataManager().getStyleSheetManager().mergeStyleRunPropWithGcp(d,f,e.begin()))?Number(d.sz):g.keb.fontSize)*(c.characterUnitIndent/g.jLu.indentChars)}var y=l.valueIndent;return 0!==l.characterUnitIndent&&(y=g.keb.fontSize*(l.characterUnitIndent/g.jLu.indentChars)),p.characterUnit&&0===l.valueIndent?{characterUnitIndent:y+Math.abs(u/g.keb.fontSize)*g.jLu.indentChars,valueIndent:0,extraIndent:s}:{characterUnitIndent:0,valueIndent:y+Math.abs(u),extraIndent:s}},t.prototype.convertListIndentIntoParagraph=function(t,e,r){var n=this.numberingManager.getListInfoFromGcpRange(e);if(n){var i=this.combineIndents(n,e,{ignoreHangingIndent:r}),o=t;0!==i.characterUnitIndent&&(o.ind.leftChars=i.characterUnitIndent),o.ind.left=i.valueIndent}},t.prototype.cancelListParagraph=function(t,e,r){var n=e.getRange(),i=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));i.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.numPr),i.setNull(g.kkf.getPropertyClass(g.uSS.ParagraphProperty).tKeys.taskPr),this.convertListIndentIntoParagraph(i,n,t);var o={range:n,property:i,mode:g.XS7.Merge};u.Gh.setParagraphProperty(o,r)},t.prototype.insertListTemplates=function(t,e,r,n){if(Array.isArray(e)&&0!==e.length){n&&e.forEach((function(t,e){var r=(null==n?void 0:n[e])?n[e]:new(g.kkf.getPropertyClass(g.uSS.RunProperty));t.rPr=r}));var i=g.g85.insertLevelsType(new(g.kkf.getPropertyClass(g.uSS.NumberingProperty)),t,e);u.Gh.setSettingProperty(i,g.LK6.numbering,r)}},t.prototype.forEachTemplates=function(t,e){var r=this.numberingManager.getAbstractNumType(t);null==r||r.lvl.forEach((function(t){if(t instanceof g.kkf.getPropertyClass(g.uSS.CTLvlWml)&&e(t))return!0}))},t.prototype.parseTemplateLeveLimit=function(t){if(t.length<=0)return g.keb.listLevelLimit;var e=0;return t.forEach((function(t){var r=t.ilvl;r>e&&(e=r)})),e+1},t.prototype.getRawTemplatesById=function(t){var e=[];return this.forEachTemplates(t,(function(t){return e.push(t),!1})),e},t.prototype.getTemplateById=function(t,e){return this.numberingManager.getLevelType(t,e)},t.prototype.getTemplatesById=function(t){var e=this.getRawTemplatesById(t);if(e.length>0){if(g.g85.isTaskFormat(e[0].numFmt.val))return[e[0]];var r=this.parseTemplateLeveLimit(e);e.length>r&&(e=e.slice(0,r))}return e.sort((function(t,e){return t.ilvl-e.ilvl}))},t.prototype.removeTemplatesById=function(t,e){var r=g.g85.removeAbstractNumType(t,this.numberingManager.getNumberingProperty(!0));r&&u.Gh.setSettingProperty(r,g.LK6.numbering,e)},t.prototype.cancelListInRange=function(t,e){var r=this;void 0===e&&(e=!0);var n=this.getValidListOpRange(t),i=this.deltaOption(this.selectionRange,!1).buildDelta();i.setCommandType(u.wI.DocModifyParagraphNumbering);var o=new Map,a=this.dataStream.getTextStream().createParagraphIterator(n);do{var s=a.getProperty(),l=null==s?void 0:s.numPr.numId;if(l){this.cancelListParagraph(e,a,i);var c=o.get(l);o.set(l,void 0===c?1:c+1)}}while(a.next());return o.forEach((function(t,e){r.numberingManager.getListsByListTemplateId(e).length===t&&r.removeTemplatesById(e,i)})),this.applyDelta(i),n},t.prototype.cancelList=function(t,e){var r=this;void 0===e&&(e=!0);var n=this.deltaOption(this.selectionRange,!1).buildDelta();n.setCommandType(u.wI.DocModifyParagraphNumbering);var i=this.dataStream.getTextStream().createParagraphIterator(),a=this.numberingManager.getWholeListByListId(t);if(a.length>0){a.forEach((function(t){i.seek(t.gcp-1),r.cancelListParagraph(e,i,n)}));var s=(0,o.__read)(a,1)[0].listId;this.numberingManager.getListsByListTemplateId(s).length===a.length&&this.removeTemplatesById(s,n)}this.applyDelta(n)},t.prototype.addListTemplates=function(t,e,r,n){if(e.length>0&&!this.numberingManager.hasTemplate(t)){var i=r.currentRange();e.sort((function(t,e){return t.ilvl-e.ilvl}));var a=(0,o.__read)(e,1)[0];0===a.ilvl&&(g.g85.isTaskFormat(a.numFmt.val)?this.insertListTemplates(t,[a],r,n):(g.g85.completeListTemplateParagraphs(a,e),this.insertListTemplates(t,e,r,n)),this.templateLevelCache.set(t,e.length),r.moveTo(i))}},t.prototype.getListStyleset=function(t){var e=this.getTemplatesById(t);return e?e.map((function(t){return{listFormat:t.numFmt.val,listText:t.lvlText.val,listHangingIndent:Math.floor(t.pPr.ind.hanging),listLeftIndent:Math.floor(t.pPr.ind.left-t.pPr.ind.hanging||t.pPr.ind.leftChars/g.jLu.indentChars*g.keb.fontSize)}})):[]},t.prototype.setListMarkerSelection=function(t){this.isSelectAllLevel=void 0;var e=this.numberingManager.getListInfoFromGcpRange(this.selection.range());(null==e?void 0:e.listMarkerSpanProp)?(this.state.listMarkerSpanProp=e.listMarkerSpanProp,this.isSelectAllLevel=t):this.state.listMarkerSpanProp=null},t.prototype.clearListMarkerSelection=function(){this.isSelectAllLevel=void 0,this.state.listMarkerSpanProp=null},t.prototype.isLastParagraph=function(t){return!this.dataStream.getTextStream().createParagraphIterator(t).next()},t}(),bn=function(){function t(t,e){this._state=t,this._service=e}return t.prototype.replaceWithMarkdownFormat=function(t,e,r,n){var i=this.convertToMarkdown(t,e,r,n);i&&this._state.applyDelta(i)},t.prototype.convertToMarkdown=function(t,e,r,n,i){var o=null;switch(r){case c.og.Headline:o=this.replaceWithHeadlineFormat(t,e,n,i);break;case c.og.BulletList:o=this.replaceWithBulletList(t,e,i);break;case c.og.TaskList:o=this.replaceWithTaskList(t,e,n,i);break;case c.og.Codeblock:o=this.replaceWithCodeblock(t,n);break;case c.og.Horizontal:o=this.replaceWithHorizontal(t,e,n);break;case c.og.Quote:o=this.replaceWithQuoteFormat(t,e,n,i);break;case c.og.HighlightBlock:o=this.replaceWithLightblockFormat(t)}return o&&o.setUpdateSelection(!0),o},t.prototype._deltaOption=function(t,e){return void 0===e&&(e=!1),u.C1.createLocalDeltaOption(t,e)},t.prototype.replaceWithHeadlineFormat=function(t,e,r,n){var i=(null==n?void 0:n.externalDelta)||this._deltaOption(t).buildDelta();i.moveTo(new g.ICE(t.gcpBegin,0)),this._service.getDocument().getRange(t.gcpBegin,t.end()-1).setStyle(r,i);var o=new g.ICE(t.begin(),e);return u.Gh.deleteText(o,i),i.moveTo(new g.ICE(t.gcpBegin,0)),i},t.prototype.replaceWithCodeblock=function(t,e){var r=new g.ICE(t.begin(),t.length()+1),n=i.StringUtil.generateRandomId(),o=(0,g.EBh)({id:n,language:e.length?e:"plain text",theme:"normal",wordWrap:!0});if(!o)return null;var a={content:"",storyType:g.AHI.textboxContent,textboxStoryProperty:o},s=(0,g.DbJ)(n,this._service.getDocument().getRange(t.begin(),t.begin()).getSectionFormat().getContentWidth());return this._service.getDocument().getCodeblocks().addTextFrame(a,{textFrameProp:s,updateSelection:!0,spanStyle:"melo-codeblock-Base-theme-char",paraStyle:"melo-codeblock-Base-theme-para",range:r,selection:this._service.getSelection()}),null},t.prototype.replaceWithBulletList=function(t,e,r){if(Ct(this._service,t))return null;var n=$t.BulletCircle;return this.replaceWithList(t,e,n,g.RHh.Bullet,r)},t.prototype.replaceWithTaskList=function(t,e,r,n){if(Ct(this._service,t))return null;var i=r===g.MJL.Done,o=$t.TaskList;return this.replaceWithList(t,e,o,g.RHh.Task,n,i?g.RWe.done:g.RWe.todo)},t.prototype.replaceWithList=function(t,e,r,n,i,o){var a=i&&i.externalDelta||this._deltaOption(t).buildDelta();a.setCommandType(u.wI.DocModifyParagraphNumbering);var s=new ze(this._state,this._service),l={range:t,listType:n,listStyles:r},c=new Ke(this._state.context,this._state).findAuto(l);return s.setListInAutoFindResult(c,n,a,r,o),u.Gh.deleteText(new g.ICE(t.begin(),e),a),a},t.prototype.replaceWithHorizontal=function(t,e,r,n){var i=new g.ICE(t.begin(),e),o=tn.createStateRange(this._state,i),a=n&&n.externalDelta||this._deltaOption(t).buildDelta();return a.setCommandType(u.wI.DocInsertParagraph),u.Gh.deleteText(i,a),o.insertSplitline(r,g.keb.splitlineColor,g.keb.splitlineSize,a),a},t.prototype.replaceWithQuoteFormat=function(t,e,r,n){var i=n&&n.externalDelta||this._deltaOption(t).buildDelta();i.setCommandType(u.wI.DocModifyParagraphStyle),u.Gh.setRunProperty(t,pe.createClearRunProperty(),i,g.XS7.Merge);var o=new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));o.blockQuote=!0;var a={range:t,property:o,mode:g.XS7.Merge};u.Gh.setParagraphProperty(a,i);var s=new g.ICE(t.begin(),e);return u.Gh.deleteText(s,i),i},t.prototype.replaceWithLightblockFormat=function(t){var e=new g.ICE(t.begin(),t.length()+1),r=i.StringUtil.generateRandomId(),n=new(g.kkf.getPropertyClass(g.uSS.TextboxStoryProperty));n.id=r,n.wordWrap=!0,n.isCodeBlock=!1,n.isLightBlock=!0;var o={storyType:g.AHI.textboxContent,content:yr.PlaceholderChar.ParagraphReturn,textboxStoryProperty:n},a=this._service.getDocument().getRange(t.begin(),t.begin()).getSectionFormat().getContentWidth();return this._service.getTextframes().addTextFrame(o,{textFrameProp:(0,g.lU6)(n.id,a),updateSelection:!0,selection:this._service.getSelection(),range:e}),null},t}(),Cn=r(66611);!function(t){t[t.CommentRef=0]="CommentRef",t[t.CommentRange=1]="CommentRange",t[t.CommentContent=2]="CommentContent"}(ln||(ln={}));var Pn,Tn=function(){function t(t){this.state=t,this.historyCommentRange=new Map}return t.prototype.getHistoryRangeMap=function(t){return this.historyCommentRange.get(t)||new g.ICE},t.prototype.addComment=function(t,e,r,n){var i;if(r){var o=this.state.getStoryStream(),a=new l.wA(this.state.dataEngine,r),s=a.fixToValidCommentRange(r);s=a.trimSpecialPlaceholder(s);var c=this.deltaOption().buildDelta();c.setCommandType(u.wI.DocInsertComment),c.globalOpts.updateSelection=!1;var p=o.getStoryLastPos(g.AHI.commentContent);(null==n?void 0:n.isGlobal)?u.Gh.insertCommentStory(t,p,e,c):u.Gh.insertComment(t,p,e,s,c),null===(i=null==n?void 0:n.beforeApply)||void 0===i||i.call(n,c),this.state.applyDelta(c)}},t.prototype.updateComment=function(t,e,r){var n=this.deltaOption().buildDelta(),o=this.state.getStoryStream();n.setCommandType(u.wI.DocModifyComment),n.globalOpts.updateSelection=!1;var a=o.getSubStoryInfoFromId(r,g.AHI.commentContent);a?(a&&(u.Gh.deleteText(a.contentRange,n),u.Gh.updateCommentStory(t,a.range.begin(),e,n)),this.state.applyDelta(n)):i.Logger.error("can not find commentStoryInfo!")},t.prototype.modifyArchiveComment=function(t){var e=this.deltaOption().buildDelta(),r=this.state.getStoryStream();e.setCommandType(u.wI.DocModifyComment),e.globalOpts.updateSelection=!1;var n=r.getSubStoryInfoFromId(t.id,g.AHI.commentContent);n?(n&&u.Gh.modifyArchiveComment(t,n.range,e),this.state.applyDelta(e)):i.Logger.error("can not find commentStoryInfo!")},t.prototype.appendComment=function(t,e){var r,n=this.state.getDataStream().getAnnotationStream(),o=null===(r=n.getCommentRangeInfoFromId(t.refId))||void 0===r?void 0:r.refProp;if(o){var a=n.getCommentRangeInfoFromId(t.refId),s=null==a?void 0:a.refRange;if(s){var l=this.state.getStoryStream(),c=this.deltaOption().buildDelta();c.setCommandType(u.wI.DocInsertComment),c.globalOpts.updateSelection=!1;var p=l.getStoryLastPos(g.AHI.commentContent);u.Gh.appendComment(t,p,e,s,c,o),this.state.applyDelta(c)}else i.Logger.error("can not find comment ref!")}},t.prototype.deleteCommentFromAnchorId=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(u.wI.DocDeleteComment),this.collectCommentDeletionToDeltaByAnchorId(e,t),this.state.applyDelta(e)},t.prototype.deleteCommentFromStoryId=function(t){var e=this.state.getStoryStream().getSubStoryInfoFromId(t,g.AHI.commentContent);if(e){var r=e.subStoryProp;if(1===this.getCommentFromAnchorId(r.refId).length)this.deleteCommentFromAnchorId(r.refId);else{var n=this.deltaOption().buildDelta();n.setCommandType(u.wI.DocDeleteComment),u.Gh.deleteText(e.range,n),this.state.applyDelta(n)}}},t.prototype.isArchiveComment=function(t){return this.collectCommentSubStoryInfosById(t).every((function(t){return t.property.isArchive}))},t.prototype.isGlobalComment=function(t){return this.collectCommentSubStoryInfosById(t).every((function(t){return t.property.isGlobal}))},t.prototype.getCommentFromAnchorId=function(t){var e=this,r=this.collectCommentSubStoryInfosById(t);return r.forEach((function(r){e.historyCommentRange.set(t,r.range)})),r},t.prototype.getCommentFromStoryId=function(t){return this.state.getStoryStream().getSubStoryInfoFromId(t,g.AHI.commentContent)},t.prototype.collectCommentInfosFromGcpRanges=function(t){var e=this,r=Array.isArray(t)?t:[t];return(0,Cn.Z)(r.map((function(t){return e.collectComments(t)})))},t.prototype.updateCommentHeight=function(t){var e=this,r=this.deltaOption().buildDelta();r.globalOpts.updateSelection=!1,r.globalOpts.needCollab=!1,t.forEach((function(t){var n=t.range;e.state.getTextStream().readText(n.gcpBegin,n.len)===g.IfD.CommentReference&&u.Gh.updateCommentRef(t.property,t.range,r)})),this.state.applyDelta(r)},t.prototype.getCommentRefPropertyFromGcp=function(t){var e=g.vCY.findPlaceholderCharProperty(this.state.getDataStream(),t);return e instanceof g.kkf.getPropertyClass(g.uSS.CommentReferenceProperty)?e:null},t.prototype.getCommentRangeInfoByAnchorId=function(t){return this.state.getDataStream().getAnnotationStream().getCommentRangeInfoFromId(t)},t.prototype.collectCommentSubStoryInfosById=function(t){var e,r=this.state.getStoryStream(),n=this.state.getTextStream(),i=this.state.getFieldStream(),o=r.createSubStoryIterator({storyType:g.AHI.commentContent}),a=new Set(Array.isArray(t)?t:[t]),s=new Map,l=function(){var t=o.getCloneProperty();if(t instanceof g.kkf.getPropertyClass(g.uSS.CommentStoryProperty)&&a.has(t.refId)){for(var e=t.refId,r=o.getRange(!0),l=o.getContentRange(!0),c=[],p=i.createFieldIterator({limitRange:l}),h=[];p.hasNext();){var d=p.getRange(!0);h.push(d),p.next()}h.length>0?(0,u.Ao)(l,h,[],c,n):c.push({text:n.readText(l.begin(),l.len)});var f=c.map((function(t,e){return c.length-1===e&&(t.text=t.text.trim()),t})).filter((function(t){return t.text})),y={range:r,property:t,contentRange:l,text:JSON.stringify(f)};s.has(e)?s.get(e).push(y):s.set(e,[y])}};do{l()}while(o.hasNext()&&o.next());return Array.isArray(t)?t.map((function(t){var e;return null!==(e=s.get(t))&&void 0!==e?e:[]})):null!==(e=s.get(t))&&void 0!==e?e:[]},t.prototype.collectCommentSubStoryInfosByRange=function(t){var e=this.state.getAnnotationStream().collectCommentRangeInfoFromRange(t),r=[];return e.forEach((function(e){t.contains(e.refRange)&&r.push(e.refProp.id)})),(0,Cn.Z)(this.collectCommentSubStoryInfosById(r))},t.prototype.collectComments=function(t){return this.state.getDataStream().getAnnotationStream().collectCommentRangeInfoFromRange(t)},t.prototype.collectCommentDeletionToDeltaByAnchorId=function(t,e,r){void 0===r&&(r={deleteCommentRef:!0,deleteCommentRange:!0,deleteCommentContent:!0});var n=this.state.getAnnotationStream().getCommentRangeInfoFromId(e);if(n){var i=r.deleteCommentRef,a=r.deleteCommentRange,s=[];if(r.deleteCommentContent){var l=this.collectCommentSubStoryInfosById(e);s.push.apply(s,(0,o.__spreadArray)([],(0,o.__read)(l.map((function(t){return{commentPart:ln.CommentContent,range:t.range}}))),!1))}i&&s.push({commentPart:ln.CommentRef,range:n.refRange}),a&&s.push({commentPart:ln.CommentRange,range:n.annotationRange}),s.sort((function(t,e){return t.range.lessThan(e.range)?1:-1})),s.forEach((function(r){r.commentPart!==ln.CommentRange?u.Gh.deleteText(r.range,t):u.Gh.deleteComment(r.range,e,t)}))}},t.prototype.deltaOption=function(){return u.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t}(),Rn=r(80491),_n=function(){function t(t){this._state=t}return t.prototype.getFontNamesCache=function(){return this._state.getDataStream().getFontNamesCache()},t.prototype.clearFontNamesCache=function(){this._state.getDataStream().clearFontNamesCache()},t.prototype.invalidateMeasureCache=function(t){Rn.dp.getDefaultEngine().invalidateMeasureCache(t)},t}(),In=function(){function t(t){this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return u.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.addQuote=function(t,e){var r=new l.wA(this.state.dataEngine,t).fixToValidDeleteRange(t),n=this.deltaOption().buildDelta();n.setCommandType(u.wI.DocInsertQuote),u.Gh.insertQuote(r,e,n),this.state.applyDelta(n)},t.prototype.deleteQuote=function(t){var e=this.getQuoteRangeById(t);if(e){var r=e.annotationRange,n=new l.wA(this.state.dataEngine,r).fixToValidDeleteRange(r),i=this.deltaOption().buildDelta();i.setCommandType(u.wI.DocDeleteQuote),u.Gh.deleteQuote(n,t,i),this.state.applyDelta(i)}},t.prototype.getQuoteRangeById=function(t){return this.annotationStream.getQuoteRangeInfoFromId(t)},t}(),wn=function(){function t(t){this.isMemberInRangeId=function(){return!0},this.isDocumentOwner=function(){return!1},this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return u.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.setIsMemberInRange=function(t){this.isMemberInRangeId=t},t.prototype.setIsDocumentOwner=function(t){this.isDocumentOwner=t},t.prototype.addPermissionRange=function(t,e){this.addPermissionRanges([{range:t,rangeId:e}])},t.prototype.addPermissionRanges=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(u.wI.DocInsertPermission),this.buildAddPermissionRangeDelta(t,e),this.state.applyDelta(e)},t.prototype.deletePermissionRange=function(t){this.deletePermissionRanges([t])},t.prototype.deletePermissionRanges=function(t){var e=this.deltaOption().buildDelta();e.setCommandType(u.wI.DocDeletePermission),e.globalOpts.updateSelection=!1,this.buildDeletePermissionRangeDelta(t,e),this.state.applyDelta(e)},t.prototype.getPermissionRangeById=function(t){return this.annotationStream.getPermissionRangeInfoFromId(t)},t.prototype.getPermissionRangesByGcpPoint=function(t){return this.annotationStream.collectPermissionRangeInfoFromGcp(t)},t.prototype.getPermissionRangesByGcpRange=function(t){return this.annotationStream.collectPermissionRangeInfoFromRange(t)},t.prototype.getPermissionRangeIdsByGcpRange=function(t){return this.getPermissionRangesByGcpRange(t).map((function(t){return t.rangeProp.id}))},t.prototype.hasPermissionRangeByGcpPoint=function(t){return this.annotationStream.collectPermissionRangeInfoFromGcp(t).length>0},t.prototype.checkPermissionRangeByGcpRange=function(t){var e,r=this;if(!this.state.context.usePermissionRangeMode()||this.isDocumentOwner())return!0;var n=t,i=this.state.getStoryStream().getSubStoryInfoFromGcp(t.begin());if(i){var o=this.state.getDrawingStream().getDrawingInfoFromContentId(i.subStoryProp.id);n=null!==(e=null==o?void 0:o.range)&&void 0!==e?e:t}var a=!1;return this.annotationStream.forEachPermissionRange(n,(function(t){return a=!r.isMemberInRangeId(t.rangeProp.id)})),!a},t.prototype.checkPermissionRange=function(){var t=this.state.context.service.getSelection().range();return this.checkPermissionRangeByGcpRange(t)},t.prototype.buildAddPermissionRangeDelta=function(t,e){return t.forEach((function(t){var r=t.range,n=t.rangeId;u.Gh.insertPermissionRange(r,n,e)})),e},t.prototype.buildDeletePermissionRangeDelta=function(t,e){var r=this;return t.forEach((function(t){var n=r.getPermissionRangeById(t);if(n){var i=n.annotationRange;i&&u.Gh.deletePermissionRange(i,t,e)}})),e},t}(),xn=function(){function t(t){this.bookmarkInfos=[],this.state=t,this.annotationStream=this.state.getDataStream().getAnnotationStream()}return t.prototype.deltaOption=function(){return u.C1.createLocalDeltaOption(this.state.selection.gcpRange)},t.prototype.addBookmark=function(t,e){if(this.isBookmarkExist(t))return!1;var r=this.deltaOption().buildDelta();r.setCommandType(u.wI.DocInsertBookmark);var n=new l.wA(this.state.dataEngine,e).fixToValidDeleteRange(e),o=i.StringUtil.generateRandomId();return u.Gh.insertBookmark(n,o,t,r),this.state.applyDelta(r),!0},t.prototype.deleteBookmark=function(t){var e=this.getBookmarkIdByName(t);if(e){var r=this.getBookmarkInfo(t);if(r){var n=r.annotationRange,i=new l.wA(this.state.dataEngine,n).fixToValidRange(n),o=this.deltaOption().buildDelta();o.setCommandType(u.wI.DocDeleteBookmark),u.Gh.deleteBookmark(i,e,t,o),this.state.applyDelta(o)}}},t.prototype.getBookmarkInfo=function(t){var e=this.getBookmarkIdByName(t);return e?this.annotationStream.getBookmarkRangeInfoFromId(e):null},t.prototype.collectAllBookmarks=function(){var t,e=new g.ICE(0,null===(t=this.state.context)||void 0===t?void 0:t.service.getDocument().getDocLength());this.bookmarkInfos=this.annotationStream.collectBookmarkRangeInfoFromRange(e)},t.prototype.getAllBookmarks=function(){return this.bookmarkInfos},t.prototype.getHiddenBookmarks=function(){return this.bookmarkInfos.filter((function(t){return t.rangeProp.name.startsWith("_")}))},t.prototype.gotoBookmark=function(t,e){void 0===e&&(e=!0);var r=new g.ICE(0,0),n=this.getBookmarkInfo(t);if(n){var i=n.annotationRange;r=new g.ICE(i.begin(),e?i.length():0)}this.state.setRangeTo(r,{forceFocus:!0,noSendCaret:!0,scrollToView:u.hF.NearTop})},t.prototype.isBookmarkExist=function(t){return void 0!==this.getBookmarkIdByName(t)},t.prototype.addBookmarkInRange=function(t,e,r){var n=new g.ICE(e,r);this.addBookmark(t,n)},t.prototype.getBookmarkIdByName=function(t){var e,r=this.bookmarkInfos.find((function(e){return e.rangeProp.name===t}));return null===(e=null==r?void 0:r.rangeProp)||void 0===e?void 0:e.id},t}(),En=function(){function t(t){this._state=t}var e;return t.prototype.getSelection=function(){return this._selection||(this._selection=new rn(this._state)),this._selection},t.prototype.getDocument=function(){return this._document||(this._document=new fn(this._state)),this._document},t.prototype.getTranslate=function(){return this._translate||(this._translate=new vn(this._state,this.getDocument())),this._translate},t.prototype.getTextframes=function(){return this._textframes||(this._textframes=new vr(this._state)),this._textframes},t.prototype.getNumbering=function(){return this._numbering||(this._numbering=new Sn(this._state,this.getSelection())),this._numbering},t.prototype.getMarkdown=function(){return this._markdown||(this._markdown=new bn(this._state,this)),this._markdown},t.prototype.getComment=function(){return this._comment||(this._comment=new Tn(this._state)),this._comment},t.prototype.getFontService=function(){return this._fontService||(this._fontService=new _n(this._state)),this._fontService},t.prototype.getQuote=function(){return this._quote||(this._quote=new In(this._state)),this._quote},t.prototype.getBookmark=function(){return this._bookmark||(this._bookmark=new xn(this._state)),this._bookmark},t.prototype.getPermissionRange=function(){return this._permissionRange||(this._permissionRange=new wn(this._state)),this._permissionRange},t=(0,o.__decorate)([(0,o.__param)(0,l.yg),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==l.ZM&&l.ZM)?e:Object])],t)}(),Dn=function(t){t.factory.inject(c.vH,(0,p.vM)(En))},kn=r(87363),Ln=r.n(kn),An="melo-caret",Fn=function(t,e){this.current=t,this.zoom=e},Mn=Math.min,On=function(t){function e(e,r){return t.call(this,e,r)||this}return(0,o.__extends)(e,t),e.prototype.calculate=function(){var t=this.findFollowInCurrentParagraph(),e=this.italicOf(t),r=Mn(this.caretHeightOf(t),this.lineHeight()),n=this.determineBottom(t)-r;return{x:this.xOf(this.current),y:n,height:r,italic:e}},e.prototype.determineBottom=function(t){if(!this.inSameLine(t,this.current)){var e=this.findFollowInCurrentLine();return e?this.caretHeightOf(e)>this.caretHeightOf(t)?this.bottomOf(e)-.22*this.caretHeightOf(e)+.22*this.caretHeightOf(t):this.bottomOf(e):this.bottomOfCurrentLineBox()}return this.bottomOf(t)},e.prototype.lineHeight=function(){return(0,i.twipsToPx)(this.getParentLineBox(this.current).rect.height)},e.prototype.getParentLineBox=function(t){for(var e=t.leafBox;e&&!(0,c.o7)(e);)e=e.parentBox;return e},e.prototype.findFollowInCurrentParagraph=function(){return(0,M.$Zc)(this.current,!1)},e.prototype.findFollowInCurrentLine=function(){var t=(0,M.$Zc)(this.current,!0);return(0,c.NF)(t.leafBox)?t:null},e.prototype.inSameLine=function(t,e){return this.getParentLineBox(t)===this.getParentLineBox(e)},e.prototype.caretHeightOf=function(t){return t.caretHeight(this.zoom)},e.prototype.xOf=function(t){return t.getDocumentOffset(this.zoom).x},e.prototype.yOf=function(t){var e=t.getDocumentOffset(this.zoom).y;return(0,c.NF)(t.leafBox)&&this.isScript(t.leafBox)?(0,i.twipsToPx)(M.d_x.textBoxVerticalAlignAdapter(t.leafBox,(0,i.pxToTwips)(e))):e},e.prototype.isScript=function(t){return[g.TBk.superscript,g.TBk.subscript].indexOf(t.textStyle.vertAlign)>=0},e.prototype.bottomOf=function(t){return this.yOf(t)+this.caretHeightOf(t)},e.prototype.bottomOfCurrentLineBox=function(){var t=this.getParentLineBox(this.current),e=cr.MM.getOffsetPoint(t,c.uO.Document).y;return(0,i.twipsToPx)(e+t.rect.height)},e.prototype.italicOf=function(t){return!!(0,c.NF)(t.leafBox)&&t.leafBox.textStyle.i},e}(Fn),Bn=function(t){function e(e,r,n){var i=t.call(this,e,r)||this;return i.selection=n,i}return(0,o.__extends)(e,t),e.prototype.calculate=function(){var t=(0,M.$Zc)(this.current),e=t.getDocumentOffset(this.zoom);return{x:e.x,y:e.y,height:t.caretHeight(this.zoom),italic:!!this.selection.getFont().isItalic()}},e}(Fn),Nn=function(t){function e(e){var r=t.call(this,e)||this;return r.timeout=0,r.viewRange=null,r.onCaretShow=function(){return r.setState({isShown:!0})},r.onCaretHidden=function(){return r.setState({isShown:!1})},r.caretChange=function(t){var e;(null===(e=r.props.context.surface)||void 0===e?void 0:e.isEditable())&&(r.update(t.viewRange),r.setState({isBlink:!0}))},r.hexToRgb=function(t){var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},r.rgbToHsv=function(t){var e=t.r,r=t.g,n=t.b,i=Math.max(e,r,n),o=Math.min(e,r,n),a=i-o,s=0,l=0===i?0:a/i,c=i/255;switch(i){case o:s=0;break;case e:s=r-n+a*(r<n?6:0),s/=6*a;break;case r:s=n-e+2*a,s/=6*a;break;case n:s=e-r+4*a,s/=6*a}return{h:s,s:l,v:c}},r.state={posX:0,posY:0,caretHeight:0,isCaret:!0,isBlink:!1,focus:!1,exceeded:!1,caretItalic:c.Jj.Undefined,blockCaretShow:!1,darkBackground:!1,isShown:!0},r}return(0,o.__extends)(e,t),e.prototype.shouldComponentUpdate=function(t,e){return this.state.focus||e.focus},e.prototype.componentDidMount=function(){this.props.context.on(c.Dk.ON_POS_UPDATE,this.onPosUpdate,this),this.props.context.on(M.cbw.ON_FOCUS,this.onFocus,this),this.props.context.on(M.cbw.ON_BLUR,this.onBlur,this),this.props.context.on(M.kgn.TABLE_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(M.kgn.TEXTFRAME_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(c.GP.ON_DRAG,this.onCaretDrag,this),this.props.context.once(M.kgn.CARET_CHANGE,this.caretChange),this.props.context.on(u.at.CusorPropChange,this.updateCaretItalic,this),this.props.context.on(M.Lll.HIDDEN,this.onCaretHidden),this.props.context.on(M.Lll.SHOW,this.onCaretShow)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.Dk.ON_POS_UPDATE,this),this.props.context.removeListener(M.cbw.ON_FOCUS,this),this.props.context.removeListener(M.cbw.ON_BLUR,this),this.props.context.removeListener(M.kgn.TABLE_DID_SCROLL,this),this.props.context.removeListener(M.kgn.TEXTFRAME_DID_SCROLL,this),this.props.context.removeListener(c.GP.ON_DRAG,this),this.props.context.removeCallBack(M.kgn.CARET_CHANGE,this.caretChange),this.props.context.removeCallBack(u.at.CusorPropChange,this.updateCaretItalic),this.props.context.removeCallBack(M.Lll.HIDDEN,this.onCaretHidden),this.props.context.removeCallBack(M.Lll.SHOW,this.onCaretShow)},e.prototype.componentDidUpdate=function(){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout((function(){t.isVisible()&&t.setState({isBlink:!0})}),500)},e.prototype.onPosUpdate=function(t){t&&t.data instanceof M.rOq&&(this.viewRange=t.data,this.update(t.data))},e.prototype.onCaretDrag=function(t){t&&(t.dragAction===c.Zk.START_DRAG?this.setState({blockCaretShow:!0}):(t.dragAction,c.Zk.END_DRAG,this.setState({blockCaretShow:!1})))},e.prototype.isCursorExceedEditRange=function(t,e,r){var n=t.getDocumentOffset(this.props.zoom()||1),i=n.docWidth,o=n.docHeight;return this.isCursorExceedEditRangeInPc(e,r,i,o)},e.prototype.isCursorExceedEditRangeInMobile=function(t,e,r,n){return t<0||t>r||e<0||e>n},e.prototype.isCursorExceedEditRangeInPc=function(t,e,r,n){var o=this.props.context;if(this.props.service.getSelection().isInTable())return this.isCursorExceedTable();var a=M.d_x.findRootContainerBox(o.getDocumentBox());if(a){var s=0,l=0,c=a.edge.padding,p=c.left,u=c.right;if(this.props.service.getSelection().isSelectionAtCodeblock())return s=Math.floor((0,i.twipsToPx)(p)),l=Math.floor((0,i.twipsToPx)(u)),t<s||t>r-l||e<0||e>n}return!1},e.prototype.isCursorExceedTextFrame=function(t){if(!(t instanceof M.SE$))return!1;var e=t.leafBox,r=e.getAncestorOf(c.uO.TextFrame);if(!(0,c.tJ)(r))return!1;var n=cr.MM.getOffsetPoint(e,c.uO.TextFrame),o=this.props.context.view.getRenderState(),a=(0,M.UY)(r,o),s=r.getOriginSizeBox().rect,l=s.width,p=s.height,u=n.x,g=n.y;return u<0||u-(0,i.pxToTwips)(a.left)>l||g<0||g>p},e.prototype.isCursorExceedTable=function(){var t=this.getTableScrollInfo();if(!t)return!1;var e=t.tableScrollLeft,r=t.tableContainerWidth,n=this.getPointOffsetInTable();return null!==n&&(n<e||n>e+r)},e.prototype.getTableScrollInfo=function(){var t,e=null===(t=this.viewRange)||void 0===t?void 0:t.start;if(!e||!(0,c.Dy)(e.leafBox))return null;var r=cr.s9.getOutestTableBox(e.leafBox);if(!r)return null;var n=this.props.context,o="table-".concat(r.tableId),a=n.view.getRenderState().getScrollerInfo(o);return a?{tableScrollLeft:(0,i.pxToTwips)(a.left),tableContainerWidth:r.rectSize.width}:null},e.prototype.getPointOffsetInTable=function(){var t,e=null===(t=this.viewRange)||void 0===t?void 0:t.start;if(!e||!(0,c.Dy)(e.leafBox))return null;var r=e.leafBox,n=this.props.zoom()||1,o=e.leafBoxOffset(n);return void 0===o?null:cr.MM.getBoxOffset(r,(function(t){return(0,c.YP)(t)&&t.nestingLevel===g.AQ})).x+(0,i.pxToTwips)(o)},e.prototype.update=function(t){var e,r;if((null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable())&&t.isCaret()){var n=this.adjustToGcpBorder(t.start),i=this.props.zoom()||1,o=(n instanceof M.SE$?new On(n,i):new Bn(n,i,this.props.service.getSelection())).calculate(),a=o.x,s=o.y,l=o.height,c=o.italic||!!(null===(r=this.props.context.state.cusorSpanProp)||void 0===r?void 0:r.i);if(this.isCursorExceedEditRange(n,a,s)||this.isCursorExceedTextFrame(n))this.setState({exceeded:!0,isBlink:!1});else{var p=this.applyContextPadding(a,s),u=p.posX,g=p.posY;this.setState({posX:u,posY:g,caretHeight:l,isCaret:t.isCaret(),isBlink:!1,exceeded:!1,caretItalic:c&&!0,darkBackground:this.isDarkBackground()})}}else this.setState({isCaret:!1,isBlink:!1})},e.prototype.updateCaretItalic=function(){var t=this.props.service.getSelection().getFont().isItalic();this.setState({caretItalic:t&&!0})},e.prototype.adjustToGcpBorder=function(t){if(!(t instanceof M.SE$))return t;var e=t.leafBox.parentBox;if(!(0,c.tq)(e))return t;var r=0===t.charsOffset?e.firstChild:e.lastChild;return new M.SE$(r,t.charsOffset,t.gcp)},e.prototype.applyContextPadding=function(t,e){var r=this.props.context.view.getPadding();return{posX:t+r.left,posY:e+r.top}},e.prototype.onFocus=function(){var t,e;if(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable()){var r=this.props.service.getSelection().getStart(),n=this.props.service.getSelection().getEnd();this.setState({focus:!0,isBlink:!1,isCaret:!!(null===(e=this.viewRange)||void 0===e?void 0:e.isCaret())&&r===n})}},e.prototype.onBlur=function(){this.setState({focus:!1,isBlink:!1})},e.prototype.getTransform=function(){return this.state.caretItalic?i.PlatformUtil.isIE()||i.PlatformUtil.isWeWorkWin()?"rotate(19deg)":"rotate(13deg)":""},e.prototype.getTransformOrigin=function(){return this.state.caretItalic?"right 80%":"center center"},e.prototype.isVisible=function(){return this.state.isCaret&&this.state.focus&&!this.state.exceeded&&!this.state.blockCaretShow&&this.state.isShown&&!this.props.context.state.listMarkerSpanProp&&this.props.service.getPermissionRange().checkPermissionRange()},e.prototype.isDarkBackground=function(){var t=this.props.service.getSelection().getFont().getTextFillColor().toString();if(this.isColorDark(g.QBv.parseHexColor(t,g.keb.bgColor)))return!0;var e=this.props.service.getSelection().getTableSelectionService();if(!e)return!1;var r=this.props.service.getSelection().getRange().range().gcpBegin,n=e.getCellProperty(r);return!!n&&this.isColorDark(g.QBv.parseShadingProperties(n.shd,g.keb.bgColor))},e.prototype.isColorDark=function(t){if("transparent"===t)return!1;var e=new RegExp("([0-9｜A-F｜a-f]{6})").exec(t);if(e){var r=(0,o.__read)(e,2),n=(r[0],r[1]);return(a=this.rgbToHsv(this.hexToRgb(n))).v<.5||a.h>.5&&a.s>.5}var i=new RegExp("rgb\\((\\d{1,3})\\,\\s*(\\d{1,3})\\,\\s*(\\d{1,3})\\)").exec(t);if(i){var a,s=(0,o.__read)(i,4),l=(s[0],s[1]),c=s[2],p=s[3];return(a=this.rgbToHsv({r:parseInt(l,10),g:parseInt(c,10),b:parseInt(p,10)})).v<.5||a.h>.5&&a.s>.5}return!1},e.prototype.onComponentScroll=function(){var t=this;this.setState({blockCaretShow:!0,exceeded:!1}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,i.debounce)((function(){t.setState({blockCaretShow:!1}),t.viewRange&&t.isVisible()&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update(t.viewRange))}),500)),this.onComponentScrollTimeout()},e.prototype.render=function(){var t=[An],e=!this.props.context.isInBlockState()&&this.isVisible();return this.state.isBlink&&!this.state.blockCaretShow&&(this.state.darkBackground?t.push("melo-caret-blink-white"):t.push("melo-caret-blink-transparent")),Ln().createElement("div",{className:t.join(" "),style:{position:"absolute",height:this.state.caretHeight,width:"".concat(1,"px"),left:this.state.posX-.5,top:this.state.posY,display:e?"block":"none",backgroundColor:g.keb.caretColor,transform:this.getTransform(),transformOrigin:this.getTransformOrigin()}})},e}(Ln().Component),Hn="melo-hidden-editor",Wn="melo-hidden-editor-mobile",Gn=function(t){function e(e){var r=t.call(this,e)||this;return r.isFocus=!1,r.inputDomRef=null,r.compositionId="",r.viewRange=null,r.forceFocus=!0,r.spaceReg=new RegExp(g.IfD.NonBreakSpace,"g"),r.caretChangedCompositionId="",r.isWindows=!1,r.props.viewRange&&(r.viewRange=r.props.viewRange),r.state={posX:0,posY:0},r.isWindows=i.PlatformUtil.isWindows(),r.contentEditable=i.PlatformUtil.isSafari()||i.PlatformUtil.isMac()&&(i.PlatformUtil.isTencentDocsDesktopApp()||i.PlatformUtil.isWeWork())?"plaintext-only":"true",r}return(0,o.__extends)(e,t),e.prototype.componentDidMount=function(){var t,e=this;this.props.context.on(c.V6.MOUSE_EVENT,this.onMouseEvent,this),this.props.context.on(M.kgn.CARET_CHANGE,this.onSelectionChanged,this),setTimeout((function(){e.viewRange&&(e.forceFocus=!0,e.update())}));var r=document.createEvent("CustomEvent");r.initCustomEvent("performance_edit_hidden_input_inited",!0,!0,{}),document.dispatchEvent(r),t=(0,o.__read)([this.onInput,this.onCompositionStart,this.onKeyDown].map((function(t){return function(r){return(0,o.__awaiter)(e,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){return this.props.context.usePermissionRangeMode()?(this.props.service.getPermissionRange().checkPermissionRange()?t.call(this,r):this.inputDomRef&&(this.inputDomRef.textContent=""),[2]):(t.call(this,r),[2])}))}))}})),3),this.onInput=t[0],this.onCompositionStart=t[1],this.onKeyDown=t[2]},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.V6.MOUSE_EVENT,this),this.props.context.removeListener(M.kgn.CARET_CHANGE,this)},e.prototype.isEditingField=function(){var t,e=this.props.context.service.getDocument().getTextFromGcpRange(this.props.context.service.getSelection().range()),r=g.BqD.decodeFieldCode(e);if(!r)return!1;var n=g.YU5.getInstance().getFieldProcessorByFieldCodeInfo(r);return null!==(t=null==n?void 0:n.isProhibitForcesFocus(e,r,this.props.context.uuid))&&void 0!==t&&t},e.prototype.componentDidUpdate=function(){this.isEditingField()||(this.isFocus||this.forceFocus)&&this.setFocus()},e.prototype.onMouseEvent=function(t){!t||t.mouseAction!==c.oX.CLICK&&t.mouseAction!==c.oX.DOUBLE_CLICK&&t.mouseAction!==c.oX.TRIPLE_CLICK&&t.mouseAction!==c.oX.LONG_CLICK||(this.forceFocus=!0,this.update())},e.prototype.onSelectionChanged=function(t){var e;if(t.viewRange){if(this.caretChangedCompositionId.length>0&&this.caretChangedCompositionId===this.compositionId&&t.option&&!0===t.option.forceNotify)return;this.viewRange=t.viewRange,this.forceFocus=!!(null===(e=t.option)||void 0===e?void 0:e.forceFocus),this.update()}},e.prototype.requestFocus=function(t){t&&(this.viewRange=t),this.forceFocus=!0,this.update(),this.props.context.fire(new M.D_l(M.cbw.ON_REQUEST_FOCUS,t))},e.prototype.requestBlur=function(){this.inputDomRef&&this.inputDomRef.blur(),this.props.context.fire(new M.D_l(M.cbw.ON_REQUEST_BLUR))},e.prototype.setFocus=function(){var t=this.props.scrollHandler.getScrollLeft(),e=this.props.scrollHandler.getScrollTop();this.inputDomRef&&this.inputDomRef.focus({preventScroll:!0}),this.props.scrollHandler.scrollTo(t,e)},e.prototype.update=function(){if(this.viewRange&&this.viewRange.start.documentBox){var t=(0,o.__assign)({},this.viewRange.start.getDocumentOffset(this.props.zoom())),e=t.x,r=t.y;Math.max(0,t.x),e=Math.min(t.docWidth,t.x),Math.max(0,t.y),r=Math.min(t.docHeight,t.y);var n=this.props.context.view.getPadding(),i=this.viewRange.start.caretHeight(this.props.zoom());this.setState({posX:e+(n.left||0),posY:r+(n.top||0)+i-5}),this.props.context.fire(new c.fV(c.Dk.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){window.isPublishedURL?this.requestBlur():this.isEditable&&(this.props.service.getSelection().isSelectionAtShape()&&vr.inputTextframe(this.props.state,"",this.props.service.getSelection().getRange()),this.compositionId="input_".concat(i.StringUtil.generateRandomId()),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new c.fV(c.Dk.ON_COMPOSITION_START,null)))},e.prototype.onCompositionUpdate=function(t){if(this.isEditable){var e=void 0;e=i.PlatformUtil.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data;var r=(0,g.GDL)(e);this.checkReportControlChars(r,e),this.props.state.compositionUpdate(this.compositionId,r,!0)}},e.prototype.onCompositionEnd=function(t){if(this.isEditable){var e=void 0;e=i.PlatformUtil.isIE()&&this.inputDomRef?this.inputDomRef.textContent:t.nativeEvent.data;var r=(0,g.GDL)(e);this.checkReportControlChars(r,e),this.props.state.compositionEnd(this.compositionId,r),this.props.context.fire(new c.fV(c.Dk.ON_COMPOSITION_END,r)),this.props.context.fire(new c.fV(c.Dk.ON_INPUT,r))}this.inputDomRef&&(this.inputDomRef.textContent=""),this.compositionId=""},e.prototype.onInput=function(){var t=this;setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),0)},e.prototype.onKeyUp=function(){var t=this;i.PlatformUtil.isIE()&&setTimeout((function(){t.compositionId.length<=0&&t.finishInput()}),100)},e.prototype.onKeyDown=function(t){var e=this,r=t.keyCode;229===t.keyCode&&"ArrowLeft"===t.key&&(r=p.VD.ARROW_LEFT),setTimeout((function(){e.controlCaretWhenComposition(r)}),50)},e.prototype.controlCaretWhenComposition=function(t){var e;if(this.compositionId.length>0){if(!this.isWindows&&(t===p.VD.ARROW_LEFT&&this.caretChangedCompositionId!==this.compositionId&&(this.caretChangedCompositionId=this.compositionId),this.caretChangedCompositionId!==this.compositionId))return;var r=this.inputDomRef;if(!r)return;var n=this.getCaretPosition(r),i=null===(e=this.props.state.getCompositionRange(this.compositionId))||void 0===e?void 0:e.begin();if(void 0===i||-1===n)return;this.props.state.setRangeTo(new g.ICE(i+n,0))||(this.caretChangedCompositionId="")}},e.prototype.getCaretPosition=function(t){var e=-1,r=t.ownerDocument||t.document,n=r.defaultView||r.parentWindow,i=document.selection;if((null==i?void 0:i.createRange)&&"Control"!==(null==i?void 0:i.type)){var o=i.createRange(),a=r.body.createTextRange();return a.moveToElementText(t),a.setEndPoint("EndToEnd",o),a.text.length}if(void 0!==n.getSelection&&n.getSelection().rangeCount>0){var s=n.getSelection().getRangeAt(0),l=s.cloneRange();l.selectNodeContents(t),l.setEnd(s.endContainer,s.endOffset),e=l.toString().length}return e},e.prototype.finishInput=function(){if(this.isEditable&&this.inputDomRef){var t=this.inputDomRef.textContent||"";this.inputDomRef.textContent="";var e=(0,g.GDL)(t);this.checkReportControlChars(e,t),e&&(t=e.replace(this.spaceReg,g.IfD.Space),this.props.service.getSelection().typeText(t),this.props.context.fire(new c.fV(c.Dk.ON_INPUT,t)))}},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new M.D_l(M.cbw.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,setTimeout((function(){e.isFocus||e.props.context.fire(new M.D_l(M.cbw.ON_BLUR))}),300)},e.prototype.checkReportControlChars=function(t,e){t.length!==e.length&&p.kQ.tdwReport({opername:"doc_word_editor",module:"doc_input",action:"controlCharsInput",ver5:escape(e)})},Object.defineProperty(e.prototype,"isEditable",{get:function(){var t;return null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable()},enumerable:!1,configurable:!0}),e.prototype.render=function(){var t=this;return Ln().createElement("div",{id:Hn,contentEditable:this.contentEditable,ref:function(e){t.inputDomRef=e},onInput:this.onInput.bind(this),onKeyUp:this.onKeyUp.bind(this),onKeyDown:this.onKeyDown.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),spellCheck:!1,tabIndex:0,role:"textbox","aria-label":"腾讯文档正文内容","aria-activedescendant":"accessibility-placeholder","aria-owns":"accessibility-placeholder",style:{left:this.state.posX,top:this.state.posY}})},(0,o.__decorate)([(0,p.o3)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[]),(0,o.__metadata)("design:returntype",void 0)],e.prototype,"onInput",null),(0,o.__decorate)([(0,p.o3)(),(0,o.__metadata)("design:type",Function),(0,o.__metadata)("design:paramtypes",[]),(0,o.__metadata)("design:returntype",void 0)],e.prototype,"onKeyUp",null),e}(Ln().Component),Vn="melo-mobile-drag-container",Un="melo-mobile-caret-container",Kn="melo-mobile-selection-drag-left-ios",zn="melo-mobile-selection-drag-right-ios",jn="melo-mobile-caret-drag-android",qn="melo-mobile-selection-drag-left-android",Xn="melo-mobile-selection-drag-right-android",Qn="melo-mobile-selection-caret-container",Yn="melo-mobile-selection-caret";!function(t){t[t.bottom=1]="bottom",t[t.top=-1]="top"}(Pn||(Pn={}));var Jn,Zn=function(){function t(t){this.scrollRoot=t,this.startScrollTime=0}return t.prototype.startScroll=function(t){var e=this;t&&this.setScrollDirection(t),this.startScrollTime=Date.now(),this.animationTicker=requestAnimationFrame((function(){return e.handlerScroll()}))},t.prototype.cancelScroll=function(){this.animationTicker&&cancelAnimationFrame(this.animationTicker)},t.prototype.setScrollDirection=function(t){this.direction=t},t.prototype.getScrollDirection=function(){return this.direction},t.prototype.restart=function(){this.startScrollTime=Date.now(),this.cancelScroll(),this.startScroll()},t.prototype.getDirectionFactor=function(){return this.direction===Pn.bottom?1:-1},t.prototype.handlerScroll=function(){var t=this,e=(Date.now()-this.startScrollTime)/3e3;e>=1&&(e=1);var r,n=30*(r=e,1-Math.pow(1-r,3))*this.getDirectionFactor(),i=this.scrollRoot.scrollHeight-this.scrollRoot.clientHeight,o=this.scrollRoot.scrollTop+n;return this.direction===Pn.bottom&&o>i?(this.scrollRoot.scrollTop=i,void cancelAnimationFrame(this.animationTicker)):this.direction===Pn.top&&o<0?(this.scrollRoot.scrollTop=0,void cancelAnimationFrame(this.animationTicker)):(this.scrollRoot.scrollTop=o,void(this.animationTicker=requestAnimationFrame((function(){return t.handlerScroll()}))))},t}();!function(t){function e(e){var r=t.call(this,e)||this;return r.draggerRef=Ln().createRef(),r.upBound=5,r.bottomBound=20,r.fingerOffset=50,r.dragContainerWidth=30,r.dragContainerHeight=30,r.LONG_TOUCH_TIME=300,r.caretPosYBeforeTouch=0,r.onTouchStart=function(t){r.isParallelMoving=!0,r.clearDragFlagTimeoutId(),r.longTouch(t).then((function(t){var e,n=null===(e=r.selector.getSelection())||void 0===e?void 0:e.viewRange;n&&((0,c.AO)(n.start.leafBox)||"SELECT"===t&&r.doSelectStart())})).catch((function(){r.clearDragFlagTimeoutId()}))},r.onTouchMove=function(t){r.clearDragFlagTimeoutId(),r.doDragMove(t)},r.onTouchEnd=function(t){r.clearDragFlagTimeoutId(),r.doDragEnd(t)},r.throttleIfUpdateCaret=(0,i.throttle)((function(t){r.updateCaret(t)}),50),r.selector=r.props.overlay.touchSelector,r.state={posX:0,posY:0,caretHeight:0,visible:!1,componentScrolling:!1,clientX:0,clientY:0,isDragTouch:!1,followFingerPosX:0,followFingerPosY:0,isReadyToDrag:!1},r}(0,o.__extends)(e,t),e.prototype.shouldComponentUpdate=function(t,e){return this.state.visible||e.visible},e.prototype.componentDidMount=function(){this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.addEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.addEventListener("touchend",this.onTouchEnd)},e.prototype.componentWillUnmount=function(){this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.removeEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.removeEventListener("touchend",this.onTouchEnd)},e.prototype.onRequestFocus=function(){this.blurOnTimeout()},e.prototype.onPosUpdate=function(t){t&&t.data instanceof M.rOq&&(this.viewRange=t.data,this.state.isDragTouch||this.updateFakeCaret(t.data))},e.prototype.handleCaretInDocumentArea=function(t,e,r,n){var i=this,o=this.props.context.view.getPadding(),a=e+(o.left||0),s=r+(o.top||0),l=n.caretHeight(this.props.zoom()),c=(this.state.isDragTouch,!0),p=t.isCaret()&&l>0&&(void 0!==this.blurTimeoutId||!1)&&c;this.setState({posX:a,posY:s,caretHeight:l,visible:p,isReadyToDrag:!1},(function(){setTimeout((function(){i.setState({isReadyToDrag:!0})}),100)}))},e.prototype.updateFakeCaret=function(t){var e;if((null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable())&&t.isCaret()){var r=(0,M.$Zc)(t.start),n=r.getDocumentOffset(this.props.zoom()),i=n.x,o=n.y,a=n.docWidth,s=n.docHeight;i<0||i>a||o<0||o>s?this.setState({visible:!1}):this.handleCaretInDocumentArea(t,i,o,r)}else this.setState({visible:!1})},e.prototype.blurOnTimeout=function(){var t=this;this.caretDragRef&&this.caretDragRef.classList.remove("melo-caret-drag-trans-anim"),this.blurTimeoutId&&clearTimeout(this.blurTimeoutId),this.blurTimeoutId=setTimeout((function(){t.caretDragRef&&(t.caretDragRef.classList.add("melo-caret-drag-trans-anim"),setTimeout((function(){t.setState({visible:!1})}),300))}),2800)},e.prototype.sendTouchEvent=function(t){var e=this.calTouchEventHitPoint(t);this.props.context.fire(new M.NkY(t,e),!1)},e.prototype.onBlur=function(){this.setState({visible:!1})},e.prototype.longTouch=function(t){var e=this,r=this.getCaretPoint();return this.caretPosYBeforeTouch=r.clientCaretY,new Promise((function(n,i){e.dragFlagTimeoutId=setTimeout((function(){var o,a=e.getTouchPoint(t);if(a){var s=e.getHitPoint(a);if(e.selector.onTouchEvent(t,s)){var l=null===(o=e.selector.getSelection())||void 0===o?void 0:o.viewRange;if(l){var c=e.iosDragTriggerScope(r,a);c&&(null==l?void 0:l.isCaret())&&n("DRAG"),c||n("SELECT"),i()}else i()}else i()}}),e.LONG_TOUCH_TIME)}))},e.prototype.doSelectStart=function(){var t,e=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;e&&this.props.context.run("selectWord",e.start.gcp)},e.prototype.doDragStart=function(t){},e.prototype.doDragMove=function(t){this.state.isDragTouch&&t.cancelable&&t.preventDefault()},e.prototype.doDragEnd=function(t){},e.prototype.doAndroidDragStart=function(){var t;(null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange)&&(this.setState({isDragTouch:!0}),this.dragStartUtil())},e.prototype.doAndroidDragEnd=function(t){this.state.isDragTouch&&(this.updateCaret(t),this.dragEndUtil(),this.setState({isDragTouch:!1}))},e.prototype.doIOSDragStart=function(t){var e,r=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;r&&(this.dragStartUtil(),this.updateFakeCaret(r),this.updateCaretForIOS(t),this.setState({isDragTouch:!0,visible:!0}))},e.prototype.doIOSDragEnd=function(t){this.state.isDragTouch&&(this.throttleIfUpdateCaret(t),this.dragEndUtil(),this.setState({visible:!1,isDragTouch:!1}))},e.prototype.dragStartUtil=function(){this.props.scrollHandler.disableScrollOnSelectionChanged(),this.startAutoScrollChecker(),this.props.context.fire(new c.CC(c.Zk.START_DRAG))},e.prototype.dragEndUtil=function(){var t,e;this.selector.finishMoving(),this.props.scrollHandler.enableScrollOnSelectionChanged(),this.stopAutoScroll(),this.props.context.fire(new c.CC(c.Zk.END_DRAG));var r=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;null===(e=this.props.context.surface)||void 0===e||e.requestFocus(r)},e.prototype.clearDragFlagTimeoutId=function(){this.dragFlagTimeoutId&&clearTimeout(this.dragFlagTimeoutId),this.dragFlagTimeoutId=void 0},e.prototype.onRealDragTouchStart=function(t){t.preventDefault(),this.sendTouchEvent(t),this.doDragStart(t)},e.prototype.onRealDragTouchMove=function(t){t.preventDefault(),this.blurOnTimeout(),this.doDragMove(t)},e.prototype.onRealDragTouchEnd=function(t){t.preventDefault(),this.blurOnTimeout(),this.sendTouchEvent(t),this.doDragEnd(t)},e.prototype.updateCaret=function(t){},e.prototype.updateCaretForIOS=function(t){var e,r=this.getTouchPoint(t);if(r){var n=r.clientTouchX,o=r.clientTouchY,a=r.documentTouchY,s=r.resultNode;this.isParallelMoving&&!this.touchInLine(a)&&(this.isParallelMoving=!1),this.updateFollowFingerCaret(r);var l=this.getRealCaretUpOffset(),c=this.getHitPoint(r);c.y=this.isParallelMoving?c.y:c.y-(0,i.pxToTwips)(l),this.selector.moveBoth({clientX:n,clientY:o-l,element:s},c),this.setState({clientX:r.clientTouchX,clientY:r.clientTouchY});var p=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;p&&this.updateFakeCaret(p)}},e.prototype.updateCaretForAndroid=function(t){var e,r=this.getTouchPoint(t),n=this.getOffsetTouchPoint(t);if(r&&n){var i=n.clientTouchX,o=n.clientTouchY,a=n.resultNode,s=this.getHitPoint(n),l=this.props.scrollHandler,c=l.getScrollRootSize().bottom-l.getMobileBottomMargin();this.selector.moveBoth({clientX:i,clientY:Math.min(c,o+this.state.caretHeight/2),element:a},s),this.setState({clientX:r.clientTouchX,clientY:r.clientTouchY});var p=null===(e=this.selector.getSelection())||void 0===e?void 0:e.viewRange;p&&this.updateFakeCaret(p)}},e.prototype.updateFollowFingerCaret=function(t){var e=this.getFollowFingerCaretUpOffset(),r=t.documentTouchX,n=t.documentTouchY-e;this.isParallelMoving&&(n=this.getCaretPoint().documentCaretY),this.setState({followFingerPosX:r,followFingerPosY:n})},e.prototype.getFollowFingerCaretUpOffset=function(){return this.isParallelMoving?this.state.caretHeight/2:this.fingerOffset},e.prototype.getRealCaretUpOffset=function(){return this.getFollowFingerCaretUpOffset()-this.state.caretHeight/2},e.prototype.touchInLine=function(t){if(0===this.caretPosYBeforeTouch)return!0;var e=this.props.layoutController.getLayoutBox().__node__,r=null==e?void 0:e.getBoundingClientRect(),n=this.caretPosYBeforeTouch-(r.top||0),i=n-this.upBound,o=n+this.state.caretHeight+this.bottomBound;return t>i&&t<o},e.prototype.getTouchPoint=function(t){if(t.targetTouches){var e=t.targetTouches[0];e||"touchstart"!==t.type&&"touchmove"!==t.type&&"touchend"!==t.type||(e=t.changedTouches[0]);var r=e.clientX,n=e.clientY,i=this.props.layoutController.getLayoutBox().__node__;if(i){var o=i.getBoundingClientRect(),a={clientTouchX:r,clientTouchY:n,documentTouchX:r-(o.x||0),documentTouchY:n-(o.y||0),resultNode:i};return a.resultNode=this.getResultNode(a),a}}},e.prototype.getResultNode=function(t){var e=this.props.layoutController.getLayoutBox(),r=e.__node__;if(r){var n=r;if((0,c.gL)(e)){var o=new i.MeloPoint({x:(0,i.pxToTwips)(t.documentTouchX),y:(0,i.pxToTwips)(t.documentTouchY)}),a=M.d_x.getLeastGrandsonByPoint(e,o);n=a[0]&&a[0].__node__}return n}},e.prototype.getOffsetTouchPoint=function(t){},e.prototype.getAndroidOffsetTouchPoint=function(t){var e=this.getTouchPoint(t);if(e)return e.clientTouchY-=this.state.caretHeight/2+this.dragContainerHeight/2,e.documentTouchY-=this.state.caretHeight/2+this.dragContainerHeight/2,e.resultNode=this.getResultNode(e),e},e.prototype.getIOSOffsetTouchPoint=function(t){var e=this.getTouchPoint(t);if(e)return e.resultNode=this.getResultNode(e),e},e.prototype.getHitPoint=function(t){return new i.MeloPoint({x:(0,i.pxToTwips)(t.documentTouchX/this.props.zoom()),y:(0,i.pxToTwips)(t.documentTouchY/this.props.zoom())})},e.prototype.getCaretPoint=function(){var t,e=this.props.layoutController.getLayoutBox().__node__,r=null==e?void 0:e.getBoundingClientRect(),n=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;if(!e||!n)return{clientCaretX:0,clientCaretY:0,documentCaretX:0,documentCaretY:0,caretHeight:0};var i=(0,M.$Zc)(null==n?void 0:n.start),o=i.getDocumentOffset(this.props.zoom()),a=o.x,s=o.y,l=i.caretHeight(this.props.zoom())||0;return{clientCaretX:a+r.left,clientCaretY:s+r.top,documentCaretX:a,documentCaretY:s,caretHeight:l}},e.prototype.androidDragTriggerScope=function(t,e){var r=e.clientTouchX>t.clientCaretX-this.dragContainerWidth/2&&e.clientTouchX<t.clientCaretX+this.dragContainerWidth/2,n=e.clientTouchY>t.clientCaretY+t.caretHeight&&e.clientTouchY<t.clientCaretY+t.caretHeight+this.dragContainerHeight;return r&&n},e.prototype.iosDragTriggerScope=function(t,e){var r=t.clientCaretY+t.caretHeight/2;return Math.pow(t.clientCaretX-e.clientTouchX,2)+Math.pow(r-e.clientTouchY,2)<Math.pow(t.caretHeight,2)},e.prototype.calTouchEventHitPoint=function(t){if(t.nativeEvent){var e=t.nativeEvent.changedTouches[0];if(this.draggerRef.current&&e){var r=this.draggerRef.current.getBoundingClientRect();return{x:(0,i.pxToTwips)(e.clientX-r.left),y:(0,i.pxToTwips)(e.clientY-r.top)-this.state.caretHeight/2}}}},e.prototype.onComponentScroll=function(){var t=this;this.setState({componentScrolling:!0}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,i.debounce)((function(){t.setState({componentScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.updateFakeCaret(t.viewRange))}),500)),this.onComponentScrollTimeout()},e.prototype.startAutoScrollChecker=function(){var t=this;this.stopAutoScroll(),this.autoScrollInterval=setInterval((function(){var e,r,n=t.state,i=n.posX,o=n.posY,a=n.caretHeight,s=n.clientY,l=n.clientX;r=t.autoScrollController?{x:l,y:s,type:M.l29.client}:{x:i,y:o+a/2,type:M.l29.scroll,xOffset:15,yOffset:a/2+15};var c=t.props.scrollHandler.getTouchEdgeJudgeInfoMobile(r);if(!(null==c?void 0:c.verticalEdge))return null===(e=t.autoScrollController)||void 0===e||e.cancelScroll(),void(t.autoScrollController=void 0);var p=c.verticalEdge===M.Pb7.bottom?Pn.bottom:Pn.top;t.autoScrollController?p!==t.autoScrollController.getScrollDirection()&&(t.autoScrollController.setScrollDirection(p),t.autoScrollController.restart()):(t.autoScrollController=new Zn(t.props.scrollHandler.getScrollRoot()),t.autoScrollController.startScroll(p))}),50)},e.prototype.stopAutoScroll=function(){var t;clearInterval(this.autoScrollInterval),null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),this.autoScrollController=void 0},e.prototype.androidCaretDrag=function(){return Ln().createElement("div",{className:jn,style:{transform:this.state.isDragTouch?"scale(1.3)":"scale(1)",transformOrigin:"50% 0%"}})},e.prototype.renderFollowFingerCaret=function(t,e,r){return null},e.prototype.render=function(){var t=this,e=(this.state.caretHeight,this.state.caretHeight+4);return Ln().createElement("div",{className:"melo-mobile-caret_wrapper"},this.renderFollowFingerCaret(21,2,e),Ln().createElement("div",{className:Un,ref:function(e){t.caretDragRef=e},style:{position:"absolute",left:this.state.posX,top:this.state.posY,zIndex:20,visibility:this.state.visible&&!this.state.componentScrolling?"visible":"hidden"}},Ln().createElement("div",{className:"melo-mobile-caret",style:{position:"absolute",width:2,height:e,pointerEvents:"none",background:"#cccccc",transition:"transform ease 0.5s, opacity ease 0.5s",opacity:this.state.visible?"1":"0",transform:(this.state.isDragTouch,"scale(1, 1)"),transformOrigin:"50% 100%"}}),""))}}(Ln().Component),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right"}(Jn||(Jn={})),function(t){function e(e){var r=t.call(this,e)||this;return r.viewRange=null,r.optionShow=!0,r.startPos=void 0,r.endPos=void 0,r.upBound=5,r.bottomBound=20,r.fingerOffset=40,r.caretContainerWidth=56,r.caretContainerExtraHeight=40,r.caretWidth=2,r.extraCaretHeight=4,r.isParallelMoving=!1,r.LONG_TOUCH_TIME=500,r.isFirstLongTouch=!1,r.isDragStart=!1,r.dragCheckerCallbackId=void 0,r.onTouchStart=function(){var t;r.longTouchTimeout&&clearTimeout(r.longTouchTimeout);var e=null===(t=r.selector.getSelection())||void 0===t?void 0:t.viewRange;r.isFirstLongTouch=!1,r.longTouchTimeout=setTimeout((function(){var t;(null==e?void 0:e.equals(null===(t=r.selector.getSelection())||void 0===t?void 0:t.viewRange))||(r.isFirstLongTouch=!0),r.isParallelMoving=!0}),r.LONG_TOUCH_TIME)},r.onTouchMove=function(t){r.longTouchTimeout&&clearTimeout(r.longTouchTimeout),r.shouldChangeSelectionByTouchMove()&&r.isDragStart&&(t.cancelable&&t.preventDefault(),r.throttleDoTouchMove(t))},r.onTouchEnd=function(t){r.longTouchTimeout&&clearTimeout(r.longTouchTimeout),(r.isFirstLongTouch||r.state.isLeftDragTouch||r.state.isRightDragTouch)&&(r.isParallelMoving=!1,r.dragTouchEnd(t)),r.isFirstLongTouch=!1,r.stopAutoScroll()},r.updateDragController=function(t){r.setState({isLeftDragTouch:t,isRightDragTouch:!t})},r.selectionCross=function(t,e){r.state.isRightDragTouch||r.shiftControllerToRightDrag(t,e),r.state.isLeftDragTouch||r.shiftControllerToLeftDrag(t,e)},r.throttleDoTouchMove=(0,i.throttle)((function(t){if(r.shouldChangeSelectionByTouchMove()){var e=r.getTouchPoint(t),n=r.getTouchHitPoint(e);r.selectionCross(e,t),r.selector.keepMoving(),r.state.isLeftDragTouch?r.selector.moveStart(r.getTouchEventInfo(e),n):r.state.isRightDragTouch&&r.selector.moveEnd(r.getTouchEventInfo(e),n)}}),50),r.selector=r.props.overlay.touchSelector,r.selector.setSelectionCrossCallback(r.updateDragController),r.state={leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1,ComponentScrolling:!1,isLeftDragTouch:!1,isRightDragTouch:!1,clientX:0,clientY:0},r}(0,o.__extends)(e,t),Object.defineProperty(e.prototype,"caretLeftMargin",{get:function(){return(this.caretContainerWidth-this.caretWidth)/2},enumerable:!1,configurable:!0}),e.prototype.shouldComponentUpdate=function(t,e){return this.state.visible||e.visible},e.prototype.componentDidMount=function(){this.props.context.on(M.kgn.SELECTION_CHANGE,this.onSelectionChanged,this),this.props.context.on(M.cbw.ON_BLUR,this.onBlur,this),this.props.context.on(M.kgn.TABLE_DID_SCROLL,this.onComponentScroll,this),this.props.context.on(M.kgn.TEXTFRAME_DID_SCROLL,this.onComponentScroll,this),this.props.scrollRoot.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.props.scrollRoot.addEventListener("touchmove",this.onTouchMove,{passive:!1}),this.props.scrollRoot.addEventListener("touchend",this.onTouchEnd,{passive:!1})},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(M.kgn.SELECTION_CHANGE,this),this.props.context.removeListener(M.cbw.ON_BLUR,this),this.props.context.removeListener(M.kgn.TABLE_DID_SCROLL,this),this.props.context.removeListener(M.kgn.TEXTFRAME_DID_SCROLL,this),this.props.scrollRoot.removeEventListener("touchstart",this.onTouchStart),this.props.scrollRoot.removeEventListener("touchmove",this.onTouchMove),this.props.scrollRoot.removeEventListener("touchend",this.onTouchEnd)},e.prototype.onSelectionChanged=function(t){(null==t?void 0:t.viewRange)&&(this.viewRange=t.viewRange,this.selector.updateBothFromRange(t.viewRange),t.option&&void 0!==t.option.mobileSelectionDrag?t.option.mobileSelectionDrag===u.p2.Hide?this.optionShow=!1:t.option.mobileSelectionDrag===u.p2.Show&&(this.optionShow=!0):this.optionShow=!0,this.update())},e.prototype.getCaretPosConsiderPadding=function(){var t=this.props.context.view.getPadding(),e=t.top,r=t.left;if(!this.viewRange)return{leftPosX:this.state.leftPosX-(r||0),leftPosY:this.state.leftPosY-(e||0),rightPosX:this.state.rightPosX-(r||0),rightPosY:this.state.rightPosY-(e||0)};var n=this.getViewRangePointPos(this.viewRange.start),i=this.getViewRangePointPos(this.viewRange.end);return{leftPosX:n.x,leftPosY:n.y,rightPosX:i.x,rightPosY:i.y}},e.prototype.touchCompare=function(t){var e=t.documentTouchX/this.props.zoom(),r=t.documentTouchY/this.props.zoom(),n=this.state,i=n.leftLineHeight,o=n.rightLineHeight,a=this.getCaretPosConsiderPadding(),s=a.leftPosX,l=a.leftPosY,c=a.rightPosX,p=a.rightPosY,u=l+i,g=l,h=p+o,d=p;return{touchInLeftLineWithPadding:r>g-this.upBound&&r<u+this.bottomBound,touchInRightLineWithPadding:r>d-this.upBound&&r<h+this.bottomBound,touchInLeftLine:r>g&&r<u,touchInRightLine:r>d&&r<h,touchOverLeftLine:r<g-3,touchBelowRightLine:r>h+3,touchBeforeLeftDrag:e<s,touchBehindRightDrag:e>c}},e.prototype.isDragInSameLine=function(){return this.state.leftPosY===this.state.rightPosY},e.prototype.getTouchHitPoint=function(t){var e=this.props.zoom();return new i.MeloPoint({x:(0,i.pxToTwips)(t.documentTouchX/e),y:(0,i.pxToTwips)(t.documentTouchY/e)})},e.prototype.getTouchEventInfo=function(t){var e=this.props.scrollHandler,r=e.getScrollRootSize().top+e.getMobileTopMargin(),n=e.getScrollRootSize().bottom-e.getMobileBottomMargin(),i=t.clientTouchY;return i>n&&(i=n),i<r&&(i=r),{clientX:t.clientTouchX,clientY:i,element:t.resultNode}},e.prototype.shiftControllerToLeftDrag=function(t,e){var r=this.touchCompare(t).touchBeforeLeftDrag;this.isParallelMoving&&this.leftDragInParallelMoving(r,e)},e.prototype.leftDragInParallelMoving=function(t,e){t&&this.isDragInSameLine()&&this.leftDragTouchStart(e)},e.prototype.shiftControllerToRightDrag=function(t,e){var r=this.touchCompare(t).touchBehindRightDrag;this.isParallelMoving&&this.rightDragInParallelMoving(r,e)},e.prototype.rightDragInParallelMoving=function(t,e){t&&this.isDragInSameLine()&&this.rightDragTouchStart(e)},e.prototype.autoScroll=function(){var t=this;this.autoScrollInterval&&clearInterval(this.autoScrollInterval),this.autoScrollInterval=setInterval((function(){t.state.isLeftDragTouch||t.state.isRightDragTouch?t.autoScrollUnit():clearInterval(t.autoScrollInterval)}),50)},e.prototype.autoScrollUnit=function(){var t;if(this.selector.start&&this.selector.end){var e,r=this.state,n=r.isLeftDragTouch,i=r.leftLineHeight,o=r.rightLineHeight,a=r.leftPosX,s=r.leftPosY,l=r.rightPosX,c=r.rightPosY,p=r.clientX,u=r.clientY;e=this.autoScrollController?{x:p,y:u,type:M.l29.client}:{x:n?a:l,y:n?s+i/2:c+o/2,type:M.l29.scroll,xOffset:15,yOffset:15+(n?i/2:o/2)};var g=this.props.scrollHandler.getTouchEdgeJudgeInfoMobile(e);if(!g)return null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),void(this.autoScrollController=null);var h=g.verticalEdge===M.Pb7.bottom?Pn.bottom:Pn.top;this.autoScrollController?h!==this.autoScrollController.getScrollDirection()&&(this.autoScrollController.setScrollDirection(h),this.autoScrollController.restart()):(this.autoScrollController=new Zn(this.props.scrollHandler.getScrollRoot()),this.autoScrollController.startScroll(h))}},e.prototype.stopAutoScroll=function(){var t;clearInterval(this.autoScrollInterval),null===(t=this.autoScrollController)||void 0===t||t.cancelScroll(),this.autoScrollController=null},e.prototype.getDocumentInfo=function(){var t=this.props.layoutController.getLayoutBox(),e=t.__node__;if(e)return{rect:e.getBoundingClientRect(),documentNode:e,documentBox:t}},e.prototype.onBlur=function(){var t;(null===(t=this.viewRange)||void 0===t?void 0:t.isCaret())&&this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.update=function(){this.viewRange&&this.optionShow&&this.shouldChangeSelection()?(this.startPos=this.getViewRangePointPos(this.viewRange.start),this.endPos=this.getViewRangePointPos(this.viewRange.end),this.startPos&&this.endPos?this.showSelectionDrag():this.hideSelectionDrag()):this.hideSelectionDrag()},e.prototype.showSelectionDrag=function(){var t,e,r,n,o,a,s,l,c=this.props.context.view.getPadding(),p=this.viewRange.start,u=this.viewRange.end,g=(0,i.twipsToPx)((null===(e=null===(t=null==p?void 0:p.lineBox)||void 0===t?void 0:t.edge)||void 0===e?void 0:e.top)||0),h=(0,i.twipsToPx)((null===(n=null===(r=null==p?void 0:p.lineBox)||void 0===r?void 0:r.edge)||void 0===n?void 0:n.bottom)||0),d=(0,i.twipsToPx)((null===(a=null===(o=null==u?void 0:u.lineBox)||void 0===o?void 0:o.edge)||void 0===a?void 0:a.top)||0),f=(0,i.twipsToPx)((null===(l=null===(s=null==u?void 0:u.lineBox)||void 0===s?void 0:s.edge)||void 0===l?void 0:l.bottom)||0);this.setState({leftPosX:this.startPos.x+(c.left||0),leftPosY:this.startPos.y+(c.top||0)+g,leftLineHeight:p.lineHeight-g-h,rightPosX:this.endPos.x+(c.left||0),rightPosY:this.endPos.y+(c.top||0)+d,rightLineHeight:u.lineHeight-d-f,visible:!0})},e.prototype.hideSelectionDrag=function(){this.setState({leftPosX:0,leftPosY:0,leftLineHeight:0,rightPosX:0,rightPosY:0,rightLineHeight:0,visible:!1})},e.prototype.getViewRangePointPos=function(t){var e=t.getLineDocumentOffset(this.props.zoom()),r=0,n=0;if(null==t?void 0:t.lineBox){var o=t.lineBox.edge;r+=o.margin.left,n+=o.margin.top,o.recycle()}return{x:e.x+(0,i.twipsToPx)(r),y:e.y+(0,i.twipsToPx)(n)}},e.prototype.dragTouchStart=function(t,e){var r=this;this.dragCheckerCallbackId=setTimeout((function(){r.setState({isLeftDragTouch:e===Jn.Left,isRightDragTouch:e===Jn.Right}),r.isDragStart=!0,r.dragCheckerCallbackId=void 0,r.props.scrollHandler.disableScrollOnSelectionChanged(),r.props.context.fire(new c.nL(t,c.iA.START_DRAG)),r.autoScroll()}),200)},e.prototype.dragTouchEnd=function(t){if(clearTimeout(this.dragCheckerCallbackId),!this.isDragStart)return this.dragCheckerCallbackId?void this.props.context.fire(new M.F78):void 0;this.selector.finishMoving(),this.stopAutoScroll(),this.props.scrollHandler.enableScrollOnSelectionChanged(),this.isDragStart=!1,this.dragCheckerCallbackId=void 0,this.props.context.fire(new c.nL(t,c.iA.END_DRAG)),this.setState({isLeftDragTouch:!1,isRightDragTouch:!1})},e.prototype.leftDragTouchStart=function(t){this.dragTouchStart(t,Jn.Left)},e.prototype.rightDragTouchStart=function(t){this.dragTouchStart(t,Jn.Right)},e.prototype.onLeftTouchStart=function(t){this.isParallelMoving=!0,this.leftDragTouchStart(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onLeftTouchEnd=function(t){this.isParallelMoving=!1,this.dragTouchEnd(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onRightTouchStart=function(t){this.isParallelMoving=!0,this.rightDragTouchStart(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.onRightTouchEnd=function(t){this.isParallelMoving=!1,this.dragTouchEnd(t.nativeEvent),this.sendTouchEvent(t)},e.prototype.sendTouchEvent=function(t){this.props.context.fire(new M.NkY(t),!1)},e.prototype.shouldChangeSelectionByTouchMove=function(){return!!this.shouldChangeSelection()&&!!(this.state.isLeftDragTouch||this.state.isRightDragTouch||this.isFirstLongTouch)},e.prototype.shouldChangeSelection=function(){var t,e=this.props.service.getSelection();if(e.isInCellsOfTable()||e.isSelectionAtImage()||e.isSelectionAtEmbeddedObject())return!1;var r=null===(t=this.selector.getSelection())||void 0===t?void 0:t.viewRange;return!((null==r?void 0:r.isCaret())&&!this.state.isLeftDragTouch&&!this.state.isRightDragTouch)},e.prototype.getTouchPoint=function(t){var e=t.targetTouches[0];e||"touchmove"!==t.type||(e=t.changedTouches[0]);var r=e.clientX,n=e.clientY;this.setState({clientX:r,clientY:n});var i=this.props.layoutController.getLayoutBox().__node__,o={clientTouchX:r,clientTouchY:n,resultNode:i,documentTouchX:r,documentTouchY:n};if(!i)return o;var a=i.getBoundingClientRect();o.documentTouchX=r-a.left,o.documentTouchY=n-a.top;var s=this.touchCompare(o),l=s.touchInLeftLineWithPadding,c=s.touchInRightLineWithPadding;this.state.isLeftDragTouch&&!l&&(this.isParallelMoving=!1),this.state.isRightDragTouch&&!c&&(this.isParallelMoving=!1);var p=this.getOffsetTouchPoint(o);return p.resultNode=this.getTouchResultNode(o),p},e.prototype.getOffsetTouchPoint=function(t){var e=t,r=this.getDocumentInfo();if(!r)return e;var n=r.rect;if(this.isParallelMoving){var i=this.getCaretPosConsiderPadding(),o=i.leftPosY,a=i.rightPosY;this.state.isLeftDragTouch?(e.documentTouchY=(o+this.state.leftLineHeight/2)*this.props.zoom(),e.clientTouchY=e.documentTouchY+n.top):this.state.isRightDragTouch&&(e.documentTouchY=(a+this.state.rightLineHeight/2)*this.props.zoom(),e.clientTouchY=e.documentTouchY+n.top)}else e.clientTouchY=t.clientTouchY-this.fingerOffset,e.documentTouchY=t.documentTouchY-this.fingerOffset;return e.clientTouchX=t.clientTouchX,e.documentTouchX=t.documentTouchX,e},e.prototype.getTouchResultNode=function(t){var e=this.props.layoutController.getLayoutBox(),r=e.__node__;if(r){var n=r;if((0,c.gL)(e)){var i=this.getTouchHitPoint(t),o=M.d_x.getLeastGrandsonByPoint(e,i);n=o[0]&&o[0].__node__}return n}},e.prototype.onComponentScroll=function(){var t=this;this.setState({ComponentScrolling:!0}),this.onComponentScrollTimeout||(this.onComponentScrollTimeout=(0,i.debounce)((function(){t.setState({ComponentScrolling:!1}),t.viewRange&&t.state.visible&&(t.viewRange.start.clearCache(),t.viewRange.end.clearCache(),t.update())}),500)),this.onComponentScrollTimeout()},e.prototype.androidDrag=function(t){var e=this.getScale();return Ln().createElement("div",{className:"".concat(t===Jn.Left?qn:Xn),style:{transform:e,opacity:this.state.visible?1:0}})},e.prototype.iosDrag=function(t){var e=this.getScale();return Ln().createElement("div",{className:"".concat(t===Jn.Left?Kn:zn),style:{transform:e,opacity:this.state.visible?"1":"0",boxShadow:"0 0 0 0 rgba(0, 0, 0, 0)"}})},e.prototype.getScale=function(){return this.state.visible?"scale(1)":"scale(0)"},e.prototype.fakeCaret=function(t){var e,r,n,i,o,a=this;t===Jn.Left?(e=this.state.leftPosX-(this.caretContainerWidth+this.caretWidth)/2,r=(r=this.state.leftPosY-this.extraCaretHeight)-this.caretContainerExtraHeight+this.extraCaretHeight,i=this.state.leftLineHeight+this.caretContainerExtraHeight,o=this.caretContainerExtraHeight-this.extraCaretHeight,n=this.state.leftLineHeight+this.extraCaretHeight):(e=this.state.rightPosX-(this.caretContainerWidth-this.caretWidth)/2,r=this.state.rightPosY,n=this.state.rightLineHeight+this.extraCaretHeight,i=this.state.rightLineHeight+this.caretContainerExtraHeight,o=0);var s=Math.min(this.caretContainerWidth,this.props.scrollRoot.clientWidth-e);return Ln().createElement("div",{className:Qn,onMouseUp:function(t){a.props.context.fire(new M.VDf(t),!1)},onTouchStart:function(e){t===Jn.Left?a.onLeftTouchStart(e):a.onRightTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t===Jn.Left?a.onLeftTouchEnd(e):a.onRightTouchEnd(e)},style:{left:e,top:r,height:i,width:s,opacity:this.state.visible?"1":"0"}},Ln().createElement("div",{className:Yn,style:{height:n,background:"#1e6fff",width:this.caretWidth,top:o,left:this.caretLeftMargin}}))},e.prototype.render=function(){var t=this,e=(this.caretWidth,this.caretWidth,-15-this.caretWidth/2),r=this.caretWidth/2-15;return Ln().createElement("div",{className:"melo-mobile-selection-drag",style:{visibility:this.state.visible&&!this.state.ComponentScrolling?"visible":"hidden"}},this.fakeCaret(Jn.Left),Ln().createElement("div",{className:Vn,onTouchStart:function(e){t.onLeftTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t.onLeftTouchEnd(e)},style:{left:this.state.leftPosX+e,top:this.state.leftPosY+-28}},this.iosDrag(Jn.Left)),this.fakeCaret(Jn.Right),Ln().createElement("div",{className:Vn,onTouchStart:function(e){t.onRightTouchStart(e)},onTouchEnd:function(e){e.preventDefault(),t.onRightTouchEnd(e)},style:{left:this.state.rightPosX+r,top:this.state.rightPosY+this.state.rightLineHeight+-2}},this.iosDrag(Jn.Right)))}}(Ln().Component);var $n,ti=function(){function t(){}return t.getShortCutKey=function(t){for(var e=t,r=[],n=p.VD.EMPTY;e>0;)e>=p.N9.COMMAND?(r.push(p.N9.COMMAND),e-=p.N9.COMMAND):e>=p.N9.WIN?(r.push(p.N9.WIN),e-=p.N9.WIN):e>=p.N9.CTRL_MAC?(r.push(p.N9.CTRL_MAC),e-=p.N9.CTRL_MAC):e>=p.N9.CTRL_WIN?(r.push(p.N9.CTRL_WIN),e-=p.N9.CTRL_WIN):e>=p.N9.ALT?(r.push(p.N9.ALT),e-=p.N9.ALT):e>=p.N9.SHIFT?(r.push(p.N9.SHIFT),e-=p.N9.SHIFT):(n=e,e=0);return{input:this.getIPadKeyName(n),modifier:this.getIPadModifierName(r)}},t.getIPadKeyName=function(t){var e=p.q2.EMPTY;return Object.keys(p.VD).some((function(r){return p.VD[r]===t&&void 0!==p.q2[r]&&(e=p.q2[r],!0)})),e},t.getIPadModifierName=function(t){return t.map((function(t){switch(t){case p.N9.COMMAND:return p.Bx.COMMAND;case p.N9.CTRL_MAC:return p.Bx.CTRL;case p.N9.ALT:return p.Bx.ALT;case p.N9.SHIFT:return p.Bx.SHIFT;default:return p.Bx.NONE}})).join("|")},t}(),ei=function(){function t(){var e=this;this.attached=!1,this.ipadKeymap=new Map,this.onIpadExternalKeyboardEvent=function(t){e.listeners.forEach((function(e){e(t)}))},this.addIPadAppKeyMap=function(t){if(i.PlatformUtil.isTencentDocsIPadApp()&&window.mqq){e.attached||(window.mqq.addEventListener("shortcutKeyEvent",e.onIpadExternalKeyboardEvent),e.attached=!0);var r=[];t.forEach((function(t){if(t!==p.VD.EMPTY&&!e.ipadKeymap.has(t)){e.ipadKeymap.set(t,!0);var n=ti.getShortCutKey(t);n.input&&r.push(n)}})),r.length>0&&window.mqq.invoke("docx","registerShortcutKeyEvent",{shortcutKey:r})}},t.instance=this,this.listeners=[]}return t.getInstance=function(){return t.instance||new t,t.instance},t.prototype.attach=function(){i.PlatformUtil.isTencentDocsIPadApp()&&window.mqq&&!this.attached&&(window.mqq.addEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!0)},t.prototype.detach=function(){i.PlatformUtil.isTencentDocsIPadApp()&&window.mqq&&(window.mqq.removeEventListener("shortcutKeyEvent",this.onIpadExternalKeyboardEvent),this.attached=!1)},t.prototype.addEventListener=function(t){this.listeners.push(t)},t.prototype.removeEventListener=function(t){for(var e=0;e<this.listeners.length;e++)t===this.listeners[e]&&(this.listeners.splice(e,1),e-=1)},t}(),ri=function(){function t(t){var e=this;this.lastInnerHeight=window.innerHeight,this.lastOrientation=Number(window.orientation),this.keyboardState=c.zO.KEYBOARD_DOWN,this.onResize=function(){setTimeout((function(){var t=window.innerHeight,r=Number(window.orientation);e.isSameOrientation(r)&&(e.lastInnerHeight-t>150?e.onKeyboardUp(c.Gt.VIEWPORT_RESIZE):t-e.lastInnerHeight>150&&e.onKeyboardDown(c.Gt.VIEWPORT_RESIZE)),e.lastOrientation=r,e.lastInnerHeight=t}),100)},this.editor=t}return t.prototype.attach=function(){i.Logger.info("attach method called but KeyboardManager already attached")},t.prototype.detach=function(){},t.prototype.getKeyboardState=function(){return this.keyboardState},t.prototype.onFocus=function(){var t;(null===(t=this.editor.surface)||void 0===t?void 0:t.isFocusing())&&this.onKeyboardUp(c.Gt.EDITOR)},t.prototype.onBlur=function(){var t;(null===(t=this.editor.surface)||void 0===t?void 0:t.isFocusing())||this.onKeyboardDown(c.Gt.EDITOR)},t.prototype.isSameOrientation=function(t){return!((0!==this.lastOrientation&&180!==this.lastOrientation||0!==t&&180!==t)&&(90!==this.lastOrientation&&-90!==this.lastOrientation||90!==t&&-90!==t))},t.prototype.onKeyboardUp=function(t){this.keyboardState!==c.zO.KEYBOARD_UP&&this.editor.fire(new c.wr(c.Ln.MOBILE_KEYBOARD_SHOW,t)),this.keyboardState=c.zO.KEYBOARD_UP},t.prototype.onKeyboardDown=function(t){this.keyboardState!==c.zO.KEYBOARD_DOWN&&this.editor.fire(new c.wr(c.Ln.MOBILE_KEYBOARD_HIDE,t)),this.keyboardState=c.zO.KEYBOARD_DOWN},t}(),ni=function(){function t(){}return t.isMetaKey=function(t){return-1!==[p.VD.ARROW_DOWN,p.VD.ARROW_UP,p.VD.ARROW_LEFT,p.VD.ARROW_RIGHT,p.VD.HOME,p.VD.END,p.VD.DELETE,p.VD.BACKSPACE,p.VD.F1,p.VD.F2,p.VD.F3,p.VD.F4,p.VD.F5,p.VD.F6,p.VD.F7,p.VD.F8,p.VD.F9,p.VD.F10,p.VD.F11,p.VD.F12,p.VD.TAB,p.VD.PAGE_DOWN,p.VD.PAGE_UP,p.VD.ENTER,p.VD.ESCAPE,p.VD.SHIFT,p.VD.CAPS_LOCK,p.VD.ALT].indexOf(t)},t.isCtrlCmdKey=function(t){if(i.PlatformUtil.isMac()){if(t===p.VD.META_LEFT||t===p.VD.META_RIGHT||t===p.yl.META_FIREFOX)return!0}else if(t===p.VD.CTRL)return!0;return!1},t.getKeyCode=function(t){var e=t.keyCode;return i.PlatformUtil.isFireFox()&&(e===p.yl.EQUAL?e=p.VD.EQUAL:e===p.yl.MINUS&&(e=p.VD.MINUS)),229===e&&(e=this.getAmendedKeyCode(t)),e},t.getMouseCode=function(t){return t.buttons*p.wE},t.getWheelCode=function(t){var e=0;return t.deltaY>0?e=p.Al.WHEEL_CLOCKWISE:t.deltaY<0&&(e=p.Al.WHEEL_ANTICLOCKWISE),e},t.getIpadKeyCode=function(t){var e=p.VD.EMPTY;if(null==t?void 0:t.input){var r=t.input,n=t.modifier;void 0!==n?e=this.getIpadCombinationKeyCode(r,n):r===p.q2.ARROW_LEFT?e=p.VD.ARROW_LEFT:r===p.q2.ARROW_RIGHT?e=p.VD.ARROW_RIGHT:r===p.q2.ARROW_UP?e=p.VD.ARROW_UP:r===p.q2.ARROW_DOWN&&(e=p.VD.ARROW_DOWN)}return e},t.getIpadCombinationKeyCode=function(e,r){var n=p.VD.EMPTY,i=e.toUpperCase();return/^[A-Z]$/.test(i)?n=p.VD[i]:e===p.q2.EQUAL?n=p.VD.EQUAL:e===p.q2.ARROW_LEFT?n=p.VD.ARROW_LEFT:e===p.q2.ARROW_RIGHT?n=p.VD.ARROW_RIGHT:e===p.q2.ARROW_UP?n=p.VD.ARROW_UP:e===p.q2.ARROW_DOWN&&(n=p.VD.ARROW_DOWN),n=t.getKeyCodeWithModifier(r,n)},t.getKeyCodeWithModifier=function(t,e){var r=e;return t.split("|").forEach((function(t){switch(t){case p.Bx.COMMAND:r+=p.N9.COMMAND;break;case p.Bx.SHIFT:r+=p.N9.SHIFT;break;case p.Bx.ALT:r+=p.N9.ALT;break;case p.Bx.CTRL:r+=p.N9.CTRL_MAC}})),r},t.getAssistKey=function(t){var e=0;return e+=t.altKey?p.N9.ALT:0,e+=t.shiftKey?p.N9.SHIFT:0,i.PlatformUtil.isMac()?(e+=t.ctrlKey?p.N9.CTRL_MAC:0,e+=t.metaKey?p.N9.COMMAND:0):(e+=t.ctrlKey?p.N9.CTRL_WIN:0,e+=t.metaKey?p.N9.WIN:0),e},t.getAmendedKeyCode=function(t){var e=t.code,r=t.key;return p.ii[e]?p.ii[e]:/[0-9a-zA-Z]/.test(r)?r.toUpperCase().charCodeAt(0):t.keyCode},t}(),ii=function(){function t(t,e){var r=this;this.keymap=new Map,this.attached=!1,this.onKeyEvent=function(t){var e=ni.getKeyCode(t),n=ni.getAssistKey(t),o=n+e;window.JankGlobalKeyCode="".concat(n,"_").concat(e),i.Logger.info("keymap|keydown",o,t),r.runAction(o,t)},this.onMouseEvent=function(t){var e=ni.getMouseCode(t),n=ni.getAssistKey(t)+e;r.runAction(n,t)},this.onWheelEvent=function(t){var e=ni.getWheelCode(t),n=ni.getAssistKey(t)+e;r.runAction(n,t)},this.onIpadExternalKeyboardEvent=function(t){if(i.Logger.info("keymap|onIpadExternalKeyboardEvent",t),t){var e=ni.getIpadKeyCode(t);r.runAction(e,void 0,i.PlatformUtil.isTencentDocsIPadApp())}},this.editor=t,this.state=e}return t.prototype.attach=function(){var t;if(this.attached)i.Logger.warn("Editor KeymapManager has attached");else{var e=null===(t=this.editor.surface)||void 0===t?void 0:t.getFocusableDom();e?(e.addEventListener("keydown",this.onKeyEvent),e.addEventListener("mousedown",this.onMouseEvent),e.addEventListener("wheel",this.onWheelEvent,{passive:!1})):i.Logger.error("Editor KeymapManager attach focusableDom is null"),i.PlatformUtil.isTencentDocsIPadApp()&&(ei.getInstance().attach(),ei.getInstance().addEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!0}},t.prototype.detach=function(){var t,e=null===(t=this.editor.surface)||void 0===t?void 0:t.getFocusableDom();e?(e.removeEventListener("keydown",this.onKeyEvent),e.removeEventListener("mousedown",this.onMouseEvent),e.removeEventListener("wheel",this.onWheelEvent)):i.Logger.error("Editor KeymapManager detach surfaceDom is null"),i.PlatformUtil.isTencentDocsIPadApp()&&(ei.getInstance().detach(),ei.getInstance().removeEventListener(this.onIpadExternalKeyboardEvent)),this.attached=!1},t.prototype.addKeymap=function(t){var e=this,r=i.PlatformUtil.isMac()?"mac":"win",n=[].concat(t.keyBindings[r]);n.forEach((function(r){r!==p.VD.EMPTY&&(e.keymap.has(r)||e.keymap.set(r,t))})),i.PlatformUtil.isTencentDocsIPadApp()&&ei.getInstance().addIPadAppKeyMap(n)},t.prototype.addKeymaps=function(t){var e=this;(0,o.__spreadArray)([],(0,o.__read)(t),!1).forEach((function(t){e.addKeymap(t)}))},t.prototype.runAction=function(t,e,r){var n,i,a;if(((null===(i=this.editor.surface)||void 0===i?void 0:i.isFocusing())||r)&&(a=this.keymap.get(t)),a){var s=a.action,l=a.extraArgs,c=void 0===l?[]:l,p=a.shouldPreventDefault;(void 0===p||p)&&e&&e.preventDefault(),(n=this.editor).run.apply(n,(0,o.__spreadArray)([s],(0,o.__read)(c),!1))}},t}(),oi=r(61533),ai=r.n(oi),si=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectNode=null,e}return(0,o.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.context.on(M.kgn.SELECTION_CHANGE,this.onSelectionChanged,this)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(M.kgn.SELECTION_CHANGE,this)},e.prototype.onSelectionChanged=function(t){if(null==t?void 0:t.viewRange){var e=t.viewRange;if(e.start.gcp!==e.end.gcp&&this.selectNode){var r=document.createRange();r.selectNode(this.selectNode);var n=window.getSelection();n&&n.addRange(r)}}},e.prototype.render=function(){var t=this;return Ln().createElement("textarea",{id:"melo-hidden-select",ref:function(e){t.selectNode=e},style:{opacity:0}}," ")},e}(Ln().Component),li=function(t){function e(e){var r=t.call(this,e)||this;return r.props=e,r.state={stamp:c.bK.NONE,gcpRange:[0,0],deleteContent:"",readContent:"用户可以通过 control 加 ~ 打开或关闭无障碍功能",isCut:!1},r}return(0,o.__extends)(e,t),e.prototype.componentDidMount=function(){this.props.context.on(c.dn.A11yContentChange,this.onContentChange,this)},e.prototype.onContentChange=function(t){var e,r=this,n=t.data;[c.bK.NONE,c.bK.ERROR].includes(n.stamp)||0!==(null===(e=n.readContent)||void 0===e?void 0:e.trim().length)&&(this.setState({readContent:" "}),this.onContentChangeTimeout||(this.onContentChangeTimeout=(0,i.debounce)((function(t){r.setState(t)}),300)),this.onContentChangeTimeout(n))},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(c.dn.A11yContentChange,this)},e.prototype.render=function(){return Ln().createElement("div",{id:"accessibility-hidden-speak","aria-live":"assertive","aria-atomic":"true","aria-hidden":"false",style:{height:0,width:0,overflow:"hidden"}},this.state.readContent)},e}(Ln().Component);!function(t){t.ARROW_LEFT="moveLeft",t.ARROW_UP="moveUp",t.ARROW_RIGHT="moveRight",t.ARROW_DOWN="moveDown",t.SELECT_LEFT="selectLeft",t.SELECT_RIGHT="selectRight",t.SELECT_UP="selectUp",t.SELECT_DOWN="selectDown",t.MOVE_TO_CHARACTER_LEFT="moveToCharacterLeft",t.MOVE_TO_CHARACTER_RIGHT="moveToCharacterRight",t.MOVE_TO_WORD_LEFT="moveToWordLeft",t.MOVE_TO_WORD_RIGHT="moveToWordRight",t.SELECT_TO_WORD_LEFT="selectToWordLeft",t.SELECT_TO_WORD_RIGHT="selectToWordRight",t.MOVE_TO_LINE_START="moveToLineStart",t.MOVE_TO_LINE_END="moveToLineEnd",t.MOVE_TO_PREVIOUS_LINE="moveToPreviousLine",t.MOVE_TO_NEXT_LINE="moveToNextLine",t.SELECT_TO_LINE_START="selectToLineStart",t.SELECT_TO_LINE_END="selectToLineEnd",t.SELECT_TO_PARA_START="selectToParaStart",t.SELECT_TO_PARA_END="selectToParaEnd",t.MOVE_TO_PARA_START="move_to_para_start",t.MOVE_TO_PARA_END="move_to_para_end",t.SELECT_TO_PREV_PAGE="selectToPrevPage",t.SELECT_TO_NEXT_PAGE="selectToNextPage",t.MOVE_TO_NEXT_PAGE="MOVE_TO_NEXT_PAGE",t.MOVE_TO_PREV_PAGE="MOVE_TO_PREV_PAGE",t.MOVE_TO_STORY_START="moveToStoryStart",t.MOVE_TO_STORY_END="moveToStoryEnd",t.SELECT_TO_STORY_START="selectToStoryStart",t.SELECT_TO_STORY_END="selectToStoryEnd",t.SELECT_WORD="selectWord",t.SELECT_PARA="selectParagraph",t.SELECT_ALL="selectAll"}($n||($n={}));var ci,pi="",ui=new RegExp(pi,"g"),gi=pi.length,hi=function(t){function e(e){var r=t.call(this,e)||this;return r.isFocus=!1,r.inputDomRef=null,r.cacheInput=pi,r.compositionId="",r.viewRange=null,r.forceFocus=!0,r.spaceReg=new RegExp(g.IfD.NonBreakSpace,"g"),r.beforeFinish=!1,r.followScreenView=(0,i.throttle)((function(){var t=r.props.scrollHandler.getScrollLeft(),e=r.props.scrollHandler.getScrollTop(),n=t/r.props.zoom(),i=e/r.props.zoom();r.setState({posX:n,posY:i})}),200),r.state={posX:0,posY:0},document.body.style.webkitUserSelect="none",r.contentEditable=i.PlatformUtil.isSafari()||i.PlatformUtil.isMac()&&(i.PlatformUtil.isTencentDocsDesktopApp()||i.PlatformUtil.isWeWork())?"plaintext-only":"true",r}return(0,o.__extends)(e,t),e.prototype.componentDidMount=function(){var t,e=this;this.props.context.fire(new M.yS1,!1),this.clearInput(),this.props.context.on(M.kgn.CARET_CHANGE,this.onSelectionChanged,this);var r=document.createEvent("CustomEvent");r.initCustomEvent("performance_edit_hidden_input_inited",!0,!0,{}),document.dispatchEvent(r),t=(0,o.__read)([this.onInput,this.onCompositionStart].map((function(t){return function(){e.props.context.usePermissionRangeMode()?e.props.service.getPermissionRange().checkPermissionRange()&&t.call(e):t.call(e)}})),2),this.onInput=t[0],this.onCompositionStart=t[1],this.props.context.isEditable()&&this.props.scrollHandler.addScrollListener(this.followScreenView)},e.prototype.componentWillUnmount=function(){this.props.context.removeListener(M.kgn.CARET_CHANGE,this),this.props.context.isEditable()&&this.props.scrollHandler.removeScrollListener(this.followScreenView)},e.prototype.onSelectionChanged=function(t){var e,r,n;(null===(r=null===(e=null==t?void 0:t.option)||void 0===e?void 0:e.customData)||void 0===r?void 0:r.temporaryInput)||t.viewRange&&(this.viewRange=t.viewRange,t.option&&void 0!==t.option.forceFocus?this.forceFocus=t.option.forceFocus:this.forceFocus=!0,(null===(n=this.props.context.surface)||void 0===n?void 0:n.isEditable())&&this.update(),this.viewRange.isCaret()||this.clearInput())},e.prototype.requestFocus=function(t,e){var r,n,i,o;e&&this.inputDomRef&&!(null===(n=null===(r=this.props)||void 0===r?void 0:r.context)||void 0===n?void 0:n.isInBlockState())?null===(i=this.inputDomRef)||void 0===i||i.focus():this.compositionId?this.endComposition(!1):(t&&(this.viewRange=t),this.forceFocus=!0,(null===(o=this.props.context.surface)||void 0===o?void 0:o.isEditable())&&(this.clearInput(!0),this.update(),this.setFocus()),this.props.context.fire(new M.D_l(M.cbw.ON_REQUEST_FOCUS,t)))},e.prototype.requestBlur=function(){this.inputDomRef&&this.isFocus&&(this.compositionId?this.endComposition():this.clearInput(),this.inputDomRef.blur()),this.props.context.fire(new M.D_l(M.cbw.ON_REQUEST_BLUR))},e.prototype.setFocus=function(){var t=this;this.props.context.isInBlockState()||setTimeout((function(){t.inputDomRef&&t.inputDomRef.focus({preventScroll:!0})}),100)},e.checkAndUpdateOffset=function(t){var e={x:t.x,y:t.y,docWidth:t.docWidth,docHeight:t.docHeight};return t.x<0&&(e.x=0),t.x>t.docWidth&&(e.x=t.docWidth),t.y<0&&(e.y=0),t.y>t.docHeight&&(e.y=t.docHeight),e},e.prototype.getHiddenEditorPosition=function(t){var r=this.props.scrollHandler.getScrollRoot();if(!r){var n=t.start.getDocumentOffset(this.props.zoom());if(0===n.x&&0===n.y&&0===n.docWidth&&0===n.docHeight)return{x:0,y:0};n=e.checkAndUpdateOffset(n);var i=this.props.context.view.getPadding(),o=t.start.caretHeight(this.props.zoom());return{x:n.x+(i.left||0),y:n.y+(i.top||0)+o-5}}return{x:r.scrollLeft/this.props.zoom(),y:r.scrollTop/this.props.zoom()}},e.prototype.update=function(){if(this.viewRange&&!this.props.context.isInBlockState()&&(this.isFocus||this.forceFocus)){var t=this.getHiddenEditorPosition(this.viewRange);this.setState({posX:t.x,posY:t.y}),this.props.context.fire(new c.fV(c.Dk.ON_POS_UPDATE,this.viewRange),!1)}},e.prototype.onCompositionStart=function(){var t;this.compositionId&&this.endComposition(),(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable())&&(this.compositionId="input_".concat(i.StringUtil.generateRandomId()),this.props.state.compositionStart(this.compositionId,!0),this.props.context.fire(new c.fV(c.Dk.ON_COMPOSITION_START,null))),this.clearInput(!0)},e.prototype.onCompositionUpdate=function(t){var e;if(null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable()){var r=t.nativeEvent.data;this.props.state.compositionUpdate(this.compositionId,r,!0)}this.clearInput(!0)},e.prototype.onCompositionEnd=function(t){var e;if(null===(e=this.props.context.surface)||void 0===e?void 0:e.isEditable()){var r=t.nativeEvent.data;this.props.state.compositionEnd(this.compositionId,r),this.props.context.fire(new c.fV(c.Dk.ON_COMPOSITION_END,r))}this.compositionId="",this.clearInput(!0)},e.prototype.onInput=function(){var t=this;this.timeoutId&&clearTimeout(this.timeoutId),this.beforeFinish=!0,this.timeoutId=setTimeout((function(){t.finishInput(),t.beforeFinish=!1,t.timeoutId=null}),0)},e.prototype.finishInput=function(){var t;if(this.inputDomRef&&!this.compositionId&&(null===(t=this.props.context.surface)||void 0===t?void 0:t.isEditable())){var e=this.inputDomRef.textContent||"";i.Logger.info("hiddeneditor=== textContent: ".concat(escape(this.inputDomRef.textContent)));var r=e.replace(this.spaceReg,g.IfD.Space);i.Logger.info("hiddeneditor=== findDiff[".concat(escape(this.cacheInput),",").concat(escape(r),"]"));var n=this.findDiff(this.cacheInput,r),o=n.toDeleteLength,a=n.toInputValue;i.Logger.info("hiddeneditor=== finishInput[toDeleteLength: ".concat(o,", toInputValue: ").concat(a,"]"));var s=this.props.state.selection.gcpRange;if(o&&s.isEmpty()){var l=new g.ICE(s.begin()-o,o);l.isValid()&&(i.Logger.info("hiddeneditor=== delete[".concat(l.begin(),", ").concat(l.length(),"}")),this.props.service.getSelection().delete(l))}var p=this.removeZeroWidthBreakSpace(a);if(this.props.service.getSelection().getText().startsWith(g.IfD.TableStart)){var u=this.props.service.getSelection().range().begin()+1;this.props.service.getSelection().setRange(u,u)}p&&this.props.service.getSelection().typeText(p),this.cacheInput=r,i.Logger.info("hiddeneditor=== finishInput[".concat(escape(p),"], cacheInput[").concat(escape(this.cacheInput),"]")),p&&this.props.context.fire(new c.fV(c.Dk.ON_INPUT,p))}},e.prototype.onClipboardEvent=function(t){t.preventDefault()},e.prototype.onFocus=function(t){t.preventDefault(),this.isFocus=!0,this.props.context.fire(new M.D_l(M.cbw.ON_FOCUS))},e.prototype.onBlur=function(t){var e=this;t.preventDefault(),this.isFocus=!1,this.clearInput(),setTimeout((function(){e.isFocus||e.props.context.fire(new M.D_l(M.cbw.ON_BLUR))}),300)},e.prototype.onKeyDown=function(t){t.keyCode===p.VD.ENTER?this.compositionId?this.endComposition():this.clearInput(!0):t.keyCode===p.VD.BACKSPACE?this.cacheInput&&this.cacheInput!==pi||this.props.context.run("backspace"):t.keyCode===p.VD.ARROW_LEFT&&this.beforeFinish&&this.props.context.run($n.ARROW_RIGHT)},e.prototype.endComposition=function(t){void 0===t&&(t=!0),this.compositionId&&(this.props.state.compositionEnd(this.compositionId,this.props.state.getCompositionText(),t),this.props.context.fire(new c.fV(c.Dk.ON_COMPOSITION_END,this.props.state.getCompositionText()))),this.compositionId="",this.clearInput()},e.prototype.findDiff=function(t,e){t=t.replace(ui,""),e=e.replace(ui,"");for(var r=0;r<t.length&&r<e.length&&t[r]===e[r];)r+=1;return{toDeleteLength:t.length-r,toInputValue:e.substring(r,e.length)}},e.prototype.removeZeroWidthBreakSpace=function(t){return t.replace(/\uFEFF/g,"")},e.prototype.clearInputOnChange=function(t){if(t){t.length>1&&this.clearInput();var e=t.charCodeAt(t.length-1);(e<33||e>126)&&65281!==e&&65292!==e&&65311!==e&&12290!==e&&this.clearInput()}},e.prototype.clearInput=function(t){if(void 0===t&&(t=!1),this.cacheInput=pi,this.inputDomRef){i.Logger.info("hiddeneditor=== clearInput[".concat(escape(this.inputDomRef.textContent),"]")),this.inputDomRef.textContent=pi;var e=document.getSelection();if(t&&e&&this.inputDomRef.firstChild){var r=document.createRange();r.setStart(this.inputDomRef.firstChild,gi),r.collapse(!0),e.removeAllRanges(),e.addRange(r)}}},e.prototype.render=function(){var t=this;return Ln().createElement("div",{id:Wn,contentEditable:this.contentEditable,ref:function(e){t.inputDomRef=e},autoCapitalize:"off",onInput:this.onInput.bind(this),onCompositionStart:this.onCompositionStart.bind(this),onCompositionUpdate:this.onCompositionUpdate.bind(this),onCompositionEnd:this.onCompositionEnd.bind(this),onCopy:this.onClipboardEvent.bind(this),onCut:this.onClipboardEvent.bind(this),onPaste:this.onClipboardEvent.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),onKeyDown:this.onKeyDown.bind(this),spellCheck:!1,tabIndex:-1,style:{left:this.state.posX,top:this.state.posY}})},e}(Ln().Component),di=r(25606),fi=r(86538),yi=function(t){for(var e=t.leafBox;e&&!(0,fi.sJ)(e)&&!(0,fi.t$)(e);)e=e.parentBox;return(0,fi.sJ)(e)?e:null},vi=function(t){for(var e=t.leafBox;e&&!(0,fi.$5)(e)&&!(0,fi.t$)(e);)e=e.parentBox;return(0,fi.$5)(e)?e:null},mi=function(t,e){return new g.ICE(t,e-t+1)},Si=function(t){var e=t.movingPoint,r=t.viewRange,n=t.editor,i=t.state,o=cr.s9.getOutestTableBox(e.leafBox);if(o){var a=void 0;if(cr.s9.getOutestTableBox(r.start.leafBox))a=function(t){var e,r=t.movingPoint,n=t.box,i=t.selection,o=yi(r),a=cr.MM.getPrevBox(o),s=vi(r),l=s.getSiblingIndex(),c=i.range(),p=c.len>0,u=s.getRanges()[0],h=u.begin(),d=u.end();if((0,fi.sJ)(a)){var f=a.children[l].getRanges()[0],y=f.begin(),v=f.end();e=p?c.contains(y)?new g.ICE(i.getStart(),v-i.getStart()):new g.ICE(y,i.getEnd()-y):new g.ICE(y,d-y)}else if(p){var m=n.getRange();if(m.equal(c)&&a){var S=a.getRangeBegin();e=new g.ICE(S,c.end()-S)}else{var b=m.begin(),C=m.end();e=new g.ICE(b,C-b)}}else e=new g.ICE(h,d-h);return e}({movingPoint:e,box:o,selection:n.service.getSelection(),textStream:i.getTextStream()});else{var s=cr.MM.getPrevBox(o);a=mi(n.selection.gcpRange.gcpBegin,s.getRangeEnd())}return n.setRangeTo(a),!0}return!1},bi=function(t){var e=t.movingPoint,r=t.viewRange,n=t.editor,i=t.state,o=cr.s9.getOutestTableBox(e.leafBox);if(o){var a=void 0;if(cr.s9.getOutestTableBox(r.start.leafBox))a=function(t){var e,r=t.movingPoint,n=t.box,i=t.selection,o=yi(r),a=cr.MM.getNextBox(o),s=vi(r),l=s.getSiblingIndex(),c=i.range(),p=c.len>0,u=s.getRanges()[0],h=u.begin(),d=u.end();if((0,fi.sJ)(a)){var f=a.children[l].getRanges()[0],y=f.begin(),v=f.end();e=p?c.contains(v)?new g.ICE(y,i.getEnd()-y):new g.ICE(i.getStart(),v-i.getStart()):new g.ICE(h,v-h)}else if(p){var m=n.getRange();if(m.equal(c)&&a){var S=a.getRangeEnd();e=new g.ICE(c.begin(),S-c.begin())}else{var b=m.begin(),C=m.end();e=new g.ICE(b,C-b)}}else e=new g.ICE(h,d-h);return e}({movingPoint:e,box:o,selection:n.service.getSelection(),textStream:i.getTextStream()});else{var s=cr.MM.getNextBox(o);a=mi(n.selection.gcpRange.gcpBegin,s.getRangeEnd())}return n.setRangeTo(a),!0}return!1};!function(t){t[t.START=0]="START",t[t.END=1]="END",t[t.UNDEFINED=2]="UNDEFINED"}(ci||(ci={}));var Ci,Pi,Ti=function(){function t(t,e,r){var n=this;this.range=g.ICE.emptyRange(),this.movingPoint=ci.UNDEFINED,this.setRangeBackward=function(t,e){var r=!0;n.movingPoint===ci.END?e>t.begin()?(r=!1,n.range=n.handleMultiRange(t,e,r)):(n.range=new g.ICE(e,t.begin()-e),n.movingPoint=ci.START):n.range=new g.ICE(e,t.end()-e),n.editor.service.getSelection().setRange(n.range.begin(),n.range.end(),{scrollToView:u.hF.Near,backward:r})},this.setRangeForward=function(t,e){var r=!1;n.movingPoint===ci.START?e<t.end()?(r=!0,n.range=n.handleMultiRange(t,e,r)):(n.range=new g.ICE(t.end(),e-t.end()),n.movingPoint=ci.END):n.range=new g.ICE(t.begin(),e-t.begin()),n.editor.service.getSelection().setRange(n.range.begin(),n.range.end(),{scrollToView:u.hF.Near,backward:r})},this.editor=t,this.state=e,this.selector=r,this.editor.on(u.at.CoreSelectionChange,(function(t){n.onCoreSelectionChanged(t)}),this)}return t.prototype.onCoreSelectionChanged=function(t){(null==t?void 0:t.range)&&(t.range.equal(this.range)||(0===t.range.length()?this.movingPoint=ci.UNDEFINED:t.option&&t.option.backward&&(this.movingPoint=t.option.backward?ci.START:ci.END)))},t.prototype.moveLeft=function(){var t=this.editor.service.getSelection(),e=this.editor.docEnv.renderType!==g.y2q.Lite,r=t.range(),n=r.begin(),i=n>1&&n-1-t.skipAnchors(n-1,!0,e)>0,o=t.skipAnchors(n,!0,e);if(r.length()>0)this.editor.service.getSelection().setRange(o,o,{scrollToView:u.hF.Near});else{var a=this.editor.service.getSelection().prevTextBreak(o,{skipField:!1});i&&(a=t.skipAnchors(a,!0,e)),this.editor.service.getSelection().setRange(a,a,{scrollToView:u.hF.Near})}},t.prototype.moveRight=function(){var t=this.editor.service.getSelection(),e=this.editor.docEnv.renderType!==g.y2q.Lite,r=t.range(),n=t.skipAnchors(r.end(),!1,e);if(r.length()>0)this.editor.service.getSelection().setRange(n,n,{scrollToView:u.hF.Near});else{var i=this.editor.service.getSelection().nextTextBreak(n);this.editor.service.getSelection().setRange(i,i,{scrollToView:u.hF.Near})}},t.prototype.moveUp=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getCurrentLineBox(t.start);if(e){var r,n=this.getLinePosFromViewPoint(t.start),o=cr.s9.getPosFromLineToTableCell(n,e,!1);o&&(r=o.lineInTableBox,n=(0,i.twipsToPx)(o.lineInTablePos));var a,s=cr.s9.getPosFromTableCellToLine(n,e,!1);s&&(r=s.lineOutsideTableBox,n=(0,i.twipsToPx)(s.lineOutsideTablePos)),r||(r=cr.MM.getVerticalPrevLineBox(e)),null!==(a=(r=cr.wl.filterNextLineBoxForHeaderFooter(e,r,!1))?this.moveToLinePointByPosition(r,n):this.selector.moveToLinePoint(e,!0))&&(this.range=new g.ICE(a,0))}}else this.moveUpInLite(t)},t.prototype.moveUpInLite=function(t){var e=t.start.linePosOffset(),r=this.moveVerticallyLite(e,t.start,!0);void 0!==r&&(this.editor.service.getSelection().setRange(r,r,{scrollToView:u.hF.Near}),this.range=new g.ICE(r,0))},t.prototype.readonlyMoveUp=function(){var t=this.editor.scrollHandler.getScrollRootSize(),e=(t.bottom-t.top)/(10*this.editor.zoom);this.editor.scrollHandler.scrollBy(0,-e,"smooth")},t.prototype.readonlyMoveDown=function(){var t=this.editor.scrollHandler.getScrollRootSize(),e=(t.bottom-t.top)/(10*this.editor.zoom);this.editor.scrollHandler.scrollBy(0,e,"smooth")},t.prototype.moveDown=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getCurrentLineBox(t.end);if(e){var r,n=this.getLinePosFromViewPoint(t.start),o=cr.s9.getPosFromLineToTableCell(n,e,!0);o&&(r=o.lineInTableBox,n=(0,i.twipsToPx)(o.lineInTablePos));var a,s=cr.s9.getPosFromTableCellToLine(n,e,!0);s&&(r=s.lineOutsideTableBox,n=(0,i.twipsToPx)(s.lineOutsideTablePos)),r||(r=cr.MM.getVerticalNextLineBox(e)),(r=cr.wl.filterNextLineBoxForHeaderFooter(e,r,!0))?(a=this.moveToLinePointByPosition(r,n))&&(a=this.fixGcpBySkippingAnchors(a,!1)):a=this.selector.moveToLinePoint(e,!1),null!==a&&(this.range=new g.ICE(a,0))}}else this.moveDownInLite(t)},t.prototype.moveDownInLite=function(t){var e=t.end.linePosOffset(),r=this.moveVerticallyLite(e,t.end,!1);void 0!==r&&(this.editor.service.getSelection().setRange(r,r,{scrollToView:u.hF.Near}),this.range=new g.ICE(r,0))},t.prototype.selectLeft=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getMovingPointGcp(e,ci.START),n=t.getDecodedFieldInfo(r);r=t.prevTextBreak(r,{skipField:!n});var i=this.editor.viewSelection.getViewRange();(function(t){var e=t.selection,r=t.state,n=t.gcp,i=t.setRangeBackward,o=t.getMovingPoint,a=t.viewRange,s=e.range(),l=r.getTextStream().readText(n,1);if(l===g.IfD.TableCellBreak){var c=e.getTableSelectionService().getPrevCellRange();if(c){var p=r.getTableStream().getCellInfo(s.begin());if(p)return i(new g.ICE(s.begin(),Math.max(p.range.end(),s.end())-s.begin()),c.begin()),!0}}if(l===g.IfD.TableRowBreak){if(r.getTextStream().readText(n-1,1)===g.IfD.TableStart)i(s,n-1);else{var u=o(a,ci.START),h=yi(u);i(s,cr.MM.getPrevBox(h).getRangeBegin())}return!0}var d=r.getTableStream().getTableInfo(n);return!(e.isInTable()||!d||(i(s,d.range.begin()),0))})({selection:t,state:this.state,gcp:r,setRangeBackward:this.setRangeBackward,getMovingPoint:this.getMovingPoint,viewRange:i})||this.setRangeBackward(e,r)},t.prototype.selectRight=function(){var t=this.editor.service.getSelection(),e=t.range(),r=this.getMovingPointGcp(e,ci.END),n=t.getDecodedFieldInfo(r),i=this.editor.service.getSelection().nextTextBreak(r,{skipField:!n});(function(t){var e=t.state,r=t.originGcp,n=t.gcp,i=t.viewRange,o=t.getMovingPoint,a=t.selection,s=t.setRangeForward,l=a.range(),c=e.getTextStream().readText(r,1),p=e.getTextStream().readText(r-1,1);if(c===g.IfD.TableRowBreak){if(e.getTextStream().readText(n,1)===g.IfD.TableEnd)s(l,n+1);else{var u=o(i,ci.END),h=yi(u);s(l,cr.MM.getNextBox(h).getRangeEnd())}return!0}if(p===g.IfD.TableCellBreak){var d=a.getTableSelectionService().getNextCellRange();if(d){var f=e.getTableStream().getCellInfo(l.begin());if(f){var y=Math.min(f.range.begin(),l.begin());return s(new g.ICE(y,l.end()-y),d.end()),!0}}}var v=e.getTableStream().getTableInfo(n);return!(a.isInTable()||!v||(s(l,v.range.end()),0))})({gcp:i,originGcp:r,viewRange:this.editor.viewSelection.getViewRange(),getMovingPoint:this.getMovingPoint,setRangeForward:this.setRangeForward,selection:t,state:this.state})||this.setRangeForward(e,i)},t.prototype.selectUp=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ci.START);if(this.editor.docEnv.renderType!==g.y2q.Lite){var r=this.getCurrentLineBox(e);if(r){var n=this.getLinePosFromViewPoint(e);if(!Si({movingPoint:e,viewRange:t,editor:this.editor,state:this.state})){var i=this.getPrevLineBoxGcp(r,n,t.start.gcp,e);null!==i&&this.setRangeBackward(this.editor.service.getSelection().range(),i)}}}else this.selectUpInLite(e)}},t.prototype.selectDown=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ci.END);if(this.editor.docEnv.renderType!==g.y2q.Lite){var r=this.getCurrentLineBox(e);if(r){var n=this.getLinePosFromViewPoint(e);if(!bi({movingPoint:e,viewRange:t,editor:this.editor,state:this.state})){var i=this.getNextLineBoxGcp(r,n,t.end.gcp,e);null!==i&&this.setRangeForward(this.editor.service.getSelection().range(),i)}}}else this.selectDownInLite(e)}},t.prototype.getPrevLineBoxGcp=function(t,e,r,n){for(var i=cr.MM.getVerticalPrevLineBox(t),o=this.getGcpLineStart(t);i;){if(!(0,c.sJ)(i)){o=this.getGcpByLinePos(i,e);var a=t.getRange();this.movingPoint===ci.START&&o===a.begin()&&(o=this.editor.service.getSelection().prevTextBreak(o));break}var s=this.getGcpLineStart(t);if(s&&r>s){o=s;break}i=i.parentBox,i=cr.MM.getPrevBoxSkipHidden(i)}return o},t.prototype.getNextLineBoxGcp=function(t,e,r,n){for(var i=cr.MM.getVerticalNextLineBox(t),o=this.getGcpLineEnd(t);i;){if(!(0,c.sJ)(i)){o=this.getGcpByLinePos(i,e);var a=t.getRange();this.movingPoint===ci.END&&o===a.end()&&n.gcp!==a.begin()&&(o=this.editor.service.getSelection().nextTextBreak(o));break}var s=this.getGcpLineEnd(t);if(s&&r<s){o=s;break}i=i.parentBox,i=cr.MM.getNextBoxSkipHidden(i)}return o},t.prototype.getGcpByPosNearBy=function(t,e){var r,n,a;!function(t){t.Left="left",t.Right="right"}(a||(a={}));var s=Number.MAX_SAFE_INTEGER,l=t,c=a.Left,p=(0,i.pxToTwips)(e);try{for(var u=(0,o.__values)(t.children),g=u.next();!g.done;g=u.next()){var h=g.value,d=h.getOuterPoint().x,f=d+h.totalWidth;if(d<=p&&p<=f){c=p-d>f-p?a.Right:a.Left,l=h;break}if(d>p){d-p<s&&(c=a.Left,l=h);break}s=f-e,l=h,c=a.Right}}catch(t){r={error:t}}finally{try{g&&!g.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}var y=l.getRange();return c===a.Left?y.begin():y.end()},t.prototype.selectUpInLite=function(t){var e=t.linePosOffset(),r=this.moveVerticallyLite(e,t,!0);void 0!==r&&this.setRangeBackward(this.editor.service.getSelection().range(),r)},t.prototype.selectDownInLite=function(t){var e=t.linePosOffset(),r=this.moveVerticallyLite(e,t,!1);void 0!==r&&this.setRangeForward(this.editor.service.getSelection().range(),r)},t.prototype.moveToWordLeft=function(){var t=this.editor.service.getSelection().range().begin();t=this.editor.service.getSelection().prevSkipSpace(t),t=this.editor.service.getSelection().prevWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:u.hF.Near})},t.prototype.moveToWordRight=function(){var t=this.editor.service.getSelection().range().end();t=this.editor.service.getSelection().nextSkipSpace(t),t=this.editor.service.getSelection().nextWordBreak(t),this.editor.service.getSelection().setRange(t,t,{scrollToView:u.hF.Near})},t.prototype.selectToWordLeft=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ci.START);e=this.editor.service.getSelection().prevSkipSpace(e),e=this.editor.service.getSelection().prevWordBreak(e,{skipField:!0}),this.setRangeBackward(t,e)},t.prototype.selectToWordRight=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ci.END);e=this.editor.service.getSelection().nextSkipSpace(e),e=this.editor.service.getSelection().nextWordBreak(e,{skipField:!0}),this.setRangeForward(t,e)},t.prototype.moveToLineStart=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getCurrentLineBox(t.start);e&&this.selector.moveToLinePoint(e,!0)}else{var r=this.moveHorizontallyLite(null==t?void 0:t.start,!0),n=this.editor.service;r&&n.getSelection().setRange(r,r,{scrollToView:u.hF.Near})}},t.prototype.moveToLineEnd=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getCurrentLineBox(t.end);e&&this.selector.moveToLinePoint(e,!1)}else{var r=this.moveHorizontallyLite(null==t?void 0:t.end,!1),n=this.editor.service;r&&n.getSelection().setRange(r,r,{scrollToView:u.hF.Near})}},t.prototype.moveToParaStart=function(){var t=this.editor.service,e=t.getSelection().range(),r=this.getMovingPointGcp(e,ci.START),n=t.getSelection().getParaRange(r);if(n){var i=null==n?void 0:n.begin();t.getSelection().setRange(i,i,{scrollToView:u.hF.Near})}},t.prototype.moveToParaEnd=function(){var t=this.editor.service,e=t.getSelection().range(),r=t.getSelection().storyLength(),n=this.getMovingPointGcp(e,ci.END),i=t.getSelection().getParaRange(n);if(i){var o=i.begin()+i.length()===r?i.end():i.end()-1;t.getSelection().setRange(o,o,{scrollToView:u.hF.Near})}},t.prototype.selectToLineStart=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getMovingPoint(t,ci.START),r=this.getCurrentLineBox(e);if(r){var n=this.getGcpLineStart(r);null!==n&&this.setRangeBackward(this.editor.service.getSelection().range(),n)}}else{var i=this.moveHorizontallyLite(null==t?void 0:t.start,!0);i&&this.setRangeBackward(this.editor.service.getSelection().range(),i)}},t.prototype.selectToLineEnd=function(){var t=this.editor.viewSelection.getViewRange();if(t)if(this.editor.docEnv.renderType!==g.y2q.Lite){var e=this.getMovingPoint(t,ci.END),r=this.getCurrentLineBox(e);if(r){var n=this.getGcpLineEnd(r);null!==n&&this.setRangeForward(this.editor.service.getSelection().range(),n)}}else{var i=this.moveHorizontallyLite(null==t?void 0:t.end,!1);i&&this.setRangeForward(this.editor.service.getSelection().range(),i)}},t.prototype.selectToParaStart=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ci.START),r=this.editor.service.getSelection().getParaRange(e);t.end()!==(null==r?void 0:r.begin())&&t.begin()!==(null==r?void 0:r.begin())||(r=this.editor.service.getSelection().getParaRange(r.begin()-1)),r&&this.setRangeBackward(t,r.begin())},t.prototype.selectToParaEnd=function(){var t=this.editor.service.getSelection().range(),e=this.getMovingPointGcp(t,ci.END),r=this.editor.service.getSelection().getParaRange(e);t.end()===(null==r?void 0:r.end())&&(r=this.editor.service.getSelection().getParaRange(r.end()+1)),r&&this.setRangeForward(t,r.end())},t.prototype.moveToPrevPage=function(){var t,e,r,n=this.editor.viewSelection.getViewRange();if(n){var a=this.getMovingPoint(n,ci.END),s=cr.MM.getOffsetPoint(a.lineBox,c.uO.Document),l=this.editor.getDocumentBox(),p=this.editor.scrollHandler.getScrollRootSize(),h=.85*(p.bottom-p.top)/this.editor.zoom;s.y=s.y-(0,i.pxToTwips)(h)-a.caretHeight();var d=this.editor.service.getSelection().storyRange().begin(),f=(0,o.__read)(cr.MM.getLeastGrandsonByPoint(l,s),1)[0];(0,c.$5)(f)?f=null===(e=null===(t=f.parentBox)||void 0===t?void 0:t.parentBox)||void 0===e?void 0:e.prevSibling:(0,c.sJ)(f)&&(f=null===(r=f.parentBox)||void 0===r?void 0:r.prevSibling),f&&(d=f.getRangeBegin()),this.editor.setRangeTo(new g.ICE(d),{scrollToView:u.hF.Top})}},t.prototype.moveToNextPage=function(){var t,e,r,n=this.editor.viewSelection.getViewRange();if(n){var a=this.getMovingPoint(n,ci.END),s=cr.MM.getOffsetPoint(a.lineBox,c.uO.Document),l=this.editor.getDocumentBox(),p=this.editor.scrollHandler.getScrollRootSize(),h=.85*(p.bottom-p.top)/this.editor.zoom;s.y=s.y+(0,i.pxToTwips)(h)+a.caretHeight();var d=this.editor.service.getSelection().storyRange().end(),f=(0,o.__read)(cr.MM.getLeastGrandsonByPoint(l,s),1)[0];(0,c.$5)(f)?f=null===(e=null===(t=f.parentBox)||void 0===t?void 0:t.parentBox)||void 0===e?void 0:e.nextSibling:(0,c.sJ)(f)&&(f=null===(r=f.parentBox)||void 0===r?void 0:r.nextSibling),f&&(d=f.getRangeEnd()),this.editor.setRangeTo(new g.ICE(d),{scrollToView:u.hF.Top})}},t.prototype.selectToPrevPage=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ci.START),r=cr.MM.getOffsetPoint(e.lineBox,c.uO.Document),n=this.editor.getDocumentBox(),a=this.editor.scrollHandler.getScrollRootSize(),s=a.bottom-a.top;r.y=r.y-(0,i.pxToTwips)(s)-e.caretHeight();var l=this.editor.service.getSelection().storyRange().begin(),p=(0,o.__read)(cr.MM.getGrandsonByPoint(n,c.uO.Line,r),2),u=p[0];p[1],u&&(l=u.getRangeBegin()),this.setRangeBackward(this.editor.service.getSelection().range(),l)}},t.prototype.selectToNextPage=function(){var t=this.editor.viewSelection.getViewRange();if(t){var e=this.getMovingPoint(t,ci.END),r=cr.MM.getOffsetPoint(e.lineBox,c.uO.Document),n=this.editor.getDocumentBox(),a=this.editor.scrollHandler.getScrollRootSize(),s=a.bottom-a.top;r.y=r.y+(0,i.pxToTwips)(s)+e.caretHeight();var l=this.editor.service.getSelection().storyRange().end(),p=(0,o.__read)(cr.MM.getGrandsonByPoint(n,c.uO.Line,r),2),u=p[0];p[1],u&&(l=u.getRangeEnd()),this.setRangeForward(this.editor.service.getSelection().range(),l)}},t.prototype.moveToStoryStart=function(){var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.begin(),t.begin(),{scrollToView:u.hF.Near})},t.prototype.moveToStoryEnd=function(){var t=this.editor.service.getSelection().storyRange();this.editor.service.getSelection().setRange(t.end(),t.end(),{scrollToView:u.hF.Near})},t.prototype.selectToStoryStart=function(){this.movingPoint=ci.START;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeBackward(t,e.begin())},t.prototype.selectToStoryEnd=function(){this.movingPoint=ci.END;var t=this.editor.service.getSelection().range(),e=this.editor.service.getSelection().storyRange();this.setRangeForward(t,e.end())},t.prototype.selectAll=function(){this.editor.service.getSelection().wholeStory()},t.prototype.selectWord=function(t){this.editor.service.getSelection().selectWord(t)},t.prototype.selectParagraph=function(t){this.editor.service.getSelection().selectParagraph(t)},t.prototype.getMovingPoint=function(t,e){var r;return e===ci.START?this.movingPoint===ci.END?r=t.end:(this.movingPoint=e,r=t.start):e===ci.END&&(this.movingPoint===ci.START?r=t.start:(this.movingPoint=e,r=t.end)),r},t.prototype.getMovingPointGcp=function(t,e){var r;return e===ci.START?this.movingPoint===ci.END?r=this.fixGcpBySkippingAnchors(t.end(),!0):(this.movingPoint=e,r=this.fixGcpBySkippingAnchors(t.begin(),!0)):e===ci.END&&(this.movingPoint===ci.START?r=this.fixGcpBySkippingAnchors(t.begin(),!1):(this.movingPoint=e,r=this.fixGcpBySkippingAnchors(t.end(),!1))),r=r>0?r:0},t.prototype.fixGcpBySkippingAnchors=function(t,e){var r=this.editor.docEnv.renderType!==g.y2q.Lite;return this.editor.service.getSelection().skipAnchors(t,e,r)},t.prototype.getCurrentLineBox=function(t){if(t instanceof M.SE$){for(var e=t.leafBox.parentBox;e&&!(0,c.o7)(e);)e=e.parentBox;if((0,c.o7)(e))return e}return null},t.prototype.getGcpByLinePos=function(t,e){for(var r;!(0,c.o7)(t);){if(!t.firstChild)return this.getGcpByPosNearBy(t,e);t=t.firstChild}var n=new i.MeloPoint;n.x=(0,i.pxToTwips)(e),n.y=null!==(r=t.rect.height/2)&&void 0!==r?r:0;var a=(0,o.__read)(cr.MM.getGrandsonByPoint(t,c.uO.Text,n),2),s=a[0],l=a[1];if(s&&l){var p=cr.MM.getOffsetByPosition(s,(0,i.twipsToPx)(l.x)).offsetUString,u=s.getRange().begin()+p,g=s.parentBox;return(0,c.tq)(g)?s.getRangeEnd()-1-u>u-s.getRangeBegin()?g.getRangeBegin():g.getRangeEnd()-1:u}return this.getGcpByPosNearBy(t,e)},t.prototype.getGcpLineStart=function(t){for(var e=null==t?void 0:t.firstChild;e;){if((0,c.NF)(e))return e.getRangeBegin();e=e.firstChild}return null},t.prototype.getGcpLineEnd=function(t){for(var e=null==t?void 0:t.lastChild;e;){if((0,c.NF)(e))return e.getRangeEnd();e=e.lastChild}return null},t.prototype.moveToLinePointByPosition=function(t,e){var r=this.getGcpByLinePos(t,e);return r!==t.getRange().end()?this.editor.service.getSelection().setRange(r,r,{scrollToView:u.hF.Near}):r=this.selector.moveToLinePoint(t,!1),r},t.prototype.handleMultiRange=function(t,e,r){var n=this.state.dataEngine.getDataStream().getFieldStream(),i=n.getNestingFieldInfos(t),o=n.getFieldRange(e,1),a=t.begin(),s=t.end();return o?1===i.length?r?new g.ICE(e,o.fieldResultRange.end()-e):new g.ICE(o.fieldResultRange.begin(),e-o.fieldResultRange.begin()):r?new g.ICE(o.fieldRange.end(),s-o.fieldRange.end()):new g.ICE(a,o.fieldRange.begin()-a):r?new g.ICE(e,s-e):new g.ICE(a,e-a)},t.prototype.moveVerticallyLite=function(t,e,r){var n,o,a,s,l,p;try{var u=void 0;if(r){var h=(0,i.twipsToPx)((null===(o=null===(n=e.paraBox)||void 0===n?void 0:n.property)||void 0===o?void 0:o.spacing.before)||0);if((y=e.paraPosOffset(this.editor.zoom)).y>h)u={clientX:t+(v=e.paraBox.__node__).getBoundingClientRect().x,clientY:y.y*this.editor.zoom+v.getBoundingClientRect().y-3,element:v};else{var d=e.paraBox.prevSibling;if(!(0,c.FG)(d))return;u={clientX:t+(v=d.__node__).getBoundingClientRect().x,clientY:v.getBoundingClientRect().bottom-(0,i.twipsToPx)((null==d?void 0:d.property)instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&(null===(a=null==d?void 0:d.property)||void 0===a?void 0:a.spacing.after)||0)*this.editor.zoom-3,element:v}}}else{var f=(0,i.twipsToPx)((null===(l=null===(s=e.paraBox)||void 0===s?void 0:s.property)||void 0===l?void 0:l.spacing.after)||0),y=e.paraPosOffset(this.editor.zoom),v=e.paraBox.__node__;if((y.y+e.lineHeight+f)*this.editor.zoom+3<v.getBoundingClientRect().height)u={clientX:t+v.getBoundingClientRect().x,clientY:(y.y+e.lineHeight)*this.editor.zoom+v.getBoundingClientRect().y+3,element:v};else{if(d=e.paraBox.nextSibling,!(0,c.FG)(d))return;u={clientX:t+(v=d.__node__).getBoundingClientRect().x,clientY:v.getBoundingClientRect().top+(0,i.twipsToPx)((null==d?void 0:d.property)instanceof g.kkf.getPropertyClass(g.uSS.ParagraphProperty)&&(null===(p=null==d?void 0:d.property)||void 0===p?void 0:p.spacing.before)||0)*this.editor.zoom+3,element:v}}}if(u){var m=this.selector.findViewPoint(u,!0);if(m)return m.gcp}}catch(t){return}},t.prototype.moveHorizontallyLite=function(t,e){var r,n=t.paraPosOffset(this.editor.zoom),i=t.paraBox.__node__;if(i){var o=i.getBoundingClientRect(),a=o.x,s=o.y,l=o.width;r=e?{clientX:a,clientY:s+n.y+t.lineHeight/2,element:i}:{clientX:a+l,clientY:s+n.y+t.lineHeight/2,element:i}}var c=this.selector.findViewPoint(r,!0);if(c)return c.gcp},t.prototype.getLinePosFromViewPoint=function(t){var e,r=(0,i.twipsToPx)(t.linePosOffset());if(t.leafBox.parentBox&&(0,c.Jt)(t.leafBox.parentBox)){var n=t.leafBox.parentBox,o=n.getOuterPoint().x+n.edge.margin.left;e=(0,i.twipsToPx)(o)+r}else e=r;return e},t}();!function(t){t.BACKSPACE="backspace",t.DELETE="delete",t.TAB="tab",t.SHIFT_TAB="shiftTab",t.ENTER="enter",t.LINE_BREAK="line_break",t.BACKSPACE_WORD="backspace_word",t.DELETE_WORD="delete_word",t.BACKSPACE_LINE="backspace_line",t.BACKSPACE_NONE="backspace_none",t.UNDO="undo",t.REDO="redo",t.PURE_REDO="pure_redo"}(Ci||(Ci={}));var Ri,_i,Ii,wi=((Pi={})[Ci.BACKSPACE]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){if(t.isCompositing())return;var r=t.service.getSelection(),n=t.docEnv.renderType!==g.y2q.Lite;r.typeBackspace(n)}},Pi[Ci.DELETE]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().delete()}},Pi[Ci.ENTER]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeParagraph()}},Pi[Ci.LINE_BREAK]=function(t,e){t&&t instanceof di.zq&&t.isEditable()&&t.service.getSelection().typeLineBreak()},Pi[Ci.TAB]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeText("\t")}},Pi[Ci.SHIFT_TAB]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){if(t.isCompositing())return;t.service.getSelection().typeText("\t")}},Pi[Ci.BACKSPACE_WORD]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){var r=t.service.getSelection().range();if(r.isEmpty()){var n=t.service.getSelection().prevSkipSpace(r.begin());n=t.service.getSelection().prevWordBreak(n),t.service.getSelection().delete(new g.ICE(n,r.begin()-n))}else t.service.getSelection().typeBackspace()}},Pi[Ci.DELETE_WORD]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){var r=t.service.getSelection().range();if(r.isEmpty()){var n=t.service.getSelection().nextSkipSpace(r.begin());n=t.service.getSelection().nextWordBreak(n),t.service.getSelection().delete(new g.ICE(r.begin(),n-r.begin()))}else t.service.getSelection().delete()}},Pi[Ci.PURE_REDO]=function(t,e){t&&t instanceof di.zq&&t.isEditable()&&t.run("isRedoAvailable")&&t.run("redo")},Pi[Ci.BACKSPACE_LINE]=function(t,e){if(t&&t instanceof di.zq&&t.isEditable()){var r=t.service.getSelection(),n=r.range();if(n.isEmpty()){var i=t.viewSelection.getViewRange();if(!i||i.start instanceof M.$gc)return;for(var o=i.start.leafBox.parentBox;o&&!(0,c.o7)(o);)o=o.parentBox;if(!o||!(0,c.o7)(o))return;if(r.isSelectionCollapseAtParaStart())return void r.typeBackspace();var a=o.getRangeBegin();r.delete(new g.ICE(a,n.begin()-a))}else r.typeBackspace()}},Pi),xi=[{keyBindings:{win:p.VD.BACKSPACE,mac:p.VD.BACKSPACE},action:Ci.BACKSPACE},{keyBindings:{win:p.N9.SHIFT+p.VD.BACKSPACE,mac:p.N9.SHIFT+p.VD.BACKSPACE},action:Ci.BACKSPACE},{keyBindings:{win:p.VD.DELETE,mac:p.VD.DELETE},action:Ci.DELETE},{keyBindings:{win:p.VD.TAB,mac:p.VD.TAB},action:Ci.TAB},{keyBindings:{win:p.VD.ENTER,mac:p.VD.ENTER},action:Ci.ENTER},{keyBindings:{win:p.N9.SHIFT+p.VD.ENTER,mac:p.N9.SHIFT+p.VD.ENTER},action:Ci.LINE_BREAK},{keyBindings:{win:p.N9.ALT+p.VD.BACKSPACE,mac:p.N9.ALT+p.VD.BACKSPACE},action:Ci.BACKSPACE_WORD},{keyBindings:{win:p.N9.ALT+p.VD.DELETE,mac:p.N9.ALT+p.VD.DELETE},action:Ci.DELETE_WORD},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.BACKSPACE,mac:p.N9.COMMAND+p.VD.BACKSPACE},action:Ci.BACKSPACE_LINE},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.Z,mac:p.N9.COMMAND+p.VD.Z},action:Ci.UNDO},{keyBindings:{win:[p.N9.CTRL_WIN+p.VD.Y,p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.Z],mac:[p.N9.COMMAND+p.VD.Y,p.N9.COMMAND+p.N9.SHIFT+p.VD.Z]},action:Ci.REDO},{keyBindings:{win:-1,mac:p.N9.COMMAND+p.N9.SHIFT+p.VD.Z},action:Ci.PURE_REDO}],Ei=((Ri={})[$n.ARROW_LEFT]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveLeft())},Ri[$n.ARROW_RIGHT]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveRight())},Ri[$n.ARROW_UP]=function(t,e){var r,n,i;t&&t instanceof di.zq&&((null===(r=t.surface)||void 0===r?void 0:r.isEditable())?null===(n=t.surface)||void 0===n||n.selectionHandler.moveUp():null===(i=t.surface)||void 0===i||i.selectionHandler.readonlyMoveUp())},Ri[$n.ARROW_DOWN]=function(t,e){var r,n,i;t&&t instanceof di.zq&&((null===(r=t.surface)||void 0===r?void 0:r.isEditable())?null===(n=t.surface)||void 0===n||n.selectionHandler.moveDown():null===(i=t.surface)||void 0===i||i.selectionHandler.readonlyMoveDown())},Ri[$n.SELECT_LEFT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectLeft())},Ri[$n.SELECT_RIGHT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectRight())},Ri[$n.SELECT_UP]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectUp())},Ri[$n.SELECT_DOWN]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectDown())},Ri[$n.MOVE_TO_CHARACTER_LEFT]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveLeft(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"one_character_to_the_left"}))},Ri[$n.MOVE_TO_CHARACTER_RIGHT]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveRight(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"one_character_to_the_right"}))},Ri[$n.MOVE_TO_WORD_LEFT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToWordLeft())},Ri[$n.MOVE_TO_WORD_RIGHT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToWordRight())},Ri[$n.SELECT_TO_WORD_LEFT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToWordLeft())},Ri[$n.SELECT_TO_WORD_RIGHT]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToWordRight())},Ri[$n.MOVE_TO_LINE_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToLineStart())},Ri[$n.MOVE_TO_LINE_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToLineEnd())},Ri[$n.SELECT_TO_LINE_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToLineStart())},Ri[$n.SELECT_TO_LINE_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToLineEnd())},Ri[$n.MOVE_TO_PREVIOUS_LINE]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveUp(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_previous_line"}))},Ri[$n.MOVE_TO_NEXT_LINE]=function(t,e){var r;t&&t instanceof di.zq&&t.isEditable()&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveDown(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_next_line"}))},Ri[$n.SELECT_TO_PARA_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToParaStart())},Ri[$n.SELECT_TO_PARA_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToParaEnd())},Ri[$n.MOVE_TO_PARA_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToParaStart(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_beginning_of_the_paragraph"}))},Ri[$n.MOVE_TO_PARA_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToParaEnd(),p.kQ.tdwReport({opername:"doc_word_editor",module:"shortcut_key",action:"the_end_of_the_paragraph"}))},Ri[$n.SELECT_TO_PREV_PAGE]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToPrevPage())},Ri[$n.SELECT_TO_NEXT_PAGE]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToNextPage())},Ri[$n.MOVE_TO_PREV_PAGE]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToPrevPage())},Ri[$n.MOVE_TO_NEXT_PAGE]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToNextPage())},Ri[$n.MOVE_TO_STORY_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToStoryStart())},Ri[$n.MOVE_TO_STORY_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.moveToStoryEnd())},Ri[$n.SELECT_TO_STORY_START]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToStoryStart())},Ri[$n.SELECT_TO_STORY_END]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectToStoryEnd())},Ri[$n.SELECT_WORD]=function(t,e,r){var n;t&&t instanceof di.zq&&(null===(n=t.surface)||void 0===n||n.selectionHandler.selectWord(r))},Ri[$n.SELECT_PARA]=function(t,e,r){var n;t&&t instanceof di.zq&&(null===(n=t.surface)||void 0===n||n.selectionHandler.selectParagraph(r))},Ri[$n.SELECT_ALL]=function(t,e){var r;t&&t instanceof di.zq&&(null===(r=t.surface)||void 0===r||r.selectionHandler.selectAll())},Ri),Di=[{keyBindings:{win:p.VD.ARROW_LEFT,mac:p.VD.ARROW_LEFT},action:$n.ARROW_LEFT},{keyBindings:{win:p.VD.ARROW_UP,mac:p.VD.ARROW_UP},action:$n.ARROW_UP},{keyBindings:{win:p.VD.ARROW_RIGHT,mac:p.VD.ARROW_RIGHT},action:$n.ARROW_RIGHT},{keyBindings:{win:p.VD.ARROW_DOWN,mac:p.VD.ARROW_DOWN},action:$n.ARROW_DOWN},{keyBindings:{win:p.N9.SHIFT+p.VD.ARROW_LEFT,mac:p.N9.SHIFT+p.VD.ARROW_LEFT},action:$n.SELECT_LEFT},{keyBindings:{win:p.N9.SHIFT+p.VD.ARROW_RIGHT,mac:p.N9.SHIFT+p.VD.ARROW_RIGHT},action:$n.SELECT_RIGHT},{keyBindings:{win:p.N9.SHIFT+p.VD.ARROW_UP,mac:p.N9.SHIFT+p.VD.ARROW_UP},action:$n.SELECT_UP},{keyBindings:{win:p.N9.SHIFT+p.VD.ARROW_DOWN,mac:p.N9.SHIFT+p.VD.ARROW_DOWN},action:$n.SELECT_DOWN},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.B},action:$n.MOVE_TO_CHARACTER_LEFT},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.F},action:$n.MOVE_TO_CHARACTER_RIGHT},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.ARROW_LEFT,mac:p.N9.ALT+p.VD.ARROW_LEFT},action:$n.MOVE_TO_WORD_LEFT},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.ARROW_RIGHT,mac:p.N9.ALT+p.VD.ARROW_RIGHT},action:$n.MOVE_TO_WORD_RIGHT},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.ARROW_LEFT,mac:p.N9.ALT+p.N9.SHIFT+p.VD.ARROW_LEFT},action:$n.SELECT_TO_WORD_LEFT},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.ARROW_RIGHT,mac:p.N9.ALT+p.N9.SHIFT+p.VD.ARROW_RIGHT},action:$n.SELECT_TO_WORD_RIGHT},{keyBindings:{win:p.VD.HOME,mac:[p.VD.HOME,p.N9.COMMAND+p.VD.ARROW_LEFT]},action:$n.MOVE_TO_LINE_START},{keyBindings:{win:p.VD.END,mac:[p.VD.END,p.N9.COMMAND+p.VD.ARROW_RIGHT]},action:$n.MOVE_TO_LINE_END},{keyBindings:{win:p.N9.SHIFT+p.VD.HOME,mac:[p.N9.SHIFT+p.VD.HOME,p.N9.COMMAND+p.N9.SHIFT+p.VD.ARROW_LEFT]},action:$n.SELECT_TO_LINE_START},{keyBindings:{win:p.N9.SHIFT+p.VD.END,mac:[p.N9.SHIFT+p.VD.END,p.N9.COMMAND+p.N9.SHIFT+p.VD.ARROW_RIGHT]},action:$n.SELECT_TO_LINE_END},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.P},action:$n.MOVE_TO_PREVIOUS_LINE},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.N},action:$n.MOVE_TO_NEXT_LINE},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.ARROW_UP,mac:p.N9.ALT+p.N9.SHIFT+p.VD.ARROW_UP},action:$n.SELECT_TO_PARA_START},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.ARROW_DOWN,mac:p.N9.ALT+p.N9.SHIFT+p.VD.ARROW_DOWN},action:$n.SELECT_TO_PARA_END},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.A},action:$n.MOVE_TO_PARA_START},{keyBindings:{win:[],mac:p.N9.CTRL_MAC+p.VD.E},action:$n.MOVE_TO_PARA_END},{keyBindings:{win:p.N9.SHIFT+p.VD.PAGE_UP,mac:p.N9.SHIFT+p.VD.PAGE_UP},action:$n.SELECT_TO_PREV_PAGE},{keyBindings:{win:p.N9.SHIFT+p.VD.PAGE_DOWN,mac:p.N9.SHIFT+p.VD.PAGE_DOWN},action:$n.SELECT_TO_NEXT_PAGE},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.HOME,mac:[p.N9.COMMAND+p.VD.HOME,p.N9.COMMAND+p.VD.ARROW_UP]},action:$n.MOVE_TO_STORY_START},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.END,mac:[p.N9.COMMAND+p.VD.END,p.N9.COMMAND+p.VD.ARROW_DOWN]},action:$n.MOVE_TO_STORY_END},{keyBindings:{win:p.VD.PAGE_DOWN,mac:p.VD.PAGE_DOWN},action:$n.MOVE_TO_NEXT_PAGE},{keyBindings:{win:p.VD.PAGE_UP,mac:p.VD.PAGE_UP},action:$n.MOVE_TO_PREV_PAGE},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.HOME,mac:p.N9.COMMAND+p.N9.SHIFT+p.VD.HOME},action:$n.SELECT_TO_STORY_START},{keyBindings:{win:p.N9.CTRL_WIN+p.N9.SHIFT+p.VD.END,mac:p.N9.COMMAND+p.N9.SHIFT+p.VD.END},action:$n.SELECT_TO_STORY_END},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.A,mac:p.N9.COMMAND+p.VD.A},action:$n.SELECT_ALL}];!function(t){t.COPY="clipboard_copy",t.CUT="clipboard_cut",t.PASTE="clipboard_paste",t.PASTE_TEXT="clipboard_paste_text"}(_i||(_i={}));var ki,Li,Ai,Fi,Mi,Oi,Bi,Ni,Hi=((Ii={})[_i.COPY]=function(t,e){t&&t instanceof di.zq&&t.isCopyable()&&t.clipboardManager.copy()},Ii[_i.CUT]=function(t,e){t&&t instanceof di.zq&&t.isEditable()&&t.clipboardManager.cut()},Ii[_i.PASTE]=function(t,e){t&&t instanceof di.zq&&t.isEditable()&&t.clipboardManager.paste()},Ii),Wi=[{keyBindings:{win:p.N9.CTRL_WIN+p.VD.C,mac:p.N9.COMMAND+p.VD.C},action:_i.COPY},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.X,mac:p.N9.COMMAND+p.VD.X},action:_i.CUT},{keyBindings:{win:p.N9.CTRL_WIN+p.VD.V,mac:p.N9.COMMAND+p.VD.V},action:_i.PASTE}],Gi=function(){function t(t){var e=document.getElementsByClassName("".concat(M.F51.meloDocView));0===e.length?this.containerView=null:this.containerView=e[0],this.editor=t,this.selector=t.createSelector()}return t.prototype.updateCursorStyle=function(t){var e;if(this.containerView&&(this.containerView.style.cursor="text",t&&this.needUpdate())){var r=null===(e=this.selector.findHitViewPoint(!1,!0,!1,t,!1))||void 0===e?void 0:e.leafBox;this.hasUpdatedContainerCursorStyle(r)||this.hasUpdatedTextFrameCursorStyle(r)}},t.prototype.hasUpdatedContainerCursorStyle=function(t){return!!(0,c.vv)(t)&&!!(0,c.Oi)(t)&&(this.containerView&&(this.containerView.style.cursor=this.editor.docEnv.editable?"move":"zoom-in"),!0)},t.prototype.hasUpdatedTextFrameCursorStyle=function(t){var e;return!!(0,c.tJ)(t)&&(this.containerView&&(this.containerView.style.cursor=(null===(e=t.textboxProperty)||void 0===e?void 0:e.textBoxType)!==g.Xbc.TextFrame&&t.textboxProperty?"text":"move"),!0)},t.prototype.needUpdate=function(){return!!this.editor.service.getDocument().getShapes().item(0)},t}(),Vi="keydown",Ui="workbench-content-container",Ki=function(){function t(t,e,r,n){var i=this;this.mouseDownTime=0,this.mouseDownPos=[0,0],this.mouseUpTime=0,this.mouseUpPos=[0,0],this.mouseType=c.PO.NONE,this.mouseAction=c.oX.NONE,this._viewRange=void 0,this.contextMenuShowTimeout=0,this.isInsert=!1,this.resetInsertStatus=function(){i.isInsert=!1},this.editor=t,this.state=e,this.mouseSelector=r.mouseSelector,this.scrollHandler=n,this.cursorUpdater=new Gi(t),this.onMouseMoveListener=this.onMouseMove.bind(this),this.onMouseUpListener=this.onMouseUp.bind(this)}return Object.defineProperty(t.prototype,"viewRange",{get:function(){return this._viewRange},set:function(t){this._viewRange=t},enumerable:!1,configurable:!0}),t.prototype.attach=function(){var t,e=this;document.addEventListener("mousemove",this.onMouseMoveListener),null===(t=document.getElementById(Ui))||void 0===t||t.addEventListener("mouseup",this.onMouseUpListener),document.addEventListener(Vi,this.resetInsertStatus),this.editor.on(M.kgn.PAGE_MOUSE_EVENT,(function(t){e.cursorUpdater.updateCursorStyle(t.hitPoint),t.event&&("mousedown"===t.event.type?e.onMouseDown(t.event.nativeEvent,t.hitPoint):"mousemove"===t.event.type?e.onMouseMove(t.event.nativeEvent,t.hitPoint):"mouseup"===t.event.type?e.onMouseUp(t.event.nativeEvent,t.hitPoint):"contextmenu"===t.event.type&&e.onContextMenu(t.event.nativeEvent,t.hitPoint))}))},t.prototype.detach=function(){var t;document.removeEventListener("mousemove",this.onMouseMoveListener),null===(t=document.getElementById(Ui))||void 0===t||t.removeEventListener("mouseup",this.onMouseMoveListener),document.removeEventListener(Vi,this.resetInsertStatus),this.editor.removeListener(M.kgn.PAGE_MOUSE_EVENT,this)},t.prototype.onMouseDown=function(t,e){0===t.button&&(this.mouseSelector.lastSelectList&&(this.mouseAction=c.oX.NONE),this.editor.fire(new c.un(t,c.oX.NONE,e)),this.scrollHandler.disableScrollOnSelectionChanged(),this.mouseType=c.PO.DOWN,this.mouseDownTime=Date.now(),this.mouseDownPos=[t.clientX,t.clientY],this.checkContinuousMouseDowns(t,e))},t.prototype.checkContinuousMouseDowns=function(t,e){var r=this;if(this.clickInterval(this.mouseUpTime,this.mouseDownTime)&&this.equalPos(this.mouseUpPos,this.mouseDownPos)&&this.mouseAction!==c.oX.DRAG&&this.mouseAction!==c.oX.LONG_CLICK||(this.mouseAction=c.oX.NONE),this.mouseAction===c.oX.NONE){if(this.isInsert)return this.isInsert=!1,this.editor.fire(new M.uWz(M.Lll.HIDDEN),!1),this.editor.run("undo"),clearTimeout(this.clickTimeInterval),void(this.clickTimeInterval=setTimeout((function(){r.editor.fire(new M.uWz(M.Lll.SHOW),!1),r.searchViewRangeByPoint(t,e)}),100));this.searchViewRangeByPoint(t,e)}},t.prototype.searchViewRangeByPoint=function(t,e){this.mouseSelector.onMouseEvent(t,c.PO.DOWN,e);var r=this.mouseSelector.getSelection();r&&(this.callMobileContextMenuIfNeed(r.viewRange),this.viewRange=r.viewRange)},t.prototype.onMouseMove=function(t,e){if(!this.editor.docEnv.isDragging){if(this.mouseType===c.PO.DOWN){var r=[t.clientX,t.clientY];this.equalPos(this.mouseDownPos,r)||(this.mouseType=c.PO.MOVE)}if(this.mouseType===c.PO.MOVE){if(this.mouseSelector.onMouseEvent(t,c.PO.MOVE,e),this.mouseSelector.start&&this.mouseSelector.end){var n=void 0;n=(0,M.YrZ)(this.mouseSelector.start,this.mouseSelector.end)?this.mouseSelector.start:this.mouseSelector.end,this.scrollHandler.scrollByIfNeedThrottle(t.clientX,t.clientY,n)}this.onDrag(t,e)}}},t.prototype.onMouseUp=function(t,e){0===t.button&&this.mouseType!==c.PO.UP&&(this.editor.fire(new c.un(t,c.oX.NONE,e)),this.scrollHandler.enableScrollOnSelectionChanged(),this.mouseType=c.PO.UP,this.mouseUpTime=Date.now(),this.mouseUpPos=[t.clientX,t.clientY],this.mouseSelector.onMouseEvent(t,c.PO.UP,e),this.checkContinuousMouseUps(t,e))},t.prototype.checkContinuousMouseUps=function(t,e){this.equalPos(this.mouseDownPos,this.mouseUpPos)?this.clickInterval(this.mouseDownTime,this.mouseUpTime)?this.mouseAction===c.oX.NONE||this.mouseAction===c.oX.LONG_CLICK?this.onClick(t,e):this.mouseAction===c.oX.CLICK||this.mouseAction===c.oX.TRIPLE_CLICK?this.onDoubleClick(t,e):this.mouseAction===c.oX.DOUBLE_CLICK&&this.onTripleClick(t,e):this.onLongClick(t,e):this.mouseAction=c.oX.NONE},t.prototype.onContextMenu=function(t,e){if(this.mouseSelector.onMouseEvent(t,c.PO.CONTEXTMENU,e),i.PlatformUtil.isTencentDocsIPadApp()){var r=this.mouseSelector.getSelection();(null==r?void 0:r.viewRange)&&this.callMobileContextMenu(r.viewRange)}},t.prototype.onDrag=function(t,e){this.mouseAction=c.oX.DRAG,this.editor.fire(new c.un(t,c.oX.DRAG))},t.prototype.onClick=function(t,e){var r;this.mouseAction=c.oX.CLICK,this.editor.fire(new c.un(t,c.oX.CLICK,e)),i.PlatformUtil.isTencentDocsIPadApp()&&(null===(r=this.editor.surface)||void 0===r||r.requestFocus(this.viewRange))},t.prototype.onDoubleClick=function(t,e){var r;if(clearTimeout(this.contextMenuShowTimeout),this.mouseAction=c.oX.DOUBLE_CLICK,this.isInsert=this.isInsert||null!==(r=this.editor.run("action_dbclick",this.editor,e))&&void 0!==r&&r,this.editor.fire(new c.un(t,c.oX.DOUBLE_CLICK,e)),this.mouseSelector.onDoubleClick(t),this.viewRange&&!this.state.waitingForReflow){var n=this.viewRange.start.documentBox;!this.isInsert&&n&&n.isValid()&&(this.editor.run("selectWord",this.viewRange.start.gcp),this.editor.fire(new M.HLW))}},t.prototype.onTripleClick=function(t,e){if(this.mouseAction=c.oX.TRIPLE_CLICK,this.editor.fire(new c.un(t,c.oX.TRIPLE_CLICK,e)),this.viewRange&&!this.state.waitingForReflow){var r=this.viewRange.start.documentBox;r&&r.isValid()&&(this.editor.run("selectParagraph",this.viewRange.start.gcp),this.editor.fire(new M.Xvi))}},t.prototype.onLongClick=function(t,e){this.mouseAction=c.oX.LONG_CLICK,this.editor.fire(new c.un(t,c.oX.LONG_CLICK,e))},t.prototype.clickInterval=function(t,e){return e-t<500},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<10&&Math.abs(t[1]-e[1])<10},t.prototype.callMobileContextMenuIfNeed=function(t){var e=this;i.PlatformUtil.isTencentDocsIPadApp()&&t&&t.equals(this.viewRange)&&(this.contextMenuShowTimeout=setTimeout((function(){e.callMobileContextMenu(t)}),400))},t.prototype.callMobileContextMenu=function(t){this.editor.fire(new M.Rmi(t))},t}(),zi=function(){function t(t,e){this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0],this.focusingTouch=!1,this.onBlur=!0,this.touchAction=c.Nl.NONE,this.viewRange=void 0,this.contextMenuShowTimeout=void 0,this.longTouchStartTimeout=void 0,this.editTipsShowTimeout=void 0,this.LONG_TOUCH_TIME=300,this.isDoubleTouchToEdit=!1,this.editor=t,this.touchSelector=e.touchSelector}return t.prototype.attach=function(){var t=this;this.editor.on(M.kgn.PAGE_TOUCH_EVENT,(function(e){e.event&&("touchstart"===e.event.type?t.onTouchStart(e.event,e.hitPoint):"touchmove"===e.event.type?t.onTouchMove(e.event,e.hitPoint):"touchend"===e.event.type&&t.onTouchEnd(e.event,e.hitPoint))})),this.editor.on(M.cbw.ON_FOCUS,(function(){t.onBlur=!1})),this.editor.on(M.cbw.ON_BLUR,(function(){t.onBlur=!0}))},t.prototype.detach=function(){this.editor.removeListener(M.kgn.PAGE_TOUCH_EVENT,this),this.editor.removeListener(M.cbw.ON_BLUR,this)},t.prototype.onTouchStart=function(t,e){var r=this;if(!this.intercept(t)){this.editor.fire(new c.nn(t.nativeEvent,c.Nl.NONE,e)),this.touchStartTime=Date.now();var n=t.changedTouches[0];this.touchStartPos=[n.clientX,n.clientY],this.touchInterval(this.touchEndTime,this.touchStartTime)&&this.equalPos(this.touchEndPos,this.touchStartPos)&&this.touchAction!==c.Nl.LONG_TOUCH||(this.touchAction=c.Nl.NONE),t.persist(),this.longTouchStartTimeout=setTimeout((function(){r.onLongTouch(t,e)}),this.LONG_TOUCH_TIME)}},t.prototype.onTouchMove=function(t,e){this.intercept(t)||(this.editor.fire(new c.nn(t.nativeEvent,c.Nl.NONE,e)),t.touches[0].touchType&&"stylus"===t.touches[0].touchType||(this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),this.touchStartTime=0,this.touchStartPos=[0,0],this.touchEndTime=0,this.touchEndPos=[0,0]))},t.prototype.onTouchEnd=function(t,e){var r,n;if(!this.intercept(t)){this.editor.fire(new c.nn(t.nativeEvent,c.Nl.NONE,e)),this.touchEndTime=Date.now();var i=t.changedTouches[0];this.touchEndPos=[i.clientX,i.clientY],this.equalPos(this.touchStartPos,this.touchEndPos)?(this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),this.touchInterval(this.touchStartTime,this.touchEndTime)?this.touchAction===c.Nl.NONE||this.touchAction===c.Nl.LONG_TOUCH?(this.focusingTouch=null!==(n=null===(r=this.editor.surface)||void 0===r?void 0:r.isFocusing())&&void 0!==n&&n,this.onTouch(t,e)):this.touchAction===c.Nl.TOUCH?this.onDoubleTouch(t,e):this.touchAction===c.Nl.DOUBLE_TOUCH&&this.onTripleTouch(t,e):this.onLongTouch(t,e)):this.touchAction=c.Nl.NONE}},t.prototype.onTouch=function(t,e){var r,n,i,o=this;this.touchAction=c.Nl.TOUCH;var a=!1;if(this.touchSelector.onTouchEvent(t.nativeEvent,e,(function(){return o.contextMenuShowTimeout=setTimeout((function(){o.editor.fire(new M.F78,!1),o.contextMenuShowTimeout=void 0}),200),a=!0,!0})),!a)if(this.editor.fire(new c.nn(t.nativeEvent,c.Nl.TOUCH,e)),this.isDoubleTouchToEdit&&this.onBlur)this.showEditTips();else if(!this.touchSelector.lastSelectList){var s=this.onBlur,l=this.touchSelector.getSelection(),p=null===(r=null==l?void 0:l.viewRange)||void 0===r?void 0:r.getGCPRange(),u=!!p&&this.editor.service.getPermissionRange().checkPermissionRangeByGcpRange(p);(null==l?void 0:l.viewRange)&&(l.viewRange.equals(this.viewRange)&&u&&(this.contextMenuShowTimeout=setTimeout((function(){s||o.callContextMenu(l.viewRange)}),400)),this.onBlur=!1,this.viewRange=l.viewRange),u?null===(n=this.editor.surface)||void 0===n||n.requestFocus(this.viewRange):(this.onBlur=!0,null===(i=this.editor.surface)||void 0===i||i.requestBlur())}},t.prototype.onDoubleTouch=function(t,e){var r,n,i;this.contextMenuShowTimeout&&clearTimeout(this.contextMenuShowTimeout),this.editTipsShowTimeout&&clearTimeout(this.editTipsShowTimeout),this.touchAction=c.Nl.DOUBLE_TOUCH;var o=!1;this.touchSelector.onTouchEvent(t.nativeEvent,e,(function(){return o=!0,!1}));var a=this.touchSelector.getSelection(),s=null===(r=null==a?void 0:a.viewRange)||void 0===r?void 0:r.getGCPRange(),l=!!s&&this.editor.service.getPermissionRange().checkPermissionRangeByGcpRange(s);(null==a?void 0:a.viewRange)&&(this.viewRange=a.viewRange,this.isDoubleTouchToEdit&&this.onBlur&&l?(this.onBlur=!1,p.kQ.tdwReport({opername:"doc_word_editor",module:"double_click",action:"edit"})):this.isTextArea(a)&&!o&&this.editor.run("selectWord",a.viewRange.start.gcp)),l?(null===(n=this.editor.surface)||void 0===n||n.requestFocus(this.viewRange),this.editor.fire(new c.nn(t.nativeEvent,c.Nl.DOUBLE_TOUCH,e,null==a?void 0:a.viewRange))):(this.onBlur=!0,null===(i=this.editor.surface)||void 0===i||i.requestBlur())},t.prototype.onTripleTouch=function(t,e){this.touchAction=c.Nl.TRIPLE_TOUCH,this.touchSelector.onTouchEvent(t.nativeEvent,e);var r=this.touchSelector.getSelection();(null==r?void 0:r.viewRange)&&(this.isTextArea(r)||this.focusingTouch)&&(this.viewRange=r.viewRange,this.editor.run("selectParagraph",r.viewRange.start.gcp))},t.prototype.onLongTouch=function(t,e){"touchend"===t.type&&(this.touchAction=c.Nl.LONG_TOUCH,this.editor.fire(new c.nn(t.nativeEvent,c.Nl.LONG_TOUCH,e)))},t.prototype.touchInterval=function(t,e){return e-t<this.LONG_TOUCH_TIME},t.prototype.isTextArea=function(t){return 0!==t.viewRange.start.leafBoxOffset()&&0!==t.viewRange.end.leafBoxOffset()},t.prototype.equalPos=function(t,e){return Math.abs(t[0]-e[0])<20&&Math.abs(t[1]-e[1])<30},t.prototype.callContextMenu=function(t){this.editor.fire(new M.Rmi(t))},t.prototype.shouldIgnore=function(t){return!1},t.prototype.intercept=function(t){var e;t.stopPropagation();var r=!(null===(e=t.changedTouches)||void 0===e?void 0:e.length);if("touchstart"===t.type){if(this.shouldIgnore(t.target)||t.touches.length>1||r)return!0}else if("touchend"===t.type){if(!t.cancelable)return this.longTouchStartTimeout&&clearTimeout(this.longTouchStartTimeout),!0;if(i.PlatformUtil.isTencentDocsIPadApp()&&t.preventDefault(),r)return!0}return!1},t.prototype.showEditTips=function(){var t=this;this.editTipsShowTimeout=setTimeout((function(){t.editor.fire(new M._Nr)}),this.LONG_TOUCH_TIME)},t}();!function(t){t.MOVE_TO_PREVIOUS_LINE="上一航",t.MOVE_TO_NEXT_LINE="下一航",t.MOVE_TO_LINE_START="已到此行开头",t.MOVE_TO_LINE_END="已到此行最后",t.MOVE_TO_TABLE_LINE_START="已到此单元格开头",t.MOVE_TO_TABLE_LINE_END="已到此单元格最后",t.PAGE_START="已到本文开头",t.PAGE_END="已到文末",t.SELECTED="选中",t.DELETE="删除",t.PASTE="粘贴",t.CUT="剪切",t.COPY="复制",t.TABLE="表格",t.TABLE_UP_CELL="上一单元格",t.TABLE_DOWN_CELL="下一单元格",t.TABLE_LEFT_CELL="左一单元格",t.TABLE_RIGHT_CELL="右一单元格",t.TABLE_ENTER="进入表格",t.TABLE_LEAVE="离开表格",t.TABLE_FIRST="第一单元格",t.TABLE_CELL="单元格",t.PARA_BREAK="换行符",t.INTRODUCTION="欢迎使用腾讯文档",t.INTRODUCTION_WEWORK="欢迎使用企业微信文档"}(ki||(ki={})),function(t){t.TITLE="标题",t.SUBTITLE="副标题",t.HEADING1="标题1",t.HEADING2="标题2",t.HEADING3="标题3",t.HEADING4="标题4",t.HEADING5="标题5",t.NORMAL=""}(Li||(Li={})),function(t){t.CIRCLE="项目符号",t.HOLLOWCIRCLE="空心项目符号",t.SQUARE="正方形项目符号",t.DIAMOND="方块项目符号",t.STAR="四角星项目符号",t.HOOK="对勾项目符号",t.ARROW="箭头项目符号"}(Ai||(Ai={})),function(t){t.TableEndBreakSpan="TableEndBreakSpan",t.TableStartBreakSpan="TableStartBreakSpan",t.TableCellBreakSpan="TableCellBreakSpan",t.TableCellStartSpan="TableCellStartSpan",t.TableRowBreakSpan="TableRowBreakSpan",t.TableRowStartSpan="TableRowStartSpan",t.ParaBreakSpan="换行符",t.DrawingAnchor="绘图",t.DefaultPluginProperty="插件",t.EmbedCommentProperty="评论",t.CodeblockProperty="代码块",t.TextSpan="文字",t.LaTeX="LaTex公式",t.Sign="电子签名",t.ImageProperty="图片",t.SplitlineProperty="分割线",t.FieldBegin="域开始",t.FieldSeparate="域分割",t.FieldEnd="域结束",t.DocLink="腾讯文档链接",t.NormalLink="普通链接",t.Calendar="日历",t.File="文件",t.Audio="音频",t.Video="视频",t.Location="地图位置",t.AddonIframe="第三方内容",t.Attachment="文档附件",t.AddonLink="第三方插件链接"}(Fi||(Fi={})),function(t){t.Introduction="introduction",t.Selected="selected",t.SlightMove="slightMove",t.Line="line",t.Insert="insert",t.Delete="delete",t.Modify="modify",t.None="none",t.Error="error"}(Mi||(Mi={})),function(t){t.LEFT="arrowLeft",t.UP="arrowUp",t.RIGHT="arrowRight",t.DOWN="arrowDown"}(Oi||(Oi={})),function(t){t.ON_COPY="on_copy",t.ON_CUT="on_cut",t.ON_PASTE="on_paste"}(Bi||(Bi={})),function(t){t.Default="normalLink",t.File="file",t.Audio="audio",t.Video="video",t.Location="location",t.Calendar="calendar",t.Database="database",t.AddonIframe="addonIframe",t.TDSheetIFrame="tdSheetIframe",t.Attachment="attachment",t.NormalLink="normalLink",t.DocLink="docLink",t.AddonLink="addonLink",t.AddonHina="addonHina"}(Ni||(Ni={}));var ji,qi=new Map([[Ni.File,Fi.File],[Ni.Audio,Fi.Audio],[Ni.Video,Fi.Video],[Ni.Location,Fi.Location],[Ni.Calendar,Fi.Calendar],[Ni.AddonIframe,Fi.AddonIframe],[Ni.Attachment,Fi.Attachment],[Ni.NormalLink,Fi.NormalLink],[Ni.DocLink,Fi.DocLink],[Ni.AddonLink,Fi.AddonLink]]);function Xi(t){var e=g.YU5.getInstance(),r=g.BqD.decodeFieldCode(t);if(!r)return"";var n=e.getFieldProcessorByFieldCodeInfo(r);return n?n.getFieldLayoutText(r,{}):""}!function(t){t.BACKSPACE="backspace",t.DELETE="delete",t.TAB="tab",t.ENTER="enter",t.ARROW_LEFT="moveLeft",t.ARROW_UP="moveUp",t.ARROW_RIGHT="moveRight",t.ARROW_DOWN="moveDown",t.MOVE_TO_WORD_LEFT="moveToWordLeft",t.MOVE_TO_WORD_RIGHT="moveToWordRight",t.MOVE_TO_LINE_START="moveToLineStart",t.MOVE_TO_LINE_END="moveToLineEnd",t.MOVE_TO_STORY_START="moveToStoryStart",t.MOVE_TO_STORY_END="moveToStoryEnd",t.SELECT_WORD="selectWord",t.SELECT_PARA="selectParagraph",t.SELECT_ALL="selectAll"}(ji||(ji={}));var Qi,Yi,Ji,Zi=[Ni.File,Ni.Audio,Ni.Video,Ni.Location,Ni.AddonIframe,Ni.TDSheetIFrame,Ni.Attachment];function $i(t){return Zi.includes(t)}function to(t){var e=t.content;switch(t.propertyType){case g.IfD.FieldBegin:return{fieldCharSpan:1,content:e};case g.IfD.FieldSeparate:return{fieldCharSpan:2,content:e};case g.IfD.FieldEnd:return{fieldCharSpan:0,content:e}}return function(t){var e,r=t.fieldCharSpan,n=t.content,i=function(t,e){var r,n;return!!(null===(n=null===(r=t.getFieldStream())||void 0===r?void 0:r.getDecodedFieldInfo(e))||void 0===n?void 0:n.isAutoUpdate)}(t.editor,t.gcp),o=t.state.getTextStream().readText(t.gcp,t.len),a=g.BqD.decodeFieldCode(t.propertyType),s=(null===(e=null==a?void 0:a.switches)||void 0===e?void 0:e[g.VEu.subtype])||"",l=s&&qi.get(s)||"";return 1===r?i?{fieldCharSpan:r,content:"".concat(n).concat(Xi(o))}:{fieldCharSpan:r,content:"".concat(n).concat(l),isReadFieldResult:!(s&&$i(s))}:2===r&&!i&&t.isReadFieldResult?{fieldCharSpan:r,content:"".concat(n).concat(o)}:{fieldCharSpan:r,content:n}}(t)}var eo=((Qi={})[g.QP6.get(g.ly6.Arrow)||""]=Ai.ARROW,Qi[g.QP6.get(g.ly6.Circle)||""]=Ai.CIRCLE,Qi[g.QP6.get(g.ly6.HollowCircle)||""]=Ai.HOLLOWCIRCLE,Qi[g.QP6.get(g.ly6.Square)||""]=Ai.SQUARE,Qi[g.QP6.get(g.ly6.Diamond)||""]=Ai.DIAMOND,Qi[g.QP6.get(g.ly6.Star)||""]=Ai.STAR,Qi[g.QP6.get(g.ly6.Hook)||""]=Ai.HOOK,Qi),ro=((Yi={}).Title=Li.TITLE,Yi.Subtitle=Li.SUBTITLE,Yi["heading 1"]=Li.HEADING1,Yi["heading 2"]=Li.HEADING2,Yi["heading 3"]=Li.HEADING3,Yi["heading 4"]=Li.HEADING4,Yi["heading 5"]=Li.HEADING5,Yi.normal=Li.NORMAL,Yi),no=((Ji={})[g.IfD.FieldBegin]={data:Fi.FieldBegin},Ji[g.IfD.FieldSeparate]={data:Fi.FieldSeparate},Ji[g.IfD.FieldEnd]={data:Fi.FieldEnd},Ji[g.IfD.DrawingAnchor]={data:Fi.DrawingAnchor,action:function(t){var e=g.vCY.findPlaceholderCharProperty(t.state.getDataStream(),t.gcpBegin);return e instanceof g.kkf.getPropertyClass(g.uSS.DrawingProperty)?t.editor.service.getDocument().collectOutlineFromDrawingType(e).replace(/\[|]/g,""):Fi.DrawingAnchor}},Ji[g.IfD.ParagraphReturn]={data:Fi.ParaBreakSpan,action:function(t){if(t.editor.service.getSelection().isInTable())return"";var e=Fi.ParaBreakSpan;if(1===t.gcpLength)switch(t.direction){case Oi.LEFT:case Oi.UP:return ki.MOVE_TO_PREVIOUS_LINE;case Oi.RIGHT:case Oi.DOWN:return ki.MOVE_TO_NEXT_LINE}return e}},Ji[g.IfD.CommentReference]={data:Fi.EmbedCommentProperty},Ji[g.IfD.TableCellBreak]={data:Fi.TableCellBreakSpan,action:function(t){if(1===t.len)switch(t.direction){case Oi.LEFT:return ki.TABLE_LEFT_CELL;case Oi.RIGHT:return ki.TABLE_RIGHT_CELL;case Oi.UP:return ki.MOVE_TO_PREVIOUS_LINE;case Oi.DOWN:return ki.MOVE_TO_NEXT_LINE}return""}},Ji),io=function(){function t(){this.accessibilityMap=new Map,this.accessibilityTitleStyleMap=new Map,this.accessibilityBulletListMap=new Map,this.clear(),this.initMap()}return t.prototype.clear=function(){this.accessibilityMap.clear(),this.accessibilityBulletListMap.clear(),this.accessibilityTitleStyleMap.clear()},t.prototype.initMap=function(){var t=this;Object.keys(no).forEach((function(e){t.accessibilityMap.set(e,no[e])})),Object.keys(ro).forEach((function(e){t.accessibilityTitleStyleMap.set(e,ro[e])})),Object.keys(eo).forEach((function(e){t.accessibilityBulletListMap.set(e,eo[e])}))},t}(),oo=function(){function t(t){this.isReadParaBreakSpan=!0,this.fieldCharSpan=0,this.isReadFieldResult=!0,this.isIntable=!1,this.isTableStart=!1,this.resetInformation="",this.contentProps=t,this.contentMap=new io}return t.prototype.reset=function(){this.isTableStart=!1,this.resetInformation="",this.isReadParaBreakSpan=!0,this.fieldCharSpan=0,this.isReadFieldResult=!0},t.prototype.isParagraphBreak=function(t){return t===g.IfD.ParagraphBreak||t===g.IfD.ParagraphReturn},t.prototype.handleSpanContent=function(t){var e=t.gcpBegin,r=t.len,n=t.begin,i=t.end,o=t.text,a=t.gcpRange,s=t.direction,l={isNext:!0,readContent:""},c=Math.max(e,n),p=Math.min(e+r,i);if(c>=p&&(!o||this.contentMap.accessibilityMap.has(o)))return l.isNext=!1,l;var u=p-c,g=this.contentMap.accessibilityMap.get(o);if(void 0===g)return l.readContent+=o,l;if(!this.isReadParaBreakSpan&&a.len>1&&this.isParagraphBreak(o))return l.readContent="",l;if(g.action){var h={gcpBegin:c,len:u,state:this.contentProps.state,gcpLength:a.len,editor:this.contentProps.context,direction:s};l.readContent+=g.action(h)}else l.readContent+=g.data;return l},t.prototype.handleTable=function(){var t=this.contentProps.context.service.getSelection().isInTable();return t!==this.isIntable?(this.isIntable=t,t?ki.TABLE_ENTER:ki.TABLE_LEAVE):""},t.prototype.handleDifferentSpansReading=function(t,e,r){var n=t.getRange(!0),i=t.getContentRange(),a=i.gcpBegin,s=i.len,l=this.contentProps.state.getTextStream().readText(n.begin(),n.len),c="".concat(e).concat(this.handleTable());if(l===g.IfD.TableStart&&(this.isTableStart=!0,this.resetInformation=c),l===g.IfD.FieldBegin||0!==this.fieldCharSpan){var p=to({gcp:n.begin(),len:n.len,content:c,propertyType:l,fieldCharSpan:this.fieldCharSpan,editor:this.contentProps.context,state:this.contentProps.state,isReadFieldResult:this.isReadFieldResult}),u=p.fieldCharSpan,h=p.content,d=p.isReadFieldResult;return this.fieldCharSpan=u,this.isReadFieldResult=null!=d?d:this.isReadFieldResult,h}var f=(0,o.__assign)((0,o.__assign)({},r),{text:l,gcpBegin:a,len:s,property:l}),y=this.handleSpanContent(f);if(!y.isNext)return null;var v="".concat(c).concat(y.readContent);return l===g.IfD.TableEnd&&this.isTableStart&&(this.isTableStart=!1,v="".concat(this.resetInformation).concat(ki.TABLE)),v},t.prototype.getParaExtraContent=function(t){var e=this.contentProps.context.service.getSelection().getParaRange(t);if(!e)return{paraExtraContent:""};var r=e.gcpBegin,n=r+e.len,i="";return t===r&&(i="".concat(this.getTitle(r,n)).concat(this.getListReadContent(r,n))),{paraExtraContent:i,endGCP:n}},t.prototype.rangeContent=function(t){var e=t.begin,r=t.end,n=t.direction,i=t.isSelected,o={readContent:"",isRead:!0},a=e;do{var s=this.getParaExtraContent(a),l=s.paraExtraContent,c=s.endGCP,p=void 0===c?0:c;if(p<=0)return o;o.readContent+=l;var u=new g.ICE(a,Math.min(p,r)-a),h=this.contentProps.state.dataEngine.getDataStream().getTextStream().createRunIterator(u);do{var d={gcpRange:u,direction:n,end:r,begin:e,isSelected:i},f=this.handleDifferentSpansReading(h,o.readContent,d);if(null===f)break;if(o.readContent=f,o.readContent.length>=1500)break}while(h.next());a=p}while(a<r);return this.reset(),o},t.prototype.getCurrentLineBox=function(t){if(t instanceof M.SE$){for(var e=t.leafBox.parentBox;e&&!(0,c.o7)(e);)e=e.parentBox;if((0,c.o7)(e))return e}return null},t.prototype.getGcp=function(t){return(0,c.Oi)(t)||(0,c.NF)(t)||(0,c.tq)(t)||(0,c.tJ)(t)?t.getRange():null},t.prototype.getListReadContent=function(t,e){var r=this.contentProps.context.service.getDocument().getListInfoFromGcpRange(new g.ICE(t,e-t));if(!r)return"";if(r.isBullet)return this.contentMap.accessibilityBulletListMap.get(r.actualText)||"";if(r.isNumbered)return r.actualText;if(r.isTask)switch(r.taskPr.taskState){case g.RWe.done:return"已办";case g.RWe.todo:return"待办"}return""},t.prototype.getTitle=function(t,e){var r=this.contentProps.context.service.getDocument().getRange(t,e).getParagraphFormat().getAttributes(),n=r.pStyle,i=r.pBdr.bottom.val!==g.EJ9.undefined?Fi.SplitlineProperty:"",o=this.contentProps.state.dataEngine.getDataManager().getStyleSheetManager().getStylePropertyFromId(n),a=o&&g.LCw.getStyleShowName(o)||"";return"".concat(a="正文"===a?"":a).concat(i)},t.prototype.lineRangeContent=function(t,e){var r,n,i=this.getCurrentLineBox(t);if(!i||!i.lastChild||!i.firstChild)return null;var o=null===(r=this.getGcp(i.firstChild))||void 0===r?void 0:r.begin(),a=null===(n=this.getGcp(i.lastChild))||void 0===n?void 0:n.end();if(void 0===o||void 0===a)return null;var s=a-o||i.getRange().len;return this.isReadParaBreakSpan=!1,{content:this.rangeContent({begin:o,end:o+s,direction:e}),gcpRange:[o,s]}},t}(),ao=function(){function t(t){this.currentCursorPosition=-1,this.lineStart=-1,this.operationMap=new Map,this.previousCursor=-1,this.managerProps=t,this.data=this.onNone(),this.content=new oo(t),this.initMap()}return Object.defineProperty(t.prototype,"accessibilityData",{get:function(){return this.data},enumerable:!1,configurable:!0}),t.prototype.resetAccessibilityData=function(){this.data=this.onNone()},Object.defineProperty(t.prototype,"isSelected",{get:function(){return this.isSelectedArea},enumerable:!1,configurable:!0}),t.prototype.resetSelected=function(){this.isSelectedArea=!1},t.getInstance=function(e){return t.instance||(t.instance=new t(e)),t.instance},t.destroy=function(){t.instance&&(t.instance=null)},t.prototype.operationSort=function(t,e){e&&(this.currentCursorPosition=e.start+e.len),this.data=this.operationMap.has(t)?this.operationMap.get(t)(e):this.onError(),this.isTable=this.isTableNow()},t.prototype.initMap=function(){var t,e=this,r=((t={})[Mi.Insert]=function(t){return e.onInsert(t)},t[Mi.Delete]=function(t){return e.onDelete(t)},t[Mi.Modify]=function(t){return e.onModify(t)},t[Mi.Selected]=function(t){return e.onSelected(t)},t[Mi.SlightMove]=function(t){return e.onSlightMove(t)},t[Mi.Line]=function(t){return e.onLine(t)},t[Mi.Introduction]=function(t){return e.onIntroduction(t)},t[Mi.None]=function(){return e.onNone()},t[Mi.Error]=function(){return e.onError()},t);Object.keys(r).forEach((function(t){e.operationMap.set(t,r[t])}))},t.prototype.onIntroduction=function(t){var e=(null==t?void 0:t.operationContent)||ki.INTRODUCTION,r=this.content.rangeContent({begin:(null==t?void 0:t.start)||0,end:((null==t?void 0:t.start)||0)+((null==t?void 0:t.len)||1)-1});return r.isRead&&(e+=r.readContent),{stamp:c.bK.INTRODUCTION,readContent:e}},t.prototype.onSelected=function(t){if(!t)return this.onError();var e=t.start,r=t.len,n=t.operationContent,i=void 0===n?"":n;this.isSelectedArea=!0,this.currentCursorPosition=e+r;var o=this.content.rangeContent({begin:e,end:this.currentCursorPosition,isSelected:this.isSelectedArea}),a=o.isRead,s=o.readContent;return a?(this.selectedData=s,{stamp:c.bK.SELECTED,gcpRange:[e,r],readContent:ki.SELECTED+this.selectedData+i}):this.onNone()},t.prototype.onSlightMove=function(t){if(this.data={stamp:c.bK.SLIGHT_MOVE},null==t?void 0:t.operationContent)return this.data.readContent=t.operationContent,this.data;if(!t)return this.data;var e=t.start,r=t.len,n=e+r,i=this.previousCursor>e?Oi.LEFT:Oi.RIGHT,o=this.content.rangeContent({begin:e,end:n,direction:i}),a=o.isRead,s=o.readContent;return a?{stamp:c.bK.SLIGHT_MOVE,gcpRange:[e,r],readContent:s}:this.onNone()},t.prototype.onLine=function(t){var e;if(this.data={stamp:c.bK.LINE},!t)return this.data;var r=t.start,n=t.len,i=new g.ICE(r,n),a=null===(e=this.managerProps.context.getViewRangeFromGcpRange(i))||void 0===e?void 0:e.start;if(!a)return this.onError();var s=this.previousCursor>r?Oi.UP:Oi.DOWN,l=this.content.lineRangeContent(a,s);if(!l)return this.onError();var p=l.content,u=l.gcpRange,h=(0,o.__read)(u,1)[0],d=this.pageEdge(h,this.lineStart);if(d)return{stamp:c.bK.LINE,readContent:d};var f=p.readContent;if(!p.isRead)return this.onNone();var y=this.isTableNow();return y?(this.isTable||(f=ki.TABLE_ENTER+f),this.isTable=!0):y||(this.isTable&&(f=ki.TABLE_LEAVE+f),this.isTable=!1),{stamp:c.bK.LINE,gcpRange:u,readContent:f}},t.prototype.onInsert=function(t){return t?{stamp:c.bK.INSERT,gcpRange:[t.start,t.len],readContent:t.operationContent}:this.onError()},t.prototype.onDelete=function(t){var e={stamp:c.bK.DELETE};if(!t)return e;var r=t.start,n=t.len;if(t.operationContent)return{stamp:c.bK.DELETE,gcpRange:[r,n],readContent:t.operationContent};var i=this.selectedData;if(!this.isSelectedArea){var o=this.content.rangeContent({begin:r,end:r+n}),a=o.isRead,s=o.readContent;if(!a)return this.onNone();i=s}return{stamp:c.bK.DELETE,gcpRange:[r,n],readContent:i}},t.prototype.onModify=function(t){return this.data={stamp:c.bK.MODIFY},t?{stamp:c.bK.MODIFY,gcpRange:[t.start,t.len],readContent:t.operationContent}:this.data},t.prototype.onError=function(){return{stamp:c.bK.ERROR}},t.prototype.onNone=function(){return{stamp:c.bK.NONE}},t.prototype.isTableNow=function(){return!1},t.prototype.pageEdge=function(t,e){if(t===e)return 0===t?ki.PAGE_START:this.managerProps.context.service.getSelection().nextTextBreak(this.currentCursorPosition)===e?ki.PAGE_END:void 0},t}(),so=function(t){var e,r=ao.getInstance(t.operationProps);return(e={})[ji.ARROW_UP]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.Line),e()},e[ji.ARROW_DOWN]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.Line),e()},e[ji.ARROW_LEFT]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.SlightMove),e()},e[ji.ARROW_RIGHT]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.SlightMove),e()},e[ji.MOVE_TO_LINE_START]=function(t,e){if(t&&t instanceof di.zq){var n={start:0,len:0,operationContent:ki.MOVE_TO_LINE_START};r.operationSort(Mi.SlightMove,n)}e()},e[ji.MOVE_TO_LINE_END]=function(t,e){if(t&&t instanceof di.zq){var n={start:0,len:0,operationContent:ki.MOVE_TO_LINE_END};r.operationSort(Mi.SlightMove,n)}e()},e[ji.MOVE_TO_WORD_LEFT]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.SlightMove),e()},e[ji.MOVE_TO_WORD_RIGHT]=function(t,e){t&&t instanceof di.zq&&r.operationSort(Mi.SlightMove),e()},e[ji.MOVE_TO_STORY_START]=function(t,e){if(t&&t instanceof di.zq){var n={start:0,len:0,operationContent:ki.PAGE_START};r.operationSort(Mi.SlightMove,n)}e()},e[ji.MOVE_TO_STORY_END]=function(t,e){if(t&&t instanceof di.zq){var n={start:0,len:0,operationContent:ki.PAGE_END};r.operationSort(Mi.SlightMove,n)}e()},e[ji.SELECT_ALL]=function(t,e){if(t&&t instanceof di.zq&&t.service.getSelection().isInTable()){var n={start:0,len:-1,operationContent:ki.TABLE};r.operationSort(Mi.Selected,n)}e()},e},lo=function(t){var e,r=ao.getInstance(t.operationProps);return(e={})[ji.BACKSPACE]=function(e,n){if(e&&e instanceof di.zq&&e.isEditable()){var i=t.operationProps.state.selection.gcpRange,o=i.gcpBegin,a={start:o,len:i.len};if(!r.isSelected){var s=e.service.getSelection().prevTextBreak(o);a={start:s,len:o-s}}r.operationSort(Mi.Delete,a)}n()},e[ji.DELETE]=function(e,n){if(e&&e instanceof di.zq&&e.isEditable()){var i=t.operationProps.state.selection.gcpRange,o=i.gcpBegin,a={start:o,len:i.len};r.isSelected||(a={start:o,len:e.service.getSelection().nextTextBreak(o)-o}),r.operationSort(Mi.Delete,a)}n()},e[ji.ENTER]=function(e,n){if(e&&e instanceof di.zq&&e.isEditable()&&!e.isCompositing()&&r.isSelected){var i=t.operationProps.state.selection.gcpRange,o={start:i.gcpBegin,len:i.len};r.operationSort(Mi.Delete,o)}n()},e},co={stamp:c.bK.ERROR},po=function(){function t(t){this.isChangeContent=!1,this.manager=null,this.currentCursorPosition=-1,this.operationProps=t,this.switchContent={start:0,len:0,operationContent:ki.INTRODUCTION},this.operationProps.context.isLayoutFinished?this.handleRenderFinish():this.operationProps.context.once(M.kgn.RENDER_FINISH,this.handleRenderFinish.bind(this)),this.operationProps.context.on(c.Hn.A11ySwitch,this.handleAccessibilitySwitch.bind(this))}return t.prototype.handleRenderFinish=function(){this.isRanderFinish=!0,this.initOperation()},t.prototype.handleAccessibilitySwitch=function(t){var e=t.accessibilityData,r=e.isSupported,n=e.content;if(this.isSupportedAccessibility=r,this.switchContent={start:0,len:0,operationContent:n},this.isSupportedAccessibility){var i=this.operationProps.context.service.getSelection().getParaRangeFromSelection(!0),o=i.gcpBegin,a=i.len;this.switchContent.len=a,this.switchContent.start=o,this.initOperation()}else this.destory()},t.prototype.initOperation=function(){this.isRanderFinish&&this.isSupportedAccessibility&&(this.manager=ao.getInstance(this.operationProps),this.operationProps.context.registerPlugin(so(this)),this.operationProps.context.registerPlugin(lo(this)),this.operationProps.context.on(M.kgn.CARET_CHANGE,this.onSelectionChanged,this),this.operationProps.context.on(u.at.ModelChange,this.onModelChange,this),this.operationProps.context.on(Bi.ON_COPY,this.onCopy,this),this.operationProps.context.on(Bi.ON_PASTE,this.onPaste,this),this.operationProps.context.on(Bi.ON_CUT,this.onCut,this),this.introduction(this.switchContent))},t.prototype.destory=function(){this.isRanderFinish&&!this.isSupportedAccessibility&&(this.introduction(this.switchContent),this.operationProps.context.removeListener(Bi.ON_COPY,this.onCopy),this.operationProps.context.removeListener(Bi.ON_PASTE,this.onPaste),this.operationProps.context.removeListener(Bi.ON_CUT,this.onCut),this.operationProps.context.removeListener(M.kgn.CARET_CHANGE,this.onSelectionChanged),this.operationProps.context.removeListener(u.at.ModelChange,this.onModelChange),this.operationProps.context.unRegisterPlugin(so(this)),this.operationProps.context.unRegisterPlugin(lo(this)),ao.destroy(),this.manager=null)},t.prototype.introduction=function(t){var e,r;null===(e=this.manager)||void 0===e||e.operationSort(Mi.Introduction,t),this.accessibilityContentChange(null===(r=this.manager)||void 0===r?void 0:r.accessibilityData)},t.prototype.accessibilityContentChange=function(t){var e;void 0===t&&(t=co),this.operationProps.context.fire(new c.ks(t)),null===(e=this.manager)||void 0===e||e.resetAccessibilityData()},t.prototype.resetModelChangeData=function(){this.isCoordinator=!1,this.isComposition=!1,this.isChangeContent=!1},t.prototype.handleCursorMove=function(t){var e,r,n={type:Mi.Error};if(!(null===(e=this.manager)||void 0===e?void 0:e.accessibilityData))return n;var i=this.manager.accessibilityData.stamp;if(i===c.bK.LINE)n={type:Mi.Line,parameters:{start:t,len:0}};else if(i===c.bK.SLIGHT_MOVE){var o=this.manager.previousCursor-t;n={type:Mi.SlightMove,parameters:{start:o<0?this.manager.previousCursor:t,len:Math.abs(o)}},(null===(r=this.manager)||void 0===r?void 0:r.isSelected)&&(n.parameters={start:this.manager.previousCursor<t?t-1:t,len:1})}return n},t.prototype.isDataChange=function(t,e){return t===e&&this.isChangeContent||this.isComposition||this.isCoordinator},t.prototype.onSelectionChanged=function(t){var e,r=t.viewRange,n=r.start,o=r.end;this.currentCursorPosition=o.gcp;var a=Mi.None,s=void 0;if(this.manager)if(this.isDataChange(n.gcp,this.manager.previousCursor))this.resetModelChangeData();else{if(null===(e=this.manager.accessibilityData)||void 0===e?void 0:e.readContent)return ao.getInstance(this.operationProps).previousCursor=this.currentCursorPosition,void this.accessibilityContentChange(this.manager.accessibilityData);if(n.gcp!==o.gcp)a=Mi.Selected,s={start:n.gcp,len:this.currentCursorPosition-n.gcp};else{var l=this.handleCursorMove(n.gcp);a=l.type,s=l.parameters,this.manager.resetSelected()}this.manager.operationSort(a,s);var c=this.manager.accessibilityData;ao.getInstance(this.operationProps).previousCursor=this.currentCursorPosition,c&&this.accessibilityContentChange(c)}else i.Logger.error("【无障碍异常】光标移动错误")},t.prototype.onModelChange=function(t){if(this.resetModelChangeData(),this.manager)if(this.manager.resetSelected(),this.operationProps.context.isCompositing())this.isComposition=!0;else{var e=t.fromServer,r=t.changeData;if(e){this.isCoordinator=!0;var n=this.operationProps.state.selection.gcpRange;ao.getInstance(this.operationProps).previousCursor=n.gcpBegin+n.len}else{var o=r.dirtyRangeMap.get("BB08J2");if(o){var a=o.first,s=a.gcpBegin,l=a.len;this.isChangeContent=!0,ao.getInstance(this.operationProps).previousCursor=s+l;var c=this.manager.accessibilityData;c&&this.accessibilityContentChange(c)}}}else i.Logger.error("【无障碍异常】数据处理错误")},t.prototype.onPaste=function(t){var e,r,n=this.operationProps.state.selection.gcpRange,i={start:n.gcpBegin,len:n.len,operationContent:ki.PASTE};r=(null===(e=this.manager)||void 0===e?void 0:e.isSelected)?Mi.Modify:Mi.Insert,this.handleCutCopyPasteEvent(r,i)},t.prototype.onCopy=function(t){var e,r;if((null===(e=this.manager)||void 0===e?void 0:e.isSelected)&&!(null===(r=null==t?void 0:t.pasteData)||void 0===r?void 0:r.isCut)){var n=this.operationProps.state.selection.gcpRange,i={start:n.gcpBegin,len:n.len,operationContent:ki.COPY};this.handleCutCopyPasteEvent(Mi.Selected,i)}},t.prototype.onCut=function(t){var e=this.operationProps.state.selection.gcpRange,r={start:e.gcpBegin,len:e.len,operationContent:ki.CUT};this.handleCutCopyPasteEvent(Mi.Modify,r)},t.prototype.handleCutCopyPasteEvent=function(t,e){var r,n;null===(r=this.manager)||void 0===r||r.operationSort(t,e),this.accessibilityContentChange(null===(n=this.manager)||void 0===n?void 0:n.accessibilityData)},t}(),uo=function(){function t(t,e,r){this.context=t,this.state=e,this.layoutController=r,this.attached=!1,this.mode=i.PlatformUtil.isTencentDocsIPadApp()?c.ns.VIEW:c.ns.EDIT,this._selectionHandler=new Ti(t,this.state,t.view.renderer.selectionOverlay.currentSelector),this._keymapManager=new ii(t,this.state),this._keyboardManager=new ri(t),this._mouseManager=new Ki(t,e,t.view.renderer.selectionOverlay,this.context.view.renderer.scrollHandler),this._touchManager=new zi(t,t.view.renderer.selectionOverlay),this.initBasicEdit(),this.initAccessibility()}var e,r,n;return Object.defineProperty(t.prototype,"keymapManager",{get:function(){return this._keymapManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"selectionHandler",{get:function(){return this._selectionHandler},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"keyboardManager",{get:function(){return this._keyboardManager},enumerable:!1,configurable:!0}),t.prototype.attach=function(){this.attached?i.Logger.warn("Surface has attached"):(this._mouseManager.attach(),this._touchManager.attach(),this._keymapManager.attach(),this._keyboardManager.attach(),this.attachEditingComponent(),this.attached=!0)},t.prototype.detach=function(){this._mouseManager.detach(),this._touchManager.detach(),this._keymapManager.detach(),this._keyboardManager.detach(),this.detachEditingComponent(),this.attached=!1},t.prototype.setMode=function(t){this.mode=t},t.prototype.getMode=function(){return this.mode},t.prototype.getFocusableDom=function(){return this.context.view.getDom()},t.prototype.isFocusing=function(){return(this.hiddenEditor instanceof Gn||this.hiddenEditor instanceof hi)&&this.hiddenEditor.isFocus},t.prototype.requestFocus=function(t,e){(this.hiddenEditor instanceof Gn||this.hiddenEditor instanceof hi)&&this.hiddenEditor.requestFocus(t,e)},t.prototype.requestBlur=function(){(this.hiddenEditor instanceof Gn||this.hiddenEditor instanceof hi)&&this.hiddenEditor.requestBlur()},t.prototype.isEditable=function(){return!(!this.context.isEditable()||this.getMode()!==c.ns.EDIT)},t.prototype.getSurfaceDom=function(){return this.context.view.getDom()},t.prototype.initAccessibility=function(){this._accessibility=new po({context:this.context,state:this.state})},t.prototype.initBasicEdit=function(){var t=this;this.context.registerPlugin(wi),xi.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin(Ei),Di.forEach((function(e){t._keymapManager.addKeymap(e)})),this.context.registerPlugin(Hi),Wi.forEach((function(e){(i.PlatformUtil.isIE()||i.PlatformUtil.isWeWorkMacOrWin())&&e.action!==_i.PASTE&&t.context.isCopyable()&&t._keymapManager.addKeymap(e)}))},t.prototype.attachEditingComponent=function(){return(0,o.__awaiter)(this,void 0,void 0,(function(){var t,e,r,n,a,s,l,c=this;return(0,o.__generator)(this,(function(o){return(t=this.context.view.getDom())?(this.context.docEnv.preview||((e=t.querySelector(".hidden-editor"))&&(e.setAttribute("aria-hidden","true"),r=this.context.view.renderer.getViewSelection().gcpRange,n=(0,M.rhU)(this.layoutController,r,this.context.view.getRenderState()),ai().render(Ln().createElement(Ln().Fragment,null,Ln().createElement(Gn,{context:this.context,state:this.state,service:this.context.service,scrollHandler:this.context.view.renderer.scrollHandler,viewRange:n,zoom:function(){return c.context.view.renderer.zoom},ref:function(t){c.hiddenEditor=t}}),Ln().createElement("div",{id:"accessibility-placeholder"})),e)),(a=t.querySelector(".caret"))&&ai().render(Ln().createElement(Nn,{context:this.context,service:this.context.service,zoom:function(){return c.context.view.renderer.zoom}}),a),(s=t.querySelector(".hidden-accessibility"))&&ai().render(Ln().createElement(li,{context:this.context}),s),i.PlatformUtil.isWeWorkMacOrWin()&&(l=t.querySelector(".hidden-selection"))&&ai().render(Ln().createElement(si,{context:this.context}),l)),[2]):(i.Logger.error("attachEditingComponent surface null"),[2])}))}))},t.prototype.detachEditingComponent=function(){var t=this.context.view.getDom();if(t){var e=t.querySelector(".hidden-editor");e&&e.remove();var r=t.querySelector(".caret");r&&r.remove();var n=t.querySelector(".mobile-caret-drag");n&&n.remove();var o=t.querySelector(".mobile-selection-drag");o&&o.remove();var a=t.querySelector(".hidden-selection");a&&a.remove()}else i.Logger.error("detachEditingComponent surface null")},t=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,c.QZ),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==di.zq&&di.zq)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(n=void 0!==cr.hy&&cr.hy)?n:Object])],t)}(),go=function(t){var e=t.factory.inject(c.S$,(0,p.vM)(uo));e&&e.attach()};function ho(t,e){var r=t.getSelection(),n=r.getTableSelectionArea();if(!e&&r.isInCellsOfTable()&&n){var i=t.getSelection().getTableSelectionService();if(!i)return!1;if(!i.getTableInfo())return!1;n.isWholeTable()?i.removeTable():i.clearContent()}else r.delete(e)}!function(){function t(t,e){this.context=t,this.service=e}var e,r,a;t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.cut=function(t){this.copyInterface?(this.copyInterface.copy(t,!0),ho(this.service,t),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT))):i.Logger.warn("clipboard|cut without copyInterface")},(0,o.__decorate)([n.CopyInterface,(0,o.__metadata)("design:type","function"==typeof(a=void 0!==n.CopyInterface&&n.CopyInterface)?a:Object)],t.prototype,"copyInterface",void 0),t=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,c.vH),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==u.IContext&&u.IContext)?e:Object,"function"==typeof(r=void 0!==c.vH&&c.vH)?r:Object])],t)}();var fo=function(){function t(t,e){var r=this;this.attached=!1,this.onCutByEvent=function(t){var e;r.context.isEditable()&&(null===(e=r.context.surface)||void 0===e?void 0:e.isFocusing())&&r.checkPermissionRange()&&(r.copyInterface&&r.copyInterface.onCopyByEvent(t,!0),ho(r.service),r.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT)))},this.context=t,this.service=e}var e,r,a;return t.prototype.attach=function(){if(this.attached)i.Logger.warn("cut has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("cut",this.onCutByEvent),this.attached=!0):i.Logger.error("CutByWeb attach surfaceDom is null")}},t.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("cut",this.onCutByEvent):i.Logger.error("CutByWeb detach surfaceDom is null"),this.attached=!1},t.prototype.cut=function(t){this.context.isEditable()&&(this.copyInterface?(this.copyInterface.copy(t,!0),ho(this.service,t),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_CUT))):i.Logger.warn("clipboard|cut without copyInterface"))},t.prototype.checkPermissionRange=function(){return this.context.service.getPermissionRange().checkPermissionRange()?(this.context.fire(new n.BeforeClipboardActionNotification(!0),!1),!0):(this.context.fire(new n.BeforeClipboardActionNotification(!1),!1),!1)},(0,o.__decorate)([n.CopyInterface,(0,o.__metadata)("design:type","function"==typeof(a=void 0!==n.CopyInterface&&n.CopyInterface)?a:Object)],t.prototype,"copyInterface",void 0),t=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,c.vH),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qw&&c.Qw)?e:Object,"function"==typeof(r=void 0!==c.vH&&c.vH)?r:Object])],t)}(),yo=function(t){var e;e=fo;var r=t.factory.inject(n.CutInterface,(0,p.vM)(e));r&&r.attach()},vo=r(2498),mo=function(t,e,r){void 0===r&&(r={});for(var n=r.ignoreParser&&r.ignoreParser[c.Rz.MainStory],i=n?"":"<div class='document'>",o="",a="",s=t.getModelBeginChild();s;){var l=e.parse(s,r);i+=l.html,o+=l.plain,a+=l.refText,s=s.getNextSibling(!0)}return{html:i=n?i:"".concat(i,"</div>"),plain:o,refText:a}},So=function(){function t(){this.map=new Map}return t.prototype.addParser=function(t,e){this.map.set(t,e)},t.prototype.getParser=function(t){return this.map.get(t)},t.prototype.parse=function(t,e){var r=this.getParser(t.uniqueTypeId);return r?r(t,e):(0,n.makeEmptyCopyData)()},t.prototype.getModelParser=function(){var t=this;return function(e,r){return t.parse(e,r)}},t}();function bo(t){var e,r,n,i=t.getProperty();return t instanceof vo.CK&&i instanceof g.Jhz&&(r=(e=t).getGCPRange(),1===(n=e.getLimitRanges()).length&&r.gcpBegin===n[0].gcpBegin&&r.len===n[0].len)}function Co(t,e){if(!bo(t))return{extraHtml:"",extraPlain:""};var r=function(t){var e=t.getProperty(),r=e.isTask?g.ly6.Square:g.QP6.get(e.lvlText);return e.isBullet||e.isTask?'<span style="font-family:Wingdings;\n                        mso-fareast-font-family:Wingdings;\n                        mso-bidi-font-family:Wingdings">\n                <span style="mso-list:Ignore;">'.concat(r,'<span style="font-family: Times New Roman">&nbsp;</span></span></span>'):'<span style="font-family:微软雅黑;\n                    mso-bidi-font-family:\'Times New Roman\';\n                    mso-font-kerning:1.0000pt;">\n            <span style="mso-list:Ignore;">'.concat(e.actualText,"<span>&nbsp;</span></span></span>\n    ")}(t);return{extraHtml:r,extraPlain:t.getProperty().actualText}}function Po(t){return(0,o.__awaiter)(this,void 0,Promise,(function(){var e=this;return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return[4,new Promise((function(r){var n=new Image;n.crossOrigin="anonymous";var i=Math.max(window.devicePixelRatio||1,1);n.onload=function(){var t=document.createElement("canvas"),a=n.width*i,s=n.height*i;t.width=a,t.height=s;var l=t.getContext("2d");l&&(l.drawImage(n,0,0,a,s,0,0,a,s),t.toBlob((function(t){return(0,o.__awaiter)(e,void 0,void 0,(function(){return(0,o.__generator)(this,(function(e){return r(null!=t?t:void 0),[2]}))}))})))},n.src=t}))];case 1:return[2,r.sent()]}}))}))}function To(t){return t>0?-t:Math.abs(t)}var Ro=function(t,e,r){var n=function(t,e,r){var n=0,o=t.ind,a=o.hangingChars,s=o.hanging,l=o.firstLineChars,c=o.firstLine;if(a)n=(u=a/g.jLu.indentChars)*r,e.push("text-indent:".concat(To((0,i.twipsToPt)(n)),"pt")),e.push("mso-char-indent-count:".concat(To(u)));else if(s){var p=(0,i.twipsToPt)(s);e.push("text-indent:".concat(To(p),"pt")),n=s}if(a||s)return n;if(l){var u=l/g.jLu.indentChars;e.push("text-indent:".concat(u,"em"))}else c&&(p=(0,i.twipsToPt)(c),e.push("text-indent:".concat(p,"pt")));return n}(t,e,r);!function(t,e,r){var n=t.isEmpty(t.tKeys.numPr)||t.numPr.isEmpty(t.numPr.tKeys.numId)||t.numPr.isEmpty(t.numPr.tKeys.ilvl)?r:0;if(t.ind.leftChars){var o=t.ind.leftChars/g.jLu.indentChars;e.push("margin-left:".concat(o+n/g.keb.fontSize,"em")),e.push("mso-para-margin-left:".concat(o,"gd"))}else{var a=(0,i.twipsToPt)(t.ind.left+n);e.push("margin-left:".concat(a,"pt"))}if(t.ind.rightChars){var s=t.ind.rightChars/g.jLu.indentChars;e.push("margin-right:".concat(s,"em")),e.push("mso-para-margin-right:".concat(s,"gd"))}else if(t.ind.right){var l=(0,i.twipsToPt)(t.ind.right);e.push("margin-right:".concat(l,"pt"))}}(t,e,n)};function _o(t){return n.ooxmlBorderType2MsoBorderTypeMap[t]||""}function Io(t){return n.htmlBorderTypeMap[t]||""}var wo=function(t){var e=[],r=[],a=t.getProperty(),s=function(t,e,r){var n=e.getTextStream().createRunIterator(t),i=e.getTextStream().createParagraphIterator(t);n.seek(t.begin()),i.seek(t.begin());var o=n.getProperty()||new(g.kkf.getPropertyClass(g.uSS.RunProperty)),a=i.getProperty()||new(g.kkf.getPropertyClass(g.uSS.ParagraphProperty));return(o=r.getStyleSheetManager().mergeStyleRunPropWithGcp(o,a,t.begin()))?Number(o.sz):g.keb.fontSize}(t.getGCPRange(),t.dataStream,t.dataManager),l=function(t,e){if(t){var r=e.getStyleSheetManager(),n=t.pStyle,i=r.getStylePropertyFromId(n,!0);if(i)return i.rPr.sz}}(a,t.dataManager);return a&&(function(t,e,r){t.jc===g.aLG.left?(e.push("text-align:left"),r.push("text-align-type-left")):t.jc===g.aLG.center?(e.push("text-align:center"),r.push("text-align-type-center")):t.jc===g.aLG.right?(e.push("text-align:right"),r.push("text-align-type-right")):(e.push("text-align:justify"),r.push("text-align-type-justify"),t.jc===g.aLG.distribute&&(e.push("text-justify:distribute-all-lines"),e.push("text-align-last: justify")))}(a,e,r),function(t,e){if(t.spacing.lineRule===g.NRl.auto){var r=t.spacing.line,n=0===r?1:r/g.jLu.autoLineRule;e.push("line-height:".concat(100*n,"%"))}else if(t.spacing.lineRule===g.NRl.exact){var o=(0,i.twipsToPx)(t.spacing.line),a=(0,i.twipsToPt)(t.spacing.line);e.push("line-height:".concat(o,"px;line-height:").concat(a,"pt;mso-line-height-rule:exactly"))}else t.spacing.lineRule===g.NRl.atLeast&&(o=(0,i.twipsToPx)(t.spacing.line),a=(0,i.twipsToPt)(t.spacing.line),e.push("line-height:".concat(o,"px;mso-line-height-alt:").concat(a,"pt")))}(a,e),function(t,e){if(void 0!==t.spacing.before){var r=(0,i.twipsToPt)(t.spacing.before);e.push("margin-top:".concat(r,"pt"))}if(void 0!==t.spacing.after){var n=(0,i.twipsToPt)(t.spacing.after);e.push("margin-bottom:".concat(n,"pt"))}}(a,e),Ro(a,e,s),function(t,e,r){var i=[],a=[],s=t.pBdr,l=s.top,c=s.bottom,p=s.left,u=s.right;if(l.val!==g.EJ9.undefined?(i.push("border-top: ".concat(Io(l.val)," #").concat(l.color," ").concat(l.sz/8,"pt")),i.push("mso-border-top-alt: ".concat(_o(l.val)," #").concat(l.color," ").concat(l.sz/8,"pt"))):c.val!==g.EJ9.undefined?(i.push("border-bottom: ".concat(Io(c.val)," #").concat(c.color," ").concat(c.sz/8,"pt")),i.push("mso-border-bottom-alt: ".concat(_o(c.val)," #").concat(c.color," ").concat(c.sz/8,"pt"))):p.val!==g.EJ9.undefined?(i.push("border-left: ".concat(Io(p.val)," #").concat(p.color," ").concat(p.sz/8,"pt")),i.push("mso-border-left-alt: ".concat(_o(p.val)," #").concat(p.color," ").concat(p.sz/8,"pt"))):u.val!==g.EJ9.undefined&&(i.push("border-right: ".concat(Io(u.val)," #").concat(u.color," ").concat(u.sz/8,"pt")),i.push("mso-border-right-alt: ".concat(_o(u.val)," #").concat(u.color," ").concat(u.sz/8,"pt"))),c.val!==g.EJ9.undefined){var h=n.borerV3V2Map[c.val]||"normal";a.push("horizontal-splitline",h)}e.push.apply(e,(0,o.__spreadArray)([],(0,o.__read)(i),!1)),r.push.apply(r,(0,o.__spreadArray)([],(0,o.__read)(a),!1))}(a,e,r),function(t,e,r){if(bo(t)){var i=t.getProperty(),o=i.listId,a=i.listLevel;e.push("mso-list:".concat((0,n.transformListIdToMsoId)(o)," level").concat(a+1)),r.push("MsoNormal")}}(t,e,r),function(t,e){e&&t.push("font-size: ".concat((0,i.twipsToPt)(e),"pt"))}(e,l)),{styles:"".concat(e.join(";")),classes:"".concat(r.join(" "))}},xo=function(t,e,r){void 0===r&&(r={});var n=r.ignoreParser&&r.ignoreParser[c.Rz.Paragraph],i=function(t){var e,r='<p class="paragraph">',n="</p>",i=t.getProperty(),o=g.ilm.LevelNone;if(i){var a=wo(t);if(r='<p class="paragraph '.concat(a.classes,'" style="').concat(a.styles,'">'),(o=i.outlineLvl)<g.ilm.LevelNone)if(o>g.ilm.Level6)r="<p>",n="</p>";else{var s=i.pStyle,l=null===(e=t.dataManager.getStyleSheetManager().getStylePropertyFromId(s))||void 0===e?void 0:e.name.toLowerCase(),c="heading".concat(o+=1);r="<h".concat(o,' class="paragraph ').concat(a.classes," tco-title-").concat(l||c,'" style="').concat(a.styles,'">'),n="</h".concat(o,">")}}return{htmlPrefix:r,htmlSuffix:n}}(t),o=n?"":i.htmlPrefix;!function(t){t.copyCssStyleManager.addCssStyle("p.MsoNormal",'\n        mso-style-name: 正文;\n        mso-style-parent: "";\n        margin: 0pt;\n        margin-bottom: .0001pt;\n        mso-pagination: none;\n        text-justify: inter-ideograph;\n        mso-font-kerning: 1.0000pt;\n    '),t.copyCssStyleManager.addCssStyle("p.paragraph","\n        mso-style-noshow: yes;\n        margin-top: 5.0000pt;\n        margin-right: 0.0000pt;\n        margin-bottom: 5.0000pt;\n        margin-left: 0.0000pt;\n        mso-margin-top-alt: auto;\n        mso-margin-bottom-alt: auto;\n        text-align: left;\n        font-family: 等线;\n        mso-bidi-font-family: 'Times New Roman';\n        font-size: 12.0000pt;\n    ")}(e);var a=Co(t);o+=a.extraHtml;var s="";s+=a.extraPlain;for(var l="",p=t.getModelBeginChild();p;){var u=p.getLimitContent();if("\r"!==u){if(p instanceof vo.Gw)for(var h=p.getModelBeginChild();h;){var d;o+=(d=e.parse(h,r)).html,s+=d.plain,l+=d.refText,h=h.getNextModelSibling()}else o+=(d=e.parse(p,r)).html,s+=d.plain,l+=d.refText;p=p.getNextModelSibling()}else o+='<span lang="EN-US"><o:p></o:p></span>',s+=u,p=p.getNextModelSibling()}return n?o="<br/>"===o?o:"".concat(o,"<br/>"):o+=i.htmlSuffix,{html:o,plain:s,refText:l}},Eo=function(t,e,r){var n;void 0===r&&(r={});for(var i=r.ignoreParser&&r.ignoreParser[c.Rz.Section],o=r.isContinuous,a=void 0===o||o,s=i?"":"<div class='section'>",l="",p="",u=t.getModelBeginChild(!0,null===(n=e.getState().selection.tableSelectionArea)||void 0===n?void 0:n.nestingLevel),g=function(){if(a){var t=e.parse(u,r);s+=t.html,l+=t.plain,p+=t.refText}else{var n=u.getGCPRange();u.getLimitRanges().find((function(t){return n.equal(t)}))&&(t=e.parse(u,r),s+=t.html,l+=t.plain,p+=t.refText)}u=u.getNextSibling(!0)};u;)g();return{html:s=i?s:"".concat(s,"</div>"),plain:l,refText:p}},Do=new RegExp("".concat(g.IfD.ParagraphReturn,"|").concat(g.IfD.TableStart,"|").concat(g.IfD.TableEnd,"|").concat(g.IfD.TableCellBreak,"|").concat(g.IfD.TableRowBreak),"g"),ko=new RegExp("".concat(g.IfD.TableStart,"|").concat(g.IfD.TableEnd,"|").concat(g.IfD.TableCellBreak,"|").concat(g.IfD.TableRowBreak),"g"),Lo=/[<>'"&]/g,Ao={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},Fo=function(t,e,r){if(t instanceof vo.Tp)return{html:"",plain:"",refText:""};var n=t.getLimitContent(),o=t.getProperty(),a="",s="";o&&(a=(a+=M.vW8.computeTextSpanFullStyles(o).cssText).replace(/"/g,"")),(null==o?void 0:o.fontFamily)?s+="data-font-family='".concat(o.fontFamily,"'"):s+='data-font-family="default"';var l="";if((null==r?void 0:r.link)&&(l+='<a href="'.concat((0,i.escapeHTML)(r.link),'">')),n.replace(/ /g,""))if("\r"===n)l+='<span lang="EN-US"><o:p></o:p></span>';else{var c=n.replace(/ /g,"&nbsp;"),p=c?c.replace(Do,""):c;l+='<span style="white-space:pre;'.concat(a,'" ').concat(s,">").concat(p,"</span>")}else l+='<span style="white-space: pre;'.concat(a,'" ').concat(s,">").concat(n.replace(Lo,(function(t){return Ao[t]})),"</span>");return n=n.replace(ko,""),(null==r?void 0:r.link)&&(l+="</a>"),{html:l,plain:n,refText:n}},Mo=function(){function t(){this.cssStyleMap={}}return t.prototype.addCssStyle=function(t,e){var r=this.cssStyleMap[t];r&&r===e||(this.cssStyleMap[t]=r?r+e:e)},t.prototype.clearCssStyleMap=function(){for(var t in this.cssStyleMap)delete this.cssStyleMap[t]},t.prototype.generateStyleHtml=function(){var t="<style>\x3c!--";for(var e in this.cssStyleMap){var r=this.cssStyleMap[e];t+="".concat(e,"{").concat(r,"}\n            ")}return t+="--\x3e</style>"},t}(),Oo=function(){function t(t,e){this.copyCssStyleManager=new Mo,this.map=new Map,this.context=t,this.state=e,this.containerMgr=new So,this.initBasicModelParser(),this.addModelParser(c.Rz.LeafContainer,this.containerMgr.getModelParser()),this.addModelParser(c.Rz.Image,this.containerMgr.getModelParser()),this.addModelParser(c.Rz.FieldContainer,this.containerMgr.getModelParser())}return t.prototype.getState=function(){return this.state},t.prototype.initBasicModelParser=function(){this.addModelParser(c.Rz.MainStory,mo),this.addModelParser(c.Rz.Paragraph,xo),this.addModelParser(c.Rz.Section,Eo),this.addModelParser(c.Rz.Text,Fo)},t.prototype.addModelParser=function(t,e){this.map.set(t,e)},t.prototype.getModelParser=function(t){return this.map.get(t)},t.prototype.addContainerParser=function(t,e){this.containerMgr.addParser(t,e)},t.prototype.parse=function(t,e){var r=this.getModelParser(t.type);return r?r(t,this,e):(i.Logger.error("cannot find parser for type=".concat(t.type)),(0,n.makeEmptyCopyData)())},t.prototype.doCopy=function(t,e,r){var i;i=Array.isArray(t)?t:t?[t]:this.state.selection.gcpRanges;var a,s=this.state.dataEngine;a=(e||this.state.selection.subStoryInfo.storyProp.storyType)===g.AHI.mainDocument?(0,vo.zp)(new vo.fl(s),i):(0,vo.ej)(new vo.fl(s),i);var l="",c="",p="";if(this.copyCssStyleManager.clearCssStyleMap(),a){var u=this.parse(a,r);return l+=u.html,c+=u.plain,p+=u.refText,{html:l,plain:c.replace(/\r/g,"\n"),refText:p,style:this.copyCssStyleManager.generateStyleHtml()}}return(0,o.__assign)((0,o.__assign)({},(0,n.makeEmptyCopyData)()),{style:""})},t}(),Bo=function(){function t(t,e){this.context=t,this.state=e}return t.prototype.doCut=function(t){var e=u.C1.createLocalDeltaOption(g.ICE.emptyRange()).buildDelta();e.setCommandType(u.wI.DocCut);var r=t||this.state.selection.gcpRange;return this.dataParser(e,r)},t.prototype.collectDataForCopyMultiRange=function(t,e){var r=this,n=[];return e.forEach((function(e){var i=r.collectDataForCopy(t,e);n.push.apply(n,(0,o.__spreadArray)([],(0,o.__read)(i),!1))})),n},t.prototype.collectDataForCopy=function(t,e){var r=t.globalOpts.commandType===u.wI.DocCut;return u.Me.collectDataForCopy(this.state.dataEngine,t,e,!0,r)},t.prototype.doCopy=function(t){var e=u.C1.createLocalDeltaOption(g.ICE.emptyRange()).buildDelta();e.setCommandType(u.wI.DocCopy);var r=t||this.state.selection.gcpRange;return this.dataParser(e,r)},t.prototype.dataParser=function(t,e){var r=this,n=t.globalOpts.commandType===u.wI.DocCut,o=u.Me.collectDataForCopy(this.state.dataEngine,t,e,!0,n),a=[];this.state.context.run(Zr.aU.TRANS_DELTA_TO_OPERATION_DATA,t,a,this.state.dataEngine);var s="",l=this.context.docEnv.uniqueId;l&&(s=l);var c=[];return o.forEach((function(t){var e=[];r.state.context.run(Zr.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,r.state.dataEngine),c.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})})),i.Logger.info(u.wI.DocCopy,"copy internal range [".concat(e.begin(),", ").concat(e.end(),"]!")),JSON.stringify({mainStory:a,subStory:c,srcGlobalPadId:s,copyStart:e.begin()})},t.prototype.parseCopyData=function(t,e,r){var n=this,i=[];this.state.context.run(Zr.aU.TRANS_DELTA_TO_OPERATION_DATA,t,i,this.state.dataEngine);var o="",a=this.context.docEnv.uniqueId;a&&(o=a);var s=[];return e.forEach((function(t){var e=[];n.state.context.run(Zr.aU.TRANS_DELTA_TO_OPERATION_DATA,t.delta,e,n.state.dataEngine),s.push({storyId:t.storyId,storyOps:e,storyType:t.storyType})})),JSON.stringify({mainStory:i,subStory:s,srcGlobalPadId:o,copyStart:null==r?void 0:r.begin()})},t.prototype.doMultiCopy=function(t,e){var r=u.C1.createLocalDeltaOption(g.ICE.emptyRange()).buildDelta();r.setCommandType(e===n.ClipboardType.Copy?u.wI.DocCopy:u.wI.DocCut);var i=this.collectDataForCopyMultiRange(r,t);return this.parseCopyData(r,i,t[0])},t}();function No(t,e){p.kQ.zzsValue(p.GI.COPY_DATA_LENGTH,e),p.kQ.zzsValue(p.GI.COPY_DATA_USE_TIME,(Date.now()-t)/1e3)}var Ho,Wo,Go,Vo=function(){function t(t,e,r){this.state=e,this.context=t,this.customClipboard=r,this.copyParserManager=new Oo(t,e),this.copyInternal=new Bo(t,e)}var e,r,a;return t.prototype.addCopyModelParser=function(t,e){this.copyParserManager.addModelParser(t,e)},t.prototype.addCopyContainerParser=function(t,e){this.copyParserManager.addContainerParser(t,e)},t.prototype.generateHtml=function(t,e,r){void 0===e&&(e=!1),this.reportCopyWordCount(t);var n=e?this.copyInternal.doCut(t):this.copyInternal.doCopy(t),o=this.copyParserManager.doCopy(t,r),a=o.html,s=o.plain,l=o.style,c=this.getHtmlWithMeloData(a,s,l,n);return this.customClipboard.setSelectionInnerData({html:c,plain:s,innerData:n}),i.Logger.info("generateHtml length info result.plain: ".concat(s.length,", result.html: ").concat(c.length)),{html:a,plain:s,innerData:n,htmlWithMeloData:c}},t.prototype.getHtmlWithMeloData=function(t,e,r,i){var o=document.createElement("div"),a='\n            <html>\n            <head>\n                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />\n                <meta name="ProgId" content="Word.Document" />\n                <meta name="Generator" content="Microsoft Word 14" />\n                <meta name="Originator" content="Microsoft Word 14" />'.concat(r,"</head><body>"),l=document.createElement("div");l.setAttribute("tdoc-data-src",i),l.setAttribute("data-version",n.DATA_VERSION),l.setAttribute(n.INNER_DATA_TYPE,(0,n.getDataType)());var c=(e||"").replace(u.Xr,"");return l.setAttribute("data-hash",s().hash(c)),o.appendChild(l),"".concat(a+o.innerHTML+t,"</body></html>")},t.prototype.writeImageToClipboard=function(t,e){var r;return(0,o.__awaiter)(this,void 0,void 0,(function(){var n,i,a,s,l,c,p,u,h,d;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return(n=document.createElement("div")).innerHTML=t,i=n.getElementsByTagName("img"),a=i.length,e.trim()||1!==a?[2]:(s=i[0],l=s.id,(c=null===(r=this.state.getDrawingStream().getDrawingInfo(l))||void 0===r?void 0:r.property)?[4,g.Cf9.getBlobFromProperty(c,!1)]:[3,2]);case 1:return u=o.sent(),[3,4];case 2:return[4,Po(s.src)];case 3:u=o.sent(),o.label=4;case 4:return p=u,h=new Blob([t],{type:"text/html"}),d=new Blob([e],{type:"text/plain"}),p?[2,new Promise((function(t,e){var r,n,i=[new ClipboardItem((r={},r[p.type]=p,r[h.type]=h,r[d.type]=d,r))];null===(n=navigator.clipboard)||void 0===n||n.write(i).then((function(){t()})).catch((function(t){e(t)}))}))]:[2]}}))}))},t.prototype.attach=function(){},t.prototype.detach=function(){},t.prototype.onCopyByEvent=function(t){},t.prototype.setClipboardData=function(t,e){void 0===e&&(e=!1),this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e||this.customClipboard.writeToSysytemClipboard()},t.prototype.fireCopyEvent=function(t){void 0===t&&(t=!1),t||this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))},t.prototype.copy=function(t,e,r){void 0===e&&(e=!1),void 0===r&&(r=!1);var n=Date.now(),i=this.generateHtml(t);No(n,i.htmlWithMeloData.length),this.setClipboardData(i,r),this.fireCopyEvent(e)},t.prototype.blockGenerateMutiRange2Html=function(t,e){var r=this.copyInternal.doMultiCopy(t,e),n=this.copyParserManager.doCopy(t,void 0,{isContinuous:!1}),i=n.html,o=n.plain,a=n.style,s=this.getHtmlWithMeloData(i,o,a,r);return this.customClipboard.setSelectionInnerData({html:s,plain:o,innerData:r}),{html:i,plain:o,innerData:r,htmlWithMeloData:s}},t.prototype.mobileBlockMultiCopy=function(t,e){var r=e.clipboardType,n=e.preventSendEvent,i=void 0!==n&&n,a=e.preventWriteSystem,s=void 0!==a&&a,l=(0,o.__spreadArray)([],(0,o.__read)(t),!1).sort((function(t,e){return t.begin()-e.begin()})),c=this.blockGenerateMutiRange2Html(l,r);this.setClipboardData(c,s),this.fireCopyEvent(i)},t.prototype.getRefText=function(t){return this.copyParserManager.doCopy(t).refText||""},t.prototype.getCopyContent=function(t){var e=document.createElement("div"),r=document.createElement("meta");r.setAttribute("charset","utf-8"),e.appendChild(r);var i=this.copyInternal.doCopy(t),o=document.createElement("melo-data");o.setAttribute("data-src",i),o.setAttribute("data-version",n.DATA_VERSION),e.appendChild(o);var a=this.copyParserManager.doCopy(t),s=a.html,l=a.plain,c=document.createElement("div");return c.innerHTML=s,e.appendChild(c),{html:e.innerHTML,plain:l}},t.prototype.writeClipboard=function(t){this.writeClipboardContent=t},t.prototype.reportCopyWordCount=function(t){var e=null!=t?t:this.context.service.getDocument().getSelection().getRange().range(),r=this.context.service.getDocument().getTextFromGcpRange(e).length;r>15e3?p.kQ.zzsStatus({attributeId:p.GI.COPY_LENGTH_OVER_15000,status:p.eG.SUCCESS}):r>1e4?p.kQ.zzsStatus({attributeId:p.GI.COPY_LENGTH_OVER_10000,status:p.eG.SUCCESS}):r>5e3?p.kQ.zzsStatus({attributeId:p.GI.COPY_LENGTH_OVER_5000,status:p.eG.SUCCESS}):r>2500?p.kQ.zzsStatus({attributeId:p.GI.COPY_LENGTH_OVER_2500,status:p.eG.SUCCESS}):p.kQ.zzsStatus({attributeId:p.GI.COPY_LENGTH_LESS_2500,status:p.eG.SUCCESS})},t=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(e=void 0!==c.Qw&&c.Qw)?e:Object,"function"==typeof(r=void 0!==l.ZM&&l.ZM)?r:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],t)}(),Uo=(function(t){function e(e,r,n){var i=t.call(this,e,r,n)||this;return i.className="CopyByMobile",i}var r,i,a;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(e){t.prototype.copy.call(this,e,!1,!1)},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(i=void 0!==l.ZM&&l.ZM)?i:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],e)}(Vo),et.Snackbar);function Ko(){Go=(new Date).valueOf(),Wo=window.setTimeout((function(){var t=window.$t;Ho=Uo.show({message:t("core-edit:copying"),autoClose:!1,type:"loading",id:"filter-html-image-snackbar"})}),1e3)}function zo(){clearTimeout(Wo),null==Ho||Ho.close(),i.Logger.info("filterHtmlImageUrlToBase64 cost: ".concat((new Date).valueOf()-Go," ms"))}function jo(t){var e=(new DOMParser).parseFromString(t,"text/html").body,r=Array.from(e.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")}));try{r.forEach((function(t){t.src=function(t){var e=t.id,r=function(t){var e,r,n=/\.(a-z)\?/;switch(null!==(r=null===(e=t.match(n))||void 0===e?void 0:e[1])&&void 0!==r?r:""){case"gif":return"image/gif";case"jpg":case"jpeg":return"image/jpeg";case"webp":return"image/webp";default:return"image/png"}}(t.src),n=document.getElementById(e),i=n.width,o=n.height,a=document.createElement("canvas");a.width=i,a.height=o;var s=a.getContext("2d");null==s||s.drawImage(n,0,0,i,o);var l=a.toDataURL(r);return l.startsWith("data:image")?l:t.src}(t)}))}catch(e){return i.Logger.error("transform url to thumbnail fail"),p.kQ.zzsStatus({attributeId:p.GI.COPY_ERROR,status:p.eG.FAIL,errorMessage:null==e?void 0:e.message}),t}return e.innerHTML}function qo(t,e,r,n){var a,s,l=(new DOMParser).parseFromString(t,"text/html").body,c=Array.from(l.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")}));if(!c||0===c.length)return i.Logger.info("clipboard html, ",t),[new ClipboardItem({"text/html":Promise.resolve(new Blob([t],{type:"text/html"})),"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})];if(!e.trim()&&1===c.length){var p=new AbortController,u=p.signal;setTimeout((function(){p.abort()}),1e4);var h=Qo({imgSrc:c[0].src,thumb:null!==(a=c[0].getAttribute("thumb"))&&void 0!==a?a:c[0].src},{needCompress:!0,signal:u}),d=c[0].id,f=null===(s=r.getDrawingStream().getDrawingInfo(d))||void 0===s?void 0:s.property,y=g.Cf9.cropImageFromBlob(h,f),v=function(t,e,r){return(0,o.__awaiter)(this,void 0,Promise,(function(){var n;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Jo(t,e)];case 1:return n=o.sent(),i.Logger.info("clipboard html, ",n),No(r,n.length),[2,new Blob([n],{type:"text/html"})]}}))}))}(t,[h],Go);return[new ClipboardItem({"text/html":v,"text/plain":Promise.resolve(new Blob([e.trim()],{type:"text/plain"})),"image/png":y})]}var m=function(t,e){return(0,o.__awaiter)(this,void 0,Promise,(function(){var r;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return[4,Xo(t)];case 1:return r=n.sent(),i.Logger.info("clipboard html, ",r),No(e,r.length),[2,new Blob([r],{type:"text/html"})]}}))}))}(t,n);return[new ClipboardItem({"text/html":m,"text/plain":Promise.resolve(new Blob([e],{type:"text/plain"}))})]}function Xo(t){return(0,o.__awaiter)(this,void 0,Promise,(function(){var e,r,n,a,s,l,c,p,u;return(0,o.__generator)(this,(function(g){switch(g.label){case 0:r=new DOMParser,n=r.parseFromString(t,"text/html"),e=n.body,a=Array.from(e.querySelectorAll("img")).filter((function(t){return!t.src.startsWith("data:image")})),s=[],l=new AbortController,c=l.signal,p=setTimeout((function(){l.abort()}),1e4),Ko(),g.label=1;case 1:return g.trys.push([1,3,,4]),a.forEach((function(t){s.push(function(t,e){return(0,o.__awaiter)(this,void 0,Promise,(function(){return(0,o.__generator)(this,(function(r){switch(r.label){case 0:return[4,Qo({imgSrc:t},{signal:e})];case 1:return[2,Yo(r.sent())]}}))}))}(t.src,c))})),[4,Promise.all(s).then((function(t){t.forEach((function(t,e){t&&(a[e].src=t)}))}))];case 2:return g.sent(),clearTimeout(p),zo(),[2,e.innerHTML];case 3:return u=g.sent(),i.Logger.error("transform image url to base64 error, ",null==u?void 0:u.message),clearTimeout(p),zo(),[2,jo(t)];case 4:return[2]}}))}))}function Qo(t,e){var r=this,n=e.needCompress,a=e.maxSize,s=e.signal;return new Promise((function(e,l){var c=t.imgSrc,p=t.thumb,u=window.$t;fetch(c,{signal:s}).then((function(t){return(0,o.__awaiter)(r,void 0,void 0,(function(){var r;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return[4,t.blob()];case 1:return r=i.sent(),n&&r.size>=1024*(null!=a?a:20)*1024?(Uo.show({message:u("core-edit:image-compress"),autoClose:!0,type:"info"}),fetch(null!=p?p:c).then((function(t){return e(t.blob())})),[2]):(e(r),[2])}}))}))})).catch((function(t){"AbortError"===t.name&&(Uo.show({message:u("core-edit:image-unable-copy"),autoClose:!0,type:"info"}),i.Logger.error("fetch image timeout")),i.Logger.error("fetch image blob fail : "+c),l(t)}))}))}function Yo(t){return(0,o.__awaiter)(this,void 0,Promise,(function(){var e,r;return(0,o.__generator)(this,(function(n){switch(n.label){case 0:return t instanceof Blob?(r=t,[3,3]):[3,1];case 1:return[4,t];case 2:r=n.sent(),n.label=3;case 3:return(e=r)?[2,new Promise((function(t){var r=new FileReader;r.onloadend=function(){t(r.result)},r.readAsDataURL(e)}))]:[2,""]}}))}))}function Jo(t,e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var r,n,a,s,l;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:n=new DOMParser,a=n.parseFromString(t,"text/html"),r=a.body,Ko(),s=r.querySelectorAll("img"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,Promise.all(e.map((function(t){return Yo(t)})))];case 2:return o.sent().forEach((function(t,e){s[e].src=t})),zo(),[2,r.innerHTML];case 3:return l=o.sent(),zo(),i.Logger.error("transform image blob to base64 error, ",null==l?void 0:l.message),[2,jo(t)];case 4:return[2]}}))}))}!function(t){function e(e,r,n){var i=t.call(this,e,r,n)||this;return i.className="CopyByMqq",i}var r,i,a;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(e){t.prototype.copy.call(this,e,!1,!1)},e.prototype.setClipboardData=function(t,e){return void 0===e&&(e=!1),(0,o.__awaiter)(this,void 0,void 0,(function(){var r,n;return(0,o.__generator)(this,(function(i){switch(i.label){case 0:return this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e?[2]:(r=window.top.mqq)&&"0"!==r.clientVersion?[4,Xo(t.htmlWithMeloData)]:[3,2];case 1:return n=i.sent(),r.invoke("docx","writeSystemClipboard",{plain:t.plain,html:n}),[3,3];case 2:this.customClipboard.writeToSysytemClipboard(),i.label=3;case 3:return[2]}}))}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(i=void 0!==l.ZM&&l.ZM)?i:Object,"function"==typeof(a=void 0!==n.CustomClipboard&&n.CustomClipboard)?a:Object])],e)}(Vo);var Zo=function(t){function e(e,r,n){var a,s=this;return(s=t.call(this,e,r,n)||this).className="CopyByWeb",s.copyFromMenuClick=!1,s.isCut=!1,s.hasAsyncCopyPermission=!1,s.attached=!1,s.onCopyByMenu=function(t){s.copyFromMenuClick&&(i.Logger.info("copyFromMenuClick"),s.onCopyByEvent(t),s.copyFromMenuClick=!1,s.range=void 0)},s.onCopyByEvent=function(t,e){return void 0===e&&(e=!1),(0,o.__awaiter)(s,void 0,void 0,(function(){var r,n,a,s,l,c,u,g,h,d,f,y;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return this.context.isCopyable()?(this.copyFromMenuClick&&(i.Logger.info("copyFromMenuClick"),this.copyFromMenuClick=!1),i.Logger.info("onCopyByEvent start with event: ".concat(t)),this.isCut=this.isCut?this.isCut:e,(r=i.PlatformUtil.isIE()?window.clipboardData:t.clipboardData)?(n=Date.now(),a=this.generateHtml(this.range,this.isCut),s=(null===(f=this.writeClipboardContent)||void 0===f?void 0:f.html)||a.htmlWithMeloData,l=(null===(y=this.writeClipboardContent)||void 0===y?void 0:y.plain)||a.plain,c=a.innerData,this.customClipboard.setData(s,l,c),i.PlatformUtil.isIE()?(r.setData("Text",l),i.Logger.info("IE clipboardData plain: ".concat(r.plain)),No(n,s.length),[3,7]):[3,1]):[2]):[2];case 1:return this.isBugSafariForErrorCode()?(r.setData("Text",l),i.Logger.info("BugSafari clipboardData plain: ".concat(r.getData("text/plain"))),No(n,s.length),[3,7]):[3,2];case 2:return!this.isSupportAsyncClipboardWrite()||this.copyFromMenuClick&&i.PlatformUtil.isSafari()?(u=jo(s),r.setData("text/html",u),r.setData("text/plain",l),No(n,u.length),i.Logger.info("chrome clipboardData plain: ".concat(r.getData("text/plain"))),i.Logger.info("chrome clipboardData html: ".concat(r.getData("text/html"))),[3,7]):[3,3];case 3:window!==window.top&&window.focus(),i.Logger.info("clipboard plain, ",l),o.label=4;case 4:return o.trys.push([4,6,,7]),g=qo(s,l,this.state,n),[4,navigator.clipboard.write(g)];case 5:return o.sent(),[3,7];case 6:return h=o.sent(),i.Logger.error("write async clipboard fail : ".concat(null==h?void 0:h.message,", use sync clipboard instead")),p.kQ.zzsStatus({attributeId:p.GI.COPY_ERROR,status:p.eG.FAIL,errorMessage:null==h?void 0:h.message}),d=jo(s),r.setData("text/html",d),r.setData("text/plain",l),i.Logger.info("chrome clipboardData plain: ".concat(r.getData("text/plain"))),i.Logger.info("chrome clipboardData html: ".concat(r.getData("text/html"))),[3,7];case 7:return this.afterCopy(t),[2]}}))}))},null===(a=null===navigator||void 0===navigator?void 0:navigator.permissions)||void 0===a||a.query({name:"clipboard-write"}).then((function(t){s.hasAsyncCopyPermission="granted"===t.state})),s}var r,a,s;return(0,o.__extends)(e,t),e.prototype.isSupportAsyncClipboardWrite=function(){return!!navigator.clipboard&&!!navigator.clipboard.write&&this.hasAsyncCopyPermission},e.prototype.isBugSafariForErrorCode=function(){return!(!i.PlatformUtil.isSafari()||!i.PlatformUtil.isMac())&&navigator.userAgent.toLocaleLowerCase().indexOf("version/13.1")>-1},e.prototype.afterCopy=function(t){null==t||t.preventDefault(),this.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY,{isCut:this.isCut})),this.isCut=!1,this.range=void 0,this.writeClipboardContent=void 0},e.prototype.copyFromMenuInSafari=function(){var t,e,r=Date.now(),n=this.generateHtml(this.range,this.isCut),i=n.plain,o=n.innerData,a=n.htmlWithMeloData;this.customClipboard.setData(a,i,o);var s=qo((null===(t=this.writeClipboardContent)||void 0===t?void 0:t.html)||a,((null===(e=this.writeClipboardContent)||void 0===e?void 0:e.plain)||i).trim(),this.state,r);window!==window.top&&window.focus(),navigator.clipboard.write(s),this.afterCopy()},e.prototype.attach=function(){if(this.attached)i.Logger.info("copy has attached");else{var t=this.context.view.getDom();t?(t.addEventListener("copy",this.onCopyByEvent),document.addEventListener("copy",this.onCopyByMenu),this.attached=!0,i.Logger.info("CopyByWeb attach surfaceDom is true")):i.Logger.error("CopyByWeb attach surfaceDom is null")}},e.prototype.detach=function(){var t=this.context.view.getDom();t?t.removeEventListener("copy",this.onCopyByEvent):i.Logger.error("CopyByWeb detach surfaceDom is null"),document.removeEventListener("copy",this.onCopyByMenu),this.attached=!1},e.prototype.copy=function(t,e){if(void 0===e&&(e=!1),this.context.isCopyable()){if(i.Logger.info("copy by web"),this.copyFromMenuClick=!0,this.range=t,this.isCut=e,i.PlatformUtil.isSafari()&&this.isSupportAsyncClipboardWrite())try{return void this.copyFromMenuInSafari()}catch(t){i.Logger.error("safari copy from menu click error, ",null==t?void 0:t.message),p.kQ.zzsStatus({attributeId:p.GI.COPY_ERROR,status:p.eG.FAIL,errorMessage:null==t?void 0:t.message})}var r=/WeComCEF/.test(navigator.userAgent),n=i.PlatformUtil.isSafari()&&!r,o=i.PlatformUtil.isMac()&&i.PlatformUtil.isWXMiniProgram(),a=i.PlatformUtil.isWeWork()&&!i.PlatformUtil.isWindows()&&!r;if(n||a||o||i.PlatformUtil.isIE()){document.body.style.webkitUserSelect="text";var s=document.createElement("textarea");s.style.opacity="0",s.contentEditable="true",document.body.appendChild(s),s.value=" ";var l=document.createRange();l.selectNode(s);var c=window.getSelection();c&&(c.removeAllRanges(),c.addRange(l)),document.execCommand("copy"),setTimeout((function(){document.body.removeChild(s)}),500)}else document.execCommand("copy")}},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Vo),$o=(function(t){function e(e,r,a){var s=t.call(this,e,r,a)||this;return s.className="CopyByWeWork",s.setClickboardData=function(t,e){return(0,o.__awaiter)(s,void 0,void 0,(function(){var r,a,s=this;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return r=function(){s.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))},[4,Xo(t)];case 1:return a=o.sent(),n.tdocsCopyPaste.isSupportWrite?(i.Logger.info("copy use tdocsCopyPaste"),[2,n.tdocsCopyPaste.write({html:a,plain:e}).then(r)]):[2,(0,n.writeWeworkClipboard)({html:a,plain:e}).then(r)]}}))}))},s}var r,a,s;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.copy=function(t,e){void 0===e&&(e=!1);var r=Date.now(),n=this.generateHtml(t,e),o=n.htmlWithMeloData,a=n.plain,s=n.innerData;No(r,o.length),i.Logger.info("copy by wework with html: ".concat(o,", plain: ").concat(a,", innerData: ").concat(s)),this.customClipboard.setData(o,a,s),this.setClickboardData(o,a)},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Vo),function(t){function e(e,r,n){var i=t.call(this,e,r,n)||this;return i.className="CopyByWXRTF",i}var r,a,s;return(0,o.__extends)(e,t),e.prototype.copy=function(e){t.prototype.copy.call(this,e,!0,!1)},e.prototype.setClipboardData=function(t,e){return void 0===e&&(e=!1),(0,o.__awaiter)(this,void 0,void 0,(function(){var r,a=this;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(this.customClipboard.setData(t.htmlWithMeloData,t.plain,t.innerData),e)return[2];if(!window.WeixinJSBridge)try{if(!window.top)return i.Logger.info("window.top not found"),[2];window.WeixinJSBridge=window.top.WeixinJSBridge,i.Logger.info("WeixinJSBridge acquired from top window")}catch(t){return i.Logger.info("can not get WeixinJSBridge, ",t),[2]}return[4,Xo(t.htmlWithMeloData)];case 1:return r=o.sent(),(0,n.writeWXRTFClipboard)({html:r,plain:t.plain}).then((function(){p.kQ.tdwReport({opername:"doc_word_editor",module:"copy_paste",action:"wx_write_rich_text"}),i.Logger.info("writeWXRTFClipboard success: ".concat(t.htmlWithMeloData)),a.context.fire(new n.ClipboardNotification(n.ClipboardNotificationType.ON_COPY))})).catch((function(){i.Logger.info("writeWXRTFClipboard fail"),p.kQ.idkeyReport(p.bP.WECHAT_COPYPASTE_FAILED)})),[2]}}))}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Vo)),ta=(function(t){function e(e,r,n){var i=t.call(this,e,r,n)||this;return i.className="CopyByQQBrowser",i}var r,a,s;(0,o.__extends)(e,t),e.prototype.attach=function(){},e.prototype.detach=function(){},e.prototype.write=function(t,e){return(0,o.__awaiter)(this,void 0,void 0,(function(){var r,n;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,Xo(t)];case 1:return r=o.sent(),i.Logger.info("window.browser.file",window.browser.file),window.browser.file.setClipboardData((function(){i.Logger.info("setClipboardData success")}),(function(){i.Logger.info("setClipboardData fail")}),{plain:e,html:r}),[3,3];case 2:return n=o.sent(),i.Logger.error("setClipboardData:error",n),[3,3];case 3:return[2]}}))}))},e.prototype.copy=function(t,e){return void 0===e&&(e=!1),(0,o.__awaiter)(this,void 0,void 0,(function(){var r,a,s,l,c;return(0,o.__generator)(this,(function(o){switch(o.label){case 0:if(!this.context.isCopyable())return[2];r=Date.now(),a=this.generateHtml(t,e),s=a.htmlWithMeloData,l=a.plain,No(r,s.length),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,n.loadQQBrowserJSSDK)()];case 2:return o.sent(),[3,4];case 3:return c=o.sent(),i.Logger.error("loadQQBrowserJSSDK fail",c),[3,4];case 4:return[2,this.write(s,l)]}}))}))},e=(0,o.__decorate)([(0,o.__param)(0,c.Qw),(0,o.__param)(1,l.yg),(0,o.__param)(2,n.ICustomClipboard),(0,o.__metadata)("design:paramtypes",["function"==typeof(r=void 0!==c.Qw&&c.Qw)?r:Object,"function"==typeof(a=void 0!==l.ZM&&l.ZM)?a:Object,"function"==typeof(s=void 0!==n.CustomClipboard&&n.CustomClipboard)?s:Object])],e)}(Vo),function(t){var e,r=t.factory;e="web"===(0,i.getParameterFromUrl)(window.location.href,"copy_type")?Zo:(0,n.isSupportWXRTF)()&&!(0,n.isSupportWeDriveMini)()?$o:Zo;var o=r.inject(n.CopyInterface,(0,p.vM)(e));o&&(i.Logger.info("copy injector use class: ".concat(o.className)),o.attach()),o instanceof Vo&&(r.inject(n.ICopyParserManager,o),i.Logger.info("copy injector with ICopyParserManager"))}),ea=function(){function t(){}return t.load=function(t){this.addons.forEach((function(e){return e(t)}))},t.loadService=function(t){Dn(t)},t.loadSurface=function(t){go(t)},t.loadClipboard=function(t){ta(t),yo(t),gt(t)},t.addons=[Dn,go,ta,yo,gt],t}()}}]),"object"==typeof globalThis&&(globalThis.jsExecEndTimeStamp=Date.now(),globalThis.cachedPerformanceEntries||(globalThis.cachedPerformanceEntries=[]),globalThis.cachedPerformanceEntries.push({name:"jsExec: js/public-8624-4ffb5acb.js",entryType:"jsExec",startTime:globalThis.jsExecStartTimeStamp,endTime:globalThis.jsExecEndTimeStamp}));
//# sourceMappingURL=public-8624-4ffb5acb.js.map